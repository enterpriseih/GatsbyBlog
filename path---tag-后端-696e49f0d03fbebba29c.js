webpackJsonp([0xab171ee7afb6],{1568:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"培养 Pythonic 思维 第 1 条：查询自己使用的 Python 版本 Python 2 于 2020 年 1 月 1 日退场，到这一刻，所有的 bug 修复、安全补丁，以及特性向后移植都会停止。此后，如果你还坚持使用 Python 2，那么会面临很多不利因素，因为它不会再获得正式的维护了。深度依赖 Python 2 代码库的开发者可以考虑用 2to3（Python 预装的工具）与  six  这样的工具过渡到 Python 3。 第 2 条：遵循 PEP…",html:'<h1 id="培养-pythonic-思维"><a href="#%E5%9F%B9%E5%85%BB-pythonic-%E6%80%9D%E7%BB%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>培养 Pythonic 思维</h1>\n<h2 id="第-1-条：查询自己使用的-python-版本"><a href="#%E7%AC%AC-1-%E6%9D%A1%EF%BC%9A%E6%9F%A5%E8%AF%A2%E8%87%AA%E5%B7%B1%E4%BD%BF%E7%94%A8%E7%9A%84-python-%E7%89%88%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 1 条：查询自己使用的 Python 版本</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34509578131037168000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python --version\n\\$ python -V\n\\$ python3 --version\n\\$ python3 -V`, `34509578131037168000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python --version\n$ python -V\n$ python3 --version\n$ python3 -V</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29723070074089920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import sys\n>>> print(sys.version_info)\nsys.version_info(major=3, minor=6, micro=15, releaselevel=\'final\', serial=0)\n>>> print(sys.version)\n3.6.15 (default, Apr 20 2022, 13:05:41)\n[GCC 5.4.0 20160609]`, `29723070074089920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> <span class="token function">import</span> sys\n<span class="token operator">>></span><span class="token operator">></span> print<span class="token punctuation">(</span>sys.version_info<span class="token punctuation">)</span>\nsys.version_info<span class="token punctuation">(</span>major<span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">minor</span><span class="token operator">=</span><span class="token number">6</span>, <span class="token assign-left variable">micro</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token assign-left variable">releaselevel</span><span class="token operator">=</span><span class="token string">\'final\'</span>, <span class="token assign-left variable">serial</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> print<span class="token punctuation">(</span>sys.version<span class="token punctuation">)</span>\n<span class="token number">3.6</span>.15 <span class="token punctuation">(</span>default, Apr <span class="token number">20</span> <span class="token number">2022</span>, <span class="token number">13</span>:05:41<span class="token punctuation">)</span>\n<span class="token punctuation">[</span>GCC <span class="token number">5.4</span>.0 <span class="token number">20160609</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Python 2 于 2020 年 1 月 1 日退场，到这一刻，所有的 bug 修复、安全补丁，以及特性向后移植都会停止。此后，如果你还坚持使用 Python 2，那么会面临很多不利因素，因为它不会再获得正式的维护了。深度依赖 Python 2 代码库的开发者可以考虑用 2to3（Python 预装的工具）与 <a href="https://six.readthedocs.io/" target="_blank" rel="nofollow noreferrer noopener">six</a> 这样的工具过渡到 Python 3。</p>\n<h2 id="第-2-条：遵循-pep-8-风格指南"><a href="#%E7%AC%AC-2-%E6%9D%A1%EF%BC%9A%E9%81%B5%E5%BE%AA-pep-8-%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 2 条：遵循 PEP 8 风格指南</h2>\n<h3 id="与空白有关的建议"><a href="#%E4%B8%8E%E7%A9%BA%E7%99%BD%E6%9C%89%E5%85%B3%E7%9A%84%E5%BB%BA%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>与空白有关的建议</h3>\n<p>在 Python 中，空白（whitespace）在语法上相当重要。Python 程序员对空白字符的用法尤其在意，因为它们会影响代码的清晰程度。在这方面，大家应该遵循以下几条建议。</p>\n<ul>\n<li>用空格（space）表示缩进，而不要用制表符（tab）。</li>\n<li>和语法相关的每一层缩进都用 4 个空格表示。</li>\n<li>每行不超过 79 个字符。</li>\n<li>对于占据多行的长表达式来说，除了首行之外的其余各行都应该在通常的缩进级别之上再加 4 个空格。</li>\n<li>在同一份文件中，函数与类之间用两个空行隔开。</li>\n<li>在同一个类中，方法与方法之间用一个空行隔开。</li>\n<li>使用字典时，键与冒号之间不加空格，写在同一行的冒号和值之间应该加一个空格。</li>\n<li>给变量赋值时，赋值符号的左边和右边各加一个空格，并且只加一个空格就好。</li>\n<li>给变量的类型做注解（annotation）时，不要把变量名和冒号隔开，但在类型信息前应该有一个空格。</li>\n</ul>\n<h3 id="与命名有关的建议"><a href="#%E4%B8%8E%E5%91%BD%E5%90%8D%E6%9C%89%E5%85%B3%E7%9A%84%E5%BB%BA%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>与命名有关的建议</h3>\n<p>PEP 8 建议采用不同的方式来给 Python 代码中的各个部分命名，这样在阅读代码时，就可以根据这些名称看出它们在 Python 语言中的角色。遵循以下与命名相关的建议。</p>\n<ul>\n<li>函数、变量及属性用小写字母来拼写，各单词之间用下划线相连，例如：<code class="language-text">lowercase_underscore</code>。</li>\n<li>受保护的实例属性，用一个下划线开头，例如：<code class="language-text">_leading_underscore</code>。</li>\n<li>私有的实例属性，用两个下划线开头，例如：<code class="language-text">__double_leading_underscore</code>。</li>\n<li>类（包括异常）命名时，每个单词的首字母均大写，例如：CapitalizedWord。</li>\n<li>模块级别的常量，所有字母都大写，各单词之间用下划线相连，例如：<code class="language-text">ALL_CAPS</code>。</li>\n<li>类中的实例方法，应该把第一个参数命名为 self，用来表示该对象本身。</li>\n<li>类方法的第一个参数，应该命名为 cls，用来表示这个类本身。</li>\n</ul>\n<h3 id="与表达式和语句有关的建议"><a href="#%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E8%AF%AD%E5%8F%A5%E6%9C%89%E5%85%B3%E7%9A%84%E5%BB%BA%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>与表达式和语句有关的建议</h3>\n<p>The Zen of Python 中提到：<code class="language-text">每件事都应该有简单的做法，而且最好只有一种</code>。PEP 8 就试着运用这个理念，来规范表达式和语句的写法。</p>\n<ul>\n<li>采用行内否定，即把否定词直接写在要否定的内容前面，而不要放在整个表达式的前面，例如应该写 <code class="language-text">if a is not b</code>，而不是 <code class="language-text">if not a is b</code>。</li>\n<li>不要通过长度判断容器或序列是不是空的，例如不要通过 <code class="language-text">if len(somelist) == 0</code> 判断 somelist 是否为 <code class="language-text">[]</code> 或 <code class="language-text">&#39;&#39;</code> 等空值，而是应该采用 <code class="language-text">if not somelist</code> 这样的写法来判断，因为 Python 会把空值自动评估为 False。</li>\n<li>如果要判断容器或序列里面有没有内容（比如要判断 somelist 是否为 <code class="language-text">[1]</code> 或 <code class="language-text">&#39;hi&#39;</code> 这样非空的值），也不应该通过长度来判断，而是应该采用 <code class="language-text">if somelist</code> 语句，因为 Python 会把非空的值自动判定为 True。</li>\n<li>不要把 if 语句、for 循环、while 循环及 except 复合语句挤在一行。应该把这些语句分成多行来写，这样更加清晰。</li>\n<li>如果表达式一行写不下，可以用括号将其括起来，而且要适当地添加换行与缩进以便于阅读。多行的表达式，应该用括号括起来，而不要用 <code class="language-text">\\</code> 符号续行。</li>\n</ul>\n<h3 id="与引入有关的建议"><a href="#%E4%B8%8E%E5%BC%95%E5%85%A5%E6%9C%89%E5%85%B3%E7%9A%84%E5%BB%BA%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>与引入有关的建议</h3>\n<p>PEP 8 对于怎样在代码中引入并使用模块，给出了下面几条建议。</p>\n<ul>\n<li>import 语句（含 <code class="language-text">from x import y</code>）总是应该放在文件开头。</li>\n<li>引入模块时，总是应该使用绝对名称，而不应该根据当前模块路径来使用相对名称。例如，要引入 bar 包中的 foo 模块，应该完整地写出 <code class="language-text">from bar import foo</code>，即便当前路径为 bar 包里，也不应该简写为 <code class="language-text">import foo</code>。</li>\n<li>如果一定要用相对名称来编写 import 语句，那就应该明确地写成：<code class="language-text">from . import foo</code>。文件中的 import 语句应该按顺序划分成三个部分：首先引入标准库里的模块，然后引入第三方模块，最后引入自己的模块。属于同一个部分的 import 语句按字母顺序排列。</li>\n</ul>\n<h2 id="第-3-条：了解-bytes-与-str-的区别"><a href="#%E7%AC%AC-3-%E6%9D%A1%EF%BC%9A%E4%BA%86%E8%A7%A3-bytes-%E4%B8%8E-str-%E7%9A%84%E5%8C%BA%E5%88%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 3 条：了解 bytes 与 str 的区别</h2>\n<p>Python 有两种类型可以表示字符序列：一种是 bytes，另一种是 str。</p>\n<p>bytes 实例包含的是原始数据，即 8 位的无符号值（通常按照 ASCII 编码标准来显示）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44372754322549520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = b\'h\\x65llo\'\nprint(list(a))\nprint(a)\n\n>>>\n[104, 101, 108, 108, 111]\nb\'hello\'`, `44372754322549520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token string">b\'h\\x65llo\'</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span>\n<span class="token string">b\'hello\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>str 实例包含的是 Unicode 码点（code point，也叫作代码点），这些码点与人类语言之中的文本字符相对应。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5141211709702098000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = \'a\\u0300 propos\'\nprint(list(a))\nprint(a)\n\n>>>\n[\'a\', \'̀\', \' \', \'p\', \'r\', \'o\', \'p\', \'o\', \'s\']\nà propos`, `5141211709702098000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token string">\'a\\u0300 propos\'</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'̀\'</span><span class="token punctuation">,</span> <span class="token string">\' \'</span><span class="token punctuation">,</span> <span class="token string">\'p\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> <span class="token string">\'o\'</span><span class="token punctuation">,</span> <span class="token string">\'p\'</span><span class="token punctuation">,</span> <span class="token string">\'o\'</span><span class="token punctuation">,</span> <span class="token string">\'s\'</span><span class="token punctuation">]</span>\nà propos</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>两种不同的字符类型与 Python 中两种常见的使用情况相对应：</p>\n<ul>\n<li>开发者需要操作原始的 8 位值序列，序列里面的这些 8 位值合起来表示一个应该按 UTF-8 或其他标准编码的字符串。</li>\n<li>开发者需要操作通用的 Unicode 字符串，而不是操作某种特定编码的字符串。</li>\n</ul>\n<p>我们通常需要编写两个辅助函数，以便在这两种情况之间转换，确保输入值类型符合开发者的预期形式。</p>\n<p>第一个辅助函数接受 bytes 或 str 实例，并返回 str：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72812114614213930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def to_str(bytes_or_str):\n    if isinstance(bytes_or_str, bytes):\n        value = bytes_or_str.decode(\'utf-8\')\n    else:\n        value = bytes_or_str\n    return value # Instance of str\n\nprint(repr(to_str(b\'foo\')))\nprint(repr(to_str(\'bar\')))\n\n>>>\n\'foo\'\n\'bar\'`, `72812114614213930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">to_str</span><span class="token punctuation">(</span>bytes_or_str<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bytes_or_str<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        value <span class="token operator">=</span> bytes_or_str<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        value <span class="token operator">=</span> bytes_or_str\n    <span class="token keyword">return</span> value <span class="token comment"># Instance of str</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>to_str<span class="token punctuation">(</span><span class="token string">b\'foo\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>to_str<span class="token punctuation">(</span><span class="token string">\'bar\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token string">\'foo\'</span>\n<span class="token string">\'bar\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>第二个辅助函数也接受 bytes 或 str 实例，但它返回的是 bytes：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8257000774424638000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def to_bytes(bytes_or_str):\n    if isinstance(bytes_or_str, str):\n        value = bytes_or_str.encode(\'utf-8\')\n    else:\n        value = bytes_or_str\n    return value # Instance of bytes\n\nprint(repr(to_bytes(b\'foo\')))\nprint(repr(to_bytes(\'bar\')))\n\n>>>\nb\'foo\'\nb\'bar\'`, `8257000774424638000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">to_bytes</span><span class="token punctuation">(</span>bytes_or_str<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bytes_or_str<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        value <span class="token operator">=</span> bytes_or_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        value <span class="token operator">=</span> bytes_or_str\n    <span class="token keyword">return</span> value <span class="token comment"># Instance of bytes</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>to_bytes<span class="token punctuation">(</span><span class="token string">b\'foo\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>to_bytes<span class="token punctuation">(</span><span class="token string">\'bar\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token string">b\'foo\'</span>\n<span class="token string">b\'bar\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Python 中使用原始的 8 位值与 Unicode 字符串时，有两个问题要注意。</p>\n<p>第一个问题是，bytes 与 str 这两种类型似乎是以相同的方式工作的，但其实例并不相互兼容，所以在传递字符序列的时候必须考虑好其类型。</p>\n<p>可以用 + 操作符将 bytes 添加到 bytes，str 也可以这样。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63382730410297400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(b\'one\' + b\'two\')\nprint(\'one\' + \'two\')\n\n>>>\nb\'onetwo\'\nonetwo`, `63382730410297400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">b\'one\'</span> <span class="token operator">+</span> <span class="token string">b\'two\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'one\'</span> <span class="token operator">+</span> <span class="token string">\'two\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token string">b\'onetwo\'</span>\nonetwo</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是不能将 str 实例添加到 bytes 实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43505237872178790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`b\'one\' + \'two\'\n\n>>>\nTraceback ...\nTypeError: can\'t concat str to bytes`, `43505237872178790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token string">b\'one\'</span> <span class="token operator">+</span> <span class="token string">\'two\'</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> can\'t concat <span class="token builtin">str</span> to <span class="token builtin">bytes</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也不能将 bytes 实例添加到 str 实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16361208322494548000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\'one\' + b\'two\'\n\n>>>\nTraceback ...\nTypeError: can only concatenate str (not &quot;bytes&quot;) to str`, `16361208322494548000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token string">\'one\'</span> <span class="token operator">+</span> <span class="token string">b\'two\'</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> can only concatenate <span class="token builtin">str</span> <span class="token punctuation">(</span><span class="token keyword">not</span> <span class="token string">"bytes"</span><span class="token punctuation">)</span> to <span class="token builtin">str</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>bytes 与 bytes 之间可以用二元操作符（binary operator）来比较大小，str 与 str 之间也可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35598211674067560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`assert b\'red\' > b\'blue\'\nassert \'red\' > \'blue\'`, `35598211674067560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">assert</span> <span class="token string">b\'red\'</span> <span class="token operator">></span> <span class="token string">b\'blue\'</span>\n<span class="token keyword">assert</span> <span class="token string">\'red\'</span> <span class="token operator">></span> <span class="token string">\'blue\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是 str 实例不能与 bytes 实例比较：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44721535192454250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`assert \'red\' > b\'blue\'\n\n>>>\nTraceback ...\nTypeError: \'>\' not supported between instances of \'str\' and \'bytes\'`, `44721535192454250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">assert</span> <span class="token string">\'red\'</span> <span class="token operator">></span> <span class="token string">b\'blue\'</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> <span class="token string">\'>\'</span> <span class="token keyword">not</span> supported between instances of <span class="token string">\'str\'</span> <span class="token keyword">and</span> <span class="token string">\'bytes\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>反过来也一样，也就是说 bytes 实例不能与 str 实例比较：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23850407152874455000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`assert b\'blue\' < \'red\'\n\n>>>\nTraceback ...\nTypeError: \'<\' not supported between instances of \'bytes\' and \'str\'`, `23850407152874455000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">assert</span> <span class="token string">b\'blue\'</span> <span class="token operator">&lt;</span> <span class="token string">\'red\'</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> <span class="token string">\'&lt;\'</span> <span class="token keyword">not</span> supported between instances of <span class="token string">\'bytes\'</span> <span class="token keyword">and</span> <span class="token string">\'str\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>判断 bytes 与 str 实例是否相等，总是会评估为假（False），即便这两个实例表示的字符完全相同，它们也不相等。例如，在下面这个例子里，它们表示的字符串都相当于 ASCII 编码之中的 foo。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10698677915058985000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(b\'foo\' == \'foo\')\n\n>>>\nFalse`, `10698677915058985000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">b\'foo\'</span> <span class="token operator">==</span> <span class="token string">\'foo\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>两种类型的实例都可以出现在 % 操作符的右侧，用来替换左侧那个格式字符串（format string）里面的 %s。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91039764108660410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(b\'red %s\' % b\'blue\')\nprint(\'red %s\' % \'blue\')\n\n>>>\nb\'red blue\'\nred blue`, `91039764108660410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">b\'red %s\'</span> <span class="token operator">%</span> <span class="token string">b\'blue\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'red %s\'</span> <span class="token operator">%</span> <span class="token string">\'blue\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token string">b\'red blue\'</span>\nred blue</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果格式字符串是 bytes 类型，那么不能用 str 实例来替换其中的 %s，因为 Python 不知道这个 str 应该按照什么方案来编码。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36694646511266570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(b\'red %s\' % \'blue\')\n\n>>>\nTraceback ...\nTypeError: %b requires a bytes-like object, or an object that implements _bytes_, not \'str\'`, `36694646511266570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">b\'red %s\'</span> <span class="token operator">%</span> <span class="token string">\'blue\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> <span class="token operator">%</span>b requires a <span class="token builtin">bytes</span><span class="token operator">-</span>like <span class="token builtin">object</span><span class="token punctuation">,</span> <span class="token keyword">or</span> an <span class="token builtin">object</span> that implements _bytes_<span class="token punctuation">,</span> <span class="token keyword">not</span> <span class="token string">\'str\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但反过来却可以，也就是说如果格式字符串是 str 类型，则可以用 bytes 实例来替换其中的 %s，问题是这可能跟你想要的结果不一样。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65318078023469800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(\'red %s\' % b\'blue\')\n\n>>>\nred b\'blue\'`, `65318078023469800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'red %s\'</span> <span class="token operator">%</span> <span class="token string">b\'blue\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nred <span class="token string">b\'blue\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样做，会让系统在 bytes 实例上面调用 <code class="language-text">__repr__</code> 方法（参见第 75 条），然后用这次调用所得到的结果替换格式字符串里的 %s，因此程序会直接输出 <code class="language-text">b&#39;blue&#39;</code>，而不是像你想的那样，输出 blue 本身。</p>\n<p>第二个问题发生在操作文件句柄的时候，这里的句柄指由内置的 open 函数返回的句柄。这样的句柄默认需要使用 Unicode 字符串操作，而不能采用原始的 bytes。习惯了 Python 2 的开发者，尤其容易碰到这个问题，进而导致程序出现奇怪的错误。例如，向文件写入二进制数据的时候，下面这种写法其实是错误的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63376991435167510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'data.bin\', \'w\') as f:\n   f.write(b\'\\xf1\\xf2\\xf3\\xf4\\xf5\')\n\n>>>\nTraceback ...\nTypeError: write() argument must be str, not bytes`, `63376991435167510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data.bin\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n   f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b\'\\xf1\\xf2\\xf3\\xf4\\xf5\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> write<span class="token punctuation">(</span><span class="token punctuation">)</span> argument must be <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token keyword">not</span> <span class="token builtin">bytes</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>程序发生异常是因为在调用 open 函数时，指定的是 <code class="language-text">&#39;w&#39;</code> 模式，所以系统要求必须以文本模式写入。如果想用二进制模式，那应该指定 <code class="language-text">&#39;wb&#39;</code> 才对。在文本模式下，write 方法接受的是包含 Unicode 数据的 str 实例，不是包含二进制数据的 bytes 实例。所以，我们得把模式改成 <code class="language-text">&#39;wb&#39;</code> 来解决该问题。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7857182268787044000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'data.bin\', \'wb\') as f:\n   f.write(b\'\\xf1\\xf2\\xf3\\xf4\\xf5\')`, `7857182268787044000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data.bin\'</span><span class="token punctuation">,</span> <span class="token string">\'wb\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n   f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b\'\\xf1\\xf2\\xf3\\xf4\\xf5\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>读取文件的时候也有类似的问题。例如，如果要把刚才写入的二进制文件读出来，那么不能用下面这种写法，同样需要改成 <code class="language-text">&#39;rb&#39;</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95986408340666070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'data.bin\', \'r\') as f:\n   data = f.read()\n\n>>>\nTraceback ...\nUnicodeDecodeError: \'utf-8\' codec can\'t decode byte 0xf1 in position 0: invalid continuation byte`, `95986408340666070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data.bin\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n   data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nUnicodeDecodeError<span class="token punctuation">:</span> <span class="token string">\'utf-8\'</span> codec can\'t decode byte <span class="token number">0xf1</span> <span class="token keyword">in</span> position <span class="token number">0</span><span class="token punctuation">:</span> invalid continuation byte</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另一种改法是在调用 open 函数的时候，通过 encoding 参数明确指定编码标准，以确保平台特有的一些行为不会干扰代码的运行效果。例如，假设刚才写到文件里的那些二进制数据表示的是一个采用 ‘cp1252’ 标准（cp1252 是一种老式的 Windows 编码方案）来编码的字符串，则可以这样写</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44285277295649550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'data.bin\', \'r\', encoding=\'cp1252\') as f:\n   data f.read()\n\nassert data == \'ioooδ\'`, `44285277295649550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data.bin\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">\'cp1252\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n   data f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">assert</span> data <span class="token operator">==</span> <span class="token string">\'ioooδ\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样程序就不会出现异常了，但返回的字符串也与读取原始字节数据所返回的有很大区别。通过这个例子，我们要提醒自己注意当前操作系统默认的编码标准（可以执行 <code class="language-text">python3 -c &#39;import locale; print(locale.getpreferredencoding())&#39;</code> 命令查看），了解它与你所期望的是否一致。如果不确定，那就在调用 open 时明确指定 encoding 参数。</p>\n<h2 id="第-4-条：用支持插值的-f-string-取代-c-风格的格式字符串与-strformat-方法"><a href="#%E7%AC%AC-4-%E6%9D%A1%EF%BC%9A%E7%94%A8%E6%94%AF%E6%8C%81%E6%8F%92%E5%80%BC%E7%9A%84-f-string-%E5%8F%96%E4%BB%A3-c-%E9%A3%8E%E6%A0%BC%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E-strformat-%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 4 条：用支持插值的 f-string 取代 C 风格的格式字符串与 str.format 方法</h2>\n<p>Python 里面最常用的字符串格式化方式是采用 % 格式化操作符。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52906928169665890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = 0b10111011\nb = 0xc5f\nprint(\'Binary is %d, hex is %d\' % (a, b))\n\n>>>\nBinary is 187, hex is 3167`, `52906928169665890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token number">0b10111011</span>\nb <span class="token operator">=</span> <span class="token number">0xc5f</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Binary is %d, hex is %d\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nBinary <span class="token keyword">is</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token builtin">hex</span> <span class="token keyword">is</span> <span class="token number">3167</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是 C 风格的格式字符串，在 Python 里有四个缺点。</p>\n<ol>\n<li>\n<p>如果 % 右侧那个元组里面的值在类型或顺序上有变化，那么程序可能会因为转换类型时发生不兼容问题而出现错误。例如，下面这个简单的格式化表达式是正确的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54509061172071550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\nformatted = \'%-10s = %.2f\' % (key, value)\nprint(formatted)\n\n>>>\nmy_var     = 1.23`, `54509061172071550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\nformatted <span class="token operator">=</span> <span class="token string">\'%-10s = %.2f\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nmy_var     <span class="token operator">=</span> <span class="token number">1.23</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但如果把 key 跟 value 互换位置，那么程序就会在运行时出现异常。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59485060736043980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`reordered_tuple = \'%-10s = %.2f\' % (value, key)\n\n>>>\nTraceback ...\nTypeError: must be real number, not str`, `59485060736043980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">reordered_tuple <span class="token operator">=</span> <span class="token string">\'%-10s = %.2f\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> must be real number<span class="token punctuation">,</span> <span class="token keyword">not</span> <span class="token builtin">str</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 % 右侧的写法不变，但左侧那个格式字符串里面的两个说明符对调了顺序，那么程序同样会发生这个错误。</p>\n</li>\n<li>\n<p>在填充模板之前，经常要先对准备填写进去的这个值稍微做一些处理，但这样一来，整个表达式可能就会写得很长，让人觉得比较混乱。下面这段代码用来罗列厨房里的各种食材，现在的这种写法并没有对填入格式字符串里面的那三个值（也就是食材的编号 i、食材的名称 item，以及食材的数量 count）预先做出调整。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9950924613475754000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pantry = [\n  (\'avocados\', 1.25),\n  (\'bananas\', 2.5),\n  (\'cherries\', 15),\n]\n\nfor i, (item, count) in enumerate(pantry):\n  print(\'#%d: %-10s = %.2f\' % (i, item, count))\n\n>>>\n#0: avocados   = 1.25\n#1: bananas    = 2.50\n#2: cherries   = 15.00`, `9950924613475754000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pantry <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token punctuation">(</span><span class="token string">\'avocados\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">(</span><span class="token string">\'bananas\'</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">(</span><span class="token string">\'cherries\'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pantry<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'#%d: %-10s = %.2f\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> item<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token comment">#0: avocados   = 1.25</span>\n<span class="token comment">#1: bananas    = 2.50</span>\n<span class="token comment">#2: cherries   = 15.00</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果想让打印出来的信息更好懂，那可能得把这几个值稍微调整一下，但是调整之后，% 操作符右侧的那个三元组就特别长，所以需要多行拆分才能写得下，这会影响程序的可读性。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99408811174002670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pantry = [\n  (\'avocados\', 1.25),\n  (\'bananas\', 2.5),\n  (\'cherries\', 15),\n]\n\nfor i, (item, count) in enumerate(pantry):\n  print(\'#%d: %-10s = %d\' % (\n     i + 1,\n     item.title(),\n     round(count)))\n\n>>>\n#1: Avocados   = 1\n#2: Bananas    = 2\n#3: Cherries   = 15`, `99408811174002670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pantry <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token punctuation">(</span><span class="token string">\'avocados\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">(</span><span class="token string">\'bananas\'</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">(</span><span class="token string">\'cherries\'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pantry<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'#%d: %-10s = %d\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>\n     i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>\n     item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n     <span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token comment">#1: Avocados   = 1</span>\n<span class="token comment">#2: Bananas    = 2</span>\n<span class="token comment">#3: Cherries   = 15</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>如果想用同一个值来填充格式字符串里的多个位置，那么必须在 % 操作符右侧的元组中相应地多次重复该值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36960786946544450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`template = \'%s loves food. See %s cook.\'\nname = \'Max\'\nformatted = template % (name, name)\nprint(formatted)\n\n>>>\nMax loves food. See Max cook.`, `36960786946544450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">template <span class="token operator">=</span> <span class="token string">\'%s loves food. See %s cook.\'</span>\nname <span class="token operator">=</span> <span class="token string">\'Max\'</span>\nformatted <span class="token operator">=</span> template <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> name<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nMax loves food<span class="token punctuation">.</span> See Max cook<span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果想在填充之前把这个值修改一下，那么必须同时修改多处才行，这尤其烦人，且容易出错。例如，如果这次要填的不是 name 而是 name.title()，那就必须提醒自己，要把所有的 name 都改成 name.title()。若是有的地方改了，有的地方没改，那输出的信息可能就不一致了。</p>\n<p>为了解决上面提到的一些问题，Python 的 % 操作符允许我们用 dict 取代 tuple，这样的话，我们就可以让格式字符串里面的说明符与 dict 里面的键以相应的名称对应起来，例如 %(key)s 这个说明符，意思就是用字符串（s）来表示 dict 里面名为 key 的那个键所保存的值。下面通过这种办法解决刚才讲的第一个缺点，也就是 % 操作符两侧的顺序不匹配问题。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50466133598765285000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\nold_way = \'%-10s = %.2f\' % (key, value)\n\nnew_way = \'%(key)-10s = %(value).2f\' % {\n  \'key\': key, \'value\': value}  # Original\n\nreordered = \'%(key)-10s = %(value).2f\' % {\n  \'value\': value, \'key\': key}  # Swapped\n\nassert old_way == new_way == reordered`, `50466133598765285000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\nold_way <span class="token operator">=</span> <span class="token string">\'%-10s = %.2f\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n\nnew_way <span class="token operator">=</span> <span class="token string">\'%(key)-10s = %(value).2f\'</span> <span class="token operator">%</span> <span class="token punctuation">{</span>\n  <span class="token string">\'key\'</span><span class="token punctuation">:</span> key<span class="token punctuation">,</span> <span class="token string">\'value\'</span><span class="token punctuation">:</span> value<span class="token punctuation">}</span>  <span class="token comment"># Original</span>\n\nreordered <span class="token operator">=</span> <span class="token string">\'%(key)-10s = %(value).2f\'</span> <span class="token operator">%</span> <span class="token punctuation">{</span>\n  <span class="token string">\'value\'</span><span class="token punctuation">:</span> value<span class="token punctuation">,</span> <span class="token string">\'key\'</span><span class="token punctuation">:</span> key<span class="token punctuation">}</span>  <span class="token comment"># Swapped</span>\n\n<span class="token keyword">assert</span> old_way <span class="token operator">==</span> new_way <span class="token operator">==</span> reordered</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种写法还可以解决刚才讲的第三个缺点，也就是用同一个值替换多个格式说明符的问题。改用这种写法之后，我们就不用在 % 操作符右侧重复这个值了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87552443074229580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`name = \'Max\'\ntemplate = \'%s loves food .See %s cook.\'\nbefore = template % (name, name)  # Tuple\ntemplate = \'%(name)s loves food .See %(name)s cook.\'\nafter = template % {\'name\': name}  # Dictionary\nassert before == after`, `87552443074229580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">name <span class="token operator">=</span> <span class="token string">\'Max\'</span>\ntemplate <span class="token operator">=</span> <span class="token string">\'%s loves food .See %s cook.\'</span>\nbefore <span class="token operator">=</span> template <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> name<span class="token punctuation">)</span>  <span class="token comment"># Tuple</span>\ntemplate <span class="token operator">=</span> <span class="token string">\'%(name)s loves food .See %(name)s cook.\'</span>\nafter <span class="token operator">=</span> template <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">\'name\'</span><span class="token punctuation">:</span> name<span class="token punctuation">}</span>  <span class="token comment"># Dictionary</span>\n<span class="token keyword">assert</span> before <span class="token operator">==</span> after</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，这种写法会让刚才讲的第二个缺点变得更加严重，因为字典格式字符串的引入，我们必须给每一个值都定义键名，而且要在键名的右侧加冒号，格式化表达式变得更加冗长，看起来也更加混乱。我们把不采用 dict 的写法与采用 dict 的写法对比一下，可以更明确地意识到这种写法的缺点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91817408320117400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pantry = [\n(\'avocados\', 1.25),\n(\'bananas\', 2.5),\n(\'cherries\', 15),\n]\n\nfor i, (item, count) in enumerate(pantry):\n  before = \'#%d: %-10s = %d\' % (\n     i + 1,\n     item.title(),\n     round(count)\n  )\n  after = \'#%(loop)d: %(item)-10s = %(count)d\' % {\n     \'loop\': i + 1,\n     \'item\': item.title(),\n     \'count\': round(count),\n  }\n\n  assert before == after`, `91817408320117400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pantry <span class="token operator">=</span> <span class="token punctuation">[</span>\n<span class="token punctuation">(</span><span class="token string">\'avocados\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">(</span><span class="token string">\'bananas\'</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">(</span><span class="token string">\'cherries\'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pantry<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  before <span class="token operator">=</span> <span class="token string">\'#%d: %-10s = %d\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>\n     i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>\n     item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n     <span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n  <span class="token punctuation">)</span>\n  after <span class="token operator">=</span> <span class="token string">\'#%(loop)d: %(item)-10s = %(count)d\'</span> <span class="token operator">%</span> <span class="token punctuation">{</span>\n     <span class="token string">\'loop\'</span><span class="token punctuation">:</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>\n     <span class="token string">\'item\'</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n     <span class="token string">\'count\'</span><span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">assert</span> before <span class="token operator">==</span> after</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>把 dict 写到格式化表达式里面会让代码变多。每个键都至少要写两次：一次是在格式说明符中，还有一次是在字典中作为键，另外，定义字典的时候，可能还要专门用一个变量来表示这个键所对应的值，而且这个变量的名称或许也和键名相同，这样算下来就是三次了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64624119655935860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`soup = \'lentil\'\nformatted = \'Today\\\'s soup is %(soup)s.\' % {\'soup\': soup}\nprint(formatted)\n\n>>>\nToday\'s soup is lentil.`, `64624119655935860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">soup <span class="token operator">=</span> <span class="token string">\'lentil\'</span>\nformatted <span class="token operator">=</span> <span class="token string">\'Today\\\'s soup is %(soup)s.\'</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">\'soup\'</span><span class="token punctuation">:</span> soup<span class="token punctuation">}</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nToday\'s soup <span class="token keyword">is</span> lentil<span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>除了要反复写键名，在格式化表达式里面使用 dict 的办法还会让表达式变得特别长，通常必须拆分为多行来写，同时，为了与格式字符串的多行写法相对应，定义字典的时候，也要一行一行地给每个键设定对应的值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12078944742507436000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`menu = {\n\'soup\': \'lentil\',\n\'oyster\': \'kumamoto\',\n\'special\': \'schnitzel\',\n}\n\ntemplate = (\'Today\\\'s soup is %(soup)s, \'\n           \'buy one get two %(oyster)s oysters, \'\n           \'and our special entree is %(special)s.\')\nformatted = template % menu\nprint(formatted)\n\n>>>\nToday\'s soup is lentil, buy one get two kumamoto oysters, and our special entree is schnitzel.`, `12078944742507436000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">menu <span class="token operator">=</span> <span class="token punctuation">{</span>\n<span class="token string">\'soup\'</span><span class="token punctuation">:</span> <span class="token string">\'lentil\'</span><span class="token punctuation">,</span>\n<span class="token string">\'oyster\'</span><span class="token punctuation">:</span> <span class="token string">\'kumamoto\'</span><span class="token punctuation">,</span>\n<span class="token string">\'special\'</span><span class="token punctuation">:</span> <span class="token string">\'schnitzel\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\ntemplate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'Today\\\'s soup is %(soup)s, \'</span>\n           <span class="token string">\'buy one get two %(oyster)s oysters, \'</span>\n           <span class="token string">\'and our special entree is %(special)s.\'</span><span class="token punctuation">)</span>\nformatted <span class="token operator">=</span> template <span class="token operator">%</span> menu\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nToday\'s soup <span class="token keyword">is</span> lentil<span class="token punctuation">,</span> buy one get two kumamoto oysters<span class="token punctuation">,</span> <span class="token keyword">and</span> our special entree <span class="token keyword">is</span> schnitzel<span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了查看格式字符串中的说明符究竟对应于字典里的哪个键，必须在这两段代码之间来回跳跃，这会令人难以发现其中的 bug。如果要对键名稍做修改，那么必须同步修改格式字符串里的说明符，这更让代码变得相当烦琐，可读性更差。</p>\n</li>\n</ol>\n<h3 id="内置的-format-函数与-str-类的-format-方法"><a href="#%E5%86%85%E7%BD%AE%E7%9A%84-format-%E5%87%BD%E6%95%B0%E4%B8%8E-str-%E7%B1%BB%E7%9A%84-format-%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内置的 format 函数与 str 类的 format 方法</h3>\n<p>Python 3 添加了高级字符串格式化（advanced string formatting）机制，它的表达能力比老式 C 风格的格式字符串要强，且不再使用 % 操作符。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3911190498568850400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = 1234.5678\nformatted = format(a, \',.2f\')\nprint(formatted)\nb = \'my string\'\nformatted = format(b, \'^20s\')\nprint(\'*\', formatted, \'*\')\n\n>>>\n1,234.57\n*      my string       *`, `3911190498568850400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token number">1234.5678</span>\nformatted <span class="token operator">=</span> <span class="token builtin">format</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">\',.2f\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\nb <span class="token operator">=</span> <span class="token string">\'my string\'</span>\nformatted <span class="token operator">=</span> <span class="token builtin">format</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token string">\'^20s\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'*\'</span><span class="token punctuation">,</span> formatted<span class="token punctuation">,</span> <span class="token string">\'*\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">234.57</span>\n<span class="token operator">*</span>      my string       <span class="token operator">*</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85982644061914270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\n\nformatted = \'{} = {}\'.format(key, value)\nprint(formatted)\n\n>>>\nmy_var = 1.234`, `85982644061914270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\n\nformatted <span class="token operator">=</span> <span class="token string">\'{} = {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nmy_var <span class="token operator">=</span> <span class="token number">1.234</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可以在 {} 里写个冒号，然后把格式说明符写在冒号的右边，用以规定 format 方法所接收的这个值应该按照怎样的格式来调整。在 Python 解释器里输入 help(‘FORMATTING’)，可以详细查看 str.format 使用的这套格式说明符所依据的规则。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42673595287461310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\n\nformatted = \'{:<10} = {:.2f}\'.format(key, value)\nprint(formatted)\n\n>>>\nmy_var     = 1.23`, `42673595287461310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\n\nformatted <span class="token operator">=</span> <span class="token string">\'{:&lt;10} = {:.2f}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nmy_var     <span class="token operator">=</span> <span class="token number">1.23</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行过程：系统先把 str.format 方法接收到的每个值传给内置的 format 函数，并找到这个值在字符串里对应的 {}，同时将 {} 里面写的格式也传给 format 函数，例如系统在处理 value 的时候，传的就是 format(value, ‘.2f’)。然后，系统会把 format 函数所返回的结果写在整个格式化字符串 {} 所在的位置。另外，每个类都可以通过 <code class="language-text">__format__</code> 这个特殊的方法定制相应的逻辑，这样的话，format 函数在把该类实例转换成字符串时，就会按照这种逻辑来转换。</p>\n<p>C 风格的格式字符串采用 % 操作符来引导格式说明符，所以如果要将这个符号照原样输出，那就必须转义，也就是连写两个 %。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34420172429927210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(\'%.2f%%\' % 12.5)\nprint(\'{} replaces {{}}\'.format(1.23))\n\n>>>\n12.50%\n1.23 replaces {}`, `34420172429927210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%.2f%%\'</span> <span class="token operator">%</span> <span class="token number">12.5</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'{} replaces {{}}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">12.50</span><span class="token operator">%</span>\n<span class="token number">1.23</span> replaces <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用 str.format 方法的时候，也可以给 str 的 {} 里面写上数字，用来指代 format 方法在这个位置所接收到的参数值位置索引。以后即使这些 {} 在格式字符串中的次序有所变动，也不用调换传给 format 方法的那些参数。于是，这就避免了前面讲的第一个缺点所提到的那个顺序问题。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77254670575313650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\n\nformatted = \'{1} = {0}\'.format(key, value)\nprint(formatted)\n\n>>>\n1.234 = my_var`, `77254670575313650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\n\nformatted <span class="token operator">=</span> <span class="token string">\'{1} = {0}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1.234</span> <span class="token operator">=</span> my_var</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同一个位置索引可以出现在 str 的多个 {} 里面，这些 {} 指代的都是 format 方法在对应位置所收到的值。这就不需要把这个值重复地传给 format 方法，于是就解决了前面提到的第三个缺点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63305882134138080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`name = \'Max\'\nformatted = \'{0} loves food. See {0} cook.\'.format(name)\nprint(formatted)\n\n>>>\nMax loves food. See Max cook.`, `63305882134138080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">name <span class="token operator">=</span> <span class="token string">\'Max\'</span>\nformatted <span class="token operator">=</span> <span class="token string">\'{0} loves food. See {0} cook.\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nMax loves food<span class="token punctuation">.</span> See Max cook<span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而，这个新的 str.format 方法并没有解决上面讲的第二个缺点。如果在对值做填充之前要先对这个值做出调整，那么用这种方法写出来的代码还是跟原来一样乱，阅读性差。把原来那种写法和现在的新写法对比一下，大家就会看到新写法并不比原来好多少。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65212049712455040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pantry = [\n    (\'avocados\', 1.25),\n    (\'bananas\', 2.5),\n    (\'cherries\', 15),\n]\n\nfor i, (item, count) in enumerate(pantry):\n    old_style = \'#%d: %-10s = %d\' % (\n        i + 1,\n        item.title(),\n        round(count))\n    new_style = \'#{}: {:<10s} = {}\'.format(\n        i + 1,\n        item.title(),\n        round(count))\n    assert old_style == new_style`, `65212049712455040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pantry <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token string">\'avocados\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'bananas\'</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'cherries\'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pantry<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    old_style <span class="token operator">=</span> <span class="token string">\'#%d: %-10s = %d\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>\n        i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>\n        item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    new_style <span class="token operator">=</span> <span class="token string">\'#{}: {:&lt;10s} = {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>\n        i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>\n        item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">assert</span> old_style <span class="token operator">==</span> new_style</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然，这种 {} 形式的说明符，还支持一些比较高级的用法，例如可以查询 dict 中某个键的值，可以访问 list 里某个位置的元素，还可以把值转化成 Unicode 或 repr 字符串。下面这段代码把这三项特性结合了起来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12717748566600618000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`menu = {\n    \'soup\': \'lentil\',\n    \'oyster\': \'kumamoto\',\n    \'special\': \'schnitzel\',\n}\n\nformatted = \'First letter is {menu[oyster][0]!r}\'.format(\n    menu=menu)\nprint(formatted)\n\n>>>\nFirst letter is \'k\'`, `12717748566600618000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">menu <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'soup\'</span><span class="token punctuation">:</span> <span class="token string">\'lentil\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'oyster\'</span><span class="token punctuation">:</span> <span class="token string">\'kumamoto\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'special\'</span><span class="token punctuation">:</span> <span class="token string">\'schnitzel\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\nformatted <span class="token operator">=</span> <span class="token string">\'First letter is {menu[oyster][0]!r}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>\n    menu<span class="token operator">=</span>menu<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFirst letter <span class="token keyword">is</span> <span class="token string">\'k\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是这些特性，依然不能解决前面提到的第四个缺点，也就是键名需要多次重复的那个问题。下面把 C 风格的格式化表达式与新的 str.format 方法对比一下，看看这两种写法在处理键值对形式的数据时有什么区别。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60946429639298376000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`old_template = (\n    \'Today\\\'s soup is %(soup)s, \'\n    \'buy one get two %(oyster)s oysters, \'\n    \'and our special entree is %(special)s.\')\nold_formatted = old_template % {\n    \'soup\': \'lentil\',\n    \'oyster\': \'kumamoto\',\n    \'special\': \'schnitzel\',\n}\n\nnew_template = (\n    \'Today\\\'s soup is {soup}, \'\n    \'buy one get two {oyster} oysters, \'\n    \'and our special entree is {special}.\')\nnew_formatted = new_template.format(\n    soup=\'lentil\',\n    oyster=\'kumamoto\',\n    special=\'schnitzel\',\n)\n\nassert old_formatted == new_formatted`, `60946429639298376000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">old_template <span class="token operator">=</span> <span class="token punctuation">(</span>\n    <span class="token string">\'Today\\\'s soup is %(soup)s, \'</span>\n    <span class="token string">\'buy one get two %(oyster)s oysters, \'</span>\n    <span class="token string">\'and our special entree is %(special)s.\'</span><span class="token punctuation">)</span>\nold_formatted <span class="token operator">=</span> old_template <span class="token operator">%</span> <span class="token punctuation">{</span>\n    <span class="token string">\'soup\'</span><span class="token punctuation">:</span> <span class="token string">\'lentil\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'oyster\'</span><span class="token punctuation">:</span> <span class="token string">\'kumamoto\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'special\'</span><span class="token punctuation">:</span> <span class="token string">\'schnitzel\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\nnew_template <span class="token operator">=</span> <span class="token punctuation">(</span>\n    <span class="token string">\'Today\\\'s soup is {soup}, \'</span>\n    <span class="token string">\'buy one get two {oyster} oysters, \'</span>\n    <span class="token string">\'and our special entree is {special}.\'</span><span class="token punctuation">)</span>\nnew_formatted <span class="token operator">=</span> new_template<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>\n    soup<span class="token operator">=</span><span class="token string">\'lentil\'</span><span class="token punctuation">,</span>\n    oyster<span class="token operator">=</span><span class="token string">\'kumamoto\'</span><span class="token punctuation">,</span>\n    special<span class="token operator">=</span><span class="token string">\'schnitzel\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">)</span>\n\n<span class="token keyword">assert</span> old_formatted <span class="token operator">==</span> new_formatted</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>新写法稍微好一点儿，因为它不用定义 dict 了，所以不需要把键名用 <code class="language-text">&#39; &#39;</code> 给括起来。它的说明符也比旧写法的说明符要简单一些。然而这些优点并不突出。另外，虽然我们在新写法里面，可以访问字典中的键，也可以访问列表中的元素，但这些功能只涵盖了 Python 表达式的一小部分特性，str.format 方法还是没有能够把 Python 表达式的优势充分发挥出来。</p>\n<h3 id="插值格式字符串"><a href="#%E6%8F%92%E5%80%BC%E6%A0%BC%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>插值格式字符串</h3>\n<p>Python 3.6 添加了一种新的特性，叫作插值格式字符串（interpolatedformat string，简称 f-string），可以解决上面提到的所有问题。新语法特性要求在格式字符串的前面加字母 f 作为前缀，这跟字母 b 与字母 r 的用法类似，也就是分别表示字节形式的字符串与原始的（或者说未经转义的）字符串的前缀。</p>\n<p>f-string 把格式字符串的表达能力发挥到了极致，它彻底解决了上文提到的第四个缺点，也就是键名重复导致的程序冗余问题。我们不用再像使用 C 风格格式表达式时那样专门定义 dict，也不用再像调用 str.format 方法时那样专门把值传给某个参数，这次可以直接在 f-string 的 {} 里面引用当前 Python 范围内的所有名称，进而达到简化的目的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66735268311296990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\n\nformatted = f\'{key} = {value}\'\nprint(formatted)\n\n>>>\nmy_var = 1.234`, `66735268311296990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\n\nformatted <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">\'</span></span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nmy_var <span class="token operator">=</span> <span class="token number">1.234</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>str.format 方法所支持的那套迷你语言，也就是在 {} 内的冒号右侧所采用的那套规则，现在也可以用到 f-string 里面，而且还可以像早前使用 str.format 时那样，通过 ! 符号把值转化成 Unicode 及 repr 形式的字符串。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10948086449371664000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\n\nformatted = f\'{key!r:<10} = {value:.2f}\'\nprint(formatted)\n\n>>>\n\'my_var\'   = 1.23`, `10948086449371664000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\n\nformatted <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token conversion-option punctuation">!r</span><span class="token punctuation">:</span><span class="token format-spec">&lt;10</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token string">\'my_var\'</span>   <span class="token operator">=</span> <span class="token number">1.23</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同一个问题，使用 f-string 来解决总是比通过 % 操作符使用 C 风格的格式字符串简单，而且也比 str.format 方法简单。下面按照从短到长的顺序把这几种写法所占的篇幅对比一下，每种写法里面的那个赋值符号（=）左侧都对齐到同一个位置，这样很容易看出符号右边的代码到底有多少。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17260339583317940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`key = \'my_var\'\nvalue = 1.234\n\nf_string = f\'{key:<10} = {value:.2f}\'\nc_tuple = \'%-10s = %.2f\' % (key, value)\nstr_args = \'{:<10} = {:.2f}\'.format(key, value)\nstr_kw = \'{key:<10} = {value:.2f}\'.format(key=key,\n                                          value=value)\nc_dict = \'%(key)-10s = %(value).2f\' % {\'key\': key,\n                                       \'value\': value}\nassert c_tuple == c_dict == f_string\nassert str_args == str_kw == f_string`, `17260339583317940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">key <span class="token operator">=</span> <span class="token string">\'my_var\'</span>\nvalue <span class="token operator">=</span> <span class="token number">1.234</span>\n\nf_string <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">:</span><span class="token format-spec">&lt;10</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span>\nc_tuple <span class="token operator">=</span> <span class="token string">\'%-10s = %.2f\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\nstr_args <span class="token operator">=</span> <span class="token string">\'{:&lt;10} = {:.2f}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\nstr_kw <span class="token operator">=</span> <span class="token string">\'{key:&lt;10} = {value:.2f}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token operator">=</span>key<span class="token punctuation">,</span>\n                                          value<span class="token operator">=</span>value<span class="token punctuation">)</span>\nc_dict <span class="token operator">=</span> <span class="token string">\'%(key)-10s = %(value).2f\'</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">\'key\'</span><span class="token punctuation">:</span> key<span class="token punctuation">,</span>\n                                       <span class="token string">\'value\'</span><span class="token punctuation">:</span> value<span class="token punctuation">}</span>\n<span class="token keyword">assert</span> c_tuple <span class="token operator">==</span> c_dict <span class="token operator">==</span> f_string\n<span class="token keyword">assert</span> str_args <span class="token operator">==</span> str_kw <span class="token operator">==</span> f_string</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 f-string 方法中，各种 Python 表达式都可以出现在 {} 里，于是这就解决了前面提到的第二个缺点。我们现在可以用相当简洁的写法对需要填充到字符串里面的值做出微调。C 风格的写法与采用 str.format 方法的写法可能会让表达式变得很长，但如果改用 f-string，或许一行就能写完。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80160292745710290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pantry = [\n    (\'avocados\', 1.25),\n    (\'bananas\', 2.5),\n    (\'cherries\', 15),\n]\n\nfor i, (item, count) in enumerate(pantry):\n    old_style = \'#%d: %-10s = %d\' % (\n        i + 1,\n        item.title(),\n        round(count))\n    new_style = \'#{}: {:<10s} = {}\'.format(\n        i + 1,\n        item.title(),\n        round(count))\n    f_string = f\'#{i + 1}: {item.title():<10s} = {round(count)}\'\n    assert old_style == new_style == f_string`, `80160292745710290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pantry <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token string">\'avocados\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'bananas\'</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'cherries\'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pantry<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    old_style <span class="token operator">=</span> <span class="token string">\'#%d: %-10s = %d\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>\n        i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>\n        item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    new_style <span class="token operator">=</span> <span class="token string">\'#{}: {:&lt;10s} = {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>\n        i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>\n        item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    f_string <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f\'#</span><span class="token interpolation"><span class="token punctuation">{</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">&lt;10s</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span>\n    <span class="token keyword">assert</span> old_style <span class="token operator">==</span> new_style <span class="token operator">==</span> f_string</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要是想表达得更清楚一些，可以把 f-string 写成多行的形式，类似于 C 语言的相邻字符串拼接（adjacent-string concatenation）。这样写虽然比单行的 f-string 要长，但仍然好过另外那两种多行的写法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93295261990031020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pantry = [\n    (\'avocados\', 1.25),\n    (\'bananas\', 2.5),\n    (\'cherries\', 15),\n]\n\nfor i, (item, count) in enumerate(pantry):\n    f_string = (\n        f\'# {i + 1}: \'\n        f\'{item.title():<10s} = \'\n        f\'{round(count)}\'\n    )\n    print(f_string)\n\n>>>\n# 1: Avocados   = 1\n# 2: Bananas    = 2\n# 3: Cherries   = 15`, `93295261990031020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pantry <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token string">\'avocados\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'bananas\'</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'cherries\'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pantry<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    f_string <span class="token operator">=</span> <span class="token punctuation">(</span>\n        <span class="token string-interpolation"><span class="token string">f\'# </span><span class="token interpolation"><span class="token punctuation">{</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">: \'</span></span>\n        <span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">&lt;10s</span><span class="token punctuation">}</span></span><span class="token string"> = \'</span></span>\n        <span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">round</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span>\n    <span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>f_string<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token comment"># 1: Avocados   = 1</span>\n<span class="token comment"># 2: Bananas    = 2</span>\n<span class="token comment"># 3: Cherries   = 15</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Python 表达式也可以出现在格式说明符中。例如，下面的代码把小数点之后的位数用变量来表示，然后把这个变量的名字 places 用 {} 括起来放到格式说明符中，这样写比采用硬代码更灵活。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91953673437802360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`places = 3\nnumber = 1.23456\nprint(f\'My number is {number:.{places}f}\')\n\n>>>\nMy number is 1.235`, `91953673437802360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">places <span class="token operator">=</span> <span class="token number">3</span>\nnumber <span class="token operator">=</span> <span class="token number">1.23456</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'My number is </span><span class="token interpolation"><span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">{</span>places<span class="token punctuation">}</span>f<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nMy number <span class="token keyword">is</span> <span class="token number">1.235</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Python 内置的四种字符串格式化办法里面，f-string 可以简洁而清晰地表达出许多种逻辑，这使它成为程序员的最佳选择。如果你想把值以适当的格式填充到字符串里面，那么首先应该考虑的就是采用 f-string 来实现。</p>\n<h3 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>采用 % 操作符把值填充到 C 风格的格式字符串时会遇到许多问题，而且这种写法比较烦琐。</li>\n<li>str.format 方法专门用一套迷你语言来定义它的格式说明符，这套语言给我们提供了一些有用的概念，但是在其他方面，这个方法还是存在与 C 风格的格式字符串一样的多种缺点，所以我们也应该避免使用它。</li>\n<li>f-string 采用新的写法，将值填充到字符串之中，解决了 C 风格的格式字符串所带来的最大问题。f-string 是个简洁而强大的机制，可以直接在格式说明符里嵌入任意 Python 表达式。</li>\n</ol>\n<h2 id="第-5-条：用辅助函数取代复杂的表达式"><a href="#%E7%AC%AC-5-%E6%9D%A1%EF%BC%9A%E7%94%A8%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0%E5%8F%96%E4%BB%A3%E5%A4%8D%E6%9D%82%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 5 条：用辅助函数取代复杂的表达式</h2>\n<p>Python 的语法相当简明，所以有时只用一条表达式就能实现许多逻辑。例如，要把 URL 之中的查询字符串拆分成键值对，那么只需要使用 parse_qs 函数就可以了。下面的例子会解析查询字符串之中的每个参数，并把这些参数跟它们所对应的整数值放到一份字典（dict）里面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30602734313623237000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from urllib.parse import parse_qs\nmy_values = parse_qs(\'red=5&blue=0&green=\',\n                     keep_blank_values=True)\nprint(repr(my_values))\n\n>>>\n{\'red\': [\'5\'], \'blue\': [\'0\'], \'green\': [\'\']}`, `30602734313623237000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> parse_qs\nmy_values <span class="token operator">=</span> parse_qs<span class="token punctuation">(</span><span class="token string">\'red=5&amp;blue=0&amp;green=\'</span><span class="token punctuation">,</span>\n                     keep_blank_values<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>my_values<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'red\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'5\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'0\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\'green\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在解析查询字符串时，可以发现，有的参数可能带有多个值，有的参数可能只有一个值，还有的参数可能是空白值，另外也会遇到根本没提供这个参数的情况。下面这三行代码分别通过 get 方法查询结果字典里面的三个参数，这刚好对应三种不同的情况：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63412654555983130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from urllib.parse import parse_qs\nmy_values = parse_qs(\'red=5&blue=0&green=\',\n                     keep_blank_values=True)\n\nprint(\'Red:         \', my_values.get(\'red\'))\nprint(\'Green:       \', my_values.get(\'green\'))\nprint(\'Opacity:     \', my_values.get(\'opacity\'))\n\n>>>\nRed:          [\'5\']\nGreen:        [\'\']\nOpacity:      None`, `63412654555983130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> parse_qs\nmy_values <span class="token operator">=</span> parse_qs<span class="token punctuation">(</span><span class="token string">\'red=5&amp;blue=0&amp;green=\'</span><span class="token punctuation">,</span>\n                     keep_blank_values<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Red:         \'</span><span class="token punctuation">,</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Green:       \'</span><span class="token punctuation">,</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'green\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Opacity:     \'</span><span class="token punctuation">,</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'opacity\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nRed<span class="token punctuation">:</span>          <span class="token punctuation">[</span><span class="token string">\'5\'</span><span class="token punctuation">]</span>\nGreen<span class="token punctuation">:</span>        <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span>\nOpacity<span class="token punctuation">:</span>      <span class="token boolean">None</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果能把参数缺失与参数为空白值这两种情况都默认当成 0，那就更好了。但这样一个小小的逻辑，似乎不值得专门写 if 语句或辅助函数，所以有人会直接用 Boolean 表达式实现。</p>\n<p>Boolean 表达式用 Python 的语法写起来很简单，因为 Python 在对这种表达式求值的时候，会把空白字符串、空白 list 以及 0 值，全都当成 False 看待。所以，只需要把 get 方法查到的结果放在 or 操作符的左边，并且在右边写上 0 就行了。这样的话，只要左边的子表达式为 False，那么整个表达式的值自然就被评估为右边那个表达式的值，也就是 0。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76878894543027720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from urllib.parse import parse_qs\nmy_values = parse_qs(\'red=5&blue=0&green=\',\n                     keep_blank_values=True)\n\n# For query string \'red=5&blue=0&green=\'\nred = my_values.get(\'red\', [\'\'])[0] or 0\ngreen = my_values.get(\'green\', [\'\'])[0] or 0\nopacity = my_values.get(\'opacity\', [\'\'])[0] or 0\nprint(f\'Red:     {red!r}\')\nprint(f\'Green:   {green!r}\')\nprint(f\'Opacity: {opacity!r}\')\n\n>>>\nRed:     \'5\'\nGreen:   0\nOpacity: 0`, `76878894543027720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> parse_qs\nmy_values <span class="token operator">=</span> parse_qs<span class="token punctuation">(</span><span class="token string">\'red=5&amp;blue=0&amp;green=\'</span><span class="token punctuation">,</span>\n                     keep_blank_values<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n\n<span class="token comment"># For query string \'red=5&amp;blue=0&amp;green=\'</span>\nred <span class="token operator">=</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span>\ngreen <span class="token operator">=</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'green\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span>\nopacity <span class="token operator">=</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'opacity\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Red:     </span><span class="token interpolation"><span class="token punctuation">{</span>red<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Green:   </span><span class="token interpolation"><span class="token punctuation">{</span>green<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Opacity: </span><span class="token interpolation"><span class="token punctuation">{</span>opacity<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nRed<span class="token punctuation">:</span>     <span class="token string">\'5\'</span>\nGreen<span class="token punctuation">:</span>   <span class="token number">0</span>\nOpacity<span class="token punctuation">:</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>表达式写成这样，看起来很别扭，而且它并没有完全实现我们想要的效果，因为我们还得保证解析出来的参数值是能够直接参与数学运算的整数。于是，需要通过内置的 int() 把这种表达式所解析出来的字符串转换成整数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36544695924135875000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`red = int(my_values.get(\'red\', [\'\'])[0] or 0)`, `36544695924135875000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">red <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在的代码比原来更难读了，因为看上去比原来还要乱。这种代码让人觉得很可怕：如果你是第一次阅读该代码，那必须得把整个表达式逐层拆分，才能明白这行代码的意思，这要花很长时间。代码当然应该写得短一些，但并不意味着非得挤成一行。</p>\n<p>Python 可以用 if/else 结构实现三元的条件表达式，这样写比刚才那种写法更清晰，且能保持代码简短。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97115735777078820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`red_str = my_values.get(\'red\', [\'\'])\nred = int(red_str[0]) if red_str[0] else 0`, `97115735777078820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">red_str <span class="token operator">=</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\nred <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>red_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">if</span> red_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但在我们这个例子里，这种写法还是不如完整的多行 if/else 结构好，虽然要多写几行，但非常容易看懂。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50423576083788800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`green_str = my_values.get(\'green\', [\'\'])\nif green_str[0]:\n    green = int(green_str[0])\nelse:\n    green = 0`, `50423576083788800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">green_str <span class="token operator">=</span> my_values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'green\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">if</span> green_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>\n    green <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>green_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    green <span class="token operator">=</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果要反复使用这套逻辑，那还是写成辅助函数比较好，即使像下面这个例子一样只用两三次，也还是值得这样做。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91238625578128850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_first_int(values, key, default=0):\n    found = values.get(key, [\'\'])\n    if found[0]:\n        return int(found[0])\n    return default`, `91238625578128850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_first_int</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> key<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    found <span class="token operator">=</span> values<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> default</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-1"><a href="#%E6%80%BB%E7%BB%93-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>Python 的语法很容易把复杂的意思挤到同一行表达式里，这样写很难懂。</li>\n<li>复杂的表达式，尤其是那种需要重复使用的复杂表达式，应该写到辅助函数里面。</li>\n<li>用 if/else 结构写成的条件表达式，要比用 or 与 and 写成的 Boolean 表达式更好懂。</li>\n</ol>\n<h2 id="第-6-条：把数据结构直接拆分到多个变量里，不要专门通过下标访问"><a href="#%E7%AC%AC-6-%E6%9D%A1%EF%BC%9A%E6%8A%8A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9B%B4%E6%8E%A5%E6%8B%86%E5%88%86%E5%88%B0%E5%A4%9A%E4%B8%AA%E5%8F%98%E9%87%8F%E9%87%8C%EF%BC%8C%E4%B8%8D%E8%A6%81%E4%B8%93%E9%97%A8%E9%80%9A%E8%BF%87%E4%B8%8B%E6%A0%87%E8%AE%BF%E9%97%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 6 条：把数据结构直接拆分到多个变量里，不要专门通过下标访问</h2>\n<p>Python 内置的元组（tuple）类型可以创建不可变的序列，把许多元素依次保存起来。最简单的用法是只用元组保存两个值，例如字典里面的键值对。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79084653026330720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`snack_calories = {\n    \'chips\': 140,\n    \'popcorn\': 80,\n    \'nuts\': 190,\n}\nitems = tuple(snack_calories.items())\nprint(items)\n\n>>>\n((\'chips\', 140), (\'popcorn\', 80), (\'nuts\', 190))`, `79084653026330720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">snack_calories <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'chips\'</span><span class="token punctuation">:</span> <span class="token number">140</span><span class="token punctuation">,</span>\n    <span class="token string">\'popcorn\'</span><span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>\n    <span class="token string">\'nuts\'</span><span class="token punctuation">:</span> <span class="token number">190</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\nitems <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>snack_calories<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">\'chips\'</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'popcorn\'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'nuts\'</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以用整数作下标，通过下标来访问元组里面对应的元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66237016847333980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`item = (\'Peanut butter\', \'Jelly\')\nfirst = item[0]\nsecond = item[1]\nprint(first, \'and\', second)\n\n>>>\nPeanut butter and Jelly`, `66237016847333980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">item <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'Peanut butter\'</span><span class="token punctuation">,</span> <span class="token string">\'Jelly\'</span><span class="token punctuation">)</span>\nfirst <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\nsecond <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token string">\'and\'</span><span class="token punctuation">,</span> second<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nPeanut butter <span class="token keyword">and</span> Jelly</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>创建好 tuple 之后，就不能通过下标给其中的元素赋新值了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69899982448149790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pair = (\'Chocolate\', \'Peanut butter\')\npair[0] = \'Honey\'\n\n>>>\nTraceback ...\nTypeError: \'tuple\' object does not support item assignment`, `69899982448149790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pair <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'Chocolate\'</span><span class="token punctuation">,</span> <span class="token string">\'Peanut butter\'</span><span class="token punctuation">)</span>\npair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'Honey\'</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> <span class="token string">\'tuple\'</span> <span class="token builtin">object</span> does <span class="token keyword">not</span> support item assignment</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Python 还有一种写法，叫作拆分（unpacking）。这种写法让我们只用一条语句，就可以把元组里面的元素分别赋给多个变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32425475885367726000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`item = (\'Peanut butter\', \'Jelly\')\nfirst, second = item  # Unpacking\nprint(first, \'and\', second)\n\n>>>\nPeanut butter and Jelly`, `32425475885367726000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">item <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'Peanut butter\'</span><span class="token punctuation">,</span> <span class="token string">\'Jelly\'</span><span class="token punctuation">)</span>\nfirst<span class="token punctuation">,</span> second <span class="token operator">=</span> item  <span class="token comment"># Unpacking</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token string">\'and\'</span><span class="token punctuation">,</span> second<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nPeanut butter <span class="token keyword">and</span> Jelly</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通过 unpacking 来赋值要比通过下标去访问元组内的元素更清晰，而且这种写法所需的代码量通常比较少。当然，赋值操作的左边除了可以罗列单个变量，也可以写成列表、序列或任意深度的可迭代对象（iterable）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32537361778069053000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`favorite_snacks = {\n    \'salty\': (\'pretzels\', 100),\n    \'sweet\': (\'cookies\', 180),\n    \'veggie\': (\'carrots\', 20),\n}\n\n((type1, (name1, cals1)),\n (type2, (name2, cals2)),\n (type3, (name3, cals3))) = favorite_snacks.items()\nprint(f\'Favorite {type1} is {name1} with {cals1} calories\')\nprint(f\'Favorite {type2} is {name2} with {cals2} calories\')\nprint(f\'Favorite {type3} is {name3} with {cals3} calories\')\n\n>>>\nFavorite salty is pretzels with 100 calories\nFavorite sweet is cookies with 180 calories\nFavorite veggie is carrots with 20 calories`, `32537361778069053000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">favorite_snacks <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'salty\'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">\'pretzels\'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token string">\'sweet\'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">\'cookies\'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token string">\'veggie\'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">\'carrots\'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token punctuation">(</span><span class="token punctuation">(</span>type1<span class="token punctuation">,</span> <span class="token punctuation">(</span>name1<span class="token punctuation">,</span> cals1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n <span class="token punctuation">(</span>type2<span class="token punctuation">,</span> <span class="token punctuation">(</span>name2<span class="token punctuation">,</span> cals2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n <span class="token punctuation">(</span>type3<span class="token punctuation">,</span> <span class="token punctuation">(</span>name3<span class="token punctuation">,</span> cals3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> favorite_snacks<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Favorite </span><span class="token interpolation"><span class="token punctuation">{</span>type1<span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>name1<span class="token punctuation">}</span></span><span class="token string"> with </span><span class="token interpolation"><span class="token punctuation">{</span>cals1<span class="token punctuation">}</span></span><span class="token string"> calories\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Favorite </span><span class="token interpolation"><span class="token punctuation">{</span>type2<span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>name2<span class="token punctuation">}</span></span><span class="token string"> with </span><span class="token interpolation"><span class="token punctuation">{</span>cals2<span class="token punctuation">}</span></span><span class="token string"> calories\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Favorite </span><span class="token interpolation"><span class="token punctuation">{</span>type3<span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>name3<span class="token punctuation">}</span></span><span class="token string"> with </span><span class="token interpolation"><span class="token punctuation">{</span>cals3<span class="token punctuation">}</span></span><span class="token string"> calories\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFavorite salty <span class="token keyword">is</span> pretzels <span class="token keyword">with</span> <span class="token number">100</span> calories\nFavorite sweet <span class="token keyword">is</span> cookies <span class="token keyword">with</span> <span class="token number">180</span> calories\nFavorite veggie <span class="token keyword">is</span> carrots <span class="token keyword">with</span> <span class="token number">20</span> calories</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31899301227084490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`snacks = [(\'bacon\', 350), (\'donut\', 240), (\'muffin\', 190)]\n\nfor rank, (name, calories) in enumerate(snacks, 1):\n    print(f\'#{rank}: {name} has {calories} calories\')\n\n>>>\n#1: bacon has 350 calories\n#2: donut has 240 calories\n#3: muffin has 190 calories`, `31899301227084490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">snacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'bacon\'</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'donut\'</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'muffin\'</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> rank<span class="token punctuation">,</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> calories<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>snacks<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'#</span><span class="token interpolation"><span class="token punctuation">{</span>rank<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string"> has </span><span class="token interpolation"><span class="token punctuation">{</span>calories<span class="token punctuation">}</span></span><span class="token string"> calories\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token comment">#1: bacon has 350 calories</span>\n<span class="token comment">#2: donut has 240 calories</span>\n<span class="token comment">#3: muffin has 190 calories</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这才是符合 Python 风格的写法（Pythonic 式的写法），我们不需要再通过下标逐层访问了。这种写法可以节省篇幅，而且比较容易理解。</p>\n<p>Python 的 unpacking 机制可以用在许多方面，例如构建列表（参见第 13 条）、给函数设计参数列表（参见第 22 条）、传递关键字参数（参见第 23 条）、接收多个返回值（参见第 19 条）等。</p>\n<p>明智地使用 unpacking 机制，可以实现很多原来必须通过下标才能写出的功能，这让代码变得更加清晰，而且能充分发挥 Python 的优势。</p>\n<h3 id="总结-2"><a href="#%E6%80%BB%E7%BB%93-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>unpacking 是一种特殊的 Python 语法，只需要一行代码，就能把数据结构里面的多个值分别赋给相应的变量。</li>\n<li>unpacking 在 Python 中应用广泛，凡是可迭代的对象都能拆分，无论它里面还有多少层迭代结构。</li>\n<li>尽量通过 unpacking 来拆解序列之中的数据，而不要通过下标访问，这样可以让代码更简洁、更清晰。</li>\n</ol>\n<h2 id="第-7-条：尽量用-enumerate-取代-range"><a href="#%E7%AC%AC-7-%E6%9D%A1%EF%BC%9A%E5%B0%BD%E9%87%8F%E7%94%A8-enumerate-%E5%8F%96%E4%BB%A3-range" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 7 条：尽量用 enumerate 取代 range</h2>\n<p>Python 内置的 range 函数适合用来迭代一系列整数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86470066010437270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from random import randint\n\nrandom_bits = 0\nfor i in range(32):\n    if randint(0, 1):\n        random_bits |= 1 << i\nprint(bin(random_bits))\n\n>>>\n0b100101010010000001011011010011`, `86470066010437270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> random <span class="token keyword">import</span> randint\n\nrandom_bits <span class="token operator">=</span> <span class="token number">0</span>\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        random_bits <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>random_bits<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">0b100101010010000001011011010011</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果要迭代的是某种数据结构，例如字符串列表，那么可以直接在这个序列上面迭代，用不着专门通过 range 设定一个取值范围，然后把这个范围里的每个整数值，依次当成下标来访问列表中的元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29288396138672333000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`flavor_list = [\'vanilla\', \'chocolate\', \'pecan\', \'strawberry\']\n\nfor flavor in flavor_list:\n    print(f\'{flavor} is delicious\')\n\n>>>\nvanilla is delicious\nchocolate is delicious\npecan is delicious\nstrawberry is delicious`, `29288396138672333000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">flavor_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'vanilla\'</span><span class="token punctuation">,</span> <span class="token string">\'chocolate\'</span><span class="token punctuation">,</span> <span class="token string">\'pecan\'</span><span class="token punctuation">,</span> <span class="token string">\'strawberry\'</span><span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> flavor <span class="token keyword">in</span> flavor_list<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>flavor<span class="token punctuation">}</span></span><span class="token string"> is delicious\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nvanilla <span class="token keyword">is</span> delicious\nchocolate <span class="token keyword">is</span> delicious\npecan <span class="token keyword">is</span> delicious\nstrawberry <span class="token keyword">is</span> delicious</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然有的时候，在迭代 list 的过程中也需要知道当前处理的这个元素在 list 里的位置。例如，我把爱吃的冰激淋口味写在 <code class="language-text">flavor_list</code> 列表里面，在打印每种口味时，我还想指出这种口味在自己心目中的排名。为了实现这样的功能，我们可以用传统的 range 方式来实现。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46906599772674080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`flavor_list = [\'vanilla\', \'chocolate\', \'pecan\', \'strawberry\']\n\nfor i in range(len(flavor_list)):\n    flavor = flavor_list[i]\n    print(f\'{i+1}: {flavor}\')\n\n>>>\n1: vanilla\n2: chocolate\n3: pecan\n4: strawberry`, `46906599772674080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">flavor_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'vanilla\'</span><span class="token punctuation">,</span> <span class="token string">\'chocolate\'</span><span class="token punctuation">,</span> <span class="token string">\'pecan\'</span><span class="token punctuation">,</span> <span class="token string">\'strawberry\'</span><span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>flavor_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    flavor <span class="token operator">=</span> flavor_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>flavor<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span><span class="token punctuation">:</span> vanilla\n<span class="token number">2</span><span class="token punctuation">:</span> chocolate\n<span class="token number">3</span><span class="token punctuation">:</span> pecan\n<span class="token number">4</span><span class="token punctuation">:</span> strawberry</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">range(len(flavor_list))</code> 的写法太过复杂，可以用 enumerate 代替。enumerate 能够把任何一种迭代器（iterator）封装成惰性生成器（lazy generator，参见第 30 条）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8674788997893978000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`flavor_list = [\'vanilla\', \'chocolate\', \'pecan\', \'strawberry\']\n\nit = enumerate(flavor_list)\nprint(next(it))\nprint(next(it))\n\n>>>\n(0, \'vanilla\')\n(1, \'chocolate\')`, `8674788997893978000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">flavor_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'vanilla\'</span><span class="token punctuation">,</span> <span class="token string">\'chocolate\'</span><span class="token punctuation">,</span> <span class="token string">\'pecan\'</span><span class="token punctuation">,</span> <span class="token string">\'strawberry\'</span><span class="token punctuation">]</span>\n\nit <span class="token operator">=</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>flavor_list<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">\'vanilla\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'chocolate\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22333706873014370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`flavor_list = [\'vanilla\', \'chocolate\', \'pecan\', \'strawberry\']\n\nfor i, flavor in enumerate(flavor_list):\n    print(f\'{i + 1}: {flavor}\')\n\n>>>\n1: vanilla\n2: chocolate\n3: pecan\n4: strawberry`, `22333706873014370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">flavor_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'vanilla\'</span><span class="token punctuation">,</span> <span class="token string">\'chocolate\'</span><span class="token punctuation">,</span> <span class="token string">\'pecan\'</span><span class="token punctuation">,</span> <span class="token string">\'strawberry\'</span><span class="token punctuation">]</span>\n\n<span class="token keyword">for</span> i<span class="token punctuation">,</span> flavor <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>flavor_list<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>flavor<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span><span class="token punctuation">:</span> vanilla\n<span class="token number">2</span><span class="token punctuation">:</span> chocolate\n<span class="token number">3</span><span class="token punctuation">:</span> pecan\n<span class="token number">4</span><span class="token punctuation">:</span> strawberry</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外，还可以通过 enumerate 的第二个参数指定起始序号，这样就不用在每次打印的时候去调整了。例如，本例可以从 1 开始计算。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84532007514421310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for i, flavor in enumerate(flavor_list, 1):\n    print(f\'{i + 1}: {flavor}\')`, `84532007514421310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> i<span class="token punctuation">,</span> flavor <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>flavor_list<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>flavor<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="总结-3"><a href="#%E6%80%BB%E7%BB%93-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>enumerate 函数可以用简洁的代码迭代 iterator，而且可以指出当前这轮循环的序号。</li>\n<li>不要先通过 range 指定下标的取值范围，然后用下标去访问序列，而是应该直接用 enumerate 函数迭代。</li>\n<li>可以通过 enumerate 的第二个参数指定起始序号（默认为 0）。</li>\n</ol>\n<h2 id="第-8-条：用-zip-函数同时遍历两个迭代器"><a href="#%E7%AC%AC-8-%E6%9D%A1%EF%BC%9A%E7%94%A8-zip-%E5%87%BD%E6%95%B0%E5%90%8C%E6%97%B6%E9%81%8D%E5%8E%86%E4%B8%A4%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 8 条：用 zip 函数同时遍历两个迭代器</h2>\n<p>写 Python 代码时，经常会根据某份列表中的对象创建许多与这份列表有关的新列表。下面这样的列表推导机制，可以把表达式运用到源列表的每个元素上面，从而生成一份派生列表（参见第 27 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37077596871299830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`names = [\'Cecilia\', \'Lise\', \'Marie\']\ncounts = [len(n) for n in names]\nprint(counts)\n\n>>>\n[7, 4, 5]`, `37077596871299830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Cecilia\'</span><span class="token punctuation">,</span> <span class="token string">\'Lise\'</span><span class="token punctuation">,</span> <span class="token string">\'Marie\'</span><span class="token punctuation">]</span>\ncounts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> names<span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>counts<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>派生列表中的元素与源列表中对应位置上面的元素有着一定的关系。如果想同时遍历这两份列表，那可以根据源列表的长度做迭代。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98151308960029380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`names = [\'Cecilia\', \'Lise\', \'Marie\']\ncounts = [len(n) for n in names]\n\nlongest_name = None\nmax_count = 0\nfor i in range(len(names)):\n    count = counts[i]\n    if count > max_count:\n        longest_name = names[i]\n        max_count = count\n\nprint(longest_name)\n\n>>>\nCecilia`, `98151308960029380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Cecilia\'</span><span class="token punctuation">,</span> <span class="token string">\'Lise\'</span><span class="token punctuation">,</span> <span class="token string">\'Marie\'</span><span class="token punctuation">]</span>\ncounts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> names<span class="token punctuation">]</span>\n\nlongest_name <span class="token operator">=</span> <span class="token boolean">None</span>\nmax_count <span class="token operator">=</span> <span class="token number">0</span>\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    count <span class="token operator">=</span> counts<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n    <span class="token keyword">if</span> count <span class="token operator">></span> max_count<span class="token punctuation">:</span>\n        longest_name <span class="token operator">=</span> names<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n        max_count <span class="token operator">=</span> count\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>longest_name<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nCecilia</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种写法的问题在于，整个循环代码看起来很乱。我们要通过下标访问 names 与 counts 这两个列表里的元素，所以表示下标的那个循环变量 i 在循环体里必须出现两次，这让代码变得不太好懂。改用 enumerate 实现（参见第 7 条）会稍微好一些，但仍然不够理想。</p>\n<p>为了把代码写得更清楚，可以用 Python 内置的 zip 函数来实现。这个函数能把两个或更多的 iterator 封装成惰性生成器（lazy generator）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80981263016780810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for name, count in zip(names, counts):\n    if count > max_count:\n        longest_name = name\n        max_count = count`, `80981263016780810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> name<span class="token punctuation">,</span> count <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> counts<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> count <span class="token operator">></span> max_count<span class="token punctuation">:</span>\n        longest_name <span class="token operator">=</span> name\n        max_count <span class="token operator">=</span> count</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>zip 每次只从它封装的那些迭代器里面各自取出一个元素，所以即便源列表很长，程序也不会因为占用内存过多而崩溃。但是，如果输入 zip 的那些列表的长度不一致，那就得小心了。例如，我给 names 列表里又添加了一个名字，但是忘了把它的长度更新到 counts 列表之中。在这种情况下，用 zip 同时遍历这两份列表，会产生奇怪的结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35863345559448035000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`names = [\'Cecilia\', \'Lise\', \'Marie\']\ncounts = [len(n) for n in names]\n\nlongest_name = None\nmax_count = 0\nfor name, count in zip(names, counts):\n    if count > max_count:\n        longest_name = name\n        max_count = count\n\nnames.append(\'Rosalind\')\nfor name, count in zip(names, counts):\n    print(name)\n\n>>>\nCecilia\nLise\nMarie`, `35863345559448035000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Cecilia\'</span><span class="token punctuation">,</span> <span class="token string">\'Lise\'</span><span class="token punctuation">,</span> <span class="token string">\'Marie\'</span><span class="token punctuation">]</span>\ncounts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> names<span class="token punctuation">]</span>\n\nlongest_name <span class="token operator">=</span> <span class="token boolean">None</span>\nmax_count <span class="token operator">=</span> <span class="token number">0</span>\n<span class="token keyword">for</span> name<span class="token punctuation">,</span> count <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> counts<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> count <span class="token operator">></span> max_count<span class="token punctuation">:</span>\n        longest_name <span class="token operator">=</span> name\n        max_count <span class="token operator">=</span> count\n\nnames<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">\'Rosalind\'</span><span class="token punctuation">)</span>\n<span class="token keyword">for</span> name<span class="token punctuation">,</span> count <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> counts<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nCecilia\nLise\nMarie</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>zip 函数只要其中任何一个迭代器处理完毕，它就不再往下走了。于是，循环的次数实际上等于最短的那份列表所具备的长度。一般情况下，我们都是根据某份列表推导出其他几份列表，然后把这些列表一起封装到 zip 里面，由于这些列表长度相同，因此不会遇到刚才的问题。</p>\n<p>在列表长度不同的情况下，zip 函数的提前终止行为可能跟你想实现的效果不一样。所以，如果无法确定这些列表的长度相同，那就不要把它们传给 zip，而是应该传给另一个叫作 <code class="language-text">zip_longest</code> 的函数，这个函数位于内置的 itertools 模块里。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92454819727443560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nnames = [\'Cecilia\', \'Lise\', \'Marie\']\ncounts = [len(n) for n in names]\n\nlongest_name = None\nmax_count = 0\nfor name, count in zip(names, counts):\n    if count > max_count:\n        longest_name = name\n        max_count = count\n\nnames.append(\'Rosalind\')\n\nfor name, count in itertools.zip_longest(names, counts):\n    print(f\'{name}: {count}\')\n\n>>>\nCecilia: 7\nLise: 4\nMarie: 5\nRosalind: None`, `92454819727443560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Cecilia\'</span><span class="token punctuation">,</span> <span class="token string">\'Lise\'</span><span class="token punctuation">,</span> <span class="token string">\'Marie\'</span><span class="token punctuation">]</span>\ncounts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> names<span class="token punctuation">]</span>\n\nlongest_name <span class="token operator">=</span> <span class="token boolean">None</span>\nmax_count <span class="token operator">=</span> <span class="token number">0</span>\n<span class="token keyword">for</span> name<span class="token punctuation">,</span> count <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> counts<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> count <span class="token operator">></span> max_count<span class="token punctuation">:</span>\n        longest_name <span class="token operator">=</span> name\n        max_count <span class="token operator">=</span> count\n\nnames<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">\'Rosalind\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">for</span> name<span class="token punctuation">,</span> count <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>zip_longest<span class="token punctuation">(</span>names<span class="token punctuation">,</span> counts<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nCecilia<span class="token punctuation">:</span> <span class="token number">7</span>\nLise<span class="token punctuation">:</span> <span class="token number">4</span>\nMarie<span class="token punctuation">:</span> <span class="token number">5</span>\nRosalind<span class="token punctuation">:</span> <span class="token boolean">None</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果其中有些列表已经遍历完了，那么 <code class="language-text">zip_longest</code> 会用当初传给 fillvalue 参数的那个值来填补空缺（本例中空缺的为字符串 <code class="language-text">&#39;Rosalind&#39;</code> 的长度值），默认的参数值是 None。</p>\n<h3 id="总结-4"><a href="#%E6%80%BB%E7%BB%93-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>内置的 zip 函数可以同时遍历多个迭代器。</li>\n<li>zip 会创建惰性生成器，让它每次只生成一个元组，所以无论输入的数据有多长，它都是一个一个处理的。</li>\n<li>如果提供的迭代器的长度不一致，那么只要其中任何一个迭代完毕，zip 就会停止。如果想按最长的那个迭代器来遍历，那就改用内置的 itertools 模块中的 <code class="language-text">zip_longest</code> 函数。</li>\n</ol>\n<h2 id="第-9-条：不要在-for-与-while-循环后面写-else-块"><a href="#%E7%AC%AC-9-%E6%9D%A1%EF%BC%9A%E4%B8%8D%E8%A6%81%E5%9C%A8-for-%E4%B8%8E-while-%E5%BE%AA%E7%8E%AF%E5%90%8E%E9%9D%A2%E5%86%99-else-%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 9 条：不要在 for 与 while 循环后面写 else 块</h2>\n<p>Python 的循环有一项大多数编程语言都不支持的特性，即可以把 else 块紧跟在整个循环结构的后面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40663313044701210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for i in range(3):\n    print(\'Loop\', i)\nelse:\n    print(\'Else block!\')\n\n>>>\nLoop 0\nLoop 1\nLoop 2\nElse block!`, `40663313044701210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Loop\'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Else block!\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nLoop <span class="token number">0</span>\nLoop <span class="token number">1</span>\nLoop <span class="token number">2</span>\nElse block!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果循环没有从头到尾执行完（也就是循环提前终止了），那么 else 块里的代码是不会执行的。在循环中使用 break 语句实际上会跳过 else 块。这个与实际想象中的功能差别较大</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11842473095073137000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for i in range(3):\n    print(\'Loop\', i)\n    if i == 1:\n        break\nelse:\n    print(\'Else block!\')\n\n>>>\nLoop 0\nLoop 1`, `11842473095073137000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Loop\'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>\n        <span class="token keyword">break</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Else block!\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nLoop <span class="token number">0</span>\nLoop <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一个奇怪的地方是，如果对空白序列做 for 循环，那么程序立刻就会执行 else 块。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91693362379275440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for x in []:\n    print(\'Never runs\')\nelse:\n    print(\'For Else block!\')\n\n>>>\nFor Else block!`, `91693362379275440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Never runs\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'For Else block!\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFor Else block!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>while 循环也是这样，如果首次循环就遇到 False，那么程序也会立刻运行 else 块。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15497477102131984000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`while False:\n    print(\'Never runs\')\nelse:\n    print(\'While Else block!\')\n\n>>>\nWhile Else block!`, `15497477102131984000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">while</span> <span class="token boolean">False</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Never runs\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'While Else block!\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nWhile Else block!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>把 else 设计成这样，是想让你利用它实现搜索逻辑。例如，如果要判断两个数是否互质（也就是除了 1 之外，是不是没有别的数能够同时整除它们），就可以用这种结构实现。先把有可能同时整除它们的数逐个试一遍，如果全都试过之后还是没找到这样的数，那么循环就会从头到尾执行完（这意味着循环没有因为 break 而提前跳出），然后程序就会执行 else 块里的代码。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36585424945171763000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = 4\nb = 9\n\nfor i in range(2, min(a, b) + 1):\n    print(\'Testing\', i)\n    if a % i == 0 and b % i == 0:\n        print(\'Not coprime\')\n        break\nelse:\n    print(\'Coprime\')\n\n>>>\nTesting 2\nTesting 3\nTesting 4\nCoprime`, `36585424945171763000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token number">4</span>\nb <span class="token operator">=</span> <span class="token number">9</span>\n\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Testing\'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> a <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> b <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Not coprime\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">break</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Coprime\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTesting <span class="token number">2</span>\nTesting <span class="token number">3</span>\nTesting <span class="token number">4</span>\nCoprime</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际工作中，会改用辅助函数完成计算。这样的辅助函数有两种常见的写法。</p>\n<ol>\n<li>\n<p>只要发现某个条件成立，就立刻返回，如果始终都没碰到这种情况，那么循环就会完整地执行，让程序返回函数末尾的那个值作为默认返回值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27038981623296365000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def coprime(a, b):\n  for i in range(2, min(a, b) + 1):\n     if a % i == 0 and b % i == 0:\n           return False\n  return True\n\nassert coprime(4, 9)\nassert not coprime(3, 6)`, `27038981623296365000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">coprime</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">if</span> a <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> b <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>\n           <span class="token keyword">return</span> <span class="token boolean">False</span>\n  <span class="token keyword">return</span> <span class="token boolean">True</span>\n\n<span class="token keyword">assert</span> coprime<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token keyword">not</span> coprime<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>用变量来记录循环过程中有没有碰到这样的情况，如果有，那就用 break 提前跳出循环，如果没有，循环就会完整地执行，无论如何，最后都返回这个变量的值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85839129090469760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def coprime_alternate(a, b):\n  is_coprime = True\n  for i in range(2, min(a, b) + 1):\n     if a % i == 0 and b % i == 0:\n           is_coprime = False\n           break\n  return is_coprime\n\nassert coprime_alternate(4, 9)\nassert not coprime_alternate(3, 6)`, `85839129090469760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">coprime_alternate</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  is_coprime <span class="token operator">=</span> <span class="token boolean">True</span>\n  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">if</span> a <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> b <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>\n           is_coprime <span class="token operator">=</span> <span class="token boolean">False</span>\n           <span class="token keyword">break</span>\n  <span class="token keyword">return</span> is_coprime\n\n<span class="token keyword">assert</span> coprime_alternate<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token keyword">not</span> coprime_alternate<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>for/else 或 while/else 结构本身虽然可以实现某些逻辑表达，但它带来的困惑，已经盖过了它的好处。</p>\n<h3 id="总结-5"><a href="#%E6%80%BB%E7%BB%93-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>Python 有种特殊的语法，可以把 else 块紧跟在整个 for 循环或 while 循环的后面。</li>\n<li>只有在整个循环没有因为 break 提前跳出的情况下，else 块才会执行</li>\n<li>把 else 块紧跟在整个循环后面，会让人不太容易看出这段代码的意思，所以要避免这样写。</li>\n</ol>\n<h2 id="第-10-条：用赋值表达式减少重复代码"><a href="#%E7%AC%AC-10-%E6%9D%A1%EF%BC%9A%E7%94%A8%E8%B5%8B%E5%80%BC%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%87%8F%E5%B0%91%E9%87%8D%E5%A4%8D%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 10 条：用赋值表达式减少重复代码</h2>\n<p>赋值表达式（assignment expression）是 Python3.8 新引入的语法，它会用到海象操作符（walrus operator）。这种写法可以解决某些持续已久的代码重复问题。</p>\n<p>这种表达式很有用，可以在普通的赋值语句无法应用的场合实现赋值，例如可以用在条件表达式的 if 语句里面。赋值表达式的值，就是赋给海象操作符左侧那个标识符的值。</p>\n<p>举个例子。如果有一筐新鲜水果要给果汁店做食材，那我们就可以这样定义其中的内容：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78940000914428040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fresh_fruit = {\n    \'apple\': 10,\n    \'banana\': 8,\n    \'lemon\': 5,\n}\n\ndef make_lemonade(count):\n    pass\n\ndef out_of_stock():\n    pass\n\ncount = fresh_fruit.get(\'lemon\', 0)\nif count:\n    make_lemonade(count)\nelse:\n    out_of_stock()`, `78940000914428040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">fresh_fruit <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'apple\'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>\n    <span class="token string">\'banana\'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>\n    <span class="token string">\'lemon\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">def</span> <span class="token function">make_lemonade</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token keyword">def</span> <span class="token function">out_of_stock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\ncount <span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'lemon\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token keyword">if</span> count<span class="token punctuation">:</span>\n    make_lemonade<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段代码看上去虽然简单，但还是显得有点儿松散，因为 count 变量虽然定义在整个 if/else 结构之上，然而只有 if 语句才会用到它，else 块根本就不需要使用这个变量。所以，这种写法让人误以为 count 是个重要的变量，if 和 else 都要用到它，但实际上并非如此。</p>\n<p>我们在 Python 里面经常要先获取某个值，然后判断它是否非零，如果是就执行某段代码。对于这种用法，我们以前总是要通过各种技巧，来避免 count 这样的变量重复出现在代码之中，这些技巧有时会让代码变得比较难懂（参考第 5 条里面提到的那些技巧）。Python 引入赋值表达式正是为了解决这样的问题。下面改用海象操作符来写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27784689908812710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if count := fresh_fruit.get(\'lemon\', 0):\n    make_lemonade(count)\nelse:\n    out_of_stock()`, `27784689908812710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">if</span> count <span class="token punctuation">:</span><span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'lemon\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    make_lemonade<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>新代码虽然只省了一行，但读起来却清晰很多，因为这种写法明确体现出 count 变量只与 if 块有关。这个赋值表达式先把 <code class="language-text">:=</code> 右边的值赋给左边的 count 变量，然后对自身求值，也就是把变量的值当成整个表达式的值。由于表达式紧跟着 if，程序会根据它的值是否非零来决定该不该执行 if 块。这种先赋值再判断的做法，正是海象操作符想要表达的意思。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85879143743687770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fresh_fruit = {\n    \'apple\': 10,\n    \'banana\': 8,\n    \'lemon\': 5,\n}\n\ndef make_cider(count):\n    pass\n\ncount = fresh_fruit.get(\'apple\', 0)\n\nif count >= 4:\n    make_cider(count)\nelse:\n    out_of_stock()`, `85879143743687770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">fresh_fruit <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'apple\'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>\n    <span class="token string">\'banana\'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>\n    <span class="token string">\'lemon\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">def</span> <span class="token function">make_cider</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\ncount <span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'apple\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n\n<span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">4</span><span class="token punctuation">:</span>\n    make_cider<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同理以上代码可以修改如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64666808655740680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (count := fresh_fruit.get(\'apple\', 0)) >= 4:\n    make_lemonade(count)\nelse:\n    out_of_stock()`, `64666808655740680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token punctuation">:</span><span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'apple\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">4</span><span class="token punctuation">:</span>\n    make_lemonade<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>与刚才那个例子一样，修改之后的代码也比原来少了一行。但是这次，我们还要注意另外一个现象：赋值表达式本身是放在一对括号里面的。为什么要这样做呢？因为我们要在 if 语句里面把这个表达式的结果跟 4 这个值相比较。刚才柠檬汁的例子没有加括号，因为那时只凭赋值表达式本身的值就能决定 if/else 的走向：只要表达式的值不是 0，程序就进入 if 分支。但是这次不行，这次要把这个赋值表达式放在更大的表达式里面，所以必须用括号把它括起来。当然，在没有必要加括号的情况下，还是尽量别加括号比较好。</p>\n<p>还有一种类似的逻辑也会出现刚才说的重复代码，这指的是：我们要根据情况给某个变量赋予不同的值，紧接着要用这个变量做参数来调用某个函数。例如，若顾客要点香蕉冰沙，那我们首先得把香蕉切成好几份，然后用其中的两份来制作这道冰沙。如果不够两份，那就抛出香蕉不足（OutOfBananas）异常。下面用传统的写法实现这种逻辑：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50850591665678890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def slice_bananas(count):\n    pass\n\n\nclass OutofBananas(Exception):\n    pass\n\n\ndef make_smoothies(count):\n    pass\n\n\nfresh_fruit = {\n    \'apple\': 10,\n    \'banana\': 8,\n    \'lemon\': 5,\n}\n\npieces = 0\ncount = fresh_fruit.get(\'banana\', 0)\nif count >= 2:\n    pieces = slice_bananas(count)\n\ntry:\n    smoothies = make_smoothies(pieces)\nexcept OutofBananas:\n    out_of_stock()`, `50850591665678890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">slice_bananas</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">OutofBananas</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">make_smoothies</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\nfresh_fruit <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'apple\'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>\n    <span class="token string">\'banana\'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>\n    <span class="token string">\'lemon\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\npieces <span class="token operator">=</span> <span class="token number">0</span>\ncount <span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'banana\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> slice_bananas<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    smoothies <span class="token operator">=</span> make_smoothies<span class="token punctuation">(</span>pieces<span class="token punctuation">)</span>\n<span class="token keyword">except</span> OutofBananas<span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一种传统的写法也很常见，就是把 if/else 结构上方那条 pieces = 0 的赋值语句移动到 else 块中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37424296342369760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`count = fresh_fruit.get(\'banana\', 0)\nif count >= 2:\n    pieces = slice_bananas(count)\nelse:\n    pieces = 0\n\ntry:\n    smoothies = make_smoothies(pieces)\nexcept OutofBananas:\n    out_of_stock()`, `37424296342369760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">count <span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'banana\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> slice_bananas<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> <span class="token number">0</span>\n\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    smoothies <span class="token operator">=</span> make_smoothies<span class="token punctuation">(</span>pieces<span class="token punctuation">)</span>\n<span class="token keyword">except</span> OutofBananas<span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种写法看上去稍微有点儿怪，因为 if 与 else 这两个分支都给 pieces 变量定义了初始值。根据 Python 的作用域规则，这种分别定义变量初始值的写法是成立的（参见第 21 条）。虽说成立，但这样写看起来比较别扭，所以很多人喜欢用第一种写法，也就是在进入 if/else 结构之前，先把 pieces 的初始值给设置好。</p>\n<p>改用海象操作符来实现，可以少写一行代码，而且能够压低 count 变量的地位，让它只出现在 if 块里，这样我们就能更清楚地意识到 pieces 变量才是整段代码的重点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6717277261009169000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pieces = 0\nif (count := fresh_fruit.get(\'banana\', 0)) >= 2:\n    pieces = slice_bananas(count)\n\ntry:\n    smoothies = make_smoothies(pieces)\nexcept OutofBananas:\n    out_of_stock()`, `6717277261009169000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pieces <span class="token operator">=</span> <span class="token number">0</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token punctuation">:</span><span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'banana\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> slice_bananas<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    smoothies <span class="token operator">=</span> make_smoothies<span class="token punctuation">(</span>pieces<span class="token punctuation">)</span>\n<span class="token keyword">except</span> OutofBananas<span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于在 if 与 else 分支里面分别定义 pieces 变量的写法来说，海象操作符也能让代码变得清晰，因为这次不用再把 count 变量放到整个 if/else 块的上方了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74294624419030060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (count := fresh_fruit.get(\'banana\', 0)) >= 2:\n    pieces = slice_bananas(count)\nelse:\n    pieces = 0\n\ntry:\n    smoothies = make_smoothies(pieces)\nexcept OutofBananas:\n    out_of_stock()`, `74294624419030060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token punctuation">:</span><span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'banana\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> slice_bananas<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> <span class="token number">0</span>\n\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    smoothies <span class="token operator">=</span> make_smoothies<span class="token punctuation">(</span>pieces<span class="token punctuation">)</span>\n<span class="token keyword">except</span> OutofBananas<span class="token punctuation">:</span>\n    out_of_stock<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Python 新手经常会遇到这样一种困难，就是找不到好办法来实现 switch/case 结构。最接近这种结构的做法是在 if/else 结构里面继续嵌套 if/else 结构，或者使用 if/elif/else 结构。</p>\n<p>例如，我们想按照一定的顺序自动给客人制作饮品，这样就不用点餐了。下面这段逻辑先判断能不能做香蕉冰沙，如果不能，就做苹果汁，还不行，就做柠檬汁：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95921566869141600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`count = fresh_fruit.get(\'banana\', 0)\nif count >= 2:\n    pieces = slice_bananas(count)\n    to_enjoy = make_smoothies(pieces)\nelse:\n    count = fresh_fruit.get(\'apple\', 0)\n    if count >= 4:\n        to_enjoy = make_cider(count)\n    else:\n        count = fresh_fruit.get(\'lemon\', 0)\n        if count:\n            to_enjoy = make_lemonade(count)\n        else:\n            to_enjoy = \'Nothing\'`, `95921566869141600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">count <span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'banana\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> slice_bananas<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    to_enjoy <span class="token operator">=</span> make_smoothies<span class="token punctuation">(</span>pieces<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    count <span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'apple\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">4</span><span class="token punctuation">:</span>\n        to_enjoy <span class="token operator">=</span> make_cider<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        count <span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'lemon\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> count<span class="token punctuation">:</span>\n            to_enjoy <span class="token operator">=</span> make_lemonade<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            to_enjoy <span class="token operator">=</span> <span class="token string">\'Nothing\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种难看的写法其实在 Python 代码里特别常见。幸好现在有了海象操作符，让我们能够轻松地模拟出很接近 switch/case 的方案。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10117031707461343000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (count := fresh_fruit.get(\'banana\', 0)) >= 2:\n    pieces = slice_bananas(count)\n    to_enjoy = make_smoothies(pieces)\nelif (count := fresh_fruit.get(\'apple\', 0)) >= 4:\n    to_enjoy = make_cider(count)\nelif count := fresh_fruit.get(\'lemon\', 0):\n    to_enjoy = make_lemonade(count)\nelse:\n    to_enjoy = \'Nothing\'`, `10117031707461343000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token punctuation">:</span><span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'banana\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>\n    pieces <span class="token operator">=</span> slice_bananas<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    to_enjoy <span class="token operator">=</span> make_smoothies<span class="token punctuation">(</span>pieces<span class="token punctuation">)</span>\n<span class="token keyword">elif</span> <span class="token punctuation">(</span>count <span class="token punctuation">:</span><span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'apple\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">4</span><span class="token punctuation">:</span>\n    to_enjoy <span class="token operator">=</span> make_cider<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">elif</span> count <span class="token punctuation">:</span><span class="token operator">=</span> fresh_fruit<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'lemon\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    to_enjoy <span class="token operator">=</span> make_lemonade<span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    to_enjoy <span class="token operator">=</span> <span class="token string">\'Nothing\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个版本只比原来短五行，但是看起来却清晰得多，因为嵌套深度与缩进层数都变少了。只要碰到刚才那种难看的结构，我们就应该考虑能不能改用海象操作符来写。</p>\n<p>Python 新手还会遇到一个困难，就是缺少 do/while 循环结构。例如，我们要把新来的水果做成果汁并且装到瓶子里面，直到水果用完为止。下面先用普通的 while 循环来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88658532614410830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def pick_fruit():\n    pass\n\n\ndef make_juice(fruit, count):\n    pass\n\n\nbottles = []\nfresh_fruit = pick_fruit()\nwhile fresh_fruit:\n    for fruit, count in fresh_fruit.items():\n        batch = make_juice(fruit, count)\n        bottles.extend(batch)\n    fresh_fruit = pick_fruit()`, `88658532614410830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">pick_fruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">make_juice</span><span class="token punctuation">(</span>fruit<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\nbottles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\nfresh_fruit <span class="token operator">=</span> pick_fruit<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">while</span> fresh_fruit<span class="token punctuation">:</span>\n    <span class="token keyword">for</span> fruit<span class="token punctuation">,</span> count <span class="token keyword">in</span> fresh_fruit<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        batch <span class="token operator">=</span> make_juice<span class="token punctuation">(</span>fruit<span class="token punctuation">,</span> count<span class="token punctuation">)</span>\n        bottles<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>\n    fresh_fruit <span class="token operator">=</span> pick_fruit<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种写法必须把 <code class="language-text">fresh_fruit = pick_fruit()</code> 写两次，第一次是在进入 while 循环之前，因为我们要给 <code class="language-text">fresh_fruit</code> 设定初始值，第二次是在 while 循环体的末尾，因为我们得把下一轮需要处理的水果列表填充到 <code class="language-text">fresh_fruit</code> 里面。如果想复用这行代码，可以考虑 loop-and-a-half 模式。这个模式虽然能消除重复，但是会让 while 循环看起来很笨，因为它成了无限循环，程序只能通过 break 语句跳出这个循环。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80598818859614680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`bottles = []\nwhile True:\n   fresh_fruit = pick_fruit()\n   if not fresh_fruit:\n      break\n    for fruit, count in fresh_fruit.items():\n        batch = make_juice(fruit, count)\n        bottles.extend(batch)`, `80598818859614680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">bottles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n   fresh_fruit <span class="token operator">=</span> pick_fruit<span class="token punctuation">(</span><span class="token punctuation">)</span>\n   <span class="token keyword">if</span> <span class="token keyword">not</span> fresh_fruit<span class="token punctuation">:</span>\n      <span class="token keyword">break</span>\n    <span class="token keyword">for</span> fruit<span class="token punctuation">,</span> count <span class="token keyword">in</span> fresh_fruit<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        batch <span class="token operator">=</span> make_juice<span class="token punctuation">(</span>fruit<span class="token punctuation">,</span> count<span class="token punctuation">)</span>\n        bottles<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>batch<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有了海象操作符，就不需要使用 <code class="language-text">loop-and-a-half</code> 模式了，我们可以在每轮循环的开头给 <code class="language-text">fresh_fruit</code> 变量赋值，并根据变量的值来决定要不要继续循环。这个写法简单易读，所以应该成为首选方案。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98335639316131070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`bottles = []\nwhile fresh_fruit := pick_fruit():\n    for fruit, count in fresh_fruit.items():\n        batch = make_juice(fruit, count)\n        bottles.extend(batch)`, `98335639316131070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">bottles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token keyword">while</span> fresh_fruit <span class="token punctuation">:</span><span class="token operator">=</span> pick_fruit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> fruit<span class="token punctuation">,</span> count <span class="token keyword">in</span> fresh_fruit<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        batch <span class="token operator">=</span> make_juice<span class="token punctuation">(</span>fruit<span class="token punctuation">,</span> count<span class="token punctuation">)</span>\n        bottles<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>batch<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在其他一些场合，赋值表达式也能缩减重复代码（参见第 29 条）。总之，如果某个表达式或赋值操作多次出现在一组代码里面，那就可以考虑用赋值表达式把这段代码改得简单一些。</p>\n<h3 id="总结-6"><a href="#%E6%80%BB%E7%BB%93-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>赋值表达式通过海象操作符（:=）给变量赋值，并且让这个值成为这条表达式的结果，于是，我们可以利用这项特性来缩减代码。如果赋值表达式是大表达式里的一部分，就得用一对括号把它括起来。</li>\n<li>虽说 Python 不支持 switch/case 与 do/while 结构，但可以利用赋值表达式清晰地模拟出这种逻辑。</li>\n</ol>\n<h1 id="列表与字典"><a href="#%E5%88%97%E8%A1%A8%E4%B8%8E%E5%AD%97%E5%85%B8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表与字典</h1>\n<h2 id="第-11-条：学会对序列做切片"><a href="#%E7%AC%AC-11-%E6%9D%A1%EF%BC%9A%E5%AD%A6%E4%BC%9A%E5%AF%B9%E5%BA%8F%E5%88%97%E5%81%9A%E5%88%87%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 11 条：学会对序列做切片</h2>\n<p>Python 有这样一种写法，可以从序列里面切割（slice）出一部分内容，让我们能够轻松地获取原序列的某个子集合。最简单的用法就是切割内置的 list、str 与 bytes。其实，凡是实现了 <code class="language-text">__getitem__</code> 与 <code class="language-text">__setitem__</code> 这两个特殊方法的类都可以切割（参见第 43 条）。</p>\n<p>最基本的写法是用 <code class="language-text">somelist[start:end]</code> 这一形式来切割，也就是从 start 开始一直取到 end 这个位置，但不包含 end 本身的元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15795457798379143000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nprint(\'Middle two:   \', a[3:5])\nprint(\'All but ends: \', a[1:7])\n\n>>>\nMiddle two:    [\'d\', \'e\']\nAll but ends:  [\'b\', \'c\', \'d\', \'e\', \'f\', \'g\']`, `15795457798379143000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Middle two:   \'</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'All but ends: \'</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nMiddle two<span class="token punctuation">:</span>    <span class="token punctuation">[</span><span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">]</span>\nAll but ends<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果是从头开始切割列表，那就应该省略冒号左侧的下标 0，这样看起来更清晰。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8179065996288593000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`assert a[:5] == a[0:5]`, `8179065996288593000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">assert</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果一直取到列表末尾，那就应该省略冒号右侧的下标，因为用不着专门把它写出来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10056289254025818000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`assert a[5:] == a[5:len(a)]`, `10056289254025818000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">assert</span> a<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> a<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>用负数作下标表示从列表末尾往前算。下面这些切割方式，即便是刚看到这段代码的人也应该能明白是什么意思。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32500573173469393000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nprint(a[:]) # [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nprint(a[:5]) # [\'a\', \'b\', \'c\', \'d\', \'e\']\nprint(a[:-1]) # [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\']\nprint(a[4:]) # [\'e\', \'f\', \'g\', \'h\']\nprint(a[-3:]) # [\'f\', \'g\', \'h\']\nprint(a[2:5]) # [\'c\', \'d\', \'e\']\nprint(a[2:-1]) # [\'c\', \'d\', \'e\', \'f\', \'g\']\nprint(a[-3:-1]) # [\'f\', \'g\']`, `32500573173469393000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'a\', \'b\', \'c\', \'d\', \'e\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'e\', \'f\', \'g\', \'h\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'f\', \'g\', \'h\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'c\', \'d\', \'e\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'c\', \'d\', \'e\', \'f\', \'g\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [\'f\', \'g\']</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果起点与终点所确定的范围超出了列表的边界，那么系统会自动忽略不存在的元素。利用这项特性，很容易就能构造出一个最多只有若干元素的输入序列，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49924603213001720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`first_twenty_items = a[:20]\nlast_twenty_items = a[-20:]`, `49924603213001720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">first_twenty_items <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>\nlast_twenty_items <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>切割时所用的下标可以越界，但是直接访问列表时却不行，那样会让程序抛出异常。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60334069430929070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a[20]\n\n>>>\nTraceback ...\nIndexError: list index out of range`, `60334069430929070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nIndexError<span class="token punctuation">:</span> <span class="token builtin">list</span> index out of <span class="token builtin">range</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>切割出来的列表是一份全新的列表。即便把某个元素换掉，也不会影响原列表中的相应位置。那个位置上的元素还是旧值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4454493221232414000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nb = a[3:]\nprint(\'Before:\', b)\nb[1] = 99\nprint(\'After: \', b)\nprint(\'No change:\', a)\n\n>>>\nBefore: [\'d\', \'e\', \'f\', \'g\', \'h\']\nAfter:  [\'d\', 99, \'f\', \'g\', \'h\']\nNo change: [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']`, `4454493221232414000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nb <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Before:\'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>\nb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">99</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After: \'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'No change:\'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nBefore<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nAfter<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nNo change<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>切片可以出现在赋值符号的左侧，表示用右侧那些元素把原列表中位于这个范围之内的元素换掉。与 unpacking 形式的赋值不同，这种赋值不要求等号两边所指定的元素个数必须相同（如果是做 unpacking，那么等号左侧用来接收数值的变量个数必须与等号右边所提供的数值个数一致，例如 <code class="language-text">a, b = c[:2]</code>，参见第 6 条）。在原列表中，位于切片范围之前和之后的那些元素会予以保留，但是列表的长度可能有所变化。例如在下面这个例子中，列表会变短，因为赋值符号右侧只提供了 3 个值，但是左侧那个切片却涵盖了 5 个值，列表会比原来少两个元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89797549649882000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nprint(\'Before \', a)\na[2:7] = [99, 22, 14]\nprint(\'After  \', a)\n\n>>>\nBefore  [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nAfter   [\'a\', \'b\', 99, 22, 14, \'h\']`, `89797549649882000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Before \'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>\na<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After  \'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nBefore  <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nAfter   <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面这段代码会使列表变长，因为赋值符号右侧的元素数量比左侧那个切片所涵盖的元素数量要多。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54375686288643530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nprint(\'Before \', a)\na[2:3] = [47, 11]\nprint(\'After  \', a)\n\n>>>\nBefore  [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nAfter   [\'a\', \'b\', 47, 11, \'d\', \'e\', \'f\', \'g\', \'h\']`, `54375686288643530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Before \'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>\na<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After  \'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nBefore  <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nAfter   <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>起止位置都留空的切片，如果出现在赋值符号右侧，那么表示给这个列表做副本，这样制作出来的新列表内容和原列表相同，但身份不同。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61200165205799050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`b = a[:]\nassert b == a and b is not a`, `61200165205799050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">b <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token keyword">assert</span> b <span class="token operator">==</span> a <span class="token keyword">and</span> b <span class="token keyword">is</span> <span class="token keyword">not</span> a</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>把不带起止下标的切片放在赋值符号左边，表示是用右边那个列表的副本把左侧列表的全部内容替换掉（注意，左侧列表依然保持原来的身份，系统不会分配新的列表）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80008711903254430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nb = a\nc = a[:]\nprint(\'Before a\', a)\nprint(\'Before b\', b)\nprint(\'Before c\', b)\na[:] = [101, 102, 103]\nassert b is a and c is not a  # Still the same list object\nprint(\'After a \', a)  # Now has different contents\nprint(\'After b \', b)  # Same list, so same contents as a\nprint(\'After c \', c)  # Not same list, same contents as a\n\n>>>\nBefore a [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nBefore b [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nBefore c [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nAfter a  [101, 102, 103]\nAfter b  [101, 102, 103]\nAfter c  [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']`, `80008711903254430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nb <span class="token operator">=</span> a\nc <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Before a\'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Before b\'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Before c\'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>\na<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span>\n<span class="token keyword">assert</span> b <span class="token keyword">is</span> a <span class="token keyword">and</span> c <span class="token keyword">is</span> <span class="token keyword">not</span> a  <span class="token comment"># Still the same list object</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After a \'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>  <span class="token comment"># Now has different contents</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After b \'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token comment"># Same list, so same contents as a</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After c \'</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>  <span class="token comment"># Not same list, same contents as a</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nBefore a <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nBefore b <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nBefore c <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\nAfter a  <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span>\nAfter b  <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span>\nAfter c  <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-7"><a href="#%E6%80%BB%E7%BB%93-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>切片要尽可能写得简单一些：如果从头开始选取，就省略起始下标 0；如果选到序列末尾，就省略终止下标。</li>\n<li>切片允许起始下标或终止下标越界，所以很容易就能表达“取开头多少个元素”（例如 <code class="language-text">a[:20]</code>）或“取末尾多少个元素”（例如 <code class="language-text">a[-20:0]</code>）等含义，而不用担心切片是否真有这么多元素。</li>\n<li>把切片放在赋值符号的左侧可以将原列表中这段范围内的元素用赋值符号右侧的元素替换掉，但可能会改变原列表的长度。</li>\n</ol>\n<h2 id="第-12-条：不要在切片里同时指定起止下标与步进"><a href="#%E7%AC%AC-12-%E6%9D%A1%EF%BC%9A%E4%B8%8D%E8%A6%81%E5%9C%A8%E5%88%87%E7%89%87%E9%87%8C%E5%90%8C%E6%97%B6%E6%8C%87%E5%AE%9A%E8%B5%B7%E6%AD%A2%E4%B8%8B%E6%A0%87%E4%B8%8E%E6%AD%A5%E8%BF%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 12 条：不要在切片里同时指定起止下标与步进</h2>\n<p>除了基本的切片写法（参见第 11 条）外，Python 还有一种特殊的步进切片形式，也就是 somelist[start:end:stride]。这种形式会在每 n 个元素里面选取一个，这样很容易就能把奇数位置上的元素与偶数位置上的元素分别通过 <code class="language-text">x[::2]</code> 与 <code class="language-text">x[1::2]</code> 选取出来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47620964148165030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x = [\'red\', \'orange\', \'yellow\', \'green\', \'blue\', \'purple\']\nodds = x[::2]\nevens = x[1::2]\nprint(odds)\nprint(evens)\n\n>>>\n[\'red\', \'yellow\', \'blue\']\n[\'orange\', \'green\', \'purple\']`, `47620964148165030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span> <span class="token string">\'yellow\'</span><span class="token punctuation">,</span> <span class="token string">\'green\'</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token string">\'purple\'</span><span class="token punctuation">]</span>\nodds <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>\nevens <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>odds<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>evens<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token string">\'yellow\'</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'orange\'</span><span class="token punctuation">,</span> <span class="token string">\'green\'</span><span class="token punctuation">,</span> <span class="token string">\'purple\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>带有步进的切片经常会引发意外的效果，并且使程序出现 bug。例如，Python 里面有个常见的技巧，就是把 -1 当成步进值对 bytes 类型的字符串做切片，这样就能将字符串反转过来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15770881793197234000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x = b\'mongoose\'\ny = x[::-1]\nprint(y)\n\n>>>\nb\'esoognom\'`, `15770881793197234000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">x <span class="token operator">=</span> <span class="token string">b\'mongoose\'</span>\ny <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token string">b\'esoognom\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Unicode 形式的字符串也可以这样反转（参见第 3 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72337603854283280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x = \'多喝水\'\ny = x[::-1]\nprint(y)\n\n>>>\n水喝多`, `72337603854283280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">x <span class="token operator">=</span> <span class="token string">\'多喝水\'</span>\ny <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n水喝多</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但如果把这种字符串编码成 UTF-8 标准的字节数据，就不能用这个技巧来反转了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82904365581006370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x = \'多喝水\'\nx = x.encode(\'utf-8\')\ny = x[::-1]\nz = y.decode(\'utf-8\')\n\n>>>\nTraceback ...\nUnicodeDecodeError: \'utf-8\' codec can\'t decode byte 0xb4 in position 0: invalid start byte`, `82904365581006370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">x <span class="token operator">=</span> <span class="token string">\'多喝水\'</span>\nx <span class="token operator">=</span> x<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>\ny <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\nz <span class="token operator">=</span> y<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nUnicodeDecodeError<span class="token punctuation">:</span> <span class="token string">\'utf-8\'</span> codec can\'t decode byte <span class="token number">0xb4</span> <span class="token keyword">in</span> position <span class="token number">0</span><span class="token punctuation">:</span> invalid start byte</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>除了 -1 之外，用其他负数做步进值，有没有意义呢？请看下面的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95335580622685750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x = [\'a\', \'b\', \'c\', \'d\', \'e\', \'f\', \'g\', \'h\']\nprint(x[::2])  # [\'a\', \'c\', \'e\', \'g\']\nprint(x[::-2])  # [\'h\', \'f\', \'d\', \'b\']`, `95335580622685750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">,</span> <span class="token string">\'e\'</span><span class="token punctuation">,</span> <span class="token string">\'f\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [\'a\', \'c\', \'e\', \'g\']</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [\'h\', \'f\', \'d\', \'b\']</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>上例中，<code class="language-text">::2</code> 表示从头开始往后选，每两个元素里面选一个。<code class="language-text">::-2</code> 的含义稍微有点儿绕，表示从末尾开始往前选，每两个元素里面选一个。</p>\n<p>同时使用起止下标与步进会让切片很难懂。方括号里面写三个值显得太过拥挤，读起来不大容易，而且在指定了步进值（尤其是负数步进值）的时候，我们必须很仔细地考虑：这究竟是从前往后取，还是从后往前取？</p>\n<p>为了避免这个问题，笔者建议大家不要把起止下标和步进值同时写在切片里。如果必须指定步进，那么尽量采用正数，而且要把起止下标都留空。即便必须同时使用步进值与起止下标，也应该考虑分成两次来写。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47100542818735284000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`y = x[::2]  # [\'a\', \'c\', \'e\', \'g\']\nz = y[1:-1] # [\'c\', \'e\']`, `47100542818735284000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">y <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># [\'a\', \'c\', \'e\', \'g\']</span>\nz <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># [\'c\', \'e\']</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>像刚才那样先隔位选取然后再切割，会让程序多做一次浅拷贝（shallow copy）。所以，应该把最能缩减列表长度的那个切片操作放在前面。如果程序实在没有那么多时间或内存去分两步操作，那么可以改用内置的 itertools 模块中的 islice 方法（参见第 36 条），这个方法用起来更清晰，因为它的起止位置与步进值都不能是负数。</p>\n<h3 id="总结-8"><a href="#%E6%80%BB%E7%BB%93-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>同时指定切片的起止下标与步进值理解起来会很困难。</li>\n<li>如果要指定步进值，那就省略起止下标，而且最好采用正数作为步进值，尽量别用负数。</li>\n<li>不要把起始位置、终止位置与步进值全都写在同一个切片操作里。如果必须同时使用这三项指标，那就分两次来做（其中一次隔位选取，另一次做切割），也可以改用 itertools 内置模块里的 islice 方法。</li>\n</ol>\n<h2 id="第-13-条：通过带星号的-unpacking-操作来捕获多个元素，不要用切片"><a href="#%E7%AC%AC-13-%E6%9D%A1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%B8%A6%E6%98%9F%E5%8F%B7%E7%9A%84-unpacking-%E6%93%8D%E4%BD%9C%E6%9D%A5%E6%8D%95%E8%8E%B7%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%8C%E4%B8%8D%E8%A6%81%E7%94%A8%E5%88%87%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 13 条：通过带星号的 unpacking 操作来捕获多个元素，不要用切片</h2>\n<p>基本的 unpacking 操作（参见第 6 条）有一项限制，就是必须提前确定需要拆解的序列的长度。例如，销售汽车的时候，我们可能会把每辆车的车龄写在一份列表中，然后按照从大到小的顺序排列好。如果试着通过基本的 unpacking 操作获取其中最旧的两辆车，那么程序运行时会出现异常。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70374510696268830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`car_ages = [0, 9, 4, 8, 7, 20, 19, 1, 6, 15]\ncar_ages_descending = sorted(car_ages, reverse=True)\noldest, second_oldest = car_ages_descending\n\n>>>\nTraceback ...\nValueError: too many values to unpack (expected 2)`, `70374510696268830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">car_ages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span>\ncar_ages_descending <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>car_ages<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\noldest<span class="token punctuation">,</span> second_oldest <span class="token operator">=</span> car_ages_descending\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nValueError<span class="token punctuation">:</span> too many values to unpack <span class="token punctuation">(</span>expected <span class="token number">2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Python 新手经常通过下标与切片（参见第 11 条）来处理这个问题。例如，可以明确通过下标把最旧和第二旧的那两辆车取出来，然后把其余的车放到另一份列表中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58979077548299180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`car_ages = [0, 9, 4, 8, 7, 20, 19, 1, 6, 15]\ncar_ages_descending = sorted(car_ages, reverse=True)\noldest = car_ages_descending[0]\nsecond_oldest = car_ages_descending[1]\nothers = car_ages_descending[2:]\nprint(oldest, second_oldest, others)\n\n>>>\n20 19 [15, 9, 8, 7, 6, 4, 1, 0]`, `58979077548299180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">car_ages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span>\ncar_ages_descending <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>car_ages<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\noldest <span class="token operator">=</span> car_ages_descending<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\nsecond_oldest <span class="token operator">=</span> car_ages_descending<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\nothers <span class="token operator">=</span> car_ages_descending<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>oldest<span class="token punctuation">,</span> second_oldest<span class="token punctuation">,</span> others<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">20</span> <span class="token number">19</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样做没问题，但是下标与切片会让代码看起来很乱。而且，用这种办法把序列中的元素分成多个子集合，其实很容易出错，因为我们通常容易把下标多写或少写一个位置。例如，若修改了其中一行，但却忘了更新另一行，那就会遇到这种错误。</p>\n<p>这个问题通过带星号的表达式（starred expression）来解决会更好一些，这也是一种 unpacking 操作，它可以把无法由普通变量接收的那些元素全都囊括进去。下面用带星号的 unpacking 操作改写刚才那段代码，这次既不用取下标，也不用做切片。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40549968292553220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`car_ages = [0, 9, 4, 8, 7, 20, 19, 1, 6, 15]\ncar_ages_descending = sorted(car_ages, reverse=True)\noldest, second_oldest, *others = car_ages_descending\nprint(oldest, second_oldest, others)\n\n>>>\n20 19 [15, 9, 8, 7, 6, 4, 1, 0]`, `40549968292553220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">car_ages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span>\ncar_ages_descending <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>car_ages<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\noldest<span class="token punctuation">,</span> second_oldest<span class="token punctuation">,</span> <span class="token operator">*</span>others <span class="token operator">=</span> car_ages_descending\n<span class="token keyword">print</span><span class="token punctuation">(</span>oldest<span class="token punctuation">,</span> second_oldest<span class="token punctuation">,</span> others<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">20</span> <span class="token number">19</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写简短易读，而且不容易出错，因为它不要求我们在修改完其中一个下标之后，还必须记得同步更新其他的下标。</p>\n<p>这种带星号的表达式可以出现在任意位置，所以它能够捕获序列中的任何一段元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1331364970566162400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`car_ages = [0, 9, 4, 8, 7, 20, 19, 1, 6, 15]\ncar_ages_descending = sorted(car_ages, reverse=True)\noldest, *others, youngest = car_ages_descending\nprint(oldest, youngest, others)\n*others, second_youngest, youngest = car_ages_descending\nprint(youngest, second_youngest, others)\n\n>>>\n20 0 [19, 15, 9, 8, 7, 6, 4, 1]\n0 1 [20, 19, 15, 9, 8, 7, 6, 4]`, `1331364970566162400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">car_ages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span>\ncar_ages_descending <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>car_ages<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\noldest<span class="token punctuation">,</span> <span class="token operator">*</span>others<span class="token punctuation">,</span> youngest <span class="token operator">=</span> car_ages_descending\n<span class="token keyword">print</span><span class="token punctuation">(</span>oldest<span class="token punctuation">,</span> youngest<span class="token punctuation">,</span> others<span class="token punctuation">)</span>\n<span class="token operator">*</span>others<span class="token punctuation">,</span> second_youngest<span class="token punctuation">,</span> youngest <span class="token operator">=</span> car_ages_descending\n<span class="token keyword">print</span><span class="token punctuation">(</span>youngest<span class="token punctuation">,</span> second_youngest<span class="token punctuation">,</span> others<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">20</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token number">0</span> <span class="token number">1</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只不过，在使用这种写法时，至少要有一个普通的接收变量与它搭配，否则就会出现 SyntaxError。例如不能像下面这样，只使用带星号的表达式而不搭配普通变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88613351942344650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`car_ages = [0, 9, 4, 8, 7, 20, 19, 1, 6, 15]\ncar_ages_descending = sorted(car_ages, reverse=True)\n*others = car_ages_descending\n\n>>>\nSyntaxError: starred assignment target must be in a list or tuple`, `88613351942344650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">car_ages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span>\ncar_ages_descending <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>car_ages<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token operator">*</span>others <span class="token operator">=</span> car_ages_descending\n\n<span class="token operator">>></span><span class="token operator">></span>\nSyntaxError<span class="token punctuation">:</span> starred assignment target must be <span class="token keyword">in</span> a <span class="token builtin">list</span> <span class="token keyword">or</span> <span class="token builtin">tuple</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外，对于单层结构来说，同一级里面最多只能出现一次带星号的 unpacking。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76202379079150300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`first, *middle, *second_middle, last = [1, 2, 3, 4]\n\n>>>\nSyntaxError: two starred expressions in assignment`, `76202379079150300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">first<span class="token punctuation">,</span> <span class="token operator">*</span>middle<span class="token punctuation">,</span> <span class="token operator">*</span>second_middle<span class="token punctuation">,</span> last <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nSyntaxError<span class="token punctuation">:</span> two starred expressions <span class="token keyword">in</span> assignment</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果要拆解的结构有很多层，那么同一级的不同部分里面可以各自出现带星号的 unpacking 操作。当然笔者并不推荐这种写法（类似的建议参见第 19 条）。这里举这样一个例子，是想帮助大家理解这种带星号的表达式可以实现怎样的拆分效果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30153144305353320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`car_inventory = {\n    \'Downtown\': (\'Silver Shadow\', \'Pinto\', \'DMC\'),\n    \'Airport\': (\'Skyline\', \'Viper\', \'Gremlin\', \'Nova\'),\n}\n\n((loc1, (best1, *rest1)),\n (loc2, (best2, *rest2))) = car_inventory.items()\nprint(f\'Best at {loc1} is {best1}, {len(rest1)} others\')\nprint(f\'Best at {loc2} is {best2}, {len(rest2)} others\')\n\n>>>\nBest at Downtown is Silver Shadow, 2 others\nBest at Airport is Skyline, 3 others`, `30153144305353320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">car_inventory <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'Downtown\'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">\'Silver Shadow\'</span><span class="token punctuation">,</span> <span class="token string">\'Pinto\'</span><span class="token punctuation">,</span> <span class="token string">\'DMC\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token string">\'Airport\'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">\'Skyline\'</span><span class="token punctuation">,</span> <span class="token string">\'Viper\'</span><span class="token punctuation">,</span> <span class="token string">\'Gremlin\'</span><span class="token punctuation">,</span> <span class="token string">\'Nova\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token punctuation">(</span><span class="token punctuation">(</span>loc1<span class="token punctuation">,</span> <span class="token punctuation">(</span>best1<span class="token punctuation">,</span> <span class="token operator">*</span>rest1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n <span class="token punctuation">(</span>loc2<span class="token punctuation">,</span> <span class="token punctuation">(</span>best2<span class="token punctuation">,</span> <span class="token operator">*</span>rest2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> car_inventory<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Best at </span><span class="token interpolation"><span class="token punctuation">{</span>loc1<span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>best1<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>rest1<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> others\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Best at </span><span class="token interpolation"><span class="token punctuation">{</span>loc2<span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>best2<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>rest2<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> others\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nBest at Downtown <span class="token keyword">is</span> Silver Shadow<span class="token punctuation">,</span> <span class="token number">2</span> others\nBest at Airport <span class="token keyword">is</span> Skyline<span class="token punctuation">,</span> <span class="token number">3</span> others</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>带星号的表达式总会形成一份列表实例。如果要拆分的序列里已经没有元素留给它了，那么列表就是空白的。如果能提前确定有待处理的序列里至少会有 N 个元素，那么这项特性就相当有用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82741669195592900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`short_list = [1, 2]\nfirst, second, *rest = short_list\nprint(first, second, rest)\n\n>>>\n1 2 []`, `82741669195592900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">short_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\nfirst<span class="token punctuation">,</span> second<span class="token punctuation">,</span> <span class="token operator">*</span>rest <span class="token operator">=</span> short_list\n<span class="token keyword">print</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">,</span> rest<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span> <span class="token number">2</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>unpacking 操作也可以用在迭代器上，但是这样写与把数据拆分到多个变量里面的那种基本写法相比，并没有太大优势。例如，我可以先构造长度为 2 的取值范围（range），并把它封装在 it 这个迭代器里，然后将其中的值拆分到 first 与 second 这两个变量里。但这样写还不如直接使用形式相符的静态列表（例如[1, 2]），那样更简单。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84096411696203730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`it = iter(range(1, 3))\nfirst, second = it\nprint(f\'{first} and {second}\')\n\n>>>\n1 and 2`, `84096411696203730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">it <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nfirst<span class="token punctuation">,</span> second <span class="token operator">=</span> it\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>first<span class="token punctuation">}</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token punctuation">{</span>second<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span> <span class="token keyword">and</span> <span class="token number">2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对迭代器做 unpacking 操作的好处，主要体现在带星号的用法上面，它使迭代器的拆分值更清晰。例如，这里有个生成器，每次可以从含有整个一周的汽车订单的 CSV 文件中取出一行数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54723054594861780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def generate_csv():\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    # ...`, `54723054594861780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">generate_csv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token comment"># ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>我们可以用下标和切片来处理这个生成器所给出的结果，但这样写需要很多行代码，而且看着比较混乱。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3533111002435762700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def generate_csv():\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    # ...\n\n\nall_csv_rows = list(generate_csv())\nheader = all_csv_rows[0]\nrows = all_csv_rows[1:]\nprint(\'CSV Header:\', header)\nprint(\'Row count:\', len(rows))\n\n>>>\nCSV Header: (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\nRow count: 4`, `3533111002435762700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">generate_csv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token comment"># ...</span>\n\n\nall_csv_rows <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>generate_csv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nheader <span class="token operator">=</span> all_csv_rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\nrows <span class="token operator">=</span> all_csv_rows<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'CSV Header:\'</span><span class="token punctuation">,</span> header<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Row count:\'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nCSV Header<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\nRow count<span class="token punctuation">:</span> <span class="token number">4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>利用带星号的 unpacking 操作，我们可以把第一行（表头）单独放在 header 变量里，同时把迭代器所给出的其余内容合起来表示成 rows 变量。这样写就清楚多了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57311083140507525000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def generate_csv():\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    yield (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\n    # ...\n\n\nit = list(generate_csv())\nheader, *rows = it\nprint(\'CSV Header:\', header)\nprint(\'Row count:\', len(rows))\n\n>>>\nCSV Header: (\'Date\', \'Make\', \'Model\', \'Year\', \'Price\')\nRow count: 4`, `57311083140507525000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">generate_csv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\n    <span class="token comment"># ...</span>\n\n\nit <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>generate_csv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nheader<span class="token punctuation">,</span> <span class="token operator">*</span>rows <span class="token operator">=</span> it\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'CSV Header:\'</span><span class="token punctuation">,</span> header<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Row count:\'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nCSV Header<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">\'Date\'</span><span class="token punctuation">,</span> <span class="token string">\'Make\'</span><span class="token punctuation">,</span> <span class="token string">\'Model\'</span><span class="token punctuation">,</span> <span class="token string">\'Year\'</span><span class="token punctuation">,</span> <span class="token string">\'Price\'</span><span class="token punctuation">)</span>\nRow count<span class="token punctuation">:</span> <span class="token number">4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>带星号的这部分总是会形成一份列表，所以要注意，这有可能耗尽计算机的全部内存并导致程序崩溃。首先必须确定系统有足够的内存可以存储拆分出来的结果数据，然后才可以对迭代器使用带星号的 unpacking 操作（还有另一种做法，参见第 31 条）。</p>\n<h3 id="总结-9"><a href="#%E6%80%BB%E7%BB%93-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>拆分数据结构并把其中的数据赋给变量时，可以用带星号的表达式，将结构中无法与普通变量相匹配的内容捕获到一份列表里。</li>\n<li>这种带星号的表达式可以出现在赋值符号左侧的任意位置，它总是会形成一份含有零个或多个值的列表。</li>\n<li>在把列表拆解成互相不重叠的多个部分时，这种带星号的 unpacking 方式比较清晰，而通过下标与切片来实现的方式则很容易出错。</li>\n</ol>\n<h2 id="第-14-条：用-sort-方法的-key-参数来表示复杂的排序逻辑"><a href="#%E7%AC%AC-14-%E6%9D%A1%EF%BC%9A%E7%94%A8-sort-%E6%96%B9%E6%B3%95%E7%9A%84-key-%E5%8F%82%E6%95%B0%E6%9D%A5%E8%A1%A8%E7%A4%BA%E5%A4%8D%E6%9D%82%E7%9A%84%E6%8E%92%E5%BA%8F%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 14 条：用 sort 方法的 key 参数来表示复杂的排序逻辑</h2>\n<p>内置的列表类型提供了名叫 sort 的方法，可以根据多项指标给 list 实例中的元素排序。在默认情况下，sort 方法总是按照自然升序排列列表内的元素。例如，如果列表中的元素都是整数，那么它就按数值从小到大排列。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45203485639774500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`numbers = [93, 86, 11, 68, 70]\nnumbers.sort()\nprint(numbers)\n\n>>>\n[11, 68, 70, 86, 93]`, `45203485639774500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span>\nnumbers<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里定义了一个 Tool 类表示各种建筑工具，它带有 <code class="language-text">__repr__</code> 方法，因此我们能把这个类的实例打印成字符串。</p>\n<p>如果仅仅这样写，那么这个由该类的对象所构成的列表是没办法用 sort 方法排序的，因为 sort 方法发现，排序所需要的特殊方法并没有定义在 Tool 类中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9918472321490723000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Tool:\n    def __init__(self, name, weight):\n        self.name = name\n        self.weight = weight\n\n    def __repr__(self):\n        return f\'Tool({self.name!r}, {self.weight})\'\n\n\ntools = [\n    Tool(\'level\', 3.5),\n    Tool(\'hammer\', 1.25),\n    Tool(\'screwdriver\', 0.5),\n    Tool(\'chisel\', 0.25),\n]\n\ntools.sort()\n\n>>>\nTraceback ...\nTypeError: \'<\' not supported between instances of \'Tool\' and \'Tool\'`, `9918472321490723000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Tool</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> weight\n\n    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f\'Tool(</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>weight<span class="token punctuation">}</span></span><span class="token string">)\'</span></span>\n\n\ntools <span class="token operator">=</span> <span class="token punctuation">[</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'level\'</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'hammer\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'screwdriver\'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'chisel\'</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\ntools<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> <span class="token string">\'&lt;\'</span> <span class="token keyword">not</span> supported between instances of <span class="token string">\'Tool\'</span> <span class="token keyword">and</span> <span class="token string">\'Tool\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面用 lambda 关键字定义这样的一个函数，把它传给 sort 方法的 key 参数，让我们能够按照 name 的字母顺序排列这些 Tool 对象。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47290798131969016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Tool:\n    def __init__(self, name, weight):\n        self.name = name\n        self.weight = weight\n\n    def __repr__(self):\n        return f\'Tool({self.name!r}, {self.weight})\'\n\n\ntools = [\n    Tool(\'level\', 3.5),\n    Tool(\'hammer\', 1.25),\n    Tool(\'screwdriver\', 0.5),\n    Tool(\'chisel\', 0.25),\n]\n\nprint(\'Unsorted:\', repr(tools))\ntools.sort(key=lambda x: x.name)\nprint(\'\\nSorted:\', tools)\n\n>>>\nUnsorted: [Tool(\'level\', 3.5), Tool(\'hammer\', 1.25), Tool(\'screwdriver\', 0.5), Tool(\'chisel\', 0.25)]\n\nSorted: [Tool(\'chisel\', 0.25), Tool(\'hammer\', 1.25), Tool(\'level\', 3.5), Tool(\'screwdriver\', 0.5)]`, `47290798131969016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Tool</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> weight\n\n    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f\'Tool(</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>weight<span class="token punctuation">}</span></span><span class="token string">)\'</span></span>\n\n\ntools <span class="token operator">=</span> <span class="token punctuation">[</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'level\'</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'hammer\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'screwdriver\'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'chisel\'</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Unsorted:\'</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>tools<span class="token punctuation">)</span><span class="token punctuation">)</span>\ntools<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'\\nSorted:\'</span><span class="token punctuation">,</span> tools<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nUnsorted<span class="token punctuation">:</span> <span class="token punctuation">[</span>Tool<span class="token punctuation">(</span><span class="token string">\'level\'</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'hammer\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'screwdriver\'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'chisel\'</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n\nSorted<span class="token punctuation">:</span> <span class="token punctuation">[</span>Tool<span class="token punctuation">(</span><span class="token string">\'chisel\'</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'hammer\'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'level\'</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'screwdriver\'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有时我们可能需要用多个标准来排序。可以利用元组的特性：如果两个元组的首个元素相等，就比较第二个元素，如果仍然相等，就继续往下比较。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17110576003853107000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Tool:\n    def __init__(self, name, weight):\n        self.name = name\n        self.weight = weight\n\n    def __repr__(self):\n        return f\'Tool({self.name!r}, {self.weight})\'\n\n\npower_tools = [\n    Tool(\'drill\', 4),\n    Tool(\'circular saw\', 5),\n    Tool(\'jackhammer\', 40),\n    Tool(\'sander\', 4),\n]\n\npower_tools.sort(key=lambda x: (x.weight, x.name))\nprint(power_tools)\n\npower_tools.sort(key=lambda x: (x.weight, x.name), reverse=True)\nprint(power_tools)\n\n>>>\n[Tool(\'drill\', 4), Tool(\'sander\', 4), Tool(\'circular saw\', 5), Tool(\'jackhammer\', 40)]\n[Tool(\'jackhammer\', 40), Tool(\'circular saw\', 5), Tool(\'sander\', 4), Tool(\'drill\', 4)]`, `17110576003853107000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Tool</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> weight\n\n    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f\'Tool(</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>weight<span class="token punctuation">}</span></span><span class="token string">)\'</span></span>\n\n\npower_tools <span class="token operator">=</span> <span class="token punctuation">[</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'drill\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'circular saw\'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'jackhammer\'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Tool<span class="token punctuation">(</span><span class="token string">\'sander\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\npower_tools<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>power_tools<span class="token punctuation">)</span>\n\npower_tools<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>power_tools<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span>Tool<span class="token punctuation">(</span><span class="token string">\'drill\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'sander\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'circular saw\'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'jackhammer\'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span>Tool<span class="token punctuation">(</span><span class="token string">\'jackhammer\'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'circular saw\'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'sander\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tool<span class="token punctuation">(</span><span class="token string">\'drill\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种做法有个缺点，就是 key 函数所构造的这个元组只能按同一个排序方向来对比它所表示的各项指标（要是升序，就都得是升序；要是降序，就都得是降序），可以利用以下方法实现不同方向的排序</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41432192576445080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`power_tools.sort(key=lambda x: (-x.weight, x.name))\nprint(power_tools)`, `41432192576445080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">power_tools<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>power_tools<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是 str 类型不支持一元减操作符，可以通过多次调用 sort 方法实现不同方向的排序，这里利用了 sort 方法是稳定排序算法的原理</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67939382009042370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`power_tools.sort(key=lambda x: x.name)  # Name ascending\npower_tools.sort(key=lambda x: x.weight, reverse=True)  # Weight descending\nprint(power_tools)`, `67939382009042370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">power_tools<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Name ascending</span>\npower_tools<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># Weight descending</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>power_tools<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>无论有多少项排序指标都可以按照这种思路来实现，而且每项指标可以分别按照各自的方向来排，不用全都是升序或全都是降序。只需要倒着写即可，也就是把最主要的那项排序指标放在最后一轮处理。在上面的例子中，首要指标是重量降序，次要指标是名称升序，所以先按名称升序排列，然后按重量降序排列。</p>\n<p>尽管这两种思路都能实现同样的效果，但只调用一次 sort，还是要比多次调用 sort 更为简单。所以，在实现多个指标按不同方向排序时，应该优先考虑让 key 函数返回元组，并对元组中的相应指标取相反数。只有在万不得已的时候，才可以考虑多次调用 sort 方法。</p>\n<h3 id="总结-10"><a href="#%E6%80%BB%E7%BB%93-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>列表的 sort 方法可以根据自然顺序给其中的字符串、整数、元组等内置类型的元素进行排序。</li>\n<li>普通对象如果通过特殊方法定义了自然顺序，那么也可以用 sort 方法来排列，但这样的对象并不多见。</li>\n<li>可以把辅助函数传给 sort 方法的 key 参数，让 sort 根据这个函数所返回的值来排列元素顺序，而不是根据元素本身来排列。</li>\n<li>如果排序时要依据的指标有很多项，可以把它们放在一个元组中，让 key 函数返回这样的元组。对于支持一元减操作符的类型来说，可以单独给这项指标取反，让排序算法在这项指标上按照相反的方向处理。</li>\n<li>如果这些指标不支持一元减操作符，可以多次调用 sort 方法，并在每次调用时分别指定 key 函数与 reverse 参数。最次要的指标放在第一轮处理，然后逐步处理更为重要的指标，首要指标放在最后一轮处理。</li>\n</ol>\n<h2 id="第-15-条：不要过分依赖给字典添加条目时所用的顺序"><a href="#%E7%AC%AC-15-%E6%9D%A1%EF%BC%9A%E4%B8%8D%E8%A6%81%E8%BF%87%E5%88%86%E4%BE%9D%E8%B5%96%E7%BB%99%E5%AD%97%E5%85%B8%E6%B7%BB%E5%8A%A0%E6%9D%A1%E7%9B%AE%E6%97%B6%E6%89%80%E7%94%A8%E7%9A%84%E9%A1%BA%E5%BA%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 15 条：不要过分依赖给字典添加条目时所用的顺序</h2>\n<p>在 Python 3.5 与之前的版本中，迭代字典（dict）时所看到的顺序好像是任意的，不一定与当初把这些键值对添加到字典时的顺序相同。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85125573356873920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# Python 3.5\nbaby_names = {\n    \'cat\': \'kitten\',\n    \'dog\': \'puppy\',\n}\n\nprint(baby_names)\n\n>>>\n{\'dog\': \'puppy\', \'cat\': \'kitten\'}`, `85125573356873920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># Python 3.5</span>\nbaby_names <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'cat\'</span><span class="token punctuation">:</span> <span class="token string">\'kitten\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'dog\'</span><span class="token punctuation">:</span> <span class="token string">\'puppy\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'dog\'</span><span class="token punctuation">:</span> <span class="token string">\'puppy\'</span><span class="token punctuation">,</span> <span class="token string">\'cat\'</span><span class="token punctuation">:</span> <span class="token string">\'kitten\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>之所以出现这种效果，是因为字典类型以前是用哈希表算法来实现的（这个算法通过内置的 hash 函数与一个随机的种子数来运行，而该种子数会在每次启动 Python 解释器时确定）。所以，这样的机制导致这些键值对在字典中的存放顺序不一定会与添加时的顺序相同，而且每次运行程序的时候，存放顺序可能都不一样。</p>\n<p>从 Python 3.6 开始，字典会保留这些键值对在添加时所用的顺序，而且 Python 3.7 版的语言规范正式确立了这条规则。于是，在新版的 Python 里，总是能够按照当初创建字典时的那套顺序来遍历这些键值对。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72519844067159410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`baby_names = {\n    \'cat\': \'kitten\',\n    \'dog\': \'puppy\',\n}\n\nprint(baby_names)\n\n>>>\n{\'cat\': \'kitten\', \'dog\': \'puppy\'}`, `72519844067159410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">baby_names <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'cat\'</span><span class="token punctuation">:</span> <span class="token string">\'kitten\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'dog\'</span><span class="token punctuation">:</span> <span class="token string">\'puppy\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'cat\'</span><span class="token punctuation">:</span> <span class="token string">\'kitten\'</span><span class="token punctuation">,</span> <span class="token string">\'dog\'</span><span class="token punctuation">:</span> <span class="token string">\'puppy\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Python 3.5 与之前的版本中，dict 所提供的许多方法（包括 keys、values、items 与 popitem 等）都不保证固定的顺序，所以让人觉得好像是随机处理的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64117583236135590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`baby_names = {\n    \'cat\': \'kitten\',\n    \'dog\': \'puppy\',\n}\n\n# Python 3.5\nprint(list(baby_names.keys()))\nprint(list(baby_names.values()))\nprint(list(baby_names.items()))\nprint(baby_names.popitem())  # Randomly chooses an item\n\n>>>\n[\'dog\', \'cat\']\n[\'puppy\', \'kitten\']\n[(\'dog\', \'puppy\'), (\'cat\', \'kitten\')]\n(\'dog\', \'puppy\')`, `64117583236135590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">baby_names <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'cat\'</span><span class="token punctuation">:</span> <span class="token string">\'kitten\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'dog\'</span><span class="token punctuation">:</span> <span class="token string">\'puppy\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment"># Python 3.5</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Randomly chooses an item</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token string">\'dog\'</span><span class="token punctuation">,</span> <span class="token string">\'cat\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'puppy\'</span><span class="token punctuation">,</span> <span class="token string">\'kitten\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'dog\'</span><span class="token punctuation">,</span> <span class="token string">\'puppy\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'cat\'</span><span class="token punctuation">,</span> <span class="token string">\'kitten\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token punctuation">(</span><span class="token string">\'dog\'</span><span class="token punctuation">,</span> <span class="token string">\'puppy\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在新版的 Python 中，这些方法已经可以按照当初添加键值对时的顺序来处理了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78526435921174680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`baby_names = {\n    \'cat\': \'kitten\',\n    \'dog\': \'puppy\',\n}\n\nprint(list(baby_names.keys()))\nprint(list(baby_names.values()))\nprint(list(baby_names.items()))\nprint(baby_names.popitem())  # Randomly chooses an item\n\n>>>\n[\'cat\', \'dog\']\n[\'kitten\', \'puppy\']\n[(\'cat\', \'kitten\'), (\'dog\', \'puppy\')]\n(\'dog\', \'puppy\')`, `78526435921174680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">baby_names <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'cat\'</span><span class="token punctuation">:</span> <span class="token string">\'kitten\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'dog\'</span><span class="token punctuation">:</span> <span class="token string">\'puppy\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>baby_names<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Randomly chooses an item</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token string">\'cat\'</span><span class="token punctuation">,</span> <span class="token string">\'dog\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'kitten\'</span><span class="token punctuation">,</span> <span class="token string">\'puppy\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'cat\'</span><span class="token punctuation">,</span> <span class="token string">\'kitten\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'dog\'</span><span class="token punctuation">,</span> <span class="token string">\'puppy\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token punctuation">(</span><span class="token string">\'dog\'</span><span class="token punctuation">,</span> <span class="token string">\'puppy\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这项变化对 Python 中那些依赖字典类型及其实现细节的特性产生了很多影响。</p>\n<p>函数的关键字参数（包括万能的 <code class="language-text">**kwargs</code> 参数，参见第 23 条），以前是按照近乎随机的顺序出现的，这使函数调用操作变得很难调试。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12380504758513111000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# Python 3.5\ndef my_func(**kwargs):\n    for key, value in kwargs.items():\n        print(\'%s = %s\' % (key, value))\n\n\nmy_func(goose=\'gosling\', kangaroo=\'joey\')\n\n>>>\nkangaroo = joey\ngoose = gosling`, `12380504758513111000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># Python 3.5</span>\n<span class="token keyword">def</span> <span class="token function">my_func</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s = %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\nmy_func<span class="token punctuation">(</span>goose<span class="token operator">=</span><span class="token string">\'gosling\'</span><span class="token punctuation">,</span> kangaroo<span class="token operator">=</span><span class="token string">\'joey\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nkangaroo <span class="token operator">=</span> joey\ngoose <span class="token operator">=</span> gosling</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，这些关键字参数总是能够保留调用函数时所指定的那套顺序。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61627170348275384000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def my_func(**kwargs):\n    for key, value in kwargs.items():\n        print(\'%s = %s\' % (key, value))\n\n\nmy_func(goose=\'gosling\', kangaroo=\'joey\')\n\n>>>\ngoose = gosling\nkangaroo = joey`, `61627170348275384000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">my_func</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s = %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\nmy_func<span class="token punctuation">(</span>goose<span class="token operator">=</span><span class="token string">\'gosling\'</span><span class="token punctuation">,</span> kangaroo<span class="token operator">=</span><span class="token string">\'joey\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\ngoose <span class="token operator">=</span> gosling\nkangaroo <span class="token operator">=</span> joey</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外，类也会利用字典来保存这个类的实例所具备的一些数据。在早前版本的 Python 中，对象（object）中的字段看上去好像是按随机顺序出现的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38079075776720690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyClass:\n    def __init__(self):\n        self.alligator = \'hatchling\'\n        self.elephant = \'calf\'\n\n\na = MyClass()\nfor key, value in a.__dict__.items():\n    print(\'%s = %s\' % (key, value))\n\n>>>\n# Python 3.5\nelephant = calf\nalligator = hatchling\n\n# Python > 3.5\nalligator = hatchling\nelephant = calf`, `38079075776720690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>alligator <span class="token operator">=</span> <span class="token string">\'hatchling\'</span>\n        self<span class="token punctuation">.</span>elephant <span class="token operator">=</span> <span class="token string">\'calf\'</span>\n\n\na <span class="token operator">=</span> MyClass<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> a<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s = %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token comment"># Python 3.5</span>\nelephant <span class="token operator">=</span> calf\nalligator <span class="token operator">=</span> hatchling\n\n<span class="token comment"># Python > 3.5</span>\nalligator <span class="token operator">=</span> hatchling\nelephant <span class="token operator">=</span> calf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在的 Python 语言规范已经要求，字典必须保留添加键值对时所依照的顺序。所以，我们可以利用这样的特征来实现一些功能，而且可以把它融入自己给类和函数所设计的 API 中。</p>\n<blockquote>\n<p>其实，内置的 collections 模块早就提供了这种能够保留插入顺序的字典，叫作 OrderedDict。它的行为跟（Python 3.7 以来的）标准 dict 类型很像，但性能上有很大区别。如果要频繁插入或弹出键值对（例如要实现 least-recently-used 缓存），那么 OrderedDict 可能比标准的 Python dict 类型更合适（如何判断是否应该换用这种类型，请参见第 70 条）。</p>\n</blockquote>\n<p>处理字典的时候，不能总是假设所有的字典都能保留键值对插入时的顺序。在 Python 中，我们很容易就能定义出特制的容器类型，并且让这些容器也像标准的 list 与 dict 等类型那样遵守相关的协议（参见第 43 条）。Python 不是静态类型的语言，大多数代码都以鸭子类型（duck typing）机制运作（也就是说，对象支持什么样的行为，就可以当成什么样的数据使用，而不用执着于它在类体系中的地位）。这种特性可能会产生意想不到的问题。</p>\n<p>例如，现在要写一个程序，统计各种小动物的受欢迎程度。我们可以设定一个字典，把每种动物和它得到的票数关联起来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45797739403137630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`votes = {\n    \'otter\': 1281,\n    \'polar bear\': 587,\n    \'fox\': 863,\n}`, `45797739403137630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">votes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'otter\'</span><span class="token punctuation">:</span> <span class="token number">1281</span><span class="token punctuation">,</span>\n    <span class="token string">\'polar bear\'</span><span class="token punctuation">:</span> <span class="token number">587</span><span class="token punctuation">,</span>\n    <span class="token string">\'fox\'</span><span class="token punctuation">:</span> <span class="token number">863</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在定义一个函数来处理投票数据。用户可以把空的字典传给这个函数，这样的话，它就会把每个动物及其排名放到这个字典中。这种字典可以充当数据模型，给带有用户界面（UI）的元素提供数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42012426639697240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def populate_ranks(votes, ranks):\n    names = list(votes.keys())\n    names.sort(key=votes.get, reverse=True)\n    for i, name in enumerate(names, 1):\n        ranks[name] = i`, `42012426639697240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">populate_ranks</span><span class="token punctuation">(</span>votes<span class="token punctuation">,</span> ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    names <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>votes<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    names<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>votes<span class="token punctuation">.</span>get<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> i<span class="token punctuation">,</span> name <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        ranks<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> i</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们还需要写一个函数来查出人气最高的动物。这个函数假定 populate_ranks 总是会按照升序向字典写入键值对，这样第一个出现在字典里的就应该是排名最靠前的动物。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57791836185650510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_winner(ranks):\n    return next(iter(ranks))`, `57791836185650510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_winner</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>下面来验证刚才设计的函数，看它们能不能实现想要的结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51800150292461720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`votes = {\n    \'otter\': 1281,\n    \'polar bear\': 587,\n    \'fox\': 863,\n}\n\n\ndef populate_ranks(votes, ranks):\n    names = list(votes.keys())\n    names.sort(key=votes.get, reverse=True)\n    for i, name in enumerate(names, 1):\n        ranks[name] = i\n\n\ndef get_winner(ranks):\n    return next(iter(ranks))\n\n\nranks = {}\npopulate_ranks(votes, ranks)\nprint(ranks)\nwinner = get_winner(ranks)\nprint(winner)\n\n>>>\n{\'otter\': 1, \'fox\': 2, \'polar bear\': 3}\notter`, `51800150292461720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">votes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'otter\'</span><span class="token punctuation">:</span> <span class="token number">1281</span><span class="token punctuation">,</span>\n    <span class="token string">\'polar bear\'</span><span class="token punctuation">:</span> <span class="token number">587</span><span class="token punctuation">,</span>\n    <span class="token string">\'fox\'</span><span class="token punctuation">:</span> <span class="token number">863</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">def</span> <span class="token function">populate_ranks</span><span class="token punctuation">(</span>votes<span class="token punctuation">,</span> ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    names <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>votes<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    names<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>votes<span class="token punctuation">.</span>get<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> i<span class="token punctuation">,</span> name <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        ranks<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> i\n\n\n<span class="token keyword">def</span> <span class="token function">get_winner</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\nranks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\npopulate_ranks<span class="token punctuation">(</span>votes<span class="token punctuation">,</span> ranks<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span>\nwinner <span class="token operator">=</span> get_winner<span class="token punctuation">(</span>ranks<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>winner<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'otter\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'fox\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'polar bear\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\notter</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果没有问题。但是，假设现在的需求变了，我们现在想要按照字母顺序在 UI 中显示，而不是像原来那样按照名次显示。为了实现这种效果，我们用内置的 collections.abc 模块定义这样一个类。这个类的功能和字典一样，而且会按照字母顺序迭代其中的内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82526125096691340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections.abc import MutableMapping\n\n\nclass SortedDict(MutableMapping):\n    def __init__(self):\n        self.data = {}\n\n    def __getitem__(self, key):\n        return self.data[key]\n\n    def __setitem__(self, key, value):\n        self.data[key] = value\n\n    def __delitem__(self, key):\n        del self.data[key]\n\n    def __iter__(self):\n        keys = list(self.data.keys())\n        keys.sort()\n        for key in keys:\n            yield key\n\n    def __len__(self):\n        return len(self.data)\n\n\nvotes = {\n    \'otter\': 1281,\n    \'polar bear\': 587,\n    \'fox\': 863,\n}\n\n\ndef populate_ranks(votes, ranks):\n    names = list(votes.keys())\n    names.sort(key=votes.get, reverse=True)\n    for i, name in enumerate(names, 1):\n        ranks[name] = i\n\n\ndef get_winner(ranks):\n    return next(iter(ranks))\n\n\nsorted_ranks = SortedDict()\npopulate_ranks(votes, sorted_ranks)\nprint(sorted_ranks.data)\nwinner = get_winner(sorted_ranks)\nprint(winner)\n\n>>>\n{\'otter\': 1, \'fox\': 2, \'polar bear\': 3}\nfox`, `82526125096691340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> MutableMapping\n\n\n<span class="token keyword">class</span> <span class="token class-name">SortedDict</span><span class="token punctuation">(</span>MutableMapping<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n\n    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value\n\n    <span class="token keyword">def</span> <span class="token function">__delitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">del</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n\n    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        keys <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        keys<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">for</span> key <span class="token keyword">in</span> keys<span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> key\n\n    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\n\n\nvotes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'otter\'</span><span class="token punctuation">:</span> <span class="token number">1281</span><span class="token punctuation">,</span>\n    <span class="token string">\'polar bear\'</span><span class="token punctuation">:</span> <span class="token number">587</span><span class="token punctuation">,</span>\n    <span class="token string">\'fox\'</span><span class="token punctuation">:</span> <span class="token number">863</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">def</span> <span class="token function">populate_ranks</span><span class="token punctuation">(</span>votes<span class="token punctuation">,</span> ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    names <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>votes<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    names<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>votes<span class="token punctuation">.</span>get<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> i<span class="token punctuation">,</span> name <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        ranks<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> i\n\n\n<span class="token keyword">def</span> <span class="token function">get_winner</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\nsorted_ranks <span class="token operator">=</span> SortedDict<span class="token punctuation">(</span><span class="token punctuation">)</span>\npopulate_ranks<span class="token punctuation">(</span>votes<span class="token punctuation">,</span> sorted_ranks<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>sorted_ranks<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\nwinner <span class="token operator">=</span> get_winner<span class="token punctuation">(</span>sorted_ranks<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>winner<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'otter\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'fox\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'polar bear\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\nfox</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>没有得到预期的结果，为什么会这样呢？因为 <code class="language-text">get_winner</code> 函数总是假设，迭代字典时的顺序应该跟 <code class="language-text">populate_ranks</code> 函数当初向字典中插入数据时的顺序一样。但是这次，我们用的是 SortedDict 实例，而不是标准的 dict 实例，所以这项假设不成立。因此，函数返回的数据是按字母顺序排列时最先出现的那个数据，也就是 <code class="language-text">&#39;fox&#39;</code>，有以下 3 种解决方案：</p>\n<ol>\n<li>\n<p>重新实现 <code class="language-text">get_winner</code> 函数，使它不再假设 ranks 字典总是能按照固定的顺序来迭代。这是最保险、最稳妥的一种方案。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97135432956679950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_winner(ranks):\n  for name, rank in ranks.items():\n     if rank == 1:\n           return name\n\nwinner = get_winner(sorted_ranks)\nprint(winner)\n\n>>>\notter`, `97135432956679950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_winner</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">for</span> name<span class="token punctuation">,</span> rank <span class="token keyword">in</span> ranks<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">if</span> rank <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>\n           <span class="token keyword">return</span> name\n\nwinner <span class="token operator">=</span> get_winner<span class="token punctuation">(</span>sorted_ranks<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>winner<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\notter</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>在函数开头先判断 ranks 是不是预期的那种标准字典（dict）。如果不是，就抛出异常。这个办法的运行性能要比刚才那种好。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33841738680319898000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_winner(ranks):\n  if not isinstance(ranks, dict):\n     raise TypeError(\'must provide a dict instance\')\n  return next(iter(ranks))\n\nget_winner(sorted_ranks)\n\n>>>\nTraceback ...\nTypeError: must provide a dict instance`, `33841738680319898000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_winner</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>ranks<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">\'must provide a dict instance\'</span><span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\nget_winner<span class="token punctuation">(</span>sorted_ranks<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> must provide a <span class="token builtin">dict</span> instance</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>通过类型注解（type annotation）来保证传给 <code class="language-text">get_winner</code> 函数的确实是个真正的 dict 实例，而不是那种行为跟标准字典类似的 MutableMapping（参见第 90 条）。下面就采用严格（strict）模式，针对含有注解的代码运行 mypy 工具。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53147510127275430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from typing import Dict, MutableMapping\n\ndef populate_ranks(votes: Dict[str, int],\n                 ranks: Dict[str, int]) -> None:\n  names = list(votes.keys())\n  names.sort(key=votes.get, reverse=True)\n  for i, name in enumerate(names, 1):\n     ranks[name] = i\n\ndef get_winner(ranks: Dict[str, int]) -> str:\n  return next(iter(ranks))\n\nclass SortedDict(MutableMapping[str, int]):\n  def __init__(self):\n     self.data = {}\n\n  def __getitem__(self, key):\n     return self.data[key]\n\n  def __setitem__(self, key, value):\n     self.data[key] = value\n\n  def __delitem__(self, key):\n     del self.data[key]\n\n  def __iter__(self):\n     keys = list(self.data.keys())\n     keys.sort()\n     for key in keys:\n           yield key\n\n  def __len__(self):\n     return len(self.data)\n\nvotes = {\n  \'otter\': 1281,\n  \'polar bear\': 587,\n  \'fox\': 863,\n}\n\nsorted_ranks = SortedDict()\npopulate_ranks(votes, sorted_ranks)\nprint(sorted_ranks.data)\nwinner = get_winner(sorted_ranks)\nprint(winner)\n\n\\$ python3 -m mypy --strict test.py\ntest.py:42: error: Argument 2 to &quot;populate_ranks&quot; has incompatible type &quot;SortedDict&quot;; expected &quot;Dict[str, int]&quot;\ntest.py:44: error: Argument 1 to &quot;get_winner&quot; has incompatible type &quot;SortedDict&quot;; expected &quot;Dict[str, int]&quot;`, `53147510127275430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> MutableMapping\n\n<span class="token keyword">def</span> <span class="token function">populate_ranks</span><span class="token punctuation">(</span>votes<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                 ranks<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n  names <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>votes<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  names<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>votes<span class="token punctuation">.</span>get<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n  <span class="token keyword">for</span> i<span class="token punctuation">,</span> name <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n     ranks<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> i\n\n<span class="token keyword">def</span> <span class="token function">get_winner</span><span class="token punctuation">(</span>ranks<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>\n  <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>ranks<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">class</span> <span class="token class-name">SortedDict</span><span class="token punctuation">(</span>MutableMapping<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n     self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n\n  <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n     self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value\n\n  <span class="token keyword">def</span> <span class="token function">__delitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">del</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n\n  <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n     keys <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n     keys<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>\n     <span class="token keyword">for</span> key <span class="token keyword">in</span> keys<span class="token punctuation">:</span>\n           <span class="token keyword">yield</span> key\n\n  <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\n\nvotes <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token string">\'otter\'</span><span class="token punctuation">:</span> <span class="token number">1281</span><span class="token punctuation">,</span>\n  <span class="token string">\'polar bear\'</span><span class="token punctuation">:</span> <span class="token number">587</span><span class="token punctuation">,</span>\n  <span class="token string">\'fox\'</span><span class="token punctuation">:</span> <span class="token number">863</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\nsorted_ranks <span class="token operator">=</span> SortedDict<span class="token punctuation">(</span><span class="token punctuation">)</span>\npopulate_ranks<span class="token punctuation">(</span>votes<span class="token punctuation">,</span> sorted_ranks<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>sorted_ranks<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\nwinner <span class="token operator">=</span> get_winner<span class="token punctuation">(</span>sorted_ranks<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>winner<span class="token punctuation">)</span>\n\n$ python3 <span class="token operator">-</span>m mypy <span class="token operator">-</span><span class="token operator">-</span>strict test<span class="token punctuation">.</span>py\ntest<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">42</span><span class="token punctuation">:</span> error<span class="token punctuation">:</span> Argument <span class="token number">2</span> to <span class="token string">"populate_ranks"</span> has incompatible <span class="token builtin">type</span> <span class="token string">"SortedDict"</span><span class="token punctuation">;</span> expected <span class="token string">"Dict[str, int]"</span>\ntest<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">:</span> error<span class="token punctuation">:</span> Argument <span class="token number">1</span> to <span class="token string">"get_winner"</span> has incompatible <span class="token builtin">type</span> <span class="token string">"SortedDict"</span><span class="token punctuation">;</span> expected <span class="token string">"Dict[str, int]"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样可以检查出类型不相符的问题，mypy 会标出错误的用法，指出函数要求的是 dict，但传入的却是 MutableMapping。这个方案既能保证静态类型准确，又不会影响程序的运行效率。</p>\n</li>\n</ol>\n<h3 id="总结-11"><a href="#%E6%80%BB%E7%BB%93-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>\n<p>从 Python 3.7 版开始，我们就可以确信迭代标准的字典时所看到的顺序跟这些键值对插入字典时的顺序一致。</p>\n</li>\n<li>\n<p>在 Python 代码中，我们很容易就能定义跟标准的字典很像但本身并不是 dict 实例的对象。对于这种类型的对象，不能假设迭代时看到的顺序必定与插入时的顺序相同。</p>\n</li>\n<li>\n<p>如果不想把这种跟标准字典很相似的类型也当成标准字典来处理，那么可以考虑这样三种办法。</p>\n<ol>\n<li>不要依赖插入时的顺序编写代码；</li>\n<li>在程序运行时明确判断它是不是标准的字典；</li>\n<li>给代码添加类型注解并做静态分析。</li>\n</ol>\n</li>\n</ol>\n<h2 id="第-16-条：用-get-处理键不在字典中的情况，不要使用-in-与-keyerror"><a href="#%E7%AC%AC-16-%E6%9D%A1%EF%BC%9A%E7%94%A8-get-%E5%A4%84%E7%90%86%E9%94%AE%E4%B8%8D%E5%9C%A8%E5%AD%97%E5%85%B8%E4%B8%AD%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%8C%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8-in-%E4%B8%8E-keyerror" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 16 条：用 get 处理键不在字典中的情况，不要使用 in 与 KeyError</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34097887956348137000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`counters = {\n    \'pumpernickel\': 2,\n    \'sourdough\': 1,\n}\n\nkey = \'wheat\'\n\nif key not in counters:\n    counters[key] = 0\ncounters[key] += 1\n\nif key in counters:\n    counters[key] += 1\nelse:\n    counters[key] = 1\n\ntry:\n    counters[key] += 1\nexcept KeyError:\n    counters[key] = 1`, `34097887956348137000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">counters <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'pumpernickel\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n    <span class="token string">\'sourdough\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\nkey <span class="token operator">=</span> <span class="token string">\'wheat\'</span>\n\n<span class="token keyword">if</span> key <span class="token keyword">not</span> <span class="token keyword">in</span> counters<span class="token punctuation">:</span>\n    counters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>\ncounters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>\n\n<span class="token keyword">if</span> key <span class="token keyword">in</span> counters<span class="token punctuation">:</span>\n    counters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    counters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>\n\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    counters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>\n<span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>\n    counters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 get 来优化</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58691023640815310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`counters = {\n    \'pumpernickel\': 2,\n    \'sourdough\': 1,\n}\n\nkey = \'wheat\'\n\ncount = counters.get(key, 0)\ncounters[key] = count + 1`, `58691023640815310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">counters <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'pumpernickel\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n    <span class="token string">\'sourdough\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\nkey <span class="token operator">=</span> <span class="token string">\'wheat\'</span>\n\ncount <span class="token operator">=</span> counters<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\ncounters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果使用 setdefault 改写是有问题的，这会有一次访问、两次赋值操作</p>\n<p>而且 setdefault 不管是否有这个键，都会执行默认值的分配，这会造成比较大的性能开销</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69796091076720710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`count = counters.setdefault(key, 0)\ncounters[key] = count + 1`, `69796091076720710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">count <span class="token operator">=</span> counters<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\ncounters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>缓解性能问题的话，可以用 get 方法加赋值表达式，也可以直接用 defaultdict</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8639418840533430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`names = votes.get(key)\nif names is None:\n    votes[key] = names = []\nnames.append(who)\n\n# 或者使用赋值表达式\nif (names := votes.get(key)) is None:\n    votes[key] = names = []\nnames.append(who)`, `8639418840533430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">names <span class="token operator">=</span> votes<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>\n<span class="token keyword">if</span> names <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n    votes<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\nnames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>who<span class="token punctuation">)</span>\n\n<span class="token comment"># 或者使用赋值表达式</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>names <span class="token punctuation">:</span><span class="token operator">=</span> votes<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n    votes<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\nnames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>who<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只有与键相关联的默认值构造起来开销很低且可以变化，而且不用担心异常问题（例如 list 实例）。在这种情况下可以使用 setdefault，然而一般也优先考虑使用 defaultdict 取代 dict</p>\n<h3 id="总结-12"><a href="#%E6%80%BB%E7%BB%93-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>有四种办法可以处理键不在字典中的情况：in 表达式、KeyError 异常、get 方法与 setdefault 方法。</li>\n<li>如果跟键相关联的值是像计数器这样的基本类型，那么 get 方法就是最好的方案；如果是那种构造起来开销比较大，或是容易出异常的类型，那么可以把这个方法与赋值表达式结合起来使用。</li>\n<li>即使看上去最应该使用 setdefault 方案，也不一定要真的使用 setdefault 方案，而是可以考虑用 defaultdict 取代普通的 dict。</li>\n</ol>\n<h2 id="第-17-条：用-defaultdict-处理内部状态中缺失的元素，而不要用-setdefault"><a href="#%E7%AC%AC-17-%E6%9D%A1%EF%BC%9A%E7%94%A8-defaultdict-%E5%A4%84%E7%90%86%E5%86%85%E9%83%A8%E7%8A%B6%E6%80%81%E4%B8%AD%E7%BC%BA%E5%A4%B1%E7%9A%84%E5%85%83%E7%B4%A0%EF%BC%8C%E8%80%8C%E4%B8%8D%E8%A6%81%E7%94%A8-setdefault" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 17 条：用 defaultdict 处理内部状态中缺失的元素，而不要用 setdefault</h2>\n<p>通过 setdefault 方案把新的城市添加到对应的集合里，这要比利用 get 方法与赋值表达式（Python3.8 的新特性）来实现的方案短很多。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72935537555502820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`visits = {\n    \'Mexico\': {\'Tulum\', \'Puerto Vallarta\'},\n    \'Japan\': {\'Hakone\'},\n}\n\nvisits.setdefault(\'France\', set()).add(\'Arles\')  # Short\nif (japan := visits.get(\'Japan\')) is None:  # Long\n    visits[\'Japan\'] = japan = set()\njapan.add(\'Kyoto\')\n\nprint(visits)\n\n>>>\n{\'Mexico\': {\'Tulum\', \'Puerto Vallarta\'}, \'Japan\': {\'Kyoto\', \'Hakone\'}, \'France\': {\'Arles\'}}`, `72935537555502820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">visits <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'Mexico\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Tulum\'</span><span class="token punctuation">,</span> <span class="token string">\'Puerto Vallarta\'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token string">\'Japan\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Hakone\'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\nvisits<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">\'France\'</span><span class="token punctuation">,</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'Arles\'</span><span class="token punctuation">)</span>  <span class="token comment"># Short</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>japan <span class="token punctuation">:</span><span class="token operator">=</span> visits<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'Japan\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>  <span class="token comment"># Long</span>\n    visits<span class="token punctuation">[</span><span class="token string">\'Japan\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> japan <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\njapan<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'Kyoto\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>visits<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'Mexico\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Tulum\'</span><span class="token punctuation">,</span> <span class="token string">\'Puerto Vallarta\'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'Japan\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Kyoto\'</span><span class="token punctuation">,</span> <span class="token string">\'Hakone\'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'France\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Arles\'</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果程序所访问的这个字典需要由你自己明确地创建，那又该怎么写？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95847053216840430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Visits:\n    def __init__(self):\n        self.data = {}\n\n    def add(self, country, city):\n        city_set = self.data.setdefault(country, set())\n        city_set.add(city)\n\n\nvisits = Visits()\nvisits.add(\'Russia\', \'Yekaterinburg\')\nvisits.add(\'Tanzania\', \'Zanzibar\')\nprint(visits.data)\n\n>>>\n{\'Russia\': {\'Yekaterinburg\'}, \'Tanzania\': {\'Zanzibar\'}}`, `95847053216840430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Visits</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        city_set <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>country<span class="token punctuation">,</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        city_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>city<span class="token punctuation">)</span>\n\n\nvisits <span class="token operator">=</span> Visits<span class="token punctuation">(</span><span class="token punctuation">)</span>\nvisits<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'Russia\'</span><span class="token punctuation">,</span> <span class="token string">\'Yekaterinburg\'</span><span class="token punctuation">)</span>\nvisits<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'Tanzania\'</span><span class="token punctuation">,</span> <span class="token string">\'Zanzibar\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>visits<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'Russia\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Yekaterinburg\'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'Tanzania\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Zanzibar\'</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上代码有以下问题</p>\n<ol>\n<li>调用了名字很怪的 setdefault 方法，很难让人理解发生了什么</li>\n<li>每次调用 add 方法，都会构造新的 set 实例</li>\n</ol>\n<p>改用 defaultdict 可以解决以上问题，它会在键缺失的情况下，自动添加这个键以及键所对应的默认值，每次发现键不存在时，该字典都会调用这个函数返回一份新的默认值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88638582975562200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\nclass Visits:\n    def __init__(self):\n        self.data = defaultdict(set)\n\n    def add(self, country, city):\n        self.data[country].add(city)\n\n\nvisits = Visits()\nvisits.add(\'England\', \'Bath\')\nvisits.add(\'England\', \'London\')\nprint(visits.data)\n\n>>>\ndefaultdict(<class \'set\'>, {\'England\': {\'Bath\', \'London\'}})`, `88638582975562200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">class</span> <span class="token class-name">Visits</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>data <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>country<span class="token punctuation">]</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span>city<span class="token punctuation">)</span>\n\n\nvisits <span class="token operator">=</span> Visits<span class="token punctuation">(</span><span class="token punctuation">)</span>\nvisits<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'England\'</span><span class="token punctuation">,</span> <span class="token string">\'Bath\'</span><span class="token punctuation">)</span>\nvisits<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'England\'</span><span class="token punctuation">,</span> <span class="token string">\'London\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>visits<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\ndefaultdict<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'set\'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">\'England\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'Bath\'</span><span class="token punctuation">,</span> <span class="token string">\'London\'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-13"><a href="#%E6%80%BB%E7%BB%93-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>如果你管理的字典可能需要添加任意的键，那么应该考虑能否用内置的 collections 模块中的 defaultdict 实例来解决问题。</li>\n<li>如果这种键名比较随意的字典是别人传给你的，你无法把它创建成 defaultdict，那么应该考虑通过 get 方法访问其中的键值。然而，在个别情况下，也可以考虑改用 setdefault 方法，因为那样写更短。</li>\n</ol>\n<h2 id="第-18-条：学会利用-__missing__-构造依赖键的默认值"><a href="#%E7%AC%AC-18-%E6%9D%A1%EF%BC%9A%E5%AD%A6%E4%BC%9A%E5%88%A9%E7%94%A8-__missing__-%E6%9E%84%E9%80%A0%E4%BE%9D%E8%B5%96%E9%94%AE%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 18 条：学会利用 <code class="language-text">__missing__</code> 构造依赖键的默认值</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73083118380027765000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pictures = {}\npath = \'profile_1234.png\'\nif (handle := pictures.get(path)) is None:\n    try:\n        handle = open(path, \'a+b\')\n    except OSError:\n        print(f\'Failed to open path {path}\')\n        raise\n    else:\n        pictures[path] = handle\n\nhandle.seek(0)\nimage_data = handle.read()`, `73083118380027765000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pictures <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\npath <span class="token operator">=</span> <span class="token string">\'profile_1234.png\'</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>handle <span class="token punctuation">:</span><span class="token operator">=</span> pictures<span class="token punctuation">.</span>get<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        handle <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">\'a+b\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Failed to open path </span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n        <span class="token keyword">raise</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        pictures<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> handle\n\nhandle<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\nimage_data <span class="token operator">=</span> handle<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果改成 setdefault</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14950092932551807000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pictures = {}\npath = \'profile_1234.png\'\ntry:\n    handle = pictures.setdefault(path, open(path, \'a+b\'))\nexcept OSError:\n    print(f\'Failed to open path {path}\')\n    raise\nelse:\n    handle.seek(0)\n\nimage_data = handle.read()`, `14950092932551807000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pictures <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\npath <span class="token operator">=</span> <span class="token string">\'profile_1234.png\'</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    handle <span class="token operator">=</span> pictures<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">\'a+b\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> OSError<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Failed to open path </span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n    <span class="token keyword">raise</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    handle<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n\nimage_data <span class="token operator">=</span> handle<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而使用 setdefault 实现会有以下问题</p>\n<ol>\n<li>即便图片的路径名已经在字典里了，程序也还是得调用内置的 open 函数创建文件句柄，于是导致这个程序要给已经创建过 handle 的那份文件再度创建 handle（两者可能相互冲突）</li>\n<li>如果 try 块抛出异常，那我们可能无法判断这个异常是 open 函数导致的，还是 setdefault 方法导致的，因为这两次调用全都写在了同一行代码里</li>\n</ol>\n<p>理论上可以使用 defaultdict 优化，但是 defaultdict 的第二个函数不能传参</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2351899463545215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\ndef open_picture(profile_path):\n    try:\n        return open(profile_path, \'a+b\')\n    except OSError:\n        print(f\'Failed to open path {profile_path}\')\n        raise\n\n\npath = \'profile_1234.png\'\npictures = defaultdict(open_picture)\nhandle = pictures[path]\nhandle.seek(0)\nimage_data = handle.read()\n\n>>>\nTraceback ...\nTypeError: open_picture() missing 1 required positional argument: \'profile_path\'`, `2351899463545215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">def</span> <span class="token function">open_picture</span><span class="token punctuation">(</span>profile_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>profile_path<span class="token punctuation">,</span> <span class="token string">\'a+b\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Failed to open path </span><span class="token interpolation"><span class="token punctuation">{</span>profile_path<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n        <span class="token keyword">raise</span>\n\n\npath <span class="token operator">=</span> <span class="token string">\'profile_1234.png\'</span>\npictures <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>open_picture<span class="token punctuation">)</span>\nhandle <span class="token operator">=</span> pictures<span class="token punctuation">[</span>path<span class="token punctuation">]</span>\nhandle<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\nimage_data <span class="token operator">=</span> handle<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> open_picture<span class="token punctuation">(</span><span class="token punctuation">)</span> missing <span class="token number">1</span> required positional argument<span class="token punctuation">:</span> <span class="token string">\'profile_path\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以通过继承 dict 类型并实现 <code class="language-text">__missing__</code> 特殊方法来解决这个问题</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98950539659957110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def open_picture(profile_path):\n    try:\n        return open(profile_path, \'a+b\')\n    except OSError:\n        print(f\'Failed to open path {profile_path}\')\n        raise\n\n\nclass Pictures(dict):\n    def __missing__(self, key):\n        value = open_picture(key)\n        self[key] = value\n        return value\n\n\npath = \'profile_1234.png\'\npictures = Pictures()\nhandle = pictures[path]\nhandle.seek(0)\nimage_data = handle.read()`, `98950539659957110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">open_picture</span><span class="token punctuation">(</span>profile_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>profile_path<span class="token punctuation">,</span> <span class="token string">\'a+b\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Failed to open path </span><span class="token interpolation"><span class="token punctuation">{</span>profile_path<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n        <span class="token keyword">raise</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">Pictures</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__missing__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        value <span class="token operator">=</span> open_picture<span class="token punctuation">(</span>key<span class="token punctuation">)</span>\n        self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value\n        <span class="token keyword">return</span> value\n\n\npath <span class="token operator">=</span> <span class="token string">\'profile_1234.png\'</span>\npictures <span class="token operator">=</span> Pictures<span class="token punctuation">(</span><span class="token punctuation">)</span>\nhandle <span class="token operator">=</span> pictures<span class="token punctuation">[</span>path<span class="token punctuation">]</span>\nhandle<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\nimage_data <span class="token operator">=</span> handle<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-14"><a href="#%E6%80%BB%E7%BB%93-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>如果创建默认值需要较大的开销，或者可能抛出异常，那就不适合用 dict 类型的 setdefault 方法实现。</li>\n<li>传给 defaultdict 的函数必须是不需要参数的函数，所以无法创建出需要依赖键名的默认值。</li>\n<li>如果要构造的默认值必须根据键名来确定，那么可以定义自己的 dict 子类并实现 <code class="language-text">__missing__</code> 方法。</li>\n</ol>\n<h1 id="函数"><a href="#%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数</h1>\n<h2 id="第-19-条：不要把函数返回的多个数值拆分到三个以上的变量中"><a href="#%E7%AC%AC-19-%E6%9D%A1%EF%BC%9A%E4%B8%8D%E8%A6%81%E6%8A%8A%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%95%B0%E5%80%BC%E6%8B%86%E5%88%86%E5%88%B0%E4%B8%89%E4%B8%AA%E4%BB%A5%E4%B8%8A%E7%9A%84%E5%8F%98%E9%87%8F%E4%B8%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 19 条：不要把函数返回的多个数值拆分到三个以上的变量中</h2>\n<p>unpacking 机制允许 Python 函数返回一个以上的值（参见第 6 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95052230869877150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_stats(numbers):\n    minimum = min(numbers)\n    maximum = max(numbers)\n    return minimum, maximum\n\n\nlengths = [63, 73, 72, 60, 67, 66, 71, 61, 72, 70]\nminimum, maximum = get_stats(lengths)  # Two return values\nprint(f\'Min: {minimum}, Max: {maximum}\')\n\n>>>\nMin: 60, Max: 73`, `95052230869877150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">def <span class="token function">get_stats</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    minimum <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    maximum <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> minimum<span class="token punctuation">,</span> maximum\n\n\nlengths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span>\nminimum<span class="token punctuation">,</span> maximum <span class="token operator">=</span> <span class="token function">get_stats</span><span class="token punctuation">(</span>lengths<span class="token punctuation">)</span>  # Two <span class="token keyword">return</span> values\n<span class="token function">print</span><span class="token punctuation">(</span>f<span class="token string">\'Min: {minimum}, Max: {maximum}\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>>></span>\nMin<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> Max<span class="token punctuation">:</span> <span class="token number">73</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95873248742363270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`first, second = 1, 2\nassert first == 1\nassert second == 2\n\n\ndef my_function():\n    return 1, 2\n\n\nfirst, second = my_function()\nassert first == 1\nassert second == 2`, `95873248742363270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">first<span class="token punctuation">,</span> second <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>\nassert first <span class="token operator">==</span> <span class="token number">1</span>\nassert second <span class="token operator">==</span> <span class="token number">2</span>\n\n\ndef <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>\n\n\nfirst<span class="token punctuation">,</span> second <span class="token operator">=</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nassert first <span class="token operator">==</span> <span class="token number">1</span>\nassert second <span class="token operator">==</span> <span class="token number">2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在返回多个值的时候，可以用带星号的表达式接收那些没有被普通变量捕获到的值（参见第 13 条）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81473625580046830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_avg_ratio(numbers):\n    average = sum(numbers) / len(numbers)\n    scaled = [x / average for x in numbers]\n    scaled.sort(reverse=True)\n    return scaled\n\n\nlengths = [63, 73, 72, 60, 67, 66, 71, 61, 72, 70]\nlongest, *middle, shortest = get_avg_ratio(lengths)\nprint(f\'Longest:  {longest:>4.0%}\')\nprint(f\'Shortest: {shortest:>4.0%}\')\n\n>>>\nLongest:  108%\nShortest:  89%`, `81473625580046830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_avg_ratio</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    average <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    scaled <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token operator">/</span> average <span class="token keyword">for</span> x <span class="token keyword">in</span> numbers<span class="token punctuation">]</span>\n    scaled<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> scaled\n\n\nlengths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span>\nlongest<span class="token punctuation">,</span> <span class="token operator">*</span>middle<span class="token punctuation">,</span> shortest <span class="token operator">=</span> get_avg_ratio<span class="token punctuation">(</span>lengths<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Longest:  </span><span class="token interpolation"><span class="token punctuation">{</span>longest<span class="token punctuation">:</span><span class="token format-spec">>4.0%</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Shortest: </span><span class="token interpolation"><span class="token punctuation">{</span>shortest<span class="token punctuation">:</span><span class="token format-spec">>4.0%</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nLongest<span class="token punctuation">:</span>  <span class="token number">108</span><span class="token operator">%</span>\nShortest<span class="token punctuation">:</span>  <span class="token number">89</span><span class="token operator">%</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7740350363672554000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_stats(numbers):\n    minimum = min(numbers)\n    maximum = max(numbers)\n    count = len(numbers)\n    average = sum(numbers)/count\n    sorted_numbers = sorted(numbers)\n    middle = count // 2\n    if count % 2 == 0:\n        lower = sorted_numbers[middle - 1]\n        upper = sorted_numbers[middle]\n        median = (lower + upper)/2\n    else:\n        median = sorted_numbers[middle]\n    return minimum, maximum, average, median, count\n\n\nlengths = [63, 73, 72, 60, 67, 66, 71, 61, 72, 70]\nminimum, maximum, average, median, count = get_stats(lengths)\nprint(f\'Min: {minimum}, Max: {maximum}\')\nprint(f\'Average: {average}, Median: {median}, Count: {count}\')\n\n>>>\nMin: 60, Max: 73\nAverage: 67.5, Median: 68.5, Count: 10`, `7740350363672554000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_stats</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    minimum <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    maximum <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    average <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token operator">/</span>count\n    sorted_numbers <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    middle <span class="token operator">=</span> count <span class="token operator">//</span> <span class="token number">2</span>\n    <span class="token keyword">if</span> count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>\n        lower <span class="token operator">=</span> sorted_numbers<span class="token punctuation">[</span>middle <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>\n        upper <span class="token operator">=</span> sorted_numbers<span class="token punctuation">[</span>middle<span class="token punctuation">]</span>\n        median <span class="token operator">=</span> <span class="token punctuation">(</span>lower <span class="token operator">+</span> upper<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        median <span class="token operator">=</span> sorted_numbers<span class="token punctuation">[</span>middle<span class="token punctuation">]</span>\n    <span class="token keyword">return</span> minimum<span class="token punctuation">,</span> maximum<span class="token punctuation">,</span> average<span class="token punctuation">,</span> median<span class="token punctuation">,</span> count\n\n\nlengths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span>\nminimum<span class="token punctuation">,</span> maximum<span class="token punctuation">,</span> average<span class="token punctuation">,</span> median<span class="token punctuation">,</span> count <span class="token operator">=</span> get_stats<span class="token punctuation">(</span>lengths<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Min: </span><span class="token interpolation"><span class="token punctuation">{</span>minimum<span class="token punctuation">}</span></span><span class="token string">, Max: </span><span class="token interpolation"><span class="token punctuation">{</span>maximum<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Average: </span><span class="token interpolation"><span class="token punctuation">{</span>average<span class="token punctuation">}</span></span><span class="token string">, Median: </span><span class="token interpolation"><span class="token punctuation">{</span>median<span class="token punctuation">}</span></span><span class="token string">, Count: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nMin<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> Max<span class="token punctuation">:</span> <span class="token number">73</span>\nAverage<span class="token punctuation">:</span> <span class="token number">67.5</span><span class="token punctuation">,</span> Median<span class="token punctuation">:</span> <span class="token number">68.5</span><span class="token punctuation">,</span> Count<span class="token punctuation">:</span> <span class="token number">10</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的写法有 2 个问题：</p>\n<ol>\n<li>函数返回的五个值都是数字，所以很容易就会搞错顺序</li>\n<li>调用函数并拆分返回值的那行代码会写得比较长</li>\n</ol>\n<p>为避免这些问题，我们不应该把函数返回的多个值拆分到三个以上的变量里。一个三元组最多只拆成三个普通变量，或两个普通变量与一个万能变量（带星号的变量）。当然用于接收的变量个数也可以比这更少。假如要拆分的值确实很多，那最好还是定义一个轻便的类或 namedtuple（参见第 37 条），并让函数返回这样的实例。</p>\n<h3 id="总结-15"><a href="#%E6%80%BB%E7%BB%93-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>函数可以把多个值合起来通过一个元组返回给调用者，以便利用 Python 的 unpacking 机制去拆分。</li>\n<li>对于函数返回的多个值，可以把普通变量没有捕获到的那些值全都捕获到一个带星号的变量里。</li>\n<li>把返回的值拆分到四个或四个以上的变量是很容易出错的，所以最好不要那么写，而是应该通过小类或 namedtuple 实例完成。</li>\n</ol>\n<h2 id="第-20-条：遇到意外状况时应该抛出异常，不要返回-none"><a href="#%E7%AC%AC-20-%E6%9D%A1%EF%BC%9A%E9%81%87%E5%88%B0%E6%84%8F%E5%A4%96%E7%8A%B6%E5%86%B5%E6%97%B6%E5%BA%94%E8%AF%A5%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%EF%BC%8C%E4%B8%8D%E8%A6%81%E8%BF%94%E5%9B%9E-none" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 20 条：遇到意外状况时应该抛出异常，不要返回 None</h2>\n<p>编写工具函数（utility function）时，许多 Python 程序员都爱用 None 这个返回值来表示特殊情况。对于某些函数来说，这或许有几分道理。</p>\n<p>例如，我们要编写一个辅助函数计算两数相除的结果。在除数是 0 的情况下，返回 None 似乎相当合理，因为这种除法的结果是没有意义的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53216031249095130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def careful_divide(a, b):\n    try:\n        return a / b\n    except ZeroDivisionError:\n        return None`, `53216031249095130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">careful_divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> a <span class="token operator">/</span> b\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token boolean">None</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用这个函数时，可以按自己的方式处理这样的返回值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6982295429341745000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def careful_divide(a, b):\n    try:\n        return a / b\n    except ZeroDivisionError:\n        return None\n\n\nx, y = 1, 0\nresult = careful_divide(x, y)\nif result is None:\n    print(\'Invalid inputs\')\n\n>>>\nInvalid inputs`, `6982295429341745000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">careful_divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> a <span class="token operator">/</span> b\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token boolean">None</span>\n\n\nx<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>\nresult <span class="token operator">=</span> careful_divide<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n<span class="token keyword">if</span> result <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nInvalid inputs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果传给 <code class="language-text">careful_divide</code> 函数的被除数为 0，会怎么样呢？在这种情况下，只要除数不为 0，函数返回的结果就应该是 0。</p>\n<p>问题是，这个函数的返回值有时可能会用在 if 条件语句里面，那时可能会根据值本身是否相当于 False 来做判断，而不像刚才那样明确判断这个值是否为 None（第 5 条也列举了类似的例子）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99103765548169040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def careful_divide(a, b):\n    try:\n        return a / b\n    except ZeroDivisionError:\n        return None\n\n\nx, y = 0, 5\nresult = careful_divide(x, y)\nif not result:\n    print(\'Invalid inputs\')  # This runs! But shouldn\'t\n\n>>>\nInvalid inputs`, `99103765548169040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">careful_divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> a <span class="token operator">/</span> b\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token boolean">None</span>\n\n\nx<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span>\nresult <span class="token operator">=</span> careful_divide<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n<span class="token keyword">if</span> <span class="token keyword">not</span> result<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span>  <span class="token comment"># This runs! But shouldn\'t</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nInvalid inputs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面这种 if 语句，会把函数返回 0 时的情况，也当成函数返回 None 时那样来处理。这种写法经常出现在 Python 代码里，因此像 <code class="language-text">careful_divide</code> 这样，用 None 来表示特殊状况的函数是很容易出错的。有两种办法可以减少这样的错误。</p>\n<ol>\n<li>\n<p>利用二元组把计算结果分成两部分返回（与这种写法有关的基础知识，参见第 19 条）。元组的首个元素表示操作是否成功，第二个元素表示计算的实际值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61931720995868344000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def careful_divide(a, b):\ntry:\n    return True, a / b\nexcept ZeroDivisionError:\n    return False, None`, `61931720995868344000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">careful_divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> a <span class="token operator">/</span> b\n<span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">None</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写，会促使调用函数者去拆分返回值，他可以先看看这次运算是否成功，然后再决定怎么处理运算结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56198475568229700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`success, result = careful_divide(x, y)\nif not success:\n  print(\'Invalid inputs\')`, `56198475568229700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">success<span class="token punctuation">,</span> result <span class="token operator">=</span> careful_divide<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n<span class="token keyword">if</span> <span class="token keyword">not</span> success<span class="token punctuation">:</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但问题是，有些调用方总喜欢忽略返回元组的第一个部分（在 Python 代码里，习惯用下划线表示用不到的变量）。这样写成的代码，乍一看似乎没问题，但实际上还是无法区分返回 0 与返回 None 这两种情况。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67814258048130420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`_, result = careful_divide(x, y)\nif not result:\n  print(\'Invalid inputs\')`, `67814258048130420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">_<span class="token punctuation">,</span> result <span class="token operator">=</span> careful_divide<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n<span class="token keyword">if</span> <span class="token keyword">not</span> result<span class="token punctuation">:</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>不采用 None 表示特例，而是向调用方抛出异常（Exception），让他自己去处理。下面我们把执行除法时发生的 ZeroDivisionError 转化成 ValueError，告诉调用方输入的值不对（什么时候应该使用 Exception 类的子类，可参见第 87 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89705596573044110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def careful_divide(a, b):\ntry:\n    return a / b\nexcept ZeroDivisionError:\n    raise ValueError(\'Invalid inputs\')`, `89705596573044110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">careful_divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> a <span class="token operator">/</span> b\n<span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，调用方拿到函数的返回值之后，不用先判断操作是否成功了。因为这次可以假设，只要能拿到返回值，就说明函数肯定顺利执行完了，所以只需要用 try 把函数包起来并在 else 块里处理运算结果就好（这种结构的详细用法，参见第 65 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64923005483797905000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def careful_divide(a, b):\ntry:\n    return a / b\nexcept ZeroDivisionError:\n    raise ValueError(\'Invalid inputs\')\n\nx, y = 5, 2\ntry:\n  result = careful_divide(x, y)\nexcept ValueError:\n  print(\'Invalid inputs\')\nelse:\n  print(\'Result is %.1f\' % result)\n\n>>>\nResult is 2.5`, `64923005483797905000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">careful_divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> a <span class="token operator">/</span> b\n<span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span>\n\nx<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n  result <span class="token operator">=</span> careful_divide<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n<span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Result is %.1f\'</span> <span class="token operator">%</span> result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nResult <span class="token keyword">is</span> <span class="token number">2.5</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>这个办法也可以扩展到那些使用类型注解的代码中（参见第 90 条），我们可以把函数的返回值指定为 float 类型，这样它就不可能返回 None 了。然而，Python 采用的是动态类型与静态类型相搭配的 gradual 类型系统，我们不能在函数的接口上指定函数可能抛出哪些异常（有的编程语言支持这样的受检异常（checked exception），调用方必须应对这些异常）。所以，我们只好把有可能抛出的异常写在文档里面，并希望调用方能够根据这份文档适当地捕获相关的异常（参见第 84 条）。</p>\n<p>下面我们给刚才那个函数加类型注解，并为它编写 docstring。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19788520661641785000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def careful_divide(a: float, b: float) -> float:\n    &quot;&quot;&quot;Divides a by b.\n\n    Raises:\n      ValueError: When the inputs cannot be divided.\n    &quot;&quot;&quot;\n    try:\n        return a / b\n    except ZeroDivisionError as e:\n        raise ValueError(\'Invalid inputs\')`, `19788520661641785000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">careful_divide</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">"""Divides a by b.\n\n    Raises:\n      ValueError: When the inputs cannot be divided.\n    """</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> a <span class="token operator">/</span> b\n    <span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'Invalid inputs\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写，输入、输出与异常都显得很清晰，所以调用方出错的概率就变得很小了。</p>\n<h3 id="总结-16"><a href="#%E6%80%BB%E7%BB%93-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>用返回值 None 表示特殊情况是很容易出错的，因为这样的值在条件表达式里面，没办法与 0 和空白字符串之类的值区分，这些值都相当于 False。</li>\n<li>用异常表示特殊的情况，而不要返回 None。让调用这个函数的程序根据文档里写的异常情况做出处理。</li>\n<li>通过类型注解可以明确禁止函数返回 None，即便在特殊情况下，它也不能返回这个值。</li>\n</ol>\n<h2 id="第-21-条：了解如何在闭包里面使用外围作用域中的变量"><a href="#%E7%AC%AC-21-%E6%9D%A1%EF%BC%9A%E4%BA%86%E8%A7%A3%E5%A6%82%E4%BD%95%E5%9C%A8%E9%97%AD%E5%8C%85%E9%87%8C%E9%9D%A2%E4%BD%BF%E7%94%A8%E5%A4%96%E5%9B%B4%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 21 条：了解如何在闭包里面使用外围作用域中的变量</h2>\n<p>有时，我们要给列表中的元素排序，而且要优先把某个群组之中的元素放在其他元素的前面。例如，渲染用户界面时，可能就需要这样做，因为关键的消息和特殊的事件应该优先显示在其他信息之前。</p>\n<p>实现这种做法的一种常见方案，是把辅助函数通过 key 参数传给列表的 sort 方法（参见第 14 条），让这个方法根据辅助函数所返回的值来决定元素在列表中的先后顺序。辅助函数先判断当前元素是否处在重要群组里，如果在，就把返回值的第一项写成 0，让它能够排在不属于这个组的那些元素之前。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43118129690379220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def sort_priority(values, group):\n    def helper(x):\n        if x in group:\n            return (0, x)\n        return (1, x)\n    values.sort(key=helper)`, `43118129690379220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">sort_priority</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">helper</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> x <span class="token keyword">in</span> group<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n    values<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>helper<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个函数可以处理比较简单的输入数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98160400975229100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def sort_priority(values, group):\n    def helper(x):\n        if x in group:\n            return (0, x)\n        return (1, x)\n    values.sort(key=helper)\n\n\nnumbers = [8, 3, 1, 2, 5, 4, 7, 6]\ngroup = {2, 3, 5, 7}\nsort_priority(numbers, group)\nprint(numbers)\n\n>>>\n[2, 3, 5, 7, 1, 4, 6, 8]`, `98160400975229100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">sort_priority</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">helper</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> x <span class="token keyword">in</span> group<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n    values<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>helper<span class="token punctuation">)</span>\n\n\nnumbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>\ngroup <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span>\nsort_priority<span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> group<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它为什么能够实现这个功能呢？这要分三个原因来讲：</p>\n<ol>\n<li>Python 支持闭包（closure），这让定义在大函数里面的小函数也能引用大函数之中的变量。具体到这个例子，<code class="language-text">sort_priority</code> 函数里面的那个 helper 函数也能够引用前者的 group 参数。</li>\n<li>函数在 Python 里是头等对象（first-class object），所以你可以像操作其他对象那样，直接引用它们、把它们赋给变量、将它们当成参数传给其他函数，或是在 in 表达式与 if 语句里面对它做比较，等等。闭包函数也是函数，所以，同样可以传给 sort 方法的 key 参数。</li>\n<li>Python 在判断两个序列（包括元组）的大小时，有自己的一套规则。它首先比较 0 号位置的那两个元素，如果相等，那就比较 1 号位置的那两个元素；如果还相等，那就比较 2 号位置的那两个元素；依此类推，直到得出结论为止。所以，我们可以利用这套规则让 helper 这个闭包函数返回一个元组，并把关键指标写为元组的首个元素以表示当前排序的值是否属于重要群组（0 表示属于，1 表示不属于）。</li>\n</ol>\n<p>如果这个 <code class="language-text">sort_priority</code> 函数还能告诉我们，列表里面有没有位于重要群组之中的元素，那就更好了，因为这样可以让用户界面开发者更方便地做出相应处理。添加这样一个功能似乎相当简单，因为闭包函数本身就需要判断当前值是否处在重要群组之中，既然这样，那么不妨让它在发现这种值时，顺便把标志变量翻转过来。最后，让闭包外的大函数（即 <code class="language-text">sort_priority</code> 函数）返回这个标志变量，如果闭包函数当时遇到过这样的值，那么这个标志肯定是 True。</p>\n<p>下面，试着用最直接的写法来实现。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="244256064185055520"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def sort_priority2(numbers, group):\n    found = False\n\n    def helper(x):\n        if x in group:\n            found = True  # Seems simple\n            return (0, x)\n        return (1, x)\n    numbers.sort(key=helper)\n    return found\n\n\nnumbers = [8, 3, 1, 2, 5, 4, 7, 6]\ngroup = {2, 3, 5, 7}\nfound = sort_priority2(numbers, group)\nprint(\'Found:\', found)\nprint(numbers)\n\n>>>\nFound: False\n[2, 3, 5, 7, 1, 4, 6, 8]`, `244256064185055520`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">sort_priority2</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    found <span class="token operator">=</span> <span class="token boolean">False</span>\n\n    <span class="token keyword">def</span> <span class="token function">helper</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> x <span class="token keyword">in</span> group<span class="token punctuation">:</span>\n            found <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># Seems simple</span>\n            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n    numbers<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>helper<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> found\n\n\nnumbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>\ngroup <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span>\nfound <span class="token operator">=</span> sort_priority2<span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> group<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Found:\'</span><span class="token punctuation">,</span> found<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFound<span class="token punctuation">:</span> <span class="token boolean">False</span>\n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>排序结果没有问题，可以看到：在排过序的 numbers 里面，重要群组 group 里的那些元素（2、3、5、7），确实出现在了其他元素前面。既然这样，那表示函数返回值的 found 变量就应该是 True，但我们看到的却是 False，这是为什么？</p>\n<p>在表达式中引用某个变量时，Python 解释器会按照下面的顺序，在各个作用域（scope）里面查找这个变量，以解析（resolve）这次引用</p>\n<ol>\n<li>当前函数的作用域。</li>\n<li>外围作用域（例如包含当前函数的其他函数所对应的作用域）。</li>\n<li>包含当前代码的那个模块所对应的作用域（也叫全局作用域，global scope）。</li>\n<li>内置作用域（built-in scope，也就是包含 len 与 str 等函数的那个作用域）。</li>\n</ol>\n<p>如果这些作用域中都没有定义名称相符的变量，那么程序就抛出 NameError 异常。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41953356767402420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`foo = does_not_exist * 5\n\n>>>\nTraceback...\nNameError: name \'does_not_exist\' is not defined`, `41953356767402420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">foo <span class="token operator">=</span> does_not_exist <span class="token operator">*</span> <span class="token number">5</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nNameError<span class="token punctuation">:</span> name <span class="token string">\'does_not_exist\'</span> <span class="token keyword">is</span> <span class="token keyword">not</span> defined</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>刚才讲的是怎么引用变量，现在我们来讲怎么给变量赋值，这要分两种情况处理。</p>\n<ol>\n<li>如果变量已经定义在当前作用域中，那么直接把新值交给它就行了。</li>\n<li>如果当前作用域中不存在这个变量，那么即便外围作用域里有同名的变量，Python 也还是会把这次的赋值操作当成变量的定义来处理</li>\n</ol>\n<p>这会产生一个重要的效果，也就是说，Python 会把包含赋值操作的这个函数当成新定义的这个变量的作用域。</p>\n<p>这可以解释刚才那种写法错在何处。<code class="language-text">sort_priority2</code> 函数里面的 helper 闭包函数是把 True 赋给了 found 变量。当前作用域里没有这样一个叫作 found 的变量，所以就算外围的 <code class="language-text">sort_priority2</code> 函数里面有 found 变量，系统也还是会把这次赋值当成定义，也就是会在 helper 里面定义一个新的 found 变量，而不是把它当成给 <code class="language-text">sort_priority2</code> 已有的那个 found 变量赋值。</p>\n<p>这种问题有时也称作作用域 bug（scoping bug），Python 新手可能认为这样的赋值规则很奇怪，但实际上 Python 是故意这么设计的。因为这样可以防止函数中的局部变量污染外围模块。假如不这样做，那么函数里的每条赋值语句都有可能影响全局作用域的变量，这样不仅混乱，而且会让全局变量之间彼此交互影响，从而导致很多难以探查的 bug。</p>\n<p>Python 有一种特殊的写法，可以把闭包里面的数据赋给闭包外面的变量。用 nonlocal 语句描述变量，就可以让系统在处理针对这个变量的赋值操作时，去外围作用域查找。然而，nonlocal 有个限制，就是不能侵入模块级别的作用域（以防污染全局作用域）。</p>\n<p>下面，用 nonlocal 改写刚才那个函数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72211251561907860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def sort_priority2(numbers, group):\n    found = False\n\n    def helper(x):\n        nonlocal found\n        if x in group:\n            found = True  # Seems simple\n            return (0, x)\n        return (1, x)\n    numbers.sort(key=helper)\n    return found\n\n\nnumbers = [8, 3, 1, 2, 5, 4, 7, 6]\ngroup = {2, 3, 5, 7}\nfound = sort_priority2(numbers, group)\nprint(\'Found:\', found)\nprint(numbers)\n\n>>>\nFound: True\n[2, 3, 5, 7, 1, 4, 6, 8]`, `72211251561907860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{5}"\n              >\n                <span class="gatsby-code-button-language">py{5}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">sort_priority2</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    found <span class="token operator">=</span> <span class="token boolean">False</span>\n\n    <span class="token keyword">def</span> <span class="token function">helper</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="gatsby-highlight-code-line">        <span class="token keyword">nonlocal</span> found</span>        <span class="token keyword">if</span> x <span class="token keyword">in</span> group<span class="token punctuation">:</span>\n            found <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># Seems simple</span>\n            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n    numbers<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>helper<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> found\n\n\nnumbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>\ngroup <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span>\nfound <span class="token operator">=</span> sort_priority2<span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> group<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Found:\'</span><span class="token punctuation">,</span> found<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFound<span class="token punctuation">:</span> <span class="token boolean">True</span>\n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>nonlocal 语句清楚地表明，我们要把数据赋给闭包之外的变量。有一种跟它互补的语句，叫作 global，用这种语句描述某个变量后，在给这个变量赋值时，系统会直接把它放到模块作用域（或者说全局作用域）中。</p>\n<p>我们都知道全局变量不应该滥用，其实 nonlocal 也这样。除比较简单的函数外，大家尽量不要用这个语句，因为它造成的副作用有时很难发现。尤其是在那种比较长的函数里，nonlocal 语句与其关联变量的赋值操作之间可能隔得很远。</p>\n<p>如果 nonlocal 的用法比较复杂，那最好是改用辅助类来封装状态。下面就定义了这样一个类，用来实现与刚才那种写法相同的效果。这样虽然稍微长一点，但看起来更清晰易读（<code class="language-text">__call__</code> 这个特殊方法，请参见第 38 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15355623804503771000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Sorter:\n    def __init__(self, group):\n        self.group = group\n        self.found = False\n\n    def __call__(self, x):\n        if x in self.group:\n            self.found = True\n            return (0, x)\n        return (1, x)\n\n\nnumbers = [8, 3, 1, 2, 5, 4, 7, 6]\ngroup = {2, 3, 5, 7}\nsorter = Sorter(group)\nnumbers.sort(key=sorter)\nassert sorter.found is True`, `15355623804503771000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Sorter</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>group <span class="token operator">=</span> group\n        self<span class="token punctuation">.</span>found <span class="token operator">=</span> <span class="token boolean">False</span>\n\n    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> x <span class="token keyword">in</span> self<span class="token punctuation">.</span>group<span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>found <span class="token operator">=</span> <span class="token boolean">True</span>\n            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n\n\nnumbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>\ngroup <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span>\nsorter <span class="token operator">=</span> Sorter<span class="token punctuation">(</span>group<span class="token punctuation">)</span>\nnumbers<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>sorter<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> sorter<span class="token punctuation">.</span>found <span class="token keyword">is</span> <span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-17"><a href="#%E6%80%BB%E7%BB%93-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>闭包函数可以引用定义它们的那个外围作用域之中的变量。</li>\n<li>按照默认的写法，在闭包里面给变量赋值并不会改变外围作用域中的同名变量。</li>\n<li>先用 nonlocal 语句说明，然后赋值，可以修改外围作用域中的变量。</li>\n<li>除特别简单的函数外，尽量少用 nonlocal 语句。</li>\n</ol>\n<h2 id="第-22-条：用数量可变的位置参数给函数设计清晰的参数列表"><a href="#%E7%AC%AC-22-%E6%9D%A1%EF%BC%9A%E7%94%A8%E6%95%B0%E9%87%8F%E5%8F%AF%E5%8F%98%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E7%BB%99%E5%87%BD%E6%95%B0%E8%AE%BE%E8%AE%A1%E6%B8%85%E6%99%B0%E7%9A%84%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 22 条：用数量可变的位置参数给函数设计清晰的参数列表</h2>\n<p>让函数接受数量可变的位置参数（positional argument），可以把函数设计得更加清晰（这些位置参数通常简称 var args，或者叫作 star args，因为我们习惯用 <code class="language-text">*args</code> 指代）。例如，假设我们要记录调试信息。如果采用参数数量固定的方案来设计，那么函数应该接受一个表示信息的 message 参数和一个 values 列表（这个列表用于存放需要填充到信息里的那些值）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78898675362046070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def log(message, values):\n    if not values:\n        print(message)\n    else:\n        values_str = \', \'.join(str(x) for x in values)\n        print(f\'{message}: {values_str}\')\n\n\nlog(\'My numbers are\', [1, 2])\nlog(\'Hi there\', [])\n\n>>>\nMy numbers are: 1, 2\nHi there`, `78898675362046070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token keyword">not</span> values<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        values_str <span class="token operator">=</span> <span class="token string">\', \'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> values<span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>values_str<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\nlog<span class="token punctuation">(</span><span class="token string">\'My numbers are\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\nlog<span class="token punctuation">(</span><span class="token string">\'Hi there\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nMy numbers are<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>\nHi there</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>即便没有值需要填充到信息里面，也必须专门传一个空白的列表进去，这样显得多余，而且让代码看起来比较乱。最好是能允许调用者把第二个参数留空。在 Python 里，可以给最后一个位置参数加前缀 *，这样调用者就只需要提供不带星号的那些参数，然后可以不再指其他参数，也可以继续指定任意数量的位置参数。函数的主体代码不用改，只修改调用代码即可。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23182290660168126000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def log(message, *values):  # The only difference\n    if not values:\n        print(message)\n    else:\n        values_str = \', \'.join(str(x) for x in values)\n        print(f\'{message}: {values_str}\')\n\n\nlog(\'My numbers are\', 1, 2)\nlog(\'Hi there\')  # Much better\n\n>>>\nMy numbers are: 1, 2\nHi there`, `23182290660168126000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token operator">*</span>values<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># The only difference</span>\n    <span class="token keyword">if</span> <span class="token keyword">not</span> values<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        values_str <span class="token operator">=</span> <span class="token string">\', \'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> values<span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>values_str<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\nlog<span class="token punctuation">(</span><span class="token string">\'My numbers are\'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\nlog<span class="token punctuation">(</span><span class="token string">\'Hi there\'</span><span class="token punctuation">)</span>  <span class="token comment"># Much better</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nMy numbers are<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>\nHi there</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种写法与拆解数据时用在赋值语句左边带星号的 unpacking 操作非常类似（参见第 13 条）。</p>\n<p>如果想把已有序列（例如某列表）里面的元素当成参数传给像 log 这样的参数个数可变的函数（variadic function），那么可以在传递序列的时采用 * 操作符。这会让 Python 把序列中的元素都当成位置参数传给这个函数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22691412526716580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`favorites = [7, 33, 99]\nlog(\'Favorite colors\', *favorites)\n\n>>>\nFavorite colors: 7, 33, 99`, `22691412526716580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">favorites <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span>\nlog<span class="token punctuation">(</span><span class="token string">\'Favorite colors\'</span><span class="token punctuation">,</span> <span class="token operator">*</span>favorites<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFavorite colors<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">99</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>令函数接受数量可变的位置参数，可能导致两个问题。</p>\n<ol>\n<li>\n<p>程序总是必须先把这些参数转化成一个元组，然后才能把它们当成可选的位置参数传给函数。这意味着，如果调用函数时，把带 * 操作符的生成器传了过去，那么程序必须先把这个生成器里的所有元素迭代完（以便形成元组），然后才能继续往下执行（相关知识，参见第 30 条）。这个元组包含生成器所给出的每个值，这可能耗费大量内存，甚至会让程序崩溃。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12276168193232673000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def my_generator():\nfor i in range(10):\n    yield i\n\ndef my_func(*args):\n  print(args)\n\nit = my_generator()\nmy_func(*it)\n\n>>>\n(0, 1, 2, 3, 4, 5, 6, 7, 8, 9)`, `12276168193232673000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">my_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> i\n\n<span class="token keyword">def</span> <span class="token function">my_func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>\n\nit <span class="token operator">=</span> my_generator<span class="token punctuation">(</span><span class="token punctuation">)</span>\nmy_func<span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接受 <code class="language-text">*args</code> 参数的函数，适合处理输入值不太多，而且数量可以提前预估的情况。在调用这种函数时，传给 <code class="language-text">*args</code> 这一部分的应该是许多个字面值或变量名才对。这种机制，主要是为了让代码写起来更方便、读起来更清晰。</p>\n</li>\n<li>\n<p>如果用了 <code class="language-text">*args</code> 之后，又要给函数添加新的位置参数，那么原有的调用操作就需要全都更新。例如给参数列表开头添加新的位置参数 sequence，那么没有据此更新的那些调用代码就会出错。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41532737582900770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def log(sequence, message, *values):\nif not values:\n    print(f\'{sequence} - {message}\')\nelse:\n    values_str = \', \'.join(str(x) for x in values)\n    print(f\'{sequence} - {message}: {values_str}\')\n\nlog(1, \'Favorites\', 7, 33)  # New with *args OK\nlog(1, \'Hi there\')  # New message only OK\nlog(\'Favorite numbers\', 7, 33)  # old usage breaks\n\n>>>\n1 - Favorites: 7, 33\n1 - Hi there\nFavorite numbers - 7: 33`, `41532737582900770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>sequence<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token operator">*</span>values<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token keyword">if</span> <span class="token keyword">not</span> values<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>sequence<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    values_str <span class="token operator">=</span> <span class="token string">\', \'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> values<span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>sequence<span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>values_str<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\nlog<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'Favorites\'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span>  <span class="token comment"># New with *args OK</span>\nlog<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'Hi there\'</span><span class="token punctuation">)</span>  <span class="token comment"># New message only OK</span>\nlog<span class="token punctuation">(</span><span class="token string">\'Favorite numbers\'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span>  <span class="token comment"># old usage breaks</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span> <span class="token operator">-</span> Favorites<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">33</span>\n<span class="token number">1</span> <span class="token operator">-</span> Hi there\nFavorite numbers <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">:</span> <span class="token number">33</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>问题在于：第三次调用 log 函数的那个地方并没有根据新的参数列表传入 sequence 参数，所以 Favorite numbers 就成了 sequence 参数，7 就成了 message 参数。这样的 bug 很难排查，因为程序不会抛出异常，只会采用错误的数据继续运行下去。为了彻底避免这种漏洞，在给这种 <code class="language-text">*arg</code> 函数添加参数时，应该使用只能通过关键字来指定的参数（keyword-only argument，参见第 25 条）。要是想做得更稳妥一些，可以考虑添加类型注解（参见第 90 条）。</p>\n</li>\n</ol>\n<h3 id="总结-18"><a href="#%E6%80%BB%E7%BB%93-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>用 def 定义函数时，可以通过 <code class="language-text">*args</code> 的写法让函数接受数量可变的位置参数。</li>\n<li>调用函数时，可以在序列左边加上 <code class="language-text">*</code> 操作符，把其中的元素当成位置参数传给 <code class="language-text">*args</code> 所表示的这一部分。</li>\n<li>如果 <code class="language-text">*</code> 操作符加在生成器前，那么传递参数时，程序有可能因为耗尽内存而崩溃。</li>\n<li>给接受 <code class="language-text">*args</code> 的函数添加新位置参数，可能导致难以排查的 bug。</li>\n</ol>\n<h2 id="第-23-条：用关键字参数来表示可选的行为"><a href="#%E7%AC%AC-23-%E6%9D%A1%EF%BC%9A%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0%E6%9D%A5%E8%A1%A8%E7%A4%BA%E5%8F%AF%E9%80%89%E7%9A%84%E8%A1%8C%E4%B8%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 23 条：用关键字参数来表示可选的行为</h2>\n<p>与大多数其他编程语言一样，Python 允许在调用函数时，按照位置传递参数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78927229017890400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def remainder(number, divisor):\n    return number % divisor\n\n\nassert remainder(20, 7) == 6`, `78927229017890400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">remainder</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> divisor<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> number <span class="token operator">%</span> divisor\n\n\n<span class="token keyword">assert</span> remainder<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Python 函数里面的所有普通参数，除了按位置传递外，还可以按关键字传递。调用函数时，在调用括号内可以把关键字的名称写在 = 左边，把参数值写在右边。这种写法不在乎参数的顺序，只要把必须指定的所有位置参数全都传过去即可。另外，关键字形式与位置形式也可以混用。下面这四种写法的效果相同：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88952702270541220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`remainder(20, 7)\nremainder(20, divisor=7)\nremainder(number=20, divisor=7)\nremainder(divisor=7, number=20)`, `88952702270541220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">remainder<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>\nremainder<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> divisor<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>\nremainder<span class="token punctuation">(</span>number<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> divisor<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>\nremainder<span class="token punctuation">(</span>divisor<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果混用，那么位置参数必须出现在关键字参数之前，否则就会出错。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7177555777468458000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`remainder(number=20, 7)\n\n>>>\nTraceback ...\nSyntaxError: positional argument follows keyword argument`, `7177555777468458000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">remainder<span class="token punctuation">(</span>number<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nSyntaxError<span class="token punctuation">:</span> positional argument follows keyword argument</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每个参数只能指定一次，不能既通过位置形式指定，又通过关键字形式指定。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95504417809719850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`remainder(20, number=7)\n\n>>>\nTraceback ...\nTypeError: remainder() got multiple values for argument number`, `95504417809719850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">remainder<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> remainder<span class="token punctuation">(</span><span class="token punctuation">)</span> got multiple values <span class="token keyword">for</span> argument number</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果有一份字典，而且字典里面的内容能够用来调用 remainder 这样的函数，那么可以把 <code class="language-text">**</code> 运算符加在字典前面，这会让 Python 把字典里面的键值以关键字参数的形式传给函数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70650923967124730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`my_kwargs = {\n    \'number\': 20,\n    \'divisor\': 7,\n}\nassert remainder(**my_kwargs) == 6`, `70650923967124730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">my_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'number\'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>\n    <span class="token string">\'divisor\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">assert</span> remainder<span class="token punctuation">(</span><span class="token operator">**</span>my_kwargs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用函数时，带 <code class="language-text">**</code> 操作符的参数可以和位置参数或关键字参数混用，只要不重复指定就行。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71864782646693910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`my_kwargs = {\n    \'divisor\': 7,\n}\nassert remainder(number=20, **my_kwargs) == 6`, `71864782646693910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">my_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'divisor\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">assert</span> remainder<span class="token punctuation">(</span>number<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">**</span>my_kwargs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也可以对多个字典分别施加 <code class="language-text">**</code> 操作，只要这些字典所提供的参数不重叠就好。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13112990434014570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`my_kwargs = {\n    \'number\': 20,\n}\nother_kwargs = {\n    \'divisor\': 7,\n}\nassert remainder(**my_kwargs, **other_kwargs) == 6`, `13112990434014570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">my_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'number\'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\nother_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'divisor\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">assert</span> remainder<span class="token punctuation">(</span><span class="token operator">**</span>my_kwargs<span class="token punctuation">,</span> <span class="token operator">**</span>other_kwargs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>定义函数时，如果想让这个函数接受任意数量的关键字参数，那么可以在参数列表里写上万能形参 <code class="language-text">**kwargs</code>，它会把调用者传进来的参数收集合到一个字典里面稍后处理（第 26 条讲了一种特别适合这么做的情况）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97023435472043130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def print_parameters(**kwargs):\n    for key, value in kwargs.items():\n        print(f\'{key} = {value}\')\n\n\nprint_parameters(alpha=1.5, beta=9, gamma=4)\n\n>>>\nalpha = 1.5\nbeta = 9\ngamma = 4`, `97023435472043130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">print_parameters</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\nprint_parameters<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nalpha <span class="token operator">=</span> <span class="token number">1.5</span>\nbeta <span class="token operator">=</span> <span class="token number">9</span>\ngamma <span class="token operator">=</span> <span class="token number">4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>关键字参数的灵活用法可以带来三个好处。</p>\n<ol>\n<li>\n<p>用关键字参数调用函数可以让初次阅读代码的人更容易看懂。例如，读到 remainder(20, 7) 这样的调用代码，就不太容易看出谁是被除数 number，谁是除数 divisor，只有去查看 remainder 的具体实现方法才能明白。但如果改用关键字形式来调用，例如 remainder(number=20, divisor=7)，那么每个参数的含义就相当明了。</p>\n</li>\n<li>\n<p>它可以带有默认值，该值是在定义函数时指定的。在大多数情况下，调用者只需要沿用这个值就好，但有时也可以明确指定自己想要传的值。这样能够减少重复代码，让程序看上去干净一些。</p>\n<p>例如，我们要计算液体流入容器的速率。如果这个容器带刻度，那么可以取前后两个时间点的刻度差（<code class="language-text">weight_diff</code>），并把它跟这两个时间点的时间差（<code class="language-text">time_diff</code>）相除，就可以算出流速了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5495867601987636000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def flow_rate(weight_diff, time_diff):\nreturn weight_diff / time_diff\n\nweight_diff = 0.5\ntime_diff = 3\nflow = flow_rate(weight_diff, time_diff)\nprint(f\'{flow:.3} kg per second\')`, `5495867601987636000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">flow_rate</span><span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token keyword">return</span> weight_diff <span class="token operator">/</span> time_diff\n\nweight_diff <span class="token operator">=</span> <span class="token number">0.5</span>\ntime_diff <span class="token operator">=</span> <span class="token number">3</span>\nflow <span class="token operator">=</span> flow_rate<span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>flow<span class="token punctuation">:</span><span class="token format-spec">.3</span><span class="token punctuation">}</span></span><span class="token string"> kg per second\'</span></span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一般来说，我们会用每秒的千克数表示流速。但有的时候，我们还想估算更长的时间段（例如几小时或几天）内的流速结果。只需给同一个函数加一个 period 参数来表示那个时间段相当于多少秒即可。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54284649057545770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def flow_rate(weight_diff, time_diff, period):\n   return (weight_diff / time_diff) * period`, `54284649057545770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">flow_rate</span><span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">,</span> period<span class="token punctuation">)</span><span class="token punctuation">:</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>weight_diff <span class="token operator">/</span> time_diff<span class="token punctuation">)</span> <span class="token operator">*</span> period</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这样写有个问题，就是每次调用函数时，都得明确指定 period 参数。即便我们想计算每秒钟的流速，也还是得明确指定 period 为 1。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58231101583246180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`flow_per_second = flow_rate(weight_diff, time_diff, 1)`, `58231101583246180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">flow_per_second <span class="token operator">=</span> flow_rate<span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>为了简化这种用法，我们可以给 period 参数设定默认值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21637879075889566000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def flow_rate(weight_diff, time_diff, period=1):\n   return (weight_diff / time_diff) * period\n\nflow_per_second = flow_rate(weight_diff, time_diff)\nflow_per_hour = flow_rate(weight_diff, time_diff, 3600)`, `21637879075889566000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">flow_rate</span><span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">,</span> period<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>weight_diff <span class="token operator">/</span> time_diff<span class="token punctuation">)</span> <span class="token operator">*</span> period\n\nflow_per_second <span class="token operator">=</span> flow_rate<span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">)</span>\nflow_per_hour <span class="token operator">=</span> flow_rate<span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个办法适用于默认值比较简单的情况。如果默认值本身要根据比较复杂的逻辑来确定（可参考第 24 条），那就得仔细考虑一下了。</p>\n</li>\n<li>\n<p>我们可以很灵活地扩充函数的参数，而不用担心会影响原有的函数调用代码。这样的话，我们就可以通过这些新参数在函数里面实现许多新的功能，同时又无须修改早前写好的调用代码，这也让程序不容易因此出现 bug。</p>\n<p>例如，我们想继续扩充上述 <code class="language-text">flow_rate</code> 函数的功能，让它可以用千克之外的其他重量单位来计算流速。那只需要再添加一个可选参数，用来表示 1 千克相当于多少个那样的单位即可。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32728972385520505000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def flow_rate(weight_diff, time_diff, period=1, units_per_kg=1):\n  return ((weight_diff * units_per_kg) / time_diff) * period`, `32728972385520505000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">flow_rate</span><span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">,</span> period<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> units_per_kg<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>weight_diff <span class="token operator">*</span> units_per_kg<span class="token punctuation">)</span> <span class="token operator">/</span> time_diff<span class="token punctuation">)</span> <span class="token operator">*</span> period</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>新参数 <code class="language-text">units_per_kg</code> 的默认值为 1，这表示默认情况下，依然以千克为重量单位来计算。于是，以前写好的那些调用代码就不用修改了。以后调用 <code class="language-text">flow_rate</code> 时，可以通过关键字形式给这个参数指定值，以表示他们想用的那种单位（例如磅，1 千克约等于 2.2 磅）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38704255480867910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pounds_per_hour = flow_rate(weight_diff, time_diff,\n                        period=3600, units_per_kg=2.2)`, `38704255480867910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pounds_per_hour <span class="token operator">=</span> flow_rate<span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">,</span>\n                        period<span class="token operator">=</span><span class="token number">3600</span><span class="token punctuation">,</span> units_per_kg<span class="token operator">=</span><span class="token number">2.2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>可选的关键字参数有助于维护向后兼容（backward compatibility）。这是个相当重要的问题，对于接受带 <code class="language-text">*args</code> 参数的函数，也要注意向后兼容（参见第 22 条）。</p>\n<p>像 period 和 <code class="language-text">units_per_kg</code> 这样可选的关键字参数，只有一个缺点，就是调用者仍然能够按照位置来指定。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69084449245077970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pounds_per_hour = flow_rate(weight_diff, time_diff, 3600, 2.2)`, `69084449245077970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">pounds_per_hour <span class="token operator">=</span> flow_rate<span class="token punctuation">(</span>weight_diff<span class="token punctuation">,</span> time_diff<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>通过位置来指定可选参数，可能会让读代码的人有点儿糊涂，因为他不太清楚 3600 和 2.2 这两个值分别指哪个量的缩放系数。所以，最好是能以关键字的形式给这些参数传值，而不要按位置去传。从设计函数的角度来说，还可以考虑用更加明确的方案以降低出错概率（参见第 25 条）。</p>\n</li>\n</ol>\n<h3 id="总结-19"><a href="#%E6%80%BB%E7%BB%93-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>函数的参数可以按位置指定，也可以用关键字的形式指定。</li>\n<li>关键字可以让每个参数的作用更加明了，因为在调用函数时只按位置指定参数，可能导致这些参数的含义不够明确。</li>\n<li>应该通过带默认值的关键字参数来扩展函数的行为，因为这不会影响原有的函数调用代码。</li>\n<li>可选的关键字参数总是应该通过参数名来传递，而不应按位置传递。</li>\n</ol>\n<h2 id="第-24-条：用-none-和-docstring-来描述默认值会变的参数"><a href="#%E7%AC%AC-24-%E6%9D%A1%EF%BC%9A%E7%94%A8-none-%E5%92%8C-docstring-%E6%9D%A5%E6%8F%8F%E8%BF%B0%E9%BB%98%E8%AE%A4%E5%80%BC%E4%BC%9A%E5%8F%98%E7%9A%84%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 24 条：用 None 和 docstring 来描述默认值会变的参数</h2>\n<p>有时，我们想把那种不能够提前固定的值，当作关键字参数的默认值。例如，记录日志消息时，默认的时间应该是触发事件的那一刻。所以，如果调用者没有明确指定时间，那么就默认把调用函数的那一刻当成这条日志的记录时间。现在试试下面这种写法，假定它能让 when 参数的默认值随着这个函数每次的执行时间而发生变化。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74919780191418340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from time import sleep\nfrom datetime import datetime\n\n\ndef log(message, when=datetime.now()):\n    print(f\'{when}: {message}\')\n\n\nlog(\'Hi there!\')\nsleep(0.1)\nlog(\'Hello again!\')\n\n>>>\n2022-09-16 11:39:58.577119: Hi there!\n2022-09-16 11:39:58.577119: Hello again!`, `74919780191418340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep\n<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime\n\n\n<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> when<span class="token operator">=</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>when<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\nlog<span class="token punctuation">(</span><span class="token string">\'Hi there!\'</span><span class="token punctuation">)</span>\nsleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>\nlog<span class="token punctuation">(</span><span class="token string">\'Hello again!\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">58.577119</span><span class="token punctuation">:</span> Hi there!\n<span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">58.577119</span><span class="token punctuation">:</span> Hello again!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写不行。因为 datetime.now 只执行了一次，所以每条日志的时间戳（timestamp）相同。参数的默认值只会在系统加载这个模块的时候，计算一遍，而不会在每次执行时都重新计算，这通常意味着这些默认值在程序启动后，就已经定下来了。只要包含这段代码的那个模块已经加载进来，那么 when 参数的默认值就是加载时计算的那个 datetime.now()，系统不会重新计算。</p>\n<p>要想在 Python 里实现这种效果，惯用的办法是把参数的默认值设为 None，同时在 docstring 文档里面写清楚，这个参数为 None 时，函数会怎么运作（参见第 84 条）。给函数写实现代码时，要判断该参数是不是 None，如果是，就把它改成相应的默认值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86239525335141650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from time import sleep\nfrom datetime import datetime\n\n\ndef log(message, when=None):\n    &quot;&quot;&quot;Log a message with a timestamp.\n\n    Args:\n        message: Message to print.\n        when: datetime of when the message occurred.\n            Defaults to the present time.\n    &quot;&quot;&quot;\n    if when is None:\n        when = datetime.now()\n    print(f\'{when}: {message}\')\n\n\nlog(\'Hi there!\')\nsleep(0.1)\nlog(\'Hello again!\')\n\n>>>\n2022-09-16 11:52:02.810552: Hi there!\n2022-09-16 11:52:02.910765: Hello again!`, `86239525335141650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep\n<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime\n\n\n<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> when<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">"""Log a message with a timestamp.\n\n    Args:\n        message: Message to print.\n        when: datetime of when the message occurred.\n            Defaults to the present time.\n    """</span>\n    <span class="token keyword">if</span> when <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        when <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>when<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\nlog<span class="token punctuation">(</span><span class="token string">\'Hi there!\'</span><span class="token punctuation">)</span>\nsleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>\nlog<span class="token punctuation">(</span><span class="token string">\'Hello again!\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token number">02.810552</span><span class="token punctuation">:</span> Hi there!\n<span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token number">02.910765</span><span class="token punctuation">:</span> Hello again!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>把参数的默认值写成 None 还有个重要的意义，就是用来表示那种以后可能由调用者修改内容的默认值（例如某个可变的容器）。例如，我们要写一个函数对采用 JSON 格式编码的数据做解码。如果无法解码，那么就返回调用时所指定的默认结果，假如调用者当时没有明确指定，那就返回空白的字典。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5908631912028373000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import json\n\n\ndef decode(data, default={}):\n    try:\n        return json.loads(data)\n    except ValueError:\n        return default`, `5908631912028373000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> json\n\n\n<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>\n        <span class="token keyword">return</span> default</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样的写法与前面 datetime.now 的例子有着同样的问题。系统只会计算一次 default 参数（在加载这个模块的时候），所以每次调用这个函数时，给调用者返回的都是一开始分配的那个字典，这就相当于凡是以默认值调用这个函数的代码都共用同一份字典。这会使程序出现很奇怪的效果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47792717458177280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import json\n\n\ndef decode(data, default={}):\n    try:\n        return json.loads(data)\n    except ValueError:\n        return default\n\n\nfoo = decode(\'bad data\')\nfoo[\'stuff\'] = 5\nbar = decode(\'also bad\')\nbar[\'meep\'] = 1\nprint(\'Foo:\', foo)\nprint(\'Bar:\', bar)\n\n>>>\nFoo: {\'stuff\': 5, \'meep\': 1}\nBar: {\'stuff\': 5, \'meep\': 1}`, `47792717458177280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> json\n\n\n<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>\n        <span class="token keyword">return</span> default\n\n\nfoo <span class="token operator">=</span> decode<span class="token punctuation">(</span><span class="token string">\'bad data\'</span><span class="token punctuation">)</span>\nfoo<span class="token punctuation">[</span><span class="token string">\'stuff\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>\nbar <span class="token operator">=</span> decode<span class="token punctuation">(</span><span class="token string">\'also bad\'</span><span class="token punctuation">)</span>\nbar<span class="token punctuation">[</span><span class="token string">\'meep\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Foo:\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Bar:\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFoo<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'stuff\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">\'meep\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>\nBar<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'stuff\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">\'meep\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们本意是想让这两次调用操作得到两个不同的空白字典，每个字典都可以分别用来存放不同的键值。但实际上，只要修改其中一个字典，另一个字典的内容就会受到影响。这种错误的根源在于，foo 和 bar 实际上是同一个字典，都等于系统一开始给 default 参数确定默认值时所分配的那个字典。它们表示的是同一个字典对象。</p>\n<p>要解决这个问题，可以把默认值设成 None，并且在 docstring 文档里面说明，函数在这个值为 None 时会怎么做。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10751835578624803000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import json\n\n\ndef decode(data, default=None):\n    &quot;&quot;&quot;Load JSON data from a string.\n\n    Args:\n        data: JSON data to decode.\n        default: Value to return if decoding fails.\n            Defaults to an empty dictionary.\n    &quot;&quot;&quot;\n    try:\n        return json.loads(data)\n    except ValueError:\n        if default is None:\n            default = {}\n        return default\n\n\nfoo = decode(\'bad data\')\nfoo[\'stuff\'] = 5\nbar = decode(\'also bad\')\nbar[\'meep\'] = 1\nprint(\'Foo:\', foo)\nprint(\'Bar:\', bar)\nassert foo is not bar\n\n>>>\nFoo: {\'stuff\': 5}\nBar: {\'meep\': 1}`, `10751835578624803000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> json\n\n\n<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">"""Load JSON data from a string.\n\n    Args:\n        data: JSON data to decode.\n        default: Value to return if decoding fails.\n            Defaults to an empty dictionary.\n    """</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> default <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            default <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">return</span> default\n\n\nfoo <span class="token operator">=</span> decode<span class="token punctuation">(</span><span class="token string">\'bad data\'</span><span class="token punctuation">)</span>\nfoo<span class="token punctuation">[</span><span class="token string">\'stuff\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>\nbar <span class="token operator">=</span> decode<span class="token punctuation">(</span><span class="token string">\'also bad\'</span><span class="token punctuation">)</span>\nbar<span class="token punctuation">[</span><span class="token string">\'meep\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Foo:\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Bar:\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> foo <span class="token keyword">is</span> <span class="token keyword">not</span> bar\n\n<span class="token operator">>></span><span class="token operator">></span>\nFoo<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'stuff\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>\nBar<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'meep\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个思路可以跟类型注解搭配起来（参见第 90 条）。下面这种写法把 when 参数标注成可选（Optional）值，并限定其类型为 datetime。于是，它的取值就只有两种可能，要么是 None，要么是 datetime 对象。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94950680988679340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from typing import Optional\n\n\ndef log_typed(message: str, when: Optional[datetime] = None) -> None:\n    &quot;&quot;&quot;Log a message with a timestamp.\n\n        Args:\n            message: Message to print.\n            when: datetime of when the message occurred.\n                Defaults to the present time.\n    &quot;&quot;&quot;\n    if when is None:\n        when = datetime.now()\n    print(f\'{when}: {message}\')`, `94950680988679340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional\n\n\n<span class="token keyword">def</span> <span class="token function">log_typed</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> when<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>datetime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">"""Log a message with a timestamp.\n\n        Args:\n            message: Message to print.\n            when: datetime of when the message occurred.\n                Defaults to the present time.\n    """</span>\n    <span class="token keyword">if</span> when <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        when <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>when<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-20"><a href="#%E6%80%BB%E7%BB%93-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>参数的默认值只会计算一次，也就是在系统把定义函数的那个模块加载进来的时候。所以，如果默认值将来可能由调用方修改（例如{}、[]）或者要随着调用时的情况变化（例如 datetime.now()），那么程序就会出现奇怪的效果。</li>\n<li>如果关键字参数的默认值属于这种会发生变化的值，那就应该写成 None，并且要在 docstring 里面描述函数此时的默认行为。</li>\n<li>默认值为 None 的关键字参数，也可以添加类型注解。</li>\n</ol>\n<h2 id="第-25-条：用只能以关键字指定和只能按位置传入的参数来设计清晰的参数列表"><a href="#%E7%AC%AC-25-%E6%9D%A1%EF%BC%9A%E7%94%A8%E5%8F%AA%E8%83%BD%E4%BB%A5%E5%85%B3%E9%94%AE%E5%AD%97%E6%8C%87%E5%AE%9A%E5%92%8C%E5%8F%AA%E8%83%BD%E6%8C%89%E4%BD%8D%E7%BD%AE%E4%BC%A0%E5%85%A5%E7%9A%84%E5%8F%82%E6%95%B0%E6%9D%A5%E8%AE%BE%E8%AE%A1%E6%B8%85%E6%99%B0%E7%9A%84%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 25 条：用只能以关键字指定和只能按位置传入的参数来设计清晰的参数列表</h2>\n<p>按关键字传递参数是 Python 函数的一项强大特性（参见第 23 条）。这种关键字参数特别灵活，在很多情况下，都能让我们写出一看就懂的函数代码。例如，计算两数相除的结果时，可能需要仔细考虑各种特殊情况。</p>\n<p>例如，在除数为 0 的情况下，是抛出 ZeroDivisionError 异常，还是返回无穷（infinity）；在结果溢出的情况下，是抛出 OverflowError 异常，还是返回 0。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1950523950066407400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def safe_division(number, divisor,\n                  ignore_overflow,\n                  ignore_zero_division):\n    try:\n        return number / divisor\n    except OverflowError:\n        if ignore_overflow:\n            return 0\n        else:\n            raise\n    except ZeroDivisionError:\n        if ignore_zero_division:\n            return float(\'inf\')\n        else:\n            raise`, `1950523950066407400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">safe_division</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> divisor<span class="token punctuation">,</span>\n                  ignore_overflow<span class="token punctuation">,</span>\n                  ignore_zero_division<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> number <span class="token operator">/</span> divisor\n    <span class="token keyword">except</span> OverflowError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_overflow<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token number">0</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_zero_division<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个函数用起来很直观。如果想在结果溢出的情况下，让它返回 0，那么可以像下面这样调用函数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51053397988791650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`result = safe_division(1.0, 10**500, True, False)\nprint(result)\n\n>>>\n0`, `51053397988791650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">result <span class="token operator">=</span> safe_division<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">**</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果想在除数是 0 的情况下，让函数返回无穷，那么就按下面这样来写。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72674032958048575000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`result = safe_division(1.0, 0, False, True)\nprint(result)\n\n>>>\ninf`, `72674032958048575000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">result <span class="token operator">=</span> safe_division<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\ninf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>表示要不要忽略异常的那两个参数都是 Boolean 值，所以容易弄错位置，这会让程序出现难以查找的 bug。要想让代码看起来更清晰，一种办法是给这两个参数都指定默认值。按照默认值，该函数只要遇到特殊情况，就会抛出异常。</p>\n<p>调用者可以用关键字参数指定覆盖其中某个参数的默认值，以调整函数在遇到那种特殊情况时的处理方式，同时让另一个参数依然取那个参数自己的默认值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20543289298970956000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def safe_division_b(number, divisor,\n                    ignore_overflow=False,\n                    ignore_zero_division=False):\n    try:\n        return number / divisor\n    except OverflowError:\n        if ignore_overflow:\n            return 0\n        else:\n            raise\n    except ZeroDivisionError:\n        if ignore_zero_division:\n            return float(\'inf\')\n        else:\n            raise\n\n\nresult = safe_division_b(1.0, 10**500, ignore_overflow=True)\nprint(result)\nresult = safe_division_b(1.0, 0, ignore_zero_division=True)\nprint(result)\n\n>>>\n0\ninf`, `20543289298970956000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{2-3}"\n              >\n                <span class="gatsby-code-button-language">py{2-3}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">safe_division_b</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> divisor<span class="token punctuation">,</span>\n<span class="gatsby-highlight-code-line">                    ignore_overflow<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                    ignore_zero_division<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> number <span class="token operator">/</span> divisor\n    <span class="token keyword">except</span> OverflowError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_overflow<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token number">0</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_zero_division<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n\n\nresult <span class="token operator">=</span> safe_division_b<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">**</span><span class="token number">500</span><span class="token punctuation">,</span> ignore_overflow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\nresult <span class="token operator">=</span> safe_division_b<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ignore_zero_division<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">0</span>\ninf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而，由于这些关键参数是可选的，我们没办法要求调用者必须按照关键字形式来指定这两个参数。他们还是可以用传统的写法，按位置给这个新定义的 <code class="language-text">safe_division_b</code> 函数传递参数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57694805982165120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`assert safe_division_b(1.0, 10**500, True, False) == 0`, `57694805982165120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">assert</span> safe_division_b<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">**</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>对于这种参数比较复杂的函数，我们可以声明只能通过关键字指定的参数（keyword-only argument），这样的话，写出来的代码就能清楚地反映调用者的想法了。这种参数只能用关键字来指定，不能按位置传递。</p>\n<p>下面就重新定义 <code class="language-text">safe_division</code> 函数，让它接受这样的参数。参数列表里的 <code class="language-text">*</code> 符号把参数分成两组，左边是位置参数，右边是只能用关键字指定的参数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20703963722602103000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def safe_division_c(number, divisor, *,\n                    ignore_overflow=False,\n                    ignore_zero_division=False):\n    try:\n        return number / divisor\n    except OverflowError:\n        if ignore_overflow:\n            return 0\n        else:\n            raise\n    except ZeroDivisionError:\n        if ignore_zero_division:\n            return float(\'inf\')\n        else:\n            raise\n\n\nassert safe_division_c(1.0, 10**500, True, False) == 0\n\n>>>\nTraceback ...\nTypeError: safe_division_c() takes 2 positional arguments but 4 were given`, `20703963722602103000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{1}"\n              >\n                <span class="gatsby-code-button-language">py{1}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">safe_division_c</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> divisor<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span></span>                    ignore_overflow<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                    ignore_zero_division<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> number <span class="token operator">/</span> divisor\n    <span class="token keyword">except</span> OverflowError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_overflow<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token number">0</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_zero_division<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n\n\n<span class="token keyword">assert</span> safe_division_c<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">**</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> safe_division_c<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">2</span> positional arguments but <span class="token number">4</span> were given</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然我们还是可以像前面那样，用关键字参数指定覆盖其中一个参数的默认值（即忽略其中一种特殊情况，并让函数在遇到另一种特殊情况时抛出异常）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57669174525844010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`result = safe_division_c(1.0, 0, ignore_zero_division=True)\nassert result == float(\'inf\')\ntry:\n    result = safe_division_c(1.0, 0)\nexcept ZeroDivisionError:\n    pass  # Expected`, `57669174525844010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">result <span class="token operator">=</span> safe_division_c<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ignore_zero_division<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> result <span class="token operator">==</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    result <span class="token operator">=</span> safe_division_c<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>  <span class="token comment"># Expected</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样改依然有问题，因为在 <code class="language-text">safe_division_c</code> 版本的函数里面，有两个参数（也就是 number 和 divisor）必须由调用者提供。然而，调用者在提供这两个参数时，既可以按位置提供，也可以按关键字提供，还可以把这两种方式混起来用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6916147341393608000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`assert safe_division_c(number=2, divisor=5) == 0.4\nassert safe_division_c(divisor=5, number=2) == 0.4\nassert safe_division_c(2, divisor=5) == 0.4`, `6916147341393608000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">assert</span> safe_division_c<span class="token punctuation">(</span>number<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> divisor<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0.4</span>\n<span class="token keyword">assert</span> safe_division_c<span class="token punctuation">(</span>divisor<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0.4</span>\n<span class="token keyword">assert</span> safe_division_c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> divisor<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0.4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在未来也许因为扩展函数的需要，甚至是因为代码风格的变化，或许要修改这两个参数的名字。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44028749460523220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def safe_division_c(numerator, denominator, *,\n                    ignore_overflow=False,\n                    ignore_zero_division=False):`, `44028749460523220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{1}"\n              >\n                <span class="gatsby-code-button-language">py{1}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">safe_division_c</span><span class="token punctuation">(</span>numerator<span class="token punctuation">,</span> denominator<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span></span>                    ignore_overflow<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                    ignore_zero_division<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这看起来只是文字上面的微调，但之前所有通过关键字形式来指定这两个参数的调用代码，都会出错。</p>\n<p>其实最重要的问题在于，我们根本就没打算把 number 和 divisor 这两个名称纳入函数的接口；我们只是在编写函数的实现代码时，随意挑了这两个比较顺口的名称而已。也并不期望调用者也非得采用这种称呼来指定这两个参数。</p>\n<p>Python 3.8 引入了一项新特性，可以解决这个问题，这就是只能按位置传递的参数（positional-only argument）。这种参数与刚才的只能通过关键字指定的参数（keyword-only argument）相反，它们必须按位置指定，绝不能通过关键字形式指定。下面来重新定义 <code class="language-text">safe_division</code> 函数，使其前两个必须由调用者提供的参数只能按位置来提供。参数列表中的 <code class="language-text">/</code> 符号，表示它左边的那些参数只能按位置指定。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22400383513875476000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def safe_division_d(numerator, denominator, /, *,\n                    ignore_overflow=False,\n                    ignore_zero_division=False):\n    try:\n        return numerator / denominator\n    except OverflowError:\n        if ignore_overflow:\n            return 0\n        else:\n            raise\n    except ZeroDivisionError:\n        if ignore_zero_division:\n            return float(\'inf\')\n        else:\n            raise\n\n\nassert safe_division_d(2, 5) == 0.4 # 正常运行\nassert safe_division_d(numerator=2, denominator=5) == 0.4 # 报错`, `22400383513875476000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{1}"\n              >\n                <span class="gatsby-code-button-language">py{1}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">safe_division_d</span><span class="token punctuation">(</span>numerator<span class="token punctuation">,</span> denominator<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span></span>                    ignore_overflow<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                    ignore_zero_division<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> numerator <span class="token operator">/</span> denominator\n    <span class="token keyword">except</span> OverflowError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_overflow<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token number">0</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_zero_division<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n\n\n<span class="token keyword">assert</span> safe_division_d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0.4</span> <span class="token comment"># 正常运行</span>\n<span class="token keyword">assert</span> safe_division_d<span class="token punctuation">(</span>numerator<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> denominator<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0.4</span> <span class="token comment"># 报错</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们可以确信：给 <code class="language-text">safe_division_d</code> 函数的前两个参数（也就是那两个必备的参数）所挑选的名称，已经与调用者的代码解耦了。即便以后再次修改这两个参数的名称，也不会影响已经写好的调用代码。</p>\n<p>在函数的参数列表之中，<code class="language-text">/</code> 符号左侧的参数是只能按位置指定的参数，<code class="language-text">*</code> 符号右侧的参数则是只能按关键字形式指定的参数。那么，这两个符号如果同时出现在参数列表中，会有什么效果呢？这是个值得注意的问题。这意味着，这两个符号之间的参数，既可以按位置提供，又可以用关键字形式指定（其实，如果不特别说明 Python 函数的参数全都属于这种参数）。在设计 API 时，为了体现某编程风格或者实现某些需求，可能会允许某些参数既可以按位置传递，也可以用关键字形式指定，这样可以让代码简单易读。例如，给下面这个 <code class="language-text">safe_division</code> 函数的参数列表添加一个可选的 ndigits 参数，允许调用者指定这次除法应该精确到小数点后第几位。</p>\n<p>下面我们用三种方式来调用这个 <code class="language-text">safe_division_e</code> 函数。ndigits 是个带默认值的普通参数，因此，它既可以按位置传递，也可以用关键字来指定，还可以直接省略。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51876363033099060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def safe_division_e(numerator, denominator, /,\n                    ndigits=10, *,\n                    ignore_overflow=False,\n                    ignore_zero_division=False):\n    try:\n        fraction = numerator / denominator\n        return round(fraction, ndigits)\n    except OverflowError:\n        if ignore_overflow:\n            return 0\n        else:\n            raise\n    except ZeroDivisionError:\n        if ignore_zero_division:\n            return float(\'inf\')\n        else:\n            raise\n\n\nresult = safe_division_e(22, 7)\nprint(result)\nresult = safe_division_e(22, 7, 5)\nprint(result)\nresult = safe_division_e(22, 7, ndigits=2)\nprint(result)\n\n>>>\n3.1428571429\n3.14286\n3.14`, `51876363033099060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">safe_division_e</span><span class="token punctuation">(</span>numerator<span class="token punctuation">,</span> denominator<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span>\n                    ndigits<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span>\n                    ignore_overflow<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                    ignore_zero_division<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        fraction <span class="token operator">=</span> numerator <span class="token operator">/</span> denominator\n        <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>fraction<span class="token punctuation">,</span> ndigits<span class="token punctuation">)</span>\n    <span class="token keyword">except</span> OverflowError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_overflow<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token number">0</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n        <span class="token keyword">if</span> ignore_zero_division<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span>\n\n\nresult <span class="token operator">=</span> safe_division_e<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\nresult <span class="token operator">=</span> safe_division_e<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\nresult <span class="token operator">=</span> safe_division_e<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> ndigits<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">3.1428571429</span>\n<span class="token number">3.14286</span>\n<span class="token number">3.14</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-21"><a href="#%E6%80%BB%E7%BB%93-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>Keyword-only argument 是一种只能通过关键字指定而不能通过位置指定的参数。这迫使调用者必须指明，这个值是传给哪一个参数的。在函数的参数列表中，这种参数位于 <code class="language-text">*</code> 符号的右侧。</li>\n<li>Positional-only argument 是这样一种参数，它不允许调用者通过关键字来指定，而是要求必须按位置传递。这可以降低调用代码与参数名称之间的耦合程度。在函数的参数列表中，这些参数位于 <code class="language-text">/</code> 符号的左侧。</li>\n<li>在参数列表中，位于 <code class="language-text">/</code> 与 <code class="language-text">*</code> 之间的参数，可以按位置指定，也可以用关键字来指定。这也是 Python 普通参数的默认指定方式。</li>\n</ol>\n<h2 id="第-26-条：用-functoolswraps-定义函数修饰器"><a href="#%E7%AC%AC-26-%E6%9D%A1%EF%BC%9A%E7%94%A8-functoolswraps-%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 26 条：用 functools.wraps 定义函数修饰器</h2>\n<p>Python 中有一种特殊的写法，可以用修饰器（decorator）来封装某个函数，从而让程序在执行这个函数之前与执行完这个函数之后，分别运行某些代码。这意味着，调用者传给函数的参数值、函数返回给调用者的值，以及函数抛出的异常，都可以由修饰器访问并修改。这是个很有用的机制，能够确保用户以正确的方式使用函数，也能够用来调试程序或实现函数注册功能，此外还有许多用途。</p>\n<p>例如，假设我们要把函数执行时收到的参数与返回的值记录下来。这在调试递归函数时是很有用的，因为我们需要知道，这个函数执行每一层递归时，输入的是什么参数，返回的是什么值。下面我们就定义这样一个修饰器，在实现这个修饰器时，用 <code class="language-text">*args</code> 与 <code class="language-text">**kwargs</code> 表示受修饰的原函数 func 所收到的参数（参见第 22 条与第 23 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63851980569599510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def trace(func):\n    def wrapper(*args, **kwargs):\n        result = func(*args, **kwargs)\n        print(f\'{func.__name__}({args!r}，{kwargs!r})\'\n              f\'-> {result!r}\')\n        return result\n    return wrapper\n\n\n@trace # 相当于 fibonacci = trace(fibonacci)\ndef fibonacci(n):\n    &quot;&quot;&quot;Return the n-th Fibonacci number&quot;&quot;&quot;\n    if n in (0, 1):\n        return n\n    return fibonacci(n - 2) + fibonacci(n - 1)\n\nfibonacci(4)\n\n>>>\nfibonacci((0,)，{})-> 0\nfibonacci((1,)，{})-> 1\nfibonacci((2,)，{})-> 1\nfibonacci((1,)，{})-> 1\nfibonacci((0,)，{})-> 0\nfibonacci((1,)，{})-> 1\nfibonacci((2,)，{})-> 1\nfibonacci((3,)，{})-> 2\nfibonacci((4,)，{})-> 3`, `63851980569599510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">trace</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        result <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">，</span><span class="token interpolation"><span class="token punctuation">{</span>kwargs<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">)\'</span></span>\n              <span class="token string-interpolation"><span class="token string">f\'-> </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> result\n    <span class="token keyword">return</span> wrapper\n\n\n@trace <span class="token comment"># 相当于 fibonacci = trace(fibonacci)</span>\n<span class="token keyword">def</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">"""Return the n-th Fibonacci number"""</span>\n    <span class="token keyword">if</span> n <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> n\n    <span class="token keyword">return</span> fibonacci<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> fibonacci<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>\n\nfibonacci<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">0</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">1</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">1</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">1</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">0</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">1</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">1</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">2</span>\nfibonacci<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">)</span>，<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token number">3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写确实能满足需求，但是会带来一个我们不愿意看到的副作用。修饰器返回的那个值，也就是刚才调用的 fibonacci，它的名字并不叫 <code class="language-text">fibonacci</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41527176749907910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(fibonacci)\n\n>>>\n<function trace.<locals>.wrapper at 0x108955dcO>`, `41527176749907910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span>fibonacci<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token operator">&lt;</span>function trace<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">></span><span class="token punctuation">.</span>wrapper at 0x108955dcO<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种现象解释起来并不困难。trace 函数返回的，是它里面定义的 wrapper 函数，所以，当我们把这个返回值赋给 fibonacci 之后，fibonacci 这个名称所表示的自然就是 wrapper 了。问题在于，这样可能会干扰那些需要利用 introspection 机制来运作的工具，例如调试器（debugger）（参见第 80 条）。</p>\n<p>例如，如果用内置的 help 函数来查看修饰后的 fibonacci，那么打印出来的并不是我们想看的帮助文档，它本来应该打印前面定义时写的那行 <code class="language-text">Return the n-th Fibonacci number</code> 文本才对。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23980313936695970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`help(fibonacci)\n\n>>>\nHelp on function wrapper in module __main__:\n\nwrapper(*args, **kwargs)`, `23980313936695970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token builtin">help</span><span class="token punctuation">(</span>fibonacci<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nHelp on function wrapper <span class="token keyword">in</span> module __main__<span class="token punctuation">:</span>\n\nwrapper<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对象序列化器（object serializer，参见第 68 条）也无法正常运作，因为它不能确定受修饰的那个原始函数的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27473908908050860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import pickle\n\npickle.dumps(fibonacci)\n\n>>>\nTraceback ...\nAttributeError: Can\'t pickle local object \'trace.<locals>.wrapper\'`, `27473908908050860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> pickle\n\npickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>fibonacci<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nAttributeError<span class="token punctuation">:</span> Can<span class="token string">\'t pickle local object \'</span>trace<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">></span><span class="token punctuation">.</span>wrapper\'</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要想解决这些问题，可以改用 functools 内置模块之中的 wraps 辅助函数来实现。wraps 本身也是个修饰器，它可以帮助你编写自己的修饰器。把它运用到 wrapper 函数上面，它就会将重要的元数据（metadata）全都从内部函数复制到外部函数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55665368262186950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import pickle\nfrom functools import wraps\n\n\ndef trace(func):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        result = func(*args, **kwargs)\n        print(f\'{func.__name__}({args!r}，{kwargs!r})\'\n              f\'-> {result!r}\')\n        return result\n    return wrapper\n\n\n@trace\ndef fibonacci(n):\n    &quot;&quot;&quot;Return the n-th Fibonacci number&quot;&quot;&quot;\n    if n in (0, 1):\n        return n\n    return fibonacci(n - 2) + fibonacci(n - 1)\n\n\npickle.dumps(fibonacci)\nhelp(fibonacci)`, `55665368262186950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{2,6}"\n              >\n                <span class="gatsby-code-button-language">py{2,6}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> pickle\n<span class="gatsby-highlight-code-line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps</span>\n\n<span class="token keyword">def</span> <span class="token function">trace</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="gatsby-highlight-code-line">    @wraps<span class="token punctuation">(</span>func<span class="token punctuation">)</span></span>    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        result <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">，</span><span class="token interpolation"><span class="token punctuation">{</span>kwargs<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">)\'</span></span>\n              <span class="token string-interpolation"><span class="token string">f\'-> </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> result\n    <span class="token keyword">return</span> wrapper\n\n\n@trace\n<span class="token keyword">def</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">"""Return the n-th Fibonacci number"""</span>\n    <span class="token keyword">if</span> n <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> n\n    <span class="token keyword">return</span> fibonacci<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> fibonacci<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>\n\n\npickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>fibonacci<span class="token punctuation">)</span>\n<span class="token builtin">help</span><span class="token punctuation">(</span>fibonacci<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们就可以通过 help 函数看到正确的文档了。虽然原来的 fibonacci 函数现在封装在修饰器里面，但我们还是可以看到它的文档。</p>\n<p>除了这里讲到的几个方面之外，Python 函数还有很多标准属性（例如 <code class="language-text">__name__</code>、<code class="language-text">__module__</code>、<code class="language-text">__annotations__</code>）也应该在受到封装时得以保留，这样才能让相关的接口正常运作。wraps 可以帮助保留这些属性，使程序表现出正确的行为。</p>\n<h3 id="总结-22"><a href="#%E6%80%BB%E7%BB%93-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>修饰器是 Python 中的一种写法，能够把一个函数封装在另一个函数里面，这样程序在执行原函数之前与执行完毕之后，就有机会执行其他一些逻辑了。</li>\n<li>修饰器可能会让那些利用 introspection 机制运作的工具（例如调试器）产生奇怪的行为。</li>\n<li>Python 内置的 functools 模块里有个叫作 wraps 的修饰器，可以帮助我们正确定义自己的修饰器，从而避开相关的问题。</li>\n</ol>\n<h1 id="推导与生成"><a href="#%E6%8E%A8%E5%AF%BC%E4%B8%8E%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>推导与生成</h1>\n<h2 id="第-27-条：用列表推导取代-map-与-filter"><a href="#%E7%AC%AC-27-%E6%9D%A1%EF%BC%9A%E7%94%A8%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%8F%96%E4%BB%A3-map-%E4%B8%8E-filter" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 27 条：用列表推导取代 map 与 filter</h2>\n<p>Python 里面有一种很精简的写法，可以根据某个序列或可迭代对象派生出一份新的列表。用这种写法写成的表达式，叫作列表推导（list comprehension）。假设我们要用列表中每个元素的平方值构建一份新的列表。传统的写法是，采用下面这个简单的 for 循环来实现。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92368787237793250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nsquares = []\nfor x in a:\n    squares.append(x**2)\nprint(squares)\n\n>>>\n[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]`, `92368787237793250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\nsquares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token keyword">for</span> x <span class="token keyword">in</span> a<span class="token punctuation">:</span>\n    squares<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>squares<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面那段代码可以改用列表推导来写，这样可以在迭代列表的过程中，根据表达式算出新列表中的对应元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54114153041668050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nsquares = [x**2 for x in a]\nprint(squares)`, `54114153041668050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\nsquares <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> a<span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>squares<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这种功能当然也可以用内置函数 map 实现，它能够从多个列表中分别取出当前位置上的元素，并把它们当作参数传给映射函数，以求出新列表在这个位置上的元素值。如果映射关系比较简单（例如只是把一个列表映射到另一个列表），那么用列表推导来写还是比用 map 简单一些，因为用 map 的时候，必须先把映射逻辑定义成 lambda 函数，这看上去稍微有点烦琐。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28042320297999823000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nsquares = list(map(lambda x: x ** 2, a))\nprint(squares)`, `28042320297999823000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\nsquares <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>squares<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>列表推导还有一个地方比 map 好，就是它能够方便地过滤原列表，把某些输入值对应的计算结果从输出结果中排除。例如，假设新列表只需要纳入原列表中那些偶数的平方值，那我们可以在推导的时候，在 for x in a 这一部分的右侧写一个条件表达式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22572165794100953000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\neven_squares = [x**2 for x in a if x % 2 == 0]\nprint(even_squares)\n\n>>>\n[4, 16, 36, 64, 100]`, `22572165794100953000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\neven_squares <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>even_squares<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种功能也可以通过内置的 filter 与 map 函数来实现，但是这两个函数相结合的写法要比列表推导难懂一些。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8455418759793165000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\neven_squares = [x**2 for x in a if x % 2 == 0]\nalt = map(lambda x: x**2, filter(lambda x: x % 2 == 0, a))\nassert even_squares == list(alt)`, `8455418759793165000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\neven_squares <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>\nalt <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> even_squares <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">(</span>alt<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>字典与集合也有相应的推导机制，分别叫作字典推导（dictionary comprehension）与集合推导（set comprehension）。编写算法时，可以利用这些机制根据原字典与原集合创建新字典与新集合。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27315848246700770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\neven_squares_dict = {x: x**2 for x in a if x % 2 == 0}\nthrees_cubed_set = {x**3 for x in a if x % 3 == 0}\nprint(even_squares_dict)\nprint(threes_cubed_set)\n\n>>>\n{2: 4, 4: 16, 6: 36, 8: 64, 10: 100}\n{216, 729, 27}`, `27315848246700770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\neven_squares_dict <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">}</span>\nthrees_cubed_set <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">**</span><span class="token number">3</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">}</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>even_squares_dict<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>threes_cubed_set<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">:</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span>\n<span class="token punctuation">{</span><span class="token number">216</span><span class="token punctuation">,</span> <span class="token number">729</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果改用 map 与 filter 实现，那么还必须调用相应的构造器（constructor），这会让代码变得很长，需要分成多行才能写得下。这样看起来比较乱，不如使用推导机制的代码清晰。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8826514175209966000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\neven_squares_dict = {x: x**2 for x in a if x % 2 == 0}\nthrees_cubed_set = {x**3 for x in a if x % 3 == 0}\n\nalt_dict = dict(map(lambda x: (x, x**2),\n                    filter(lambda x: x % 2 == 0, a)))\nalt_set = set(map(lambda x: x**3,\n                  filter(lambda x: x % 3 == 0, a)))\n\nassert even_squares_dict == alt_dict\nassert threes_cubed_set == alt_set`, `8826514175209966000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\neven_squares_dict <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">}</span>\nthrees_cubed_set <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">**</span><span class="token number">3</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">}</span>\n\nalt_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nalt_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token operator">**</span><span class="token number">3</span><span class="token punctuation">,</span>\n                  <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">assert</span> even_squares_dict <span class="token operator">==</span> alt_dict\n<span class="token keyword">assert</span> threes_cubed_set <span class="token operator">==</span> alt_set</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-23"><a href="#%E6%80%BB%E7%BB%93-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>列表推导要比内置的 map 与 filter 函数清晰，因为它不用另外定义 lambda 表达式。</li>\n<li>列表推导可以很容易地跳过原列表中的某些数据，假如改用 map 实现，那么必须搭配 filter 才能实现。</li>\n<li>字典与集合也可以通过推导来创建。</li>\n</ol>\n<h2 id="第-28-条：控制推导逻辑的子表达式不要超过两个"><a href="#%E7%AC%AC-28-%E6%9D%A1%EF%BC%9A%E6%8E%A7%E5%88%B6%E6%8E%A8%E5%AF%BC%E9%80%BB%E8%BE%91%E7%9A%84%E5%AD%90%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8D%E8%A6%81%E8%B6%85%E8%BF%87%E4%B8%A4%E4%B8%AA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 28 条：控制推导逻辑的子表达式不要超过两个</h2>\n<p>除了最基本的用法（参见第 27 条）外，列表推导还支持多层循环。例如，要把矩阵（一种二维列表，它的每个元素本身也是列表）转化成普通的一维列表，那么可以在推导时，使用两条 for 子表达式。这些子表达式会按照从左到右的顺序解读。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3195103683912914400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]\nflat = [x for row in matrix for x in row]\nprint(flat)\n\n>>>\n[1, 2, 3, 4, 5, 6, 7, 8, 9]`, `3195103683912914400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\nflat <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> row <span class="token keyword">in</span> matrix <span class="token keyword">for</span> x <span class="token keyword">in</span> row<span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>flat<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写简单易懂，这也正是多层循环在列表推导之中的合理用法。多层循环还可以用来重制那种两层深的结构。例如，如果要根据二维矩阵里每个元素的平方值构建一个新的二维矩阵，那么可以采用下面这种写法。这看上去有点儿复杂，因为它把小的推导逻辑 <code class="language-text">[x**2 for x in row]</code> 嵌到了大的推导逻辑里面，不过，这行语句总体上不难理解。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92947090697948320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]\nsquared = [[x**2 for x in row] for row in matrix]\nprint(squared)\n\n>>>\n[[1, 4, 9], [16, 25, 36], [49, 64, 81]]`, `92947090697948320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\nsquared <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> row<span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> matrix<span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>squared<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果推导过程中还要再加一层循环，那么语句就会变得很长，必须把它分成多行来写，例如下面是把一个三维矩阵转化成普通一维列表的代码。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92701375901385640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`my_lists = [\n    [[1, 2, 3], [4, 5, 6]]\n]\nflat = [x for sublist1 in my_lists\n        for sublist2 in sublist1\n        for x in sublist2]\nprint(flat)\n\n>>>\n[1, 2, 3, 4, 5, 6]`, `92701375901385640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">my_lists <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n<span class="token punctuation">]</span>\nflat <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> sublist1 <span class="token keyword">in</span> my_lists\n        <span class="token keyword">for</span> sublist2 <span class="token keyword">in</span> sublist1\n        <span class="token keyword">for</span> x <span class="token keyword">in</span> sublist2<span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>flat<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这种情况下，采用列表推导来实现，其实并不会比传统的 for 循环节省多少代码。下面用常见的 for 循环改写刚才的例子。这次我们通过级别不同的缩进表示每一层循环的深度，这要比刚才那种三层矩阵的列表推导更加清晰。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1425147179418595600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`my_lists = [\n    [[1, 2, 3], [4, 5, 6]]\n]\nflat = []\nfor sublistl in my_lists:\n    for sublist2 in sublistl:\n        flat.extend(sublist2)`, `1425147179418595600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">my_lists <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n<span class="token punctuation">]</span>\nflat <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token keyword">for</span> sublistl <span class="token keyword">in</span> my_lists<span class="token punctuation">:</span>\n    <span class="token keyword">for</span> sublist2 <span class="token keyword">in</span> sublistl<span class="token punctuation">:</span>\n        flat<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>sublist2<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>推导的时候，可以使用多个 if 条件。如果这些 if 条件出现在同一层循环内，那么它们之间默认是 and 关系，也就是必须同时成立。例如，如果要用原列表中大于 4 且是偶数的值来构建新列表，那么既可以连用两个 if，也可以只用一个 if，下面两种写法效果相同。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35564920159692194000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nb = [x for x in a if x > 4 if x % 2 == 0]\nc = [x for x in a if x > 4 and x % 2 == 0]`, `35564920159692194000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\nb <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">4</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>\nc <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">4</span> <span class="token keyword">and</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在推导时，每一层的 for 子表达式都可以带有 if 条件。例如，要根据原矩阵构建新的矩阵，把其中各元素之和大于等于 10 的那些行选出来，而且只保留其中能够被 3 整除的那些元素。这个逻辑用列表推导来写，并不需要太多的代码，但是这些代码理解起来会很困难。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7746336929725817000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]\nfiltered = [[x for x in row if x % 3 == 0]\n            for row in matrix if sum(row) >= 10]\nprint(filtered)\n\n>>>\n[[6], [9]]`, `7746336929725817000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\nfiltered <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> row <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>\n            <span class="token keyword">for</span> row <span class="token keyword">in</span> matrix <span class="token keyword">if</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>filtered<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>虽然这个例子是笔者专门构造出来的，但在实际中，我们确实会碰到很多类似的需求。有人可能觉得，这些需求应该通过推导来实现。然而，笔者强烈建议大家不要用刚才的写法来推导新的 list、dict 或 set，因为这样写出来的代码很难让初次阅读这段程序的人看懂。对于 dict 来说，问题尤其严重，因为必须得把键与值的推导逻辑都表达出来才行。</p>\n<p>总之，在表示推导逻辑时，最多只应该写两个子表达式（例如两个 if 条件、两个 for 循环，或者一个 if 条件与一个 for 循环）。只要实现的逻辑比这还复杂，那就应该采用普通的 if 与 for 语句来实现，并且可以考虑编写辅助函数（参见第 30 条）。</p>\n<h3 id="总结-24"><a href="#%E6%80%BB%E7%BB%93-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>推导的时候可以使用多层循环，每层循环可以带有多个条件。</li>\n<li>控制推导逻辑的子表达式不要超过两个，否则代码很难读懂。</li>\n</ol>\n<h2 id="第-29-条：用赋值表达式消除推导中的重复代码"><a href="#%E7%AC%AC-29-%E6%9D%A1%EF%BC%9A%E7%94%A8%E8%B5%8B%E5%80%BC%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B6%88%E9%99%A4%E6%8E%A8%E5%AF%BC%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 29 条：用赋值表达式消除推导中的重复代码</h2>\n<p>推导 list、dict 与 set 等变体结构时，经常要在多个地方用到同一个计算结果。例如，我们要给制作紧固件的公司编写程序以管理订单。顾客下单后，我们要判断当前的库存能否满足这份订单，也就是说，要核查每种产品的数量有没有达到可以发货的最低限制（8 个为一批，至少要有一批，才能发货）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57860295950779220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`stock = {\n    \'nails\': 125,\n    \'screws\': 35,\n    \'wingnuts\': 8,\n    \'washers\': 24,\n}\norder = [\'screws\', \'wingnuts\', \'clips\']\n\n\ndef get_batches(count, size):\n    return count // size\n\n\nresult = {}\nfor name in order:\n    count = stock.get(name, 0)\n    batches = get_batches(count, 8)\n    if batches:\n        result[name] = batches\n\nprint(result)\n\n>>>\n{\'screws\': 4, \'wingnuts\': 1}`, `57860295950779220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">stock <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'nails\'</span><span class="token punctuation">:</span> <span class="token number">125</span><span class="token punctuation">,</span>\n    <span class="token string">\'screws\'</span><span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>\n    <span class="token string">\'wingnuts\'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>\n    <span class="token string">\'washers\'</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\norder <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'screws\'</span><span class="token punctuation">,</span> <span class="token string">\'wingnuts\'</span><span class="token punctuation">,</span> <span class="token string">\'clips\'</span><span class="token punctuation">]</span>\n\n\n<span class="token keyword">def</span> <span class="token function">get_batches</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> count <span class="token operator">//</span> size\n\n\nresult <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">for</span> name <span class="token keyword">in</span> order<span class="token punctuation">:</span>\n    count <span class="token operator">=</span> stock<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n    batches <span class="token operator">=</span> get_batches<span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> batches<span class="token punctuation">:</span>\n        result<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> batches\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'screws\'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">\'wingnuts\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段循环逻辑，如果改用字典推导来写，会简单一些（参见第 27 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34053831043661242000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`found = {name: get_batches(stock.get(name, 0), 8)\n         for name in order\n         if get_batches(stock.get(name, 0), 8)}\nprint(found)`, `34053831043661242000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">found <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> get_batches<span class="token punctuation">(</span>stock<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>\n         <span class="token keyword">for</span> name <span class="token keyword">in</span> order\n         <span class="token keyword">if</span> get_batches<span class="token punctuation">(</span>stock<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写虽然比刚才简短，但问题是，它把 <code class="language-text">get_batches(stock.get(name, 0), 8)</code> 写了两遍。这样会让代码看起来比较乱，而且实际上，程序也没有必要把这个结果计算两遍。另外，如果这两个地方忘了同步更新，那么程序就会出现 bug。例如，我们决定每一批不是 8 个，而是 4 个，那么需要把 <code class="language-text">get_batches</code> 的第二个参数从 8 改成 4，但是，万一我们忘了同步修改另一个地方，那么代码就可能会出问题（它会把大于等于 4 但是小于 8 的情况给漏掉）。</p>\n<p>有个简单的办法可以解决这个问题，那就是在推导的过程中使用 Python 3.8 新引入的 <code class="language-text">:=</code> 操作符进行赋值表达（参见第 10 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58123349158564430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`found = {name: batches for name in order\n         if (batches := get_batches(stock.get(name, 0), 8))}`, `58123349158564430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">found <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> batches <span class="token keyword">for</span> name <span class="token keyword">in</span> order\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>batches <span class="token punctuation">:</span><span class="token operator">=</span> get_batches<span class="token punctuation">(</span>stock<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这条 <code class="language-text">batches := get_batches(...)</code> 赋值表达式，能够从 stock 字典里查到对应产品一共有几批，并把这个批数放在 batches 变量里。这样的话，我们推导这个产品所对应批数时，就不用再通过 <code class="language-text">get_batches</code> 计算了，因为结果已经保存到 batches 里面了。这种写法只需要把 get 与 <code class="language-text">get_batches</code> 调用一次即可，这样能够提升效率，因为我们不需要针对 order 列表中的每件产品都多做一次 get 与 <code class="language-text">get_batches</code>。</p>\n<p>在推导过程中，描述新值的那一部分也可以出现赋值表达式。但如果在其他部分引用了定义在那一部分的变量，那么程序可能就会在运行时出错。例如，如果写成了下面这样，那么程序就必须先考虑 <code class="language-text">for name, count in stock.items() if tenth &gt; 0</code>，而这个时候，其中的 tenth 还没有得到定义。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7148604671333092000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`result = {name: (tenth := count // 10)\n          for name, count in stock.items() if tenth > 0}\nprint(result)\n\n>>>\nTraceback ...\nNameError: name \'tenth\' is not defined`, `7148604671333092000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">result <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token punctuation">(</span>tenth <span class="token punctuation">:</span><span class="token operator">=</span> count <span class="token operator">//</span> <span class="token number">10</span><span class="token punctuation">)</span>\n          <span class="token keyword">for</span> name<span class="token punctuation">,</span> count <span class="token keyword">in</span> stock<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> tenth <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">}</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nNameError<span class="token punctuation">:</span> name <span class="token string">\'tenth\'</span> <span class="token keyword">is</span> <span class="token keyword">not</span> defined</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了解决这个问题，可以把赋值表达式移动到 if 条件里面，然后在描述新值的这一部分引用已经定义过的 tenth 变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56335153038921760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`result = {name: tenth for name, count in stock.items()\n          if (tenth := count // 10) > 0}\nprint(result)\n\n>>>\n{\'nails\': 12, \'screws\': 3, \'washers\': 2}`, `56335153038921760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">result <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> tenth <span class="token keyword">for</span> name<span class="token punctuation">,</span> count <span class="token keyword">in</span> stock<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>tenth <span class="token punctuation">:</span><span class="token operator">=</span> count <span class="token operator">//</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">}</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'nails\'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">\'screws\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'washers\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果推导逻辑不带条件，而表示新值的那一部分又使用了 <code class="language-text">:=</code> 操作符，那么操作符左边的变量就会泄漏到包含这条推导语句的那个作用域里（参见第 21 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69409379619555290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`half = [(last := count // 2) for count in stock.values()]\nprint(f\'Last item of {half} is {last}\')\n\n>>>\nLast item of [62, 17, 4, 12] is 12`, `69409379619555290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">half <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>last <span class="token punctuation">:</span><span class="token operator">=</span> count <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> count <span class="token keyword">in</span> stock<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Last item of </span><span class="token interpolation"><span class="token punctuation">{</span>half<span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>last<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nLast item of <span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token number">12</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这与普通的 for 循环所用的那个循环变量类似</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81866571986763120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for count in stock.values():  # Leaks loop variable\n    pass\nprint(f\'Last item of {list(stock.values())} is {count}\')\n\n>>>\nLast item of [125, 35, 8, 24] is 24`, `81866571986763120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> count <span class="token keyword">in</span> stock<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Leaks loop variable</span>\n    <span class="token keyword">pass</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Last item of </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">list</span><span class="token punctuation">(</span>stock<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nLast item of <span class="token punctuation">[</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token number">24</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而，推导语句中的 for 循环所使用的循环变量，是不会像刚才那样泄漏到外面的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36086019982946804000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`half = [count // 2 for count in stock.values()]\nprint(half)\n# Works\nprint(count)  # Exception because loop variable didn\'t leak\n\n>>>\n[62, 17, 4, 12]\nTraceback ...\nNameError: name \'count\' is not defined`, `36086019982946804000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">half <span class="token operator">=</span> <span class="token punctuation">[</span>count <span class="token operator">//</span> <span class="token number">2</span> <span class="token keyword">for</span> count <span class="token keyword">in</span> stock<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span>\n<span class="token comment"># Works</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>  <span class="token comment"># Exception because loop variable didn\'t leak</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nNameError<span class="token punctuation">:</span> name <span class="token string">\'count\'</span> <span class="token keyword">is</span> <span class="token keyword">not</span> defined</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最好不要泄漏循环变量，所以，建议赋值表达式只出现在推导逻辑的条件之中。</p>\n<p>赋值表达式不仅可以用在推导过程中，而且可以用来编写生成器表达式（generator expression，参见第 32 条）。下面这种写法创建的是迭代器，而不是字典实例，该迭代器每次会给出一对数值，其中第一个元素为产品的名字，第二个元素为这种产品的库存。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65052861919561590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`found = ((name, batches) for name in order\n         if (batches := get_batches(stock.get(name, 0), 8)))\nprint(next(found))\nprint(next(found))\n\n>>>\n(\'screws\', 4)\n(\'wingnuts\', 1)`, `65052861919561590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">found <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> batches<span class="token punctuation">)</span> <span class="token keyword">for</span> name <span class="token keyword">in</span> order\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>batches <span class="token punctuation">:</span><span class="token operator">=</span> get_batches<span class="token punctuation">(</span>stock<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">(</span><span class="token string">\'screws\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'wingnuts\'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-25"><a href="#%E6%80%BB%E7%BB%93-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>编写推导式与生成器表达式时，可以在描述条件的那一部分通过赋值表达式定义变量，并在其他部分复用该变量，可使程序简单易读。</li>\n<li>对于推导式与生成器表达式来说，虽然赋值表达式也可以出现在描述条件的那一部分之外，但最好别这么写。</li>\n</ol>\n<h2 id="第-30-条：不要让函数直接返回列表，应该让它逐个生成列表里的值"><a href="#%E7%AC%AC-30-%E6%9D%A1%EF%BC%9A%E4%B8%8D%E8%A6%81%E8%AE%A9%E5%87%BD%E6%95%B0%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%E5%88%97%E8%A1%A8%EF%BC%8C%E5%BA%94%E8%AF%A5%E8%AE%A9%E5%AE%83%E9%80%90%E4%B8%AA%E7%94%9F%E6%88%90%E5%88%97%E8%A1%A8%E9%87%8C%E7%9A%84%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 30 条：不要让函数直接返回列表，应该让它逐个生成列表里的值</h2>\n<p>如果函数要返回的是个包含许多结果的序列，那么最简单的办法就是把这些结果放到列表中。例如，我们要返回字符串里每个单词的首字母所对应的下标。下面这种写法，会把每次遇到的新单词所在的位置追加（append）到存放结果的 result 列表中，在函数末尾返回这份列表。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32400307197757240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def index_words(text):\n    result = []\n    if text:\n        result.append(0)\n    for index, letter in enumerate(text):\n        if letter == \' \':\n            result.append(index + 1)\n    return result`, `32400307197757240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">index_words</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">if</span> text<span class="token punctuation">:</span>\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> index<span class="token punctuation">,</span> letter <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> letter <span class="token operator">==</span> <span class="token string">\' \'</span><span class="token punctuation">:</span>\n            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们把一段范例文本传给这个函数，它可以返回正确的结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38149293092467660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`address = \'Four score and seven years ago...\'\nresult = index_words(address)\nprint(result)\n\n>>>\n[0, 5, 11, 15, 21, 27]`, `38149293092467660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">address <span class="token operator">=</span> <span class="token string">\'Four score and seven years ago...\'</span>\nresult <span class="token operator">=</span> index_words<span class="token punctuation">(</span>address<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>index_words 函数有两个缺点。</p>\n<ol>\n<li>\n<p>它的代码看起来有点杂乱。每找到一个新单词，它都要调用 append 方法，而调用这个方法时，必须写上 result.append 这样一串字符，这就把我们想要强调的重点，也就是这个新单词在字符串中的位置（index + 1）淡化了。另外，函数还必须专门用一行代码创建这个保存结果的 result 列表，并且要用一条 return 语句把它返回给调用者。这样算下来，虽然函数的主体部分大约有 130 个字符（非空白的），但真正重要的只有 75 个左右。</p>\n<p>这种函数改用生成器（generator）来实现会比较好。生成器由包含 yield 表达式的函数创建。下面就定义一个生成器函数，实现与刚才那个函数相同的效果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28588295361787910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def index_words_iter(text):\n  if text:\n     yield 0\n  for index, letter in enumerate(text):\n     if letter == \' \':\n           yield index + 1\n\naddress = \'Four score and seven years ago...\'\nresult = index_words_iter(address)\nprint(list(result))`, `28588295361787910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">index_words_iter</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token keyword">if</span> text<span class="token punctuation">:</span>\n     <span class="token keyword">yield</span> <span class="token number">0</span>\n  <span class="token keyword">for</span> index<span class="token punctuation">,</span> letter <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>\n     <span class="token keyword">if</span> letter <span class="token operator">==</span> <span class="token string">\' \'</span><span class="token punctuation">:</span>\n           <span class="token keyword">yield</span> index <span class="token operator">+</span> <span class="token number">1</span>\n\naddress <span class="token operator">=</span> <span class="token string">\'Four score and seven years ago...\'</span>\nresult <span class="token operator">=</span> index_words_iter<span class="token punctuation">(</span>address<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>它必须把所有的结果都保存到列表中，然后才能返回列表。如果输入的数据特别多，那么程序可能会因为耗尽内存而崩溃。</p>\n<p>相反，用生成器函数来实现，就不会有这个问题了。它可以接受长度任意的输入信息，并把内存消耗量压得比较低。例如下面这个生成器，只需要把当前这行文字从文件中读进来就行，每次推进的时候，它都只处理一个单词，直到把当前这行文字处理完毕，才读入下一行文字。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99997184830219350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\ndef index_file(handle):\n  offset = 0\n  for line in handle:\n     if line:\n           yield offset\n     for letter in line:\n           offset += 1\n           if letter == \' \':\n              yield offset\n\nwith open(\'address.txt\', \'r\') as f:\n  it = index_file(f)\n  results = itertools.islice(it, 0, 10)\n  print(list(results))`, `99997184830219350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\n<span class="token keyword">def</span> <span class="token function">index_file</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  offset <span class="token operator">=</span> <span class="token number">0</span>\n  <span class="token keyword">for</span> line <span class="token keyword">in</span> handle<span class="token punctuation">:</span>\n     <span class="token keyword">if</span> line<span class="token punctuation">:</span>\n           <span class="token keyword">yield</span> offset\n     <span class="token keyword">for</span> letter <span class="token keyword">in</span> line<span class="token punctuation">:</span>\n           offset <span class="token operator">+=</span> <span class="token number">1</span>\n           <span class="token keyword">if</span> letter <span class="token operator">==</span> <span class="token string">\' \'</span><span class="token punctuation">:</span>\n              <span class="token keyword">yield</span> offset\n\n<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'address.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n  it <span class="token operator">=</span> index_file<span class="token punctuation">(</span>f<span class="token punctuation">)</span>\n  results <span class="token operator">=</span> itertools<span class="token punctuation">.</span>islice<span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\n  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>该函数运行时所耗的内存，取决于文件中最长的那一行所包含的字符数。把刚才那份输入数据存放到 address.txt 文件，让这个函数去读取并用它所返回的生成器构建一份列表，可以看到跟原来相同的结果（islice 函数的详细用法，参见第 36 条）。</p>\n<p>定义这种生成器函数的时候，只有一个地方需要注意，就是调用者无法重复使用函数所返回的迭代器，因为这些迭代器是有状态的（参见第 31 条）。</p>\n</li>\n</ol>\n<h3 id="总结-26"><a href="#%E6%80%BB%E7%BB%93-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>用生成器来实现比让函数把结果收集合到列表里再返回，要更加清晰一些。</li>\n<li>生成器函数所返回的迭代器可以产生一系列值，每次产生的那个值都是由函数体的下一条 yield 表达式所决定的。</li>\n<li>不管输入的数据量有多大，生成器函数每次都只需要根据其中的一小部分来计算当前这次的输出值。它不用把整个输入值全都读取进来，也不用一次就把所有的输出值全都算好。</li>\n</ol>\n<h2 id="第-31-条：谨慎地迭代函数所收到的参数"><a href="#%E7%AC%AC-31-%E6%9D%A1%EF%BC%9A%E8%B0%A8%E6%85%8E%E5%9C%B0%E8%BF%AD%E4%BB%A3%E5%87%BD%E6%95%B0%E6%89%80%E6%94%B6%E5%88%B0%E7%9A%84%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 31 条：谨慎地迭代函数所收到的参数</h2>\n<p>如果函数接受的参数是个包含许多对象的列表，那么这份列表有可能要迭代多次。例如，我们要分析美国得克萨斯州的游客数量。原始数据保存在一份列表中，其中的每个元素表示每年有多少游客到这个城市旅游（单位是百万）。我们现在要统计每个城市的游客数占游客总数的百分比。</p>\n<p>为了求出这份数据，先把列表里的所有元素加起来求出游客总数，然后，分别用每个城市的游客数除以游客总数计算出该城市在总数据中所占的百分比。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76230871198239880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def normalize(numbers):\n    total = sum(numbers)\n    result = []\n    for value in numbers:\n        percent = 100 * value / total\n        result.append(percent)\n    return result`, `76230871198239880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">normalize</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>\n        percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> value <span class="token operator">/</span> total\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>percent<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>把一份范例数据放到列表中传给这个函数，可以得到正确的结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85445641230059540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def normalize(numbers):\n    total = sum(numbers)\n    result = []\n    for value in numbers:\n        percent = 100 * value / total\n        result.append(percent)\n    return result\n\n\nvisits = [15, 35, 80]\npercentages = normalize(visits)\nprint(percentages)\nassert sum(percentages) == 100.0\n\n>>>\n[11.538461538461538, 26.923076923076923, 61.53846153846154]`, `85445641230059540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">normalize</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>\n        percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> value <span class="token operator">/</span> total\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>percent<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result\n\n\nvisits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span>\npercentages <span class="token operator">=</span> normalize<span class="token punctuation">(</span>visits<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100.0</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">11.538461538461538</span><span class="token punctuation">,</span> <span class="token number">26.923076923076923</span><span class="token punctuation">,</span> <span class="token number">61.53846153846154</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了应对规模更大的数据，我们现在需要让程序能够从文件中读取信息，并假设得克萨斯州所有城市的游客数都放在这份文件中。笔者决定用生成器实现，因为这样做可以让我们把同样的功能套用在其他数据上面，例如分析全世界（而不仅仅是得克萨斯一州）各城市的游客数。那些场合的数据量与内存用量可能会比现在大得多（参见第 30 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99462901396984120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def read_visits(data_path):\n    with open(data_path)as f:\n        for line in f:\n            yield int(line)`, `99462901396984120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">read_visits</span><span class="token punctuation">(</span>data_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>data_path<span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>\n        <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> <span class="token builtin">int</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>奇怪的是，对 <code class="language-text">read_visits</code> 所返回的迭代器调用 normalize 函数后，并没有得到结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23944996551271604000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`it = read_visits(\'my_numbers.txt\')\npercentages = normalize(it)\nprint(percentages)\n\n>>>\n[]`, `23944996551271604000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">it <span class="token operator">=</span> read_visits<span class="token punctuation">(</span><span class="token string">\'my_numbers.txt\'</span><span class="token punctuation">)</span>\npercentages <span class="token operator">=</span> normalize<span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>出现这种状况的原因在于，迭代器只能产生一次结果。假如迭代器或生成器已经抛出过 StopIteration 异常，继续用它来构造列表或是像 normalize 那样对它做 for 循环，那它不会给出任何结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94715586494126830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`it = read_visits(\'my_numbers.txt\')\nprint(list(it))\nprint(list(it))  # Already exhausted\n\n>>>\n[15, 35, 80]\n[]`, `94715586494126830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">it <span class="token operator">=</span> read_visits<span class="token punctuation">(</span><span class="token string">\'my_numbers.txt\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Already exhausted</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有个因素也很令人迷惑，那就是：在已经把数据耗完的迭代器上面继续迭代，程序居然不报错。for 循环、list 构造器以及 Python 标准库的其他许多函数，都认为迭代器在正常的操作过程中抛出 StopIteration 异常是很自然的。它们没办法区分，这个迭代器是本身就没有数据可以提供，还是虽然有数据，但现在已经耗尽了。</p>\n<p>为了解决这个问题，我们可以把外界传入的迭代器特意遍历一整轮，从而将其中的内容复制到一份列表里。这样的话，以后就可以用这份列表来处理数据了，那时想迭代多少遍都可以。下面的函数与原来的 normalize 函数功能相同，但是它会把收到的那个 numbers 迭代器所能提供的数据明确地复制到 <code class="language-text">numbers_copy</code> 列表里。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77450860311038600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def normalize_copy(numbers):\n    numbers_copy = list(numbers)  # Copy the iterator\n    total = sum(numbers_copy)\n    result = []\n    for value in numbers_copy:\n        percent = 100 * value / total\n        result.append(percent)\n    return result`, `77450860311038600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">normalize_copy</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    numbers_copy <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>  <span class="token comment"># Copy the iterator</span>\n    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers_copy<span class="token punctuation">)</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> numbers_copy<span class="token punctuation">:</span>\n        percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> value <span class="token operator">/</span> total\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>percent<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在的这个函数就可以正确处理 <code class="language-text">read_visits</code> 生成器函数所返回的 it 值了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52891401516873015000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`it = read_visits(\'my_numbers.txt\')\npercentages = normalize_copy(it)\nprint(percentages)\nassert sum(percentages) == 100.0`, `52891401516873015000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">it <span class="token operator">=</span> read_visits<span class="token punctuation">(</span><span class="token string">\'my_numbers.txt\'</span><span class="token punctuation">)</span>\npercentages <span class="token operator">=</span> normalize_copy<span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个办法虽然能解决问题，但如果输入给它的迭代器所要提供的数据量相当庞大，那么有可能导致程序在复制迭代器时，因耗尽内存而崩溃。所以，把这个方案用在大规模的数据集合上面，会抵消掉 <code class="language-text">read_visits</code> 的好处。编写那样一个函数，就是不想让程序把整套数据全都读取进来，而是可以一条一条地处理。为了应对大规模的数据，其中一个变通方案是让 normalize 函数接受另外一个函数（也就是下面的 <code class="language-text">get_iter</code>），使它每次要使用迭代器时，都去向那个函数索要。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4774495147926916000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def normalize_func(get_iter):\n    total = sum(get_iter())  # New iterator\n    result = []\n    for value in get_iter():  # New iterator\n        percent = 100 * value / total\n        result.append(percent)\n    return result`, `4774495147926916000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">normalize_func</span><span class="token punctuation">(</span>get_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>get_iter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># New iterator</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> get_iter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># New iterator</span>\n        percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> value <span class="token operator">/</span> total\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>percent<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 <code class="language-text">normalize_func</code> 函数时，需要传入一条 <code class="language-text">lambda</code> 表达式，让这个表达式去调用 <code class="language-text">read_visits</code> 生成器函数。这样 <code class="language-text">normalize_func</code> 每次向 <code class="language-text">get_iter</code> 索要迭代器时，程序都会给出一个新的迭代器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68828652504093270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`path = \'my_numbers.txt\'\npercentages = normalize_func(lambda: read_visits(path))\nprint(percentages)\nassert sum(percentages) == 100.0`, `68828652504093270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">path <span class="token operator">=</span> <span class="token string">\'my_numbers.txt\'</span>\npercentages <span class="token operator">=</span> normalize_func<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> read_visits<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样做虽然可行，但传入这么一个 lambda 表达式显得有点儿生硬。要想用更好的办法解决这个问题，可以新建一种容器类，让它实现迭代器协议（iterator protocol）。</p>\n<p>Python 的 for 循环及相关的表达式，正是按照迭代器协议来遍历容器内容的。Python 执行 <code class="language-text">for x in foo</code> 这样的语句时，实际上会调用 iter(foo)，也就是把 foo 传给内置的 iter 函数。这个函数会触发名为 <code class="language-text">foo.__iter__</code> 的特殊方法，该方法必须返回迭代器对象（这个迭代器对象本身要实现 <code class="language-text">__next__</code> 特殊方法）。最后，Python 会用迭代器对象反复调用内置的 next 函数，直到数据耗尽为止（如果抛出 StopIteration 异常，就表示数据已经迭代完了）。</p>\n<p>这个过程听上去比较复杂，但总结起来，其实只需要让你的类在实现 <code class="language-text">__iter__</code> 方法时，按照生成器的方式来写就好。下面定义这样一种可迭代的容器类，用来读取文件中的游客数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51583491327471550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ReadVisits:\n    def __init__(self, data_path):\n        self.data_path = data_path\n\n    def __iter__(self):\n        with open(self.data_path) as f:\n            for line in f:\n                yield int(line)`, `51583491327471550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ReadVisits</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>data_path <span class="token operator">=</span> data_path\n\n    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data_path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>\n                <span class="token keyword">yield</span> <span class="token builtin">int</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们只需要把新的容器传给最早的那个 normalize 函数运行即可，函数本身的代码不需要修改。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33240240926675767000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def normalize(numbers):\n    total = sum(numbers)\n    result = []\n    for value in numbers:\n        percent = 100 * value / total\n        result.append(percent)\n    return result\n\n\nclass ReadVisits:\n    def __init__(self, data_path):\n        self.data_path = data_path\n\n    def __iter__(self):\n        with open(self.data_path) as f:\n            for line in f:\n                yield int(line)\n\n\npath = \'my_numbers.txt\'\nvisits = ReadVisits(path)\npercentages = normalize(visits)\nprint(percentages)\nassert sum(percentages) == 100.0`, `33240240926675767000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">normalize</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>\n        percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> value <span class="token operator">/</span> total\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>percent<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result\n\n\n<span class="token keyword">class</span> <span class="token class-name">ReadVisits</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>data_path <span class="token operator">=</span> data_path\n\n    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data_path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>\n                <span class="token keyword">yield</span> <span class="token builtin">int</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>\n\n\npath <span class="token operator">=</span> <span class="token string">\'my_numbers.txt\'</span>\nvisits <span class="token operator">=</span> ReadVisits<span class="token punctuation">(</span>path<span class="token punctuation">)</span>\npercentages <span class="token operator">=</span> normalize<span class="token punctuation">(</span>visits<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样做为什么可行呢？因为 normalize 函数里面的 sum 会触发 <code class="language-text">ReadVisits.__iter__</code>，让系统分配一个新的迭代器对象给它。接下来，normalize 通过 for 循环计算每项数据占总值的百分比时，又会触发 <code class="language-text">__iter__</code>，于是系统会分配另一个迭代器对象。这些迭代器各自推进，其中一个迭代器把数据耗尽，并不会影响其他迭代器。所以，在每一个迭代器上面遍历，都可以分别看到一套完整的数据。这种方案的唯一缺点，就是多次读取输入数据。</p>\n<p>明白了 ReadVisits 这种容器的工作原理后，我们就可以在编写函数和方法时先确认一下，收到的应该是像 ReadVisits 这样的容器，而不是普通的迭代器。按照协议，如果将普通的迭代器传给内置的 iter 函数，那么函数会把迭代器本身返回给调用者。反之，如果传来的是容器类型，那么 iter 函数就会返回一个新的迭代器对象。我们可以借助这条规律，判断输入值是不是这种容器。如果不是，就抛出 TypeError 异常，因为我们没办法在那样的值上面重复遍历。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49794491558709300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def normalize_defensive(numbers):\n    if iter(numbers) is numbers:  # An iterator -- bad!\n        raise TypeError(\'Must supply a container\')\n    total = sum(numbers)\n    result = []\n    for value in numbers:\n        percent = 100 * value / total\n        result.append(percent)\n    return result`, `49794491558709300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">normalize_defensive</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span> <span class="token keyword">is</span> numbers<span class="token punctuation">:</span>  <span class="token comment"># An iterator -- bad!</span>\n        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">\'Must supply a container\'</span><span class="token punctuation">)</span>\n    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>\n        percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> value <span class="token operator">/</span> total\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>percent<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一种写法也可以检测出这样的问题。collections.abc 内置模块里定义了名为 Iterator 的类，它用在 isinstance 函数中，可以判断自己收到的参数是不是这种实例。如果是，就抛出异常（参见第 43 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92073062186933980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def normalize_defensive(numbers):\n    if isinstance(numbers, Iterator):  # Another way to check\n        raise TypeError(\'Must supply a container\')\n    total = sum(numbers)\n    result = []\n    for value in numbers:\n        percent = 100 * value / total\n        result.append(percent)\n    return result`, `92073062186933980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">normalize_defensive</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Another way to check</span>\n        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">\'Must supply a container\'</span><span class="token punctuation">)</span>\n    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>\n        percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> value <span class="token operator">/</span> total\n        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>percent<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种自定义容器的方案，最适合于既不想像 <code class="language-text">normalize_copy</code> 函数一样，把迭代器提供的这套数据全部复制一份，同时又要多次遍历这套数据的情况。该方案不仅支持自定义容器，还支持系统自带的列表类型，因为这些全都属于遵循迭代器协议的可迭代容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43530380787920490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`visits = [15, 35, 80]\npercentages = normalize_defensive(visits)\nassert sum(percentages) == 100.0\n\npath = \'my_numbers.txt\'\nvisits = ReadVisits(path)\npercentages = normalize_defensive(visits)\nassert sum(percentages) == 100.0`, `43530380787920490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">visits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span>\npercentages <span class="token operator">=</span> normalize_defensive<span class="token punctuation">(</span>visits<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100.0</span>\n\npath <span class="token operator">=</span> <span class="token string">\'my_numbers.txt\'</span>\nvisits <span class="token operator">=</span> ReadVisits<span class="token punctuation">(</span>path<span class="token punctuation">)</span>\npercentages <span class="token operator">=</span> normalize_defensive<span class="token punctuation">(</span>visits<span class="token punctuation">)</span>\n<span class="token keyword">assert</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>percentages<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果输入的是普通迭代器而不是容器，那么 <code class="language-text">normalize_defensive</code> 就会抛出异常。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86915414116376440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`visits = [15, 35, 80]\nit = iter(visits)\nnormalize_defensive(it)\n\n>>>\nTraceback ...\nTypeError: Must supply a container`, `86915414116376440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">visits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span>\nit <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>visits<span class="token punctuation">)</span>\nnormalize_defensive<span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> Must supply a container</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种思路也适用于异步的迭代器（示例参见第 61 条）。</p>\n<h3 id="总结-27"><a href="#%E6%80%BB%E7%BB%93-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>函数和方法如果要把收到的参数遍历很多遍，那就必须特别小心。因为如果这些参数为迭代器，那么程序可能得不到预期的值，从而出现奇怪的效果。</li>\n<li>Python 的迭代器协议确定了容器与迭代器应该怎样跟内置的 iter 及 next 函数、for 循环及相关的表达式交互。</li>\n<li>要想让自定义的容器类型可以迭代，只需要把 <code class="language-text">__iter__</code> 方法实现为生成器即可。</li>\n<li>可以把值传给 iter 函数，检测它返回的是不是那个值本身。如果是，就说明这是个普通的迭代器，而不是一个可以迭代的容器。另外，也可以用内置的 isinstance 函数判断该值是不是 collections.abc.Iterator 类的实例。</li>\n</ol>\n<h2 id="第-32-条：考虑用生成器表达式改写数据量较大的列表推导"><a href="#%E7%AC%AC-32-%E6%9D%A1%EF%BC%9A%E8%80%83%E8%99%91%E7%94%A8%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%94%B9%E5%86%99%E6%95%B0%E6%8D%AE%E9%87%8F%E8%BE%83%E5%A4%A7%E7%9A%84%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 32 条：考虑用生成器表达式改写数据量较大的列表推导</h2>\n<p>列表推导可以根据输入序列中的每个元素创建一个包含派生元素的新列表（参见第 27 条）。如果输入的数据量比较小，那么这样做没问题，但如果数据量很大，那么程序就有可能因为内存耗尽而崩溃。</p>\n<p>例如，我们要读取一份文件并返回每行的字符数。假如采用列表推导来实现，那需要把文件中的每行文本都载入内存，并统计长度。对于庞大的文件，或者像 network socket 这样无休止的输入来说，这么写恐怕有问题。下面就是采用列表推导写的代码，它只能处理输入数据量比较少的情况。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69884523513720300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`value = [len(x) for x in open(\'my_file.txt\')]\nprint(value)`, `69884523513720300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'my_file.txt\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>要想处理大规模的数据，可以使用生成器表达式（generator expression）来做，它扩展了列表推导式与生成器机制。程序在对生成器表达式求值时，并不会让它把包含输出结果的那个序列立刻构建出来，而是会把它当成一个迭代器，该迭代器每次可以根据表达式中的逻辑给出一项结果。</p>\n<p>生成器表达式的写法，与列表推导式语法类似，但它是写在一对圆括号内，而不是方括号里面。下面这种写法的效果与刚才一样，但是程序并不会立刻给出全部结果，而是先将生成器表达式表示成一个迭代器返回。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27556451693903640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`it = (len(x) for x in open(\'my_file.txt\'))\nprint(it)\n\n>>>\n<generator object <genexpr> at 0x7f13063e03c0>`, `27556451693903640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">it <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'my_file.txt\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token operator">&lt;</span>generator <span class="token builtin">object</span> <span class="token operator">&lt;</span>genexpr<span class="token operator">></span> at <span class="token number">0x7f13063e03c0</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>返回的迭代器每次可以推进一步，这时它会根据生成表达式的逻辑计算出下一项输出结果（这项结果可以通过内置的 next 函数取得）。需要多少项结果，就把迭代器推进多少次，这种采用生成器表达式来实现的写法不会消耗太多内存。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75178591204293300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(next(it))\nprint(next(it))`, `75178591204293300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>生成器表达式还有个强大的特性，就是可以组合起来。例如，可以用刚才那条生成器表达式所形成的 it 迭代器作为输入，编写一条新的生成器表达式。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84876991751726000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`it = (len(x) for x in open(\'my_file.txt\'))\nroots = ((x, x ** 0.5) for x in it)\nprint(roots)`, `84876991751726000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">it <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'my_file.txt\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nroots <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x <span class="token operator">**</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> it<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>roots<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这条表达式所形成的 roots 迭代器每次推进时，会引发连锁反应：它也推进内部迭代器 it 以判断当前是否还能在 it 上面继续迭代，如果可以，就把 it 所返回的值代入 <code class="language-text">(x, x ** 0.5)</code> 里面求出结果。这种写法使用的内存同样不会太多。</p>\n<p>多个生成器嵌套而成的代码，执行起来还是相当快的。所以，如果要对数据量很大的输入流做一系列处理，那么生成器表达式应该是个很好的选择。唯一需要注意的是，生成器表达式返回的迭代器是有状态的，跑完一整轮之后，就不能继续使用了（参见第 31 条）。</p>\n<h3 id="总结-28"><a href="#%E6%80%BB%E7%BB%93-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>通过列表推导来处理大量的输入数据，可能会占用许多内存。</li>\n<li>改用生成器表达式来做，可以避免内存使用量过大的问题，因为这种表达式所形成的迭代器每次只会计算一项结果。</li>\n<li>生成器表达式所形成的迭代器可以当成 for 语句的子表达式出现在另一个生成器表达式里。</li>\n<li>把生成器表达式组合起来使用，能够写出执行速度快且占用内存少的代码。</li>\n</ol>\n<h2 id="第-33-条：通过-yield-from-把多个生成器连起来用"><a href="#%E7%AC%AC-33-%E6%9D%A1%EF%BC%9A%E9%80%9A%E8%BF%87-yield-from-%E6%8A%8A%E5%A4%9A%E4%B8%AA%E7%94%9F%E6%88%90%E5%99%A8%E8%BF%9E%E8%B5%B7%E6%9D%A5%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 33 条：通过 yield from 把多个生成器连起来用</h2>\n<p>生成器有很多好处（参见第 30 条），而且能够解决许多常见的问题（参见第 31 条）。生成器的用途特别广，所以许多程序都会频繁使用它们，而且是一个连着一个地用。</p>\n<p>例如，我们要编写一个图形程序，让它在屏幕上面移动图像，从而形成动画效果。假设要实现这样一段动画：图片先快速移动一段时间，然后暂停，接下来慢速移动一段时间。为了把移动与暂停表示出来，笔者定义了下面两个生成器函数，让它们分别给出图片在当前时间段内应该保持的速度。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20014214073620470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def move(period, speed):\n    for _ in range(period):\n        yield speed\n\n\ndef pause(delay):\n    for _ in range(delay):\n        yield 0`, `20014214073620470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>period<span class="token punctuation">,</span> speed<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>period<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> speed\n\n\n<span class="token keyword">def</span> <span class="token function">pause</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了把完整的动画制作出来，需要将 move 与 pause 连起来使用，从而算出这张图片当前的位置与上一个位置之差。下面的函数用三个 for 循环来表示动画的三个环节，在每一个环节里，它都通过 yield 把图片当前的位置与上一次的位置之差 delta 返回给调用者。根据 animate 函数返回的 delta 值，即可把整段动画做好。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42914594816136770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def animate():\n    for delta in move(4, 5.0):\n        yield delta\n    for delta in pause(3):\n        yield delta\n    for delta in move(2, 3.0):\n        yield delta`, `42914594816136770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> delta <span class="token keyword">in</span> move<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> delta\n    <span class="token keyword">for</span> delta <span class="token keyword">in</span> pause<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> delta\n    <span class="token keyword">for</span> delta <span class="token keyword">in</span> move<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> delta</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来，我们就根据 animate 生成器所给出的 delta 值，把整个动画效果渲染出来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18943773929525930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def render(delta):\n    print(f\'Delta: {delta:.1f}\')\n    # Move the images onscreen\n\n\ndef run(func):\n    for delta in func():\n        render(delta)\n\n\nrun(animate)\n\n>>>\nDelta: 5.0\nDelta: 5.0\nDelta: 5.0\nDelta: 5.0\nDelta: 0.0\nDelta: 0.0\nDelta: 0.0\nDelta: 3.0\nDelta: 3.0`, `18943773929525930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">render</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Delta: </span><span class="token interpolation"><span class="token punctuation">{</span>delta<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n    <span class="token comment"># Move the images onscreen</span>\n\n\n<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> delta <span class="token keyword">in</span> func<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        render<span class="token punctuation">(</span>delta<span class="token punctuation">)</span>\n\n\nrun<span class="token punctuation">(</span>animate<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">0.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">0.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">0.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">3.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">3.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种写法的问题在于，animate 函数里有很多重复的地方。比如它反复使用 for 结构来操纵生成器，而且每个 for 结构都使用相同的 yield 表达式，这样看上去很啰唆。这个例子仅仅连用了三个生成器，就让代码变得如此烦琐，若是动画里面有十几或几十个环节，那么代码读起来会更加困难。</p>\n<p>为了解决这个问题，我们可以改用 yield from 形式的表达式来实现。这种形式，会先从嵌套进去的小生成器里面取值，如果该生成器已经用完，那么程序的控制流程就会回到 yield from 所在的这个函数之中，然后它有可能进入下一套 yield from 逻辑。下面这段代码，用 yield from 语句重新实现了 animate 函数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98287953950196370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def animate_composed():\n    yield from move(4, 5.0)\n    yield from pause(3)\n    yield from move(2, 3.0)\n\nrun(animate_composed)\n\n>>>\nDelta: 5.0\nDelta: 5.0\nDelta: 5.0\nDelta: 5.0\nDelta: 0.0\nDelta: 0.0\nDelta: 0.0\nDelta: 3.0\nDelta: 3.0`, `98287953950196370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">animate_composed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> move<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> pause<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> move<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span>\n\nrun<span class="token punctuation">(</span>animate_composed<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">5.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">0.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">0.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">0.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">3.0</span>\nDelta<span class="token punctuation">:</span> <span class="token number">3.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它的运行结果与刚才一样，但是代码看上去更清晰、更直观了。Python 解释器看到 yield from 形式的表达式后，会自己想办法实现与带有普通 yield 语句的 for 循环相同的效果，而且这种实现方式要更快。下面采用内置的 timeit 模块编写并运行一个 micro-benchmark 试试。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6362024400158273000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import timeit\n\n\ndef child():\n    for i in range(1_000_000):\n        yield i\n\n\ndef slow():\n    for i in child():\n        yield i\n\n\ndef fast():\n    yield from child()\n\n\nbaseline = timeit.timeit(\n    stmt=\'for _ in slow(): pass\',\n    globals=globals(),\n    number=50)\nprint(f\'Manual nesting {baseline:.2f}s\')\ncomparison = timeit.timeit(\n    stmt=\'for _ in fast(): pass\',\n    globals=globals(),\n    number=50)\nprint(f\'Composed nesting {comparison:2f}s\')\nreduction = -(comparison - baseline)/baseline\nprint(f\'{reduction:.1%} less time\')\n\n>>>\nManual nesting 3.70s\nComposed nesting 3.319963s\n10.2% less time`, `6362024400158273000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> timeit\n\n\n<span class="token keyword">def</span> <span class="token function">child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>1_000_000<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> i\n\n\n<span class="token keyword">def</span> <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> child<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> i\n\n\n<span class="token keyword">def</span> <span class="token function">fast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> child<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n\nbaseline <span class="token operator">=</span> timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>\n    stmt<span class="token operator">=</span><span class="token string">\'for _ in slow(): pass\'</span><span class="token punctuation">,</span>\n    <span class="token builtin">globals</span><span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    number<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Manual nesting </span><span class="token interpolation"><span class="token punctuation">{</span>baseline<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">s\'</span></span><span class="token punctuation">)</span>\ncomparison <span class="token operator">=</span> timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>\n    stmt<span class="token operator">=</span><span class="token string">\'for _ in fast(): pass\'</span><span class="token punctuation">,</span>\n    <span class="token builtin">globals</span><span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    number<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Composed nesting </span><span class="token interpolation"><span class="token punctuation">{</span>comparison<span class="token punctuation">:</span><span class="token format-spec">2f</span><span class="token punctuation">}</span></span><span class="token string">s\'</span></span><span class="token punctuation">)</span>\nreduction <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>comparison <span class="token operator">-</span> baseline<span class="token punctuation">)</span><span class="token operator">/</span>baseline\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>reduction<span class="token punctuation">:</span><span class="token format-spec">.1%</span><span class="token punctuation">}</span></span><span class="token string"> less time\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nManual nesting <span class="token number">3.</span>70s\nComposed nesting <span class="token number">3.</span>319963s\n<span class="token number">10.2</span><span class="token operator">%</span> less time</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，如果要把多个生成器连起来用，那么笔者强烈建议优先考虑 yield from 表达式。</p>\n<h3 id="总结-29"><a href="#%E6%80%BB%E7%BB%93-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>如果要连续使用多个生成器，那么可以通过 yield from 表达式来分别使用这些生成器，这样做能够免去重复的 for 结构。</li>\n<li>yield from 的性能要胜过那种在 for 循环里手工编写 yield 表达式的方案。</li>\n</ol>\n<h2 id="第-34-条：不要用-send-给生成器注入数据"><a href="#%E7%AC%AC-34-%E6%9D%A1%EF%BC%9A%E4%B8%8D%E8%A6%81%E7%94%A8-send-%E7%BB%99%E7%94%9F%E6%88%90%E5%99%A8%E6%B3%A8%E5%85%A5%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 34 条：不要用 send 给生成器注入数据</h2>\n<p>yield 表达式让我们能够轻松地写出生成器函数，使得调用者可以每次只获取输出序列中的一项结果（参见第 30 条）。但问题是，这种通道是单向的，也就是说，无法让生成器在其一端接收数据流，同时在另一端给出计算结果。假如能实现双向通信，那么生成器的适用面会更广。</p>\n<p>例如，我们想用软件实现无线电广播，用它来发送信号。为了编写这个程序，我们必须用一个函数来模拟正弦波，让它能够给出一系列按照正弦方式分布的点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48179037981806470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import math\n\n\ndef wave(amplitude, steps):\n    step_size = 2 * math.pi / steps\n    for step in range(steps):\n        radians = step * step_size\n        fraction = math.sin(radians)\n        output = amplitude * fraction\n        yield output`, `48179037981806470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> math\n\n\n<span class="token keyword">def</span> <span class="token function">wave</span><span class="token punctuation">(</span>amplitude<span class="token punctuation">,</span> steps<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    step_size <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> steps\n    <span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        radians <span class="token operator">=</span> step <span class="token operator">*</span> step_size\n        fraction <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>radians<span class="token punctuation">)</span>\n        output <span class="token operator">=</span> amplitude <span class="token operator">*</span> fraction\n        <span class="token keyword">yield</span> output</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有了这个 wave 函数，我们可以让它按照某个固定的振幅生成一系列可供传输的值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22806050653361897000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def transmit(output):\n    if output is None:\n        print(f\'Output is None\')\n    else:\n        print(f\'Output: {output:>5.1f}\')\n\n\ndef run(it):\n    for output in it:\n        transmit(output)\n\n\nrun(wave(3.0, 8))\n\n>>>\nOutput:   0.0\nOutput:   2.1\nOutput:   3.0\nOutput:   2.1\nOutput:   0.0\nOutput:  -2.1\nOutput:  -3.0\nOutput:  -2.1`, `22806050653361897000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">transmit</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> output <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Output is None\'</span></span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Output: </span><span class="token interpolation"><span class="token punctuation">{</span>output<span class="token punctuation">:</span><span class="token format-spec">>5.1f</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> output <span class="token keyword">in</span> it<span class="token punctuation">:</span>\n        transmit<span class="token punctuation">(</span>output<span class="token punctuation">)</span>\n\n\nrun<span class="token punctuation">(</span>wave<span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">2.1</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">3.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">2.1</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">2.1</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">3.0</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">2.1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写可以生成基本的波形，但问题是，该函数在产生这些值的时候，只能按照刚开始给定的振幅来计算，而没办法使振幅在整个生成过程中根据某个因素发生变化（例如在发送调幅广播信号时，我们就需要这么做）。现在，我们要让生成器在计算每个值的时候，都能考虑到振幅的变化，从而实现调幅。</p>\n<p>Python 的生成器支持 send 方法，这可以让生成器变为双向通道。send 方法可以把参数发给生成器，让它成为上一条 yield 表达式的求值结果，并将生成器推进到下一条 yield 表达式，然后把 yield 右边的值返回给 send 方法的调用者。然而在一般情况下，我们还是会通过内置的 next 函数来推进生成器，按照这种写法，上一条 yield 表达式的求值结果总是 None。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27413194141085030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def my_generator():\n    received = yield 1\n    print(f\'received {received}\')\n\n\nit = iter(my_generator())\noutput = next(it)  # Get first generator output\nprint(f\'output = {output}\')\ntry:\n    next(it)  # Run generator until it exits\nexcept StopIteration:\n    pass\n\n>>>\noutput = 1\nreceived None`, `27413194141085030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">my_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    received <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'received </span><span class="token interpolation"><span class="token punctuation">{</span>received<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\nit <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>my_generator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\noutput <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>  <span class="token comment"># Get first generator output</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'output = </span><span class="token interpolation"><span class="token punctuation">{</span>output<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>  <span class="token comment"># Run generator until it exits</span>\n<span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\noutput <span class="token operator">=</span> <span class="token number">1</span>\nreceived <span class="token boolean">None</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果不通过 for 循环或内置的 next 函数推进生成器，而是改用 send 方法，那么调用方法时传入的参数就会成为上一条 yield 表达式的值，生成器拿到这个值后，会继续运行到下一条 yield 表达式那里。可是，刚开始推进生成器的时候，它是从头执行的，而不是从某一条 yield 表达式那里继续的，所以，首次调用 send 方法时，只能传 None，要是传入其他值，程序运行时就会抛出异常。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1714503417756807400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def my_generator():\n    received = yield 1\n    print(f\'received {received}\')\n\n\nit = iter(my_generator())\noutput = it.send(None)  # Get first generator output\nprint(f\'output {output}\')\ntry:\n    it.send(\'hello!\')  # Send value into the generator\nexcept StopIteration:\n    pass\n\n>>>\noutput 1\nreceived hello!`, `1714503417756807400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">my_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    received <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'received </span><span class="token interpolation"><span class="token punctuation">{</span>received<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\nit <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>my_generator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\noutput <span class="token operator">=</span> it<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># Get first generator output</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'output </span><span class="token interpolation"><span class="token punctuation">{</span>output<span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    it<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">\'hello!\'</span><span class="token punctuation">)</span>  <span class="token comment"># Send value into the generator</span>\n<span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\noutput <span class="token number">1</span>\nreceived hello!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以利用这种机制让调用者把振幅发送过来，这样函数就能根据这个输入值调整生成的正弦波幅值了。首先修改 wave 函数的代码，让它把 yield 表达式的求值结果（也就是调用者通过 send 发过来的振幅）保存到 amplitude 变量里，这样就能根据该变量计算出下次应该生成的值。</p>\n<p>然后，要修改 run 函数调用 <code class="language-text">wave_modulating</code> 函数的方式。它现在必须把每次所要使用的振幅发给 <code class="language-text">wave_modulating</code> 生成器。首次必须发送 None，因为此时生成器还没有遇到过 yield 表达式，它不需要知道上一条 yield 表达式的求值结果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49529782033050760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import math\n\n\ndef transmit(output):\n    if output is None:\n        print(f\'Output is None\')\n    else:\n        print(f\'Output: {output:>5.1f}\')\n\n\ndef wave_modulating(steps):\n    step_size = 2 * math.pi / steps\n    amplitude = yield  # Receive initial amplitude\n    for step in range(steps):\n        radians = step * step_size\n        fraction = math.sin(radians)\n        output = amplitude * fraction\n        amplitude = yield output  # Receive next amplitude\n\n\ndef run_modulating(it):\n    amplitudes = [None, 7, 7, 7, 2, 2, 2, 2, 10, 10, 10, 10, 10]\n    for amplitude in amplitudes:\n        output = it.send(amplitude)\n        transmit(output)\n\n\nrun_modulating(wave_modulating(12))\n\n>>>\nOutput is None\nOutput:   0.0\nOutput:   3.5\nOutput:   6.1\nOutput:   2.0\nOutput:   1.7\nOutput:   1.0\nOutput:   0.0\nOutput:  -5.0\nOutput:  -8.7\nOutput: -10.0\nOutput:  -8.7\nOutput:  -5.0`, `49529782033050760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> math\n\n\n<span class="token keyword">def</span> <span class="token function">transmit</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> output <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Output is None\'</span></span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Output: </span><span class="token interpolation"><span class="token punctuation">{</span>output<span class="token punctuation">:</span><span class="token format-spec">>5.1f</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">wave_modulating</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    step_size <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> steps\n    amplitude <span class="token operator">=</span> <span class="token keyword">yield</span>  <span class="token comment"># Receive initial amplitude</span>\n    <span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        radians <span class="token operator">=</span> step <span class="token operator">*</span> step_size\n        fraction <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>radians<span class="token punctuation">)</span>\n        output <span class="token operator">=</span> amplitude <span class="token operator">*</span> fraction\n        amplitude <span class="token operator">=</span> <span class="token keyword">yield</span> output  <span class="token comment"># Receive next amplitude</span>\n\n\n<span class="token keyword">def</span> <span class="token function">run_modulating</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    amplitudes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> amplitude <span class="token keyword">in</span> amplitudes<span class="token punctuation">:</span>\n        output <span class="token operator">=</span> it<span class="token punctuation">.</span>send<span class="token punctuation">(</span>amplitude<span class="token punctuation">)</span>\n        transmit<span class="token punctuation">(</span>output<span class="token punctuation">)</span>\n\n\nrun_modulating<span class="token punctuation">(</span>wave_modulating<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nOutput <span class="token keyword">is</span> <span class="token boolean">None</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">3.5</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">6.1</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">2.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">1.7</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">1.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">5.0</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">8.7</span>\nOutput<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10.0</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">8.7</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">5.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写没问题，程序可以按照每次输入的值调整输出信号的振幅。首次输出的肯定是 None，因为此时 <code class="language-text">wave_modulating</code> 函数并不知道 amplitude 是多少，它只有在运行第一条 yield 表达式后，才能把调用者通过 send 发来的值保存到这个变量里。</p>\n<p>这种写法有个缺点，就是它很难让初次阅读这段代码的人立刻理解它的意思。把 yield 放在赋值语句的右侧，本身就不太直观，因为我们必须先了解生成器的这项高级特性，才能明白 yield 与 send 是如何相互配合的。</p>\n<p>现在假设程序的需求变得更复杂了。这次要生成的载波不是简单的正弦波，而是由多个信号序列构成的复合波形（complex waveform）。要实现这个需求，可以连用几条 yield from 语句，把多个生成器串接起来（参见第 33 条）。下面先验证一下，这种写法能否处理振幅固定的简单情况。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55347620382411325000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def complex_wave():\n    yield from wave(7.0, 3)\n    yield from wave(2.0, 4)\n    yield from wave(10.0, 5)\n\n\nrun(complex_wave())\n\n>>>\nOutput:   0.0\nOutput:   6.1\nOutput:  -6.1\nOutput:   0.0\nOutput:   2.0\nOutput:   0.0\nOutput:  -2.0\nOutput:   0.0\nOutput:   9.5\nOutput:   5.9\nOutput:  -5.9\nOutput:  -9.5`, `55347620382411325000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">complex_wave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave<span class="token punctuation">(</span><span class="token number">7.0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave<span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>\n\n\nrun<span class="token punctuation">(</span>complex_wave<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">6.1</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">6.1</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">2.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">2.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">9.5</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">5.9</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">5.9</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">9.5</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，利用 yield from 表达式确实可以处理比较简单的情况。那既然这样，我们再试试看，它能否处理那种采用 send 方法写成的函数。下面就用这种写法，接连多次调用 <code class="language-text">wave_modulating</code> 生成器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14081831607511908000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def complex_wave_modulating():\n    yield from wave_modulating(3)\n    yield from wave_modulating(4)\n    yield from wave_modulating(5)\n\n\nrun_modulating(complex_wave_modulating())\n\n>>>\nOutput is None\nOutput:   0.0\nOutput:   6.1\nOutput:  -6.1\nOutput is None\nOutput:   0.0\nOutput:   2.0\nOutput:   0.0\nOutput: -10.0\nOutput is None\nOutput:   0.0\nOutput:   9.5\nOutput:   5.9`, `14081831607511908000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">complex_wave_modulating</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave_modulating<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave_modulating<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave_modulating<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>\n\n\nrun_modulating<span class="token punctuation">(</span>complex_wave_modulating<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nOutput <span class="token keyword">is</span> <span class="token boolean">None</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">6.1</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">6.1</span>\nOutput <span class="token keyword">is</span> <span class="token boolean">None</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">2.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10.0</span>\nOutput <span class="token keyword">is</span> <span class="token boolean">None</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">9.5</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">5.9</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写在大方向上是对的，但问题在于：程序竟然输出了那么多 None！这是为什么呢？因为每条 yield from 表达式其实都在遍历一个嵌套进去的生成器，所以每个嵌套生成器都必须分别执行它们各自的第一条 yield 语句（也就是什么值都不带的那条 yield 语句），只有执行过这条语句之后，这些生成器才能通过 send 方法所传来的值决定这条语句的求值结果，并把这个结果放在 amplitude 变量里以计算下一次应该输出的值。所以，<code class="language-text">complex_wave_modulating</code> 函数处理完前一个嵌套的生成器之后，会进入下一个嵌套的生成器，而这时就必须先把该生成器的第一条 yield 语句运行过去，这就导致后面两个嵌套生成器会各自从 amplitudes 列表里浪费掉一个，并使得每个嵌套生成器所拿到的第一个结果必定是 None，还会让最后那个嵌套生成器少执行两次。</p>\n<p>这意味着，虽然 yield from 语句与 send 方法单独用着都没问题，然而结合使用的效果却不太让人满意。当然也可以在 <code class="language-text">run_modulating</code> 函数里添加一些代码，使得计算波形的步调与 amplitudes 列表提供振幅值的步调相一致，但这只能使程序越写越复杂，因为利用 send 方法写成的 <code class="language-text">wave_modulating</code> 函数本身已经不太直观了，而我们又把这个生成器函数通过 yield from 语句套到了 <code class="language-text">complex_wave_modulating</code> 里面，这理解起来就更加困难了。所以，笔者建议彻底抛开 send 方法，改用更简单的方案来做。</p>\n<p>最简单的一种写法，是把迭代器传给 wave 函数，让 wave 每次用到振幅的时候，通过 Python 内置的 next 函数推进这个迭代器并返回一个输入振幅。于是，这就促使多个生成器之间，产生连环反应（其他类似案例参见第 32 条）。</p>\n<p>这样，我们只需要把同一个迭代器分别传给这几条 yield from 语句里的 <code class="language-text">wave_cascading</code> 就行。迭代器是有状态的（参见第 31 条），所以下一个 <code class="language-text">wave_cascading</code> 会从上一个 <code class="language-text">wave_cascading</code> 使用完的地方，继续往下使用 <code class="language-text">amplitude_it</code> 迭代器。</p>\n<p>要想触发这个组合的生成器，只需要把振幅值放在列表中，并把针对列表制作的迭代器传给 <code class="language-text">complex_wave_cascading</code> 就好。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75242339379158450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import math\n\n\ndef transmit(output):\n    if output is None:\n        print(f\'Output is None\')\n    else:\n        print(f\'Output: {output:>5.1f}\')\n\n\ndef wave_cascading(amplitude_it, steps):\n    step_size = 2 * math.pi / steps\n    for step in range(steps):\n        radians = step * step_size\n        fraction = math.sin(radians)\n        amplitude = next(amplitude_it)  # Get next input\n        output = amplitude * fraction\n        yield output\n\n\ndef complex_wave_cascading(amplitude_it):\n    yield from wave_cascading(amplitude_it, 3)\n    yield from wave_cascading(amplitude_it, 4)\n    yield from wave_cascading(amplitude_it, 5)\n\n\ndef run_cascading():\n    amplitudes = [7, 7, 7, 2, 2, 2, 2, 10, 10, 10, 10, 10]\n    it = complex_wave_cascading(iter(amplitudes))\n    for amplitude in amplitudes:\n        output = next(it)\n        transmit(output)\n\n\nrun_cascading()\n\n>>>\nOutput:   0.0\nOutput:   6.1\nOutput:  -6.1\nOutput:   0.0\nOutput:   2.0\nOutput:   0.0\nOutput:  -2.0\nOutput:   0.0\nOutput:   9.5\nOutput:   5.9\nOutput:  -5.9\nOutput:  -9.5`, `75242339379158450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> math\n\n\n<span class="token keyword">def</span> <span class="token function">transmit</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> output <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Output is None\'</span></span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Output: </span><span class="token interpolation"><span class="token punctuation">{</span>output<span class="token punctuation">:</span><span class="token format-spec">>5.1f</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">wave_cascading</span><span class="token punctuation">(</span>amplitude_it<span class="token punctuation">,</span> steps<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    step_size <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> steps\n    <span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        radians <span class="token operator">=</span> step <span class="token operator">*</span> step_size\n        fraction <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>radians<span class="token punctuation">)</span>\n        amplitude <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>amplitude_it<span class="token punctuation">)</span>  <span class="token comment"># Get next input</span>\n        output <span class="token operator">=</span> amplitude <span class="token operator">*</span> fraction\n        <span class="token keyword">yield</span> output\n\n\n<span class="token keyword">def</span> <span class="token function">complex_wave_cascading</span><span class="token punctuation">(</span>amplitude_it<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave_cascading<span class="token punctuation">(</span>amplitude_it<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave_cascading<span class="token punctuation">(</span>amplitude_it<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> wave_cascading<span class="token punctuation">(</span>amplitude_it<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">run_cascading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    amplitudes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\n    it <span class="token operator">=</span> complex_wave_cascading<span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>amplitudes<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> amplitude <span class="token keyword">in</span> amplitudes<span class="token punctuation">:</span>\n        output <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n        transmit<span class="token punctuation">(</span>output<span class="token punctuation">)</span>\n\n\nrun_cascading<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">6.1</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">6.1</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">2.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">2.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">0.0</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">9.5</span>\nOutput<span class="token punctuation">:</span>   <span class="token number">5.9</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">5.9</span>\nOutput<span class="token punctuation">:</span>  <span class="token operator">-</span><span class="token number">9.5</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种写法最大的优点在于，迭代器可以来自任何地方，而且完全可以是动态的（例如可以用生成器函数来实现迭代器）。此方案只有一个缺陷，就是必须假设负责输入的生成器绝对能保证线程安全，但有时其实保证不了这一点。如果代码要跨越线程边界，那么用 async 函数实现可能更好（参见第 62 条）。</p>\n<h3 id="总结-30"><a href="#%E6%80%BB%E7%BB%93-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>send 方法可以把数据注入生成器，让它成为上一条 yield 表达式的求值结果，生成器可以把这个结果赋给变量。</li>\n<li>把 send 方法与 yield from 表达式搭配起来使用，可能导致奇怪的结果，例如会让程序在本该输出有效值的地方输出 None。</li>\n<li>通过迭代器向组合起来的生成器输入数据，要比采用 send 方法的那种方案好，所以尽量避免使用 send 方法。</li>\n</ol>\n<h2 id="第-35-条：不要通过-throw-变换生成器的状态"><a href="#%E7%AC%AC-35-%E6%9D%A1%EF%BC%9A%E4%B8%8D%E8%A6%81%E9%80%9A%E8%BF%87-throw-%E5%8F%98%E6%8D%A2%E7%94%9F%E6%88%90%E5%99%A8%E7%9A%84%E7%8A%B6%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 35 条：不要通过 throw 变换生成器的状态</h2>\n<p>除 yield from 表达式（参见第 33 条）与 send 方法（参见第 34 条）外，生成器还有一项高级功能，就是可以把调用者通过 throw 方法传来的 Exception 实例重新抛出。这个 throw 方法用起来很简单：如果调用了这个方法，那么生成器下次推进时，就不会像平常那样，直接走到下一条 yield 表达式那里，而是会把通过 throw 方法传入的异常重新抛出。下面用代码演示这种效果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99513061009126050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyError(Exception):\n    pass\n\n\ndef my_generator():\n    yield 1\n    yield 2\n    yield 3\n\n\nit = my_generator()\nprint(next(it))  # Yield 1\nprint(next(it))  # Yield 2\nprint(it.throw(MyError(\'test error\')))\n\n>>>\n1\n2\nTraceback ...\n__main__.MyError: test error`, `99513061009126050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">my_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token number">1</span>\n    <span class="token keyword">yield</span> <span class="token number">2</span>\n    <span class="token keyword">yield</span> <span class="token number">3</span>\n\n\nit <span class="token operator">=</span> my_generator<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Yield 1</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Yield 2</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>throw<span class="token punctuation">(</span>MyError<span class="token punctuation">(</span><span class="token string">\'test error\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span>\n<span class="token number">2</span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n__main__<span class="token punctuation">.</span>MyError<span class="token punctuation">:</span> test error</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>生成器函数可以用标准的 try/except 复合语句把 yield 表达式包裹起来，如果函数上次执行到了这条表达式这里，而这次即将继续执行时，又发现外界通过 throw 方法给自己注入了异常，那么这个异常就会被 try 结构捕获下来，如果捕获之后不继续抛异常，那么生成器函数会推进到下一条 yield 表达式（更多异常处理，参见第 65 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38676176583147500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyError(Exception):\n    pass\n\n\ndef my_generator():\n    yield 1\n    try:\n        yield 2\n    except MyError:\n        print(\'Got MyError!\')\n    else:\n        yield 3\n    yield 4\n\n\nit = my_generator()\nprint(next(it))  # Yield 1\nprint(next(it))  # Yield 2\nprint(it.throw(MyError(\'test error\')))\n\n>>>\n1\n2\nGot MyError!\n4`, `38676176583147500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">my_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token number">1</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> <span class="token number">2</span>\n    <span class="token keyword">except</span> MyError<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Got MyError!\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> <span class="token number">3</span>\n    <span class="token keyword">yield</span> <span class="token number">4</span>\n\n\nit <span class="token operator">=</span> my_generator<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Yield 1</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Yield 2</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>throw<span class="token punctuation">(</span>MyError<span class="token punctuation">(</span><span class="token string">\'test error\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">1</span>\n<span class="token number">2</span>\nGot MyError!\n<span class="token number">4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这项机制会在生成器与调用者之间形成双向通信通道（另一种双向通信通道，参见第 34 条），这在某些情况下是有用的。例如，要编写一个偶尔可以重置的计时器程序。笔者定义下面的 Reset 异常与 timer 生成器方法，让调用者可以在 timer 给出的迭代器上通过 throw 方法注入 Reset 异常，令计时器重置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32549037963964998000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Reset(Exception):\n    pass\n\n\ndef timer(period):\n    current = period\n    while current:\n        current -= 1\n        try:\n            yield current\n        except Reset:\n            current = period`, `32549037963964998000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Reset</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>period<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    current <span class="token operator">=</span> period\n    <span class="token keyword">while</span> current<span class="token punctuation">:</span>\n        current <span class="token operator">-=</span> <span class="token number">1</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> current\n        <span class="token keyword">except</span> Reset<span class="token punctuation">:</span>\n            current <span class="token operator">=</span> period</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>按照这种写法，如果 timer 正准备从 yield 表达式往下推进时，发现有人注入了 Reset 异常，那么它就会把这个异常捕获下来，并进入 except 分支，在这里它会把表示倒计时的 current 变量重新调整成最初的 period 值。</p>\n<p>这个计时器可以与外界某个按秒轮询的输入机制对接起来。为此，笔者定义一个 run 函数以驱动 timer 生成器所给出的那个 it 迭代器，并根据外界的情况做处理，如果外界要求重置，那就通过 it 迭代器的 throw 方法给计时器注入 Reset 变量，如果外界没有这样要求，那就调用 announce 函数打印生成器所给的倒计时值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38187951837245170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Reset(Exception):\n    pass\n\n\ndef timer(period):\n    current = period\n    while current:\n        current -= 1\n        try:\n            yield current\n        except Reset:\n            current = period\n\n\ndef check_for_reset():\n    # Poll for external event\n    # ...\n    pass\n\n\ndef announce(remaining):\n    print(f\'{remaining} ticks remaining\')\n\n\ndef run():\n    it = timer(4)\n    while True:\n        try:\n            if check_for_reset():\n                current = it.throw(Reset())\n            else:\n                current = next(it)\n        except StopIteration:\n            break\n        else:\n            announce(current)\n\n\nrun()\n\n>>>\n3 ticks remaining\n2 ticks remaining\n1 ticks remaining\n0 ticks remaining`, `38187951837245170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Reset</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>period<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    current <span class="token operator">=</span> period\n    <span class="token keyword">while</span> current<span class="token punctuation">:</span>\n        current <span class="token operator">-=</span> <span class="token number">1</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> current\n        <span class="token keyword">except</span> Reset<span class="token punctuation">:</span>\n            current <span class="token operator">=</span> period\n\n\n<span class="token keyword">def</span> <span class="token function">check_for_reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># Poll for external event</span>\n    <span class="token comment"># ...</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">announce</span><span class="token punctuation">(</span>remaining<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>remaining<span class="token punctuation">}</span></span><span class="token string"> ticks remaining\'</span></span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    it <span class="token operator">=</span> timer<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token keyword">if</span> check_for_reset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n                current <span class="token operator">=</span> it<span class="token punctuation">.</span>throw<span class="token punctuation">(</span>Reset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token keyword">else</span><span class="token punctuation">:</span>\n                current <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n        <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>\n            <span class="token keyword">break</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            announce<span class="token punctuation">(</span>current<span class="token punctuation">)</span>\n\n\nrun<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">3</span> ticks remaining\n<span class="token number">2</span> ticks remaining\n<span class="token number">1</span> ticks remaining\n<span class="token number">0</span> ticks remaining</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写没错，但是有点儿难懂，因为用了许多层嵌套结构。我们要判断 <code class="language-text">check_for_reset</code> 函数的返回值，以确定是应该通过 it.throw 注入 Reset 异常，还是应该通过 next 推进迭代器。如果是要推进迭代器，那么还得捕获 StopIteration 异常：若是捕获到了这种异常，那说明迭代器已经走到终点，则要执行 break 跳出 while 循环；若没捕获到，则需要调用 announce 函数打印倒计时值。这会让代码变得很乱。</p>\n<p>有个简单的办法，能够改写这段代码，那就是用可迭代的容器对象（参见第 31 条）定义一个有状态的闭包（参见第 38 条）。下面的代码就写了这样一个 Timer 类，并通过它重新实现刚才的 timer 生成器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26256445426701070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Timer:\n    def __init__(self, period):\n        self.current = period\n        self.period = period\n\n    def reset(self):\n        self.current = self.period\n\n    def __iter__(self):\n        while self.current:\n            self.current -= 1\n            yield self.current`, `26256445426701070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Timer</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> period<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>current <span class="token operator">=</span> period\n        self<span class="token punctuation">.</span>period <span class="token operator">=</span> period\n\n    <span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>current <span class="token operator">=</span> self<span class="token punctuation">.</span>period\n\n    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">while</span> self<span class="token punctuation">.</span>current<span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>current <span class="token operator">-=</span> <span class="token number">1</span>\n            <span class="token keyword">yield</span> self<span class="token punctuation">.</span>current</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，run 函数就好写多了，因为它只需要用 for 循环迭代这个 timer 即可。这样写出来的代码，不像刚才那样有那么多层嵌套，所以读起来很容易懂。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49615924146045100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Reset(Exception):\n    pass\n\n\ndef check_for_reset():\n    # Poll for external event\n    # ...\n    pass\n\n\ndef announce(remaining):\n    print(f\'{remaining} ticks remaining\')\n\n\nclass Timer:\n    def __init__(self, period):\n        self.current = period\n        self.period = period\n\n    def reset(self):\n        self.current = self.period\n\n    def __iter__(self):\n        while self.current:\n            self.current -= 1\n            yield self.current\n\n\ndef run():\n    timer = Timer(4)\n    for current in timer:\n        if check_for_reset():\n            timer.reset()\n        announce(current)\n\n\nrun()\n\n>>>\n3 ticks remaining\n2 ticks remaining\n1 ticks remaining\n0 ticks remaining`, `49615924146045100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{29-37}"\n              >\n                <span class="gatsby-code-button-language">py{29-37}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Reset</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">check_for_reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># Poll for external event</span>\n    <span class="token comment"># ...</span>\n    <span class="token keyword">pass</span>\n\n\n<span class="token keyword">def</span> <span class="token function">announce</span><span class="token punctuation">(</span>remaining<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>remaining<span class="token punctuation">}</span></span><span class="token string"> ticks remaining\'</span></span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">Timer</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> period<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>current <span class="token operator">=</span> period\n        self<span class="token punctuation">.</span>period <span class="token operator">=</span> period\n\n    <span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>current <span class="token operator">=</span> self<span class="token punctuation">.</span>period\n\n    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">while</span> self<span class="token punctuation">.</span>current<span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>current <span class="token operator">-=</span> <span class="token number">1</span>\n            <span class="token keyword">yield</span> self<span class="token punctuation">.</span>current\n\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    timer <span class="token operator">=</span> Timer<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">for</span> current <span class="token keyword">in</span> timer<span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">if</span> check_for_reset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            timer<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        announce<span class="token punctuation">(</span>current<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">run<span class="token punctuation">(</span><span class="token punctuation">)</span></span>\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">3</span> ticks remaining\n<span class="token number">2</span> ticks remaining\n<span class="token number">1</span> ticks remaining\n<span class="token number">0</span> ticks remaining</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写所输出的结果与前面一样，但是这种实现方案理解起来要容易得多，即便是初次阅读这段代码的人也很容易就能读懂。凡是想用生成器与异常来实现的功能，通常都可以改用异步机制去做（参见第 60 条），那样会更好。如果确实遇到了这里讲到的这种需求，那么应该通过可迭代的类来实现生成器，而不要用 throw 方法注入异常。</p>\n<h3 id="总结-31"><a href="#%E6%80%BB%E7%BB%93-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>throw 方法可以把异常发送到生成器刚执行过的那条 yield 表达式那里，让这个异常在生成器下次推进时重新抛出。</li>\n<li>通过 throw 方法注入异常，会让代码变得难懂，因为需要用多层嵌套的模板结构来抛出并捕获这种异常。</li>\n<li>如果确实遇到了这样的特殊情况，那么应该通过类的 <code class="language-text">__iter__</code> 方法实现生成器，并且专门提供一个方法，让调用者通过这个方法来触发这种特殊的状态变换逻辑。</li>\n</ol>\n<h2 id="第-36-条：考虑用-itertools-拼装迭代器与生成器"><a href="#%E7%AC%AC-36-%E6%9D%A1%EF%BC%9A%E8%80%83%E8%99%91%E7%94%A8-itertools-%E6%8B%BC%E8%A3%85%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 36 条：考虑用 itertools 拼装迭代器与生成器</h2>\n<p>Python 内置的 itertools 模块里有很多函数，可以用来安排迭代器之间的交互关系（相关的基础知识，参见第 30 条与第 31 条）。</p>\n<p>如果要实现比较难写的迭代逻辑，那么应该先查看 itertools 的文档（在 Python 解释器界面输入 help(itertools)），说不定里面就有你能用到的函数。下面分三大类，列出其中最重要的函数。</p>\n<h3 id="连接多个迭代器"><a href="#%E8%BF%9E%E6%8E%A5%E5%A4%9A%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>连接多个迭代器</h3>\n<p>内置的 itertools 模块有一些函数可以把多个迭代器连成一个使用。</p>\n<h4 id="chain"><a href="#chain" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>chain</h4>\n<p>chain 可以把多个迭代器从头到尾连成一个迭代器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84962468409485930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nit = itertools.chain([1, 2, 3], [4, 5, 6])\nprint(list(it))\n\n>>>\n[1, 2, 3, 4, 5, 6]`, `84962468409485930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="repeat"><a href="#repeat" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>repeat</h4>\n<p>repeat 可以制作这样一个迭代器，它会不停地输出某个值。调用 repeat 时，也可以通过第二个参数指定迭代器最多能输出几次。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97649963203255090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nit = itertools.repeat(\'hello\', 3)\nprint(list(it))\n\n>>>\n[\'hello\', \'hello\', \'hello\']`, `97649963203255090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token string">\'hello\'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token string">\'hello\'</span><span class="token punctuation">,</span> <span class="token string">\'hello\'</span><span class="token punctuation">,</span> <span class="token string">\'hello\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="cycle"><a href="#cycle" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cycle</h4>\n<p>cycle 可以制作这样一个迭代器，它会循环地输出某段内容之中的各项元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22498379155223613000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nit = itertools.cycle([1, 2])\nresult = [next(it) for _ in range(10)]\nprint(result)\n\n>>>\n[1, 2, 1, 2, 1, 2, 1, 2, 1, 2]`, `22498379155223613000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>cycle<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\nresult <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="tee"><a href="#tee" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>tee</h4>\n<p>tee 可以让一个迭代器分裂成多个平行的迭代器，具体个数由第二个参数指定。如果这些迭代器推进的速度不一致，那么程序可能要用大量内存做缓冲，以存放进度落后的迭代器将来会用到的元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53181556254656280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nit1, it2, it3 = itertools.tee([\'first\', \'second\'], 3)\nprint(list(it1))\nprint(list(it2))\nprint(list(it3))\n\n>>>\n[\'first\', \'second\']\n[\'first\', \'second\']\n[\'first\', \'second\']`, `53181556254656280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nit1<span class="token punctuation">,</span> it2<span class="token punctuation">,</span> it3 <span class="token operator">=</span> itertools<span class="token punctuation">.</span>tee<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'first\'</span><span class="token punctuation">,</span> <span class="token string">\'second\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it1<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it2<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it3<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token string">\'first\'</span><span class="token punctuation">,</span> <span class="token string">\'second\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'first\'</span><span class="token punctuation">,</span> <span class="token string">\'second\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'first\'</span><span class="token punctuation">,</span> <span class="token string">\'second\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="zip_longest"><a href="#zip_longest" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>zip_longest</h4>\n<p>它与 Python 内置的 zip 函数类似（参见第 8 条），但区别在于，如果源迭代器的长度不同，那么它会用 fillvalue 参数的值来填补提前耗尽的那些迭代器所留下的空缺。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8309081848893940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nkeys = [\'one\', \'two\', \'three\']\nvalues = [1, 2]\n\nnormal = list(zip(keys, values))\nprint(\'zip:        \', normal)\n\nit = itertools.zip_longest(keys, values, fillvalue=\'nope\')\nlongest = list(it)\nprint(\'zip_longest:\', longest)\n\n>>>\nzip:         [(\'one\', 1), (\'two\', 2)]\nzip_longest: [(\'one\', 1), (\'two\', 2), (\'three\', \'nope\')]`, `8309081848893940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nkeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'one\'</span><span class="token punctuation">,</span> <span class="token string">\'two\'</span><span class="token punctuation">,</span> <span class="token string">\'three\'</span><span class="token punctuation">]</span>\nvalues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n\nnormal <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'zip:        \'</span><span class="token punctuation">,</span> normal<span class="token punctuation">)</span>\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>zip_longest<span class="token punctuation">(</span>keys<span class="token punctuation">,</span> values<span class="token punctuation">,</span> fillvalue<span class="token operator">=</span><span class="token string">\'nope\'</span><span class="token punctuation">)</span>\nlongest <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'zip_longest:\'</span><span class="token punctuation">,</span> longest<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token builtin">zip</span><span class="token punctuation">:</span>         <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'one\'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'two\'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\nzip_longest<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'one\'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'two\'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'three\'</span><span class="token punctuation">,</span> <span class="token string">\'nope\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="过滤源迭代器中的元素"><a href="#%E8%BF%87%E6%BB%A4%E6%BA%90%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>过滤源迭代器中的元素</h3>\n<p>Python 内置的 itertools 模块里有一些函数可以过滤源迭代器中的元素。</p>\n<h4 id="islice"><a href="#islice" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>islice</h4>\n<p>islice 可以在不拷贝数据的前提下，按照下标切割源迭代器。可以只给出切割的终点，也可以同时给出起点与终点，还可以指定步进值。这种切割方式与标准的序列切片及步进机制类似（参见第 11 条与第 12 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40661836979551840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nvalues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nfirst_five = itertools.islice(values, 5)\nprint(\'First five: \', list(first_five))\nmiddle_odds = itertools.islice(values, 2, 8, 2)\nprint(\'Middle odds:\', list(middle_odds))\n\n>>>\nFirst five:  [1, 2, 3, 4, 5]\nMiddle odds: [3, 5, 7]`, `40661836979551840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nvalues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\nfirst_five <span class="token operator">=</span> itertools<span class="token punctuation">.</span>islice<span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'First five: \'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>first_five<span class="token punctuation">)</span><span class="token punctuation">)</span>\nmiddle_odds <span class="token operator">=</span> itertools<span class="token punctuation">.</span>islice<span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Middle odds:\'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>middle_odds<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFirst five<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>\nMiddle odds<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="takewhile"><a href="#takewhile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>takewhile</h4>\n<p>takewhile 会一直从源迭代器里获取元素，直到某元素让测试函数返回 False 为止。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24945030344300245000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nvalues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n\n\ndef less_than_seven(x):\n    return x < 7\n\n\nit = itertools.takewhile(less_than_seven, values)\nprint(list(it))\n\n>>>\n[1, 2, 3, 4, 5, 6]`, `24945030344300245000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nvalues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\n\n\n<span class="token keyword">def</span> <span class="token function">less_than_seven</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> x <span class="token operator">&lt;</span> <span class="token number">7</span>\n\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>takewhile<span class="token punctuation">(</span>less_than_seven<span class="token punctuation">,</span> values<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="dropwhile"><a href="#dropwhile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dropwhile</h4>\n<p>与 takewhile 相反，dropwhile 会一直跳过源序列里的元素，直到某元素让测试函数返回 True 为止，然后它会从这个地方开始逐个取值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25501752900315046000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nvalues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n\n\ndef less_than_seven(x):\n    return x < 7\n\n\nit = itertools.dropwhile(less_than_seven, values)\nprint(list(it))\n\n>>>\n[7, 8, 9, 10]`, `25501752900315046000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nvalues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\n\n\n<span class="token keyword">def</span> <span class="token function">less_than_seven</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> x <span class="token operator">&lt;</span> <span class="token number">7</span>\n\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>dropwhile<span class="token punctuation">(</span>less_than_seven<span class="token punctuation">,</span> values<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="filterfalse"><a href="#filterfalse" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>filterfalse</h4>\n<p>filterfalse 和内置的 filter 函数相反，它会逐个输出源迭代器里使得测试函数返回 False 的那些元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79426559430244880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nvalues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n\n\ndef evens(x):\n    return x % 2 == 0\n\n\nfilter_result = filter(evens, values)\nprint(\'Filter:      \', list(filter_result))\nfilter_false_result = itertools.filterfalse(evens, values)\nprint(\'Filter false:\', list(filter_false_result))\n\n>>>\nFilter:       [2, 4, 6, 8, 10]\nFilter false: [1, 3, 5, 7, 9]`, `79426559430244880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nvalues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\n\n\n<span class="token keyword">def</span> <span class="token function">evens</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span>\n\n\nfilter_result <span class="token operator">=</span> <span class="token builtin">filter</span><span class="token punctuation">(</span>evens<span class="token punctuation">,</span> values<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Filter:      \'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>filter_result<span class="token punctuation">)</span><span class="token punctuation">)</span>\nfilter_false_result <span class="token operator">=</span> itertools<span class="token punctuation">.</span>filterfalse<span class="token punctuation">(</span>evens<span class="token punctuation">,</span> values<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Filter false:\'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>filter_false_result<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nFilter<span class="token punctuation">:</span>       <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\nFilter false<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="用源迭代器中的元素合成新元素"><a href="#%E7%94%A8%E6%BA%90%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0%E5%90%88%E6%88%90%E6%96%B0%E5%85%83%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用源迭代器中的元素合成新元素</h3>\n<p>Python 内置的 itertools 模块里，有一些函数可以根据源迭代器中的元素合成新的元素。</p>\n<h4 id="accumulate"><a href="#accumulate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>accumulate</h4>\n<p>accumulate 会从源迭代器里取出一个元素，并把已经累计的结果与这个元素一起传给表示累加逻辑的函数，然后输出那个函数的计算结果，并把结果当成新的累计值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38154531730289885000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nvalues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nsum_reduce = itertools.accumulate(values)\nprint(\'Sum:   \', list(sum_reduce))\n\n\ndef sum_modulo_20(first, second):\n    output = first + second\n    return output % 20\n\n\nmodulo_reduce = itertools.accumulate(values, sum_modulo_20)\nprint(\'Modulo:\', list(modulo_reduce))\n\n>>>\nSum:    [1, 3, 6, 10, 15, 21, 28, 36, 45, 55]\nModulo: [1, 3, 6, 10, 15, 1, 8, 16, 5, 15]`, `38154531730289885000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nvalues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\nsum_reduce <span class="token operator">=</span> itertools<span class="token punctuation">.</span>accumulate<span class="token punctuation">(</span>values<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Sum:   \'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>sum_reduce<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">sum_modulo_20</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    output <span class="token operator">=</span> first <span class="token operator">+</span> second\n    <span class="token keyword">return</span> output <span class="token operator">%</span> <span class="token number">20</span>\n\n\nmodulo_reduce <span class="token operator">=</span> itertools<span class="token punctuation">.</span>accumulate<span class="token punctuation">(</span>values<span class="token punctuation">,</span> sum_modulo_20<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Modulo:\'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>modulo_reduce<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nSum<span class="token punctuation">:</span>    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">]</span>\nModulo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这与内置的 functools 模块中 reduce 函数，实际上是一样的，只不过这个函数每次只给出一项累计值。如果调用者没有指定表示累加逻辑的双参数函数（binary function），那么默认的逻辑就是两值相加。</p>\n<h4 id="product"><a href="#product" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>product</h4>\n<p>product 会从一个或多个源迭代器里获取元素，并计算笛卡尔积（Cartesian product），它可以取代那种多层嵌套的列表推导代码（参见第 28 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8626884241133892000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nsingle = itertools.product([1, 2], repeat=2)\nprint(\'Single:  \', list(single))\n\nmultiple = itertools.product([1, 2], [\'a\', \'b\'])\nprint(\'Multiple:\', list(multiple))\n\n>>>\nSingle:   [(1, 1), (1, 2), (2, 1), (2, 2)]\nMultiple: [(1, \'a\'), (1, \'b\'), (2, \'a\'), (2, \'b\')]`, `8626884241133892000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nsingle <span class="token operator">=</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Single:  \'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>single<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\nmultiple <span class="token operator">=</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Multiple:\'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>multiple<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nSingle<span class="token punctuation">:</span>   <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\nMultiple<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="permutations"><a href="#permutations" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>permutations</h4>\n<p>permutations 会考虑源迭代器所能给出的全部元素，并逐个输出由其中 N 个元素形成的每种有序排列（permutation）方式，元素相同但顺序不同，算作两种排列。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49135181784895000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nit = itertools.permutations([1, 2, 3, 4], 2)\nprint(list(it))\n\n>>>\n[(1, 2), (1, 3), (1, 4), (2, 1), (2, 3), (2, 4), (3, 1), (3, 2), (3, 4), (4, 1), (4, 2), (4, 3)]`, `49135181784895000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>permutations<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="combinations"><a href="#combinations" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>combinations</h4>\n<p>combinations 会考虑源迭代器所能给出的全部元素，并逐个输出由其中 N 个元素形成的每种无序组合（combination）方式，元素相同但顺序不同，算作同一种组合。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75755210556647750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nit = itertools.combinations([1, 2, 3, 4], 2)\nprint(list(it))\n\n>>>\n[(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (3, 4)]`, `75755210556647750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>combinations<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="combinations_with_replacement"><a href="#combinations_with_replacement" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">combinations_with_replacement</code></h4>\n<p><code class="language-text">combinations_with_replacement</code> 与 combinations 类似，但它允许同一个元素在组合里多次出现。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49869516528141620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import itertools\n\nit = itertools.combinations_with_replacement([1, 2, 3, 4], 2)\nprint(list(it))\n\n>>>\n[(1, 1), (1, 2), (1, 3), (1, 4), (2, 2), (2, 3), (2, 4), (3, 3), (3, 4), (4, 4)]`, `49869516528141620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> itertools\n\nit <span class="token operator">=</span> itertools<span class="token punctuation">.</span>combinations_with_replacement<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-32"><a href="#%E6%80%BB%E7%BB%93-32" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>itertools 包里面有三套函数可以拼装迭代器与生成器，它们分别能够连接多个迭代器，过滤源迭代器中的元素，以及用源迭代器中的元素合成新元素。</li>\n<li>通过 help(itertools) 查看文档，了解这些函数所支持的其他参数，以及许多更为高级的函数和实用的代码范例。</li>\n</ol>\n<h1 id="类与接口"><a href="#%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类与接口</h1>\n<h2 id="第-37-条：用组合起来的类来实现多层结构，不要用嵌套的内置类型"><a href="#%E7%AC%AC-37-%E6%9D%A1%EF%BC%9A%E7%94%A8%E7%BB%84%E5%90%88%E8%B5%B7%E6%9D%A5%E7%9A%84%E7%B1%BB%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%A4%9A%E5%B1%82%E7%BB%93%E6%9E%84%EF%BC%8C%E4%B8%8D%E8%A6%81%E7%94%A8%E5%B5%8C%E5%A5%97%E7%9A%84%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 37 条：用组合起来的类来实现多层结构，不要用嵌套的内置类型</h2>\n<p>Python 内置的字典类型，很适合维护对象在生命期内的动态内部状态。所谓动态的（dynamic），是指我们无法获知那套状态会用到哪些标识符。例如，如果要用成绩册（Gradebook）记录学生的分数，而我们又没办法提前确定这些学生的名字，那么受到记录的每位学生与各自的分数，对于 Gradebook 对象来说，就属于动态的内部状态。为了实现这个需求，笔者定义下面这样一个类，让它把学生的名字当作键保存到 <code class="language-text">_grades</code> 字典中，因为我们无法提前确定要记录哪些学生，所以不能将每位学生的名字都设置成这个类的一项属性。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76906335164353790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class SimpleGradebook:\n\n    def __init__(self):\n        self._grades = {}\n\n    def add_student(self, name):\n        self._grades[name] = []\n\n    def report_grade(self, name, score):\n        self._grades[name].append(score)\n\n    def average_grade(self, name):\n        grades = self._grades[name]\n        return sum(grades) / len(grades)\n\n\nbook = SimpleGradebook()\nbook.add_student(\'Isaac Newton\')\nbook.report_grade(\'Isaac Newton\', 90)\nbook.report_grade(\'Isaac Newton\', 95)\nbook.report_grade(\'Isaac Newton\', 85)\n\nprint(book.average_grade(\'Isaac Newton\'))\n\n>>>\n90.0`, `76906335164353790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">SimpleGradebook</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n    <span class="token keyword">def</span> <span class="token function">add_student</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n\n    <span class="token keyword">def</span> <span class="token function">report_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>score<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">average_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        grades <span class="token operator">=</span> self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span>\n        <span class="token keyword">return</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>grades<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>grades<span class="token punctuation">)</span>\n\n\nbook <span class="token operator">=</span> SimpleGradebook<span class="token punctuation">(</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>add_student<span class="token punctuation">(</span><span class="token string">\'Isaac Newton\'</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Isaac Newton\'</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Isaac Newton\'</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Isaac Newton\'</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>average_grade<span class="token punctuation">(</span><span class="token string">\'Isaac Newton\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">90.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>字典与相关的内置类型用起来很方便，但同时也容易遭到滥用导致代码出问题。例如，我们现在要扩展这个 SimpleGradebook 类的功能，让它按照科目保存成绩，而不是把所有科目的成绩存在一起。通过修改 <code class="language-text">_grades</code> 字典的用法，使它必须把键（也就是学生的名字）与另一个小字典相对应，而不是像刚才那样，直接与列表对应起来。那份小字典以各科的名称作键与一份列表对应起来，以保存学生在这一科的全部考试成绩。这次笔者用 defaultdict 来实现这个小字典，这样可以方便地处理科目名称还不存在的那些情况（参见第 17 条）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28996253105981130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\nclass BySubjectGradebook:\n    def __init__(self):\n        self._grades = {}  # Outer dict\n\n    def add_student(self, name):\n        self._grades[name] = defaultdict(list)  # Inner dict`, `28996253105981130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">class</span> <span class="token class-name">BySubjectGradebook</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># Outer dict</span>\n\n    <span class="token keyword">def</span> <span class="token function">add_student</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>  <span class="token comment"># Inner dict</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>程序写到现在，还算比较直观。但是接下来，我们要编写 <code class="language-text">report_grade</code> 方法来记录某位学生在某科目上的一次成绩，并且要写 <code class="language-text">average_grade</code> 方法计算某位学生所有科目的平均成绩。这两个方法写起来就稍微有点复杂了，因为必须处理多层嵌套的字典结构，不过，这似乎还在可以把握的范围内。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44377864200815845000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\nclass BySubjectGradebook:\n    def __init__(self):\n        self._grades = {}  # Outer dict\n\n    def add_student(self, name):\n        self._grades[name] = defaultdict(list)  # Inner dict\n\n    def report_grade(self, name, subject, grade):\n        by_subject = self._grades[name]\n        grade_list = by_subject[subject]\n        grade_list.append(grade)\n\n    def average_grade(self, name):\n        by_subject = self._grades[name]\n        total, count = 0, 0\n        for grades in by_subject.values():\n            total += sum(grades)\n            count += len(grades)\n        return total / count`, `44377864200815845000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{11-22}"\n              >\n                <span class="gatsby-code-button-language">py{11-22}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">class</span> <span class="token class-name">BySubjectGradebook</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># Outer dict</span>\n\n    <span class="token keyword">def</span> <span class="token function">add_student</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>  <span class="token comment"># Inner dict</span>\n\n<span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">report_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        by_subject <span class="token operator">=</span> self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">        grade_list <span class="token operator">=</span> by_subject<span class="token punctuation">[</span>subject<span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">        grade_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>grade<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">average_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        by_subject <span class="token operator">=</span> self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">        total<span class="token punctuation">,</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">for</span> grades <span class="token keyword">in</span> by_subject<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            total <span class="token operator">+=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>grades<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">            count <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>grades<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> total <span class="token operator">/</span> count</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>扩展后的类，用起来依然比较容易。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11314918442261135000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`book = BySubjectGradebook()\nbook.add_student(\'Albert Einstein\')\nbook.report_grade(\'Albert Einstein\', \'Math\', 75)\nbook.report_grade(\'Albert Einstein\', \'Math\', 65)\nbook.report_grade(\'Albert Einstein\', \'Gym\', 90)\nbook.report_grade(\'Albert Einstein\', \'Gym\', 95)\nprint(book.average_grade(\'Albert Einstein\'))\n\n>>>\n81.25`, `11314918442261135000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">book <span class="token operator">=</span> BySubjectGradebook<span class="token punctuation">(</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>add_student<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Math\'</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Math\'</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Gym\'</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Gym\'</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>average_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">81.25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在假设需求又变了，我们还要记录每次考试在科目里的权重（weight），因为期中考试与期末考试及随堂举行的临时考试（pop quiz）在总成绩里占的比例是不同的。实现这项功能的一种办法是改变里面那个小字典的用法，让它不要把成绩（score）直接添加到与键名（也就科目名称）相对应的那份列表里，而是先用成绩与权重构造元组，然后把（score, weight）形式的元组添加到列表里。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85989121254593790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\nclass WeightedGradebook:\n    def __init__(self):\n        self._grades = {}\n\n    def add_student(self, name):\n        self._grades[name] = defaultdict(list)\n\n    def report_grade(self, name, subject, score, weight):\n        by_subject = self._grades[name]\n        grade_list = by_subject[subject]\n        grade_list.append((score, weight))`, `85989121254593790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">class</span> <span class="token class-name">WeightedGradebook</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n    <span class="token keyword">def</span> <span class="token function">add_student</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">report_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> score<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        by_subject <span class="token operator">=</span> self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span>\n        grade_list <span class="token operator">=</span> by_subject<span class="token punctuation">[</span>subject<span class="token punctuation">]</span>\n        grade_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">report_grade</code> 方法改起来似乎挺简单的，只需要把原来的成绩变为带权重的元组保存到列表里面即可。但是 <code class="language-text">average_grade</code> 方法就比较难懂了，因为我们必须在循环里面再嵌套一个循环。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41043497227392840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\nclass WeightedGradebook:\n    def __init__(self):\n        self._grades = {}\n\n    def add_student(self, name):\n        self._grades[name] = defaultdict(list)\n\n    def report_grade(self, name, subject, score, weight):\n        by_subject = self._grades[name]\n        grade_list = by_subject[subject]\n        grade_list.append((score, weight))\n\n    def average_grade(self, name):\n        by_subject = self._grades[name]\n        score_sum, score_count = 0, 0\n        for subject, scores in by_subject.items():\n            subject_avg, total_weight = 0, 0\n            for score, weight in scores:\n                subject_avg += score * weight\n                total_weight += weight\n\n            score_sum += subject_avg / total_weight\n            score_count += 1\n        return score_sum / score_count\n\n\nbook = WeightedGradebook()\nbook.add_student(\'Albert Einstein\')\nbook.report_grade(\'Albert Einstein\', \'Math\', 75, 0.05)\nbook.report_grade(\'Albert Einstein\', \'Math\', 65, 0.15)\nbook.report_grade(\'Albert Einstein\', \'Math\', 70, 0.80)\nbook.report_grade(\'Albert Einstein\', \'Gym\', 100, 0.40)\nbook.report_grade(\'Albert Einstein\', \'Gym\', 85, 0.60)\nprint(book.average_grade(\'Albert Einstein\'))\n\n>>>\n80.25`, `41043497227392840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">class</span> <span class="token class-name">WeightedGradebook</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n    <span class="token keyword">def</span> <span class="token function">add_student</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">report_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> score<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        by_subject <span class="token operator">=</span> self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span>\n        grade_list <span class="token operator">=</span> by_subject<span class="token punctuation">[</span>subject<span class="token punctuation">]</span>\n        grade_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">average_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        by_subject <span class="token operator">=</span> self<span class="token punctuation">.</span>_grades<span class="token punctuation">[</span>name<span class="token punctuation">]</span>\n        score_sum<span class="token punctuation">,</span> score_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>\n        <span class="token keyword">for</span> subject<span class="token punctuation">,</span> scores <span class="token keyword">in</span> by_subject<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            subject_avg<span class="token punctuation">,</span> total_weight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>\n            <span class="token keyword">for</span> score<span class="token punctuation">,</span> weight <span class="token keyword">in</span> scores<span class="token punctuation">:</span>\n                subject_avg <span class="token operator">+=</span> score <span class="token operator">*</span> weight\n                total_weight <span class="token operator">+=</span> weight\n\n            score_sum <span class="token operator">+=</span> subject_avg <span class="token operator">/</span> total_weight\n            score_count <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> score_sum <span class="token operator">/</span> score_count\n\n\nbook <span class="token operator">=</span> WeightedGradebook<span class="token punctuation">(</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>add_student<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Math\'</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Math\'</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Math\'</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">0.80</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Gym\'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0.40</span><span class="token punctuation">)</span>\nbook<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">,</span> <span class="token string">\'Gym\'</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">0.60</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>average_grade<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">80.25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个类用起来也变得困难了，因为单看代码很难知道 <code class="language-text">report_grade</code> 里面那些数字形式的位置参数表示什么意思。</p>\n<p>如果遇到的是类似这种比较复杂的需求，那么不要再嵌套字典、元组、集合、列表等内置的类型了，而是应该编写一批新类并让这些类形成一套体系。</p>\n<p>拿这个成绩册的例子来说，一开始我们并不知道后来要考虑成绩权重，所以那个时候似乎没有必要专门创建这样一套类体系。后来，当要纳入权重因素时，有人认为，这可以继续通过 Python 内置的字典与元组来实现，因为只不过是要给保存内部状态的那个结构多添加一层而已。所以，才有了刚才那种复杂的写法。其实，在需要分科目统计成绩时，就不应该继续嵌套下去了，那样会让字典里出现小字典，而小字典里又会出现列表。这种超过两层的嵌套结构，其他开发者很难看懂，而且后面维护起来也很麻烦。</p>\n<p>只要发现记录内部状态的代码开始变得复杂起来，就应该及时把这些代码拆分到多个类里。这样可以定义良好的接口，并且能够合理地封装数据。这种写法可以在接口与具体实现之间创建一层抽象。</p>\n<h3 id="把多层嵌套的内置类型重构为类体系"><a href="#%E6%8A%8A%E5%A4%9A%E5%B1%82%E5%B5%8C%E5%A5%97%E7%9A%84%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B%E9%87%8D%E6%9E%84%E4%B8%BA%E7%B1%BB%E4%BD%93%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>把多层嵌套的内置类型重构为类体系</h3>\n<p>有很多种办法可以实现重构（除了这里讲的这种，第 89 条还讲了另一种）。笔者这里采用的办法是，先从依赖树的最底层做起，也就是考虑怎么记录某科目的单次考试成绩与权重。这么简单的一条信息，似乎没必要专门写一个类来记录。由于分数不需要修改，因此元组已经足够用了。下面以（score, weight）形式的元组来记录单次考试成绩，并把这种元素添加到列表里面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99996280754408590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`grades = []\ngrades.append((95, 0.45))\ngrades.append((85, 0.55))\ntotal = sum(score * weight for score, weight in grades)\ntotal_weight = sum(weight for _, weight in grades)\naverage_grade = total / total_weight`, `99996280754408590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">grades <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\ngrades<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">0.45</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ngrades<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">0.55</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ntotal <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>score <span class="token operator">*</span> weight <span class="token keyword">for</span> score<span class="token punctuation">,</span> weight <span class="token keyword">in</span> grades<span class="token punctuation">)</span>\ntotal_weight <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>weight <span class="token keyword">for</span> _<span class="token punctuation">,</span> weight <span class="token keyword">in</span> grades<span class="token punctuation">)</span>\naverage_grade <span class="token operator">=</span> total <span class="token operator">/</span> total_weight</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>汇总每次考试的权重之和（<code class="language-text">total * weight</code>）时，不需要关注具体的成绩，所以在 <code class="language-text">for ... in ...</code> 结构中用下划线（<code class="language-text">*</code>）表示元组中的 score 那一部分，表示计算时忽略它。</p>\n<p>这种写法的问题在于，元组里的元素只能通过位置区分。例如，如果还要把老师的评语记在每次考试的成绩旁边，那么早前使用二元组的那些代码就全都需要修改，因为现在必须采用包含三个元素的元组才行。另外，统计成绩之和与权重之和时，还得分别用一个下划线跳过每个三元组里面表示评语的那一部分。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46999109903919310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`grades = []\ngrades.append((95, 0.45, \'Great job\'))\ngrades.append((85, 0.55, \'Better next time\'))\ntotal = sum(score * weight for score, weight, _ in grades)\ntotal_weight = sum(weight for _, weight, _ in grades)\naverage_grade = total / total_weight`, `46999109903919310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">grades <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\ngrades<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token string">\'Great job\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ngrades<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">0.55</span><span class="token punctuation">,</span> <span class="token string">\'Better next time\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ntotal <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>score <span class="token operator">*</span> weight <span class="token keyword">for</span> score<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> _ <span class="token keyword">in</span> grades<span class="token punctuation">)</span>\ntotal_weight <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>weight <span class="token keyword">for</span> _<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> _ <span class="token keyword">in</span> grades<span class="token punctuation">)</span>\naverage_grade <span class="token operator">=</span> total <span class="token operator">/</span> total_weight</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>元组拖得太长，就跟字典套得太深一样，都不好维护。所以只要发现元组里的元素超过两个，就应该考虑其他办法了。</p>\n<p>Python 内置的 collections 模块里有个具名元组（namedtuple）类型，恰好可以满足这样的需求，这种类型很容易就能定义出小型的类以表示不可变的数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76305255977690890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import namedtuple\n\nGrade = namedtuple(\'Grade\', (\'score\', \'weight\'))`, `76305255977690890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple\n\nGrade <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">\'Grade\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'score\'</span><span class="token punctuation">,</span> <span class="token string">\'weight\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这样的类，既可以通过位置参数构造，也可以用关键字参数来创建。每个属性都有名字，因此可以根据属性名称访问字段，如果将来需求发生变化（例如需要修改数据，或是要转变成一个简单的数据容器），也很容易就能把这种 namedtuple 改写成普通的类。</p>\n<h3 id="namedtuple-的局限"><a href="#namedtuple-%E7%9A%84%E5%B1%80%E9%99%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>namedtuple 的局限</h3>\n<p>虽然 namedtuple 可以用于许多场合，但我们一定要知道在哪些情况下不适合用它。</p>\n<ol>\n<li>namedtuple 类无法指定默认的参数值。如果数据的可选属性比较多，那么采用这种类来表示，会很不方便。在属性较多的情况下，应该改用内置的 dataclasses 模块实现。</li>\n<li>namedtuple 实例的属性值仍然可以通过数字下标与迭代来访问，所以可能还是会有人（尤其是那些通过你发布的 API 来编程的人）会采用这种方式访问这些属性，这样的话，将来就不太容易把它转成普通的类了。如果无法完全控制这些 namedtuple 实例的用法，那么最好还是明确定义一个新的类。</li>\n</ol>\n<p>有了叫作 Grade 的具名元组，我们就可以写出表示科目的 Subject 类，让它容纳许多个这样的元组。</p>\n<p>然后，就可以写一个表示学生的 Student 类，用它来记录某位学生各科目（Subject）的考试成绩。</p>\n<p>最后，写这样一个表示成绩册的 Gradebook 容器类，把每位学生的名字与表示这位学生的 Student 对象关联起来，如果成绩册里还没有记录过这位学生，那么在调用 <code class="language-text">get_student</code> 方法时，Gradebook 就会构造一个默认的 Student 对象给调用者使用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30573725674260490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import namedtuple, defaultdict\n\nGrade = namedtuple(\'Grade\', (\'score\', \'weight\'))\n\n\nclass Subject:\n    def __init__(self):\n        self._grades = []\n\n    def report_grade(self, score, weight):\n        self._grades.append(Grade(score, weight))\n\n    def average_grade(self):\n        total, total_weight = 0, 0\n        for grade in self._grades:\n            total += grade.score * grade.weight\n            total_weight += grade.weight\n        return total / total_weight\n\n\nclass Student:\n    def __init__(self):\n        self._subjects = defaultdict(Subject)\n\n    def get_subject(self, name):\n        return self._subjects[name]\n\n    def average_grade(self):\n        total, count = 0, 0\n        for subject in self._subjects.values():\n            total += subject.average_grade()\n            count += 1\n        return total / count\n\n\nclass Gradebook:\n    def __init__(self):\n        self._students = defaultdict(Student)\n\n    def get_student(self, name):\n        return self._students[name]\n\n\nbook = Gradebook()\nalbert = book.get_student(\'Albert Einstein\')\nmath = albert.get_subject(\'Math\')\nmath.report_grade(75, 0.05)\nmath.report_grade(65, 0.15)\nmath.report_grade(70, 0.80)\ngym = albert.get_subject(\'Gym\')\ngym.report_grade(100, 0.40)\ngym.report_grade(85, 0.60)\nprint(albert.average_grade())\n\n>>>\n80.25`, `30573725674260490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple<span class="token punctuation">,</span> defaultdict\n\nGrade <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">\'Grade\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'score\'</span><span class="token punctuation">,</span> <span class="token string">\'weight\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">Subject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n\n    <span class="token keyword">def</span> <span class="token function">report_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> score<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_grades<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Grade<span class="token punctuation">(</span>score<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">average_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        total<span class="token punctuation">,</span> total_weight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>\n        <span class="token keyword">for</span> grade <span class="token keyword">in</span> self<span class="token punctuation">.</span>_grades<span class="token punctuation">:</span>\n            total <span class="token operator">+=</span> grade<span class="token punctuation">.</span>score <span class="token operator">*</span> grade<span class="token punctuation">.</span>weight\n            total_weight <span class="token operator">+=</span> grade<span class="token punctuation">.</span>weight\n        <span class="token keyword">return</span> total <span class="token operator">/</span> total_weight\n\n\n<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_subjects <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>Subject<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_subject</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_subjects<span class="token punctuation">[</span>name<span class="token punctuation">]</span>\n\n    <span class="token keyword">def</span> <span class="token function">average_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        total<span class="token punctuation">,</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>\n        <span class="token keyword">for</span> subject <span class="token keyword">in</span> self<span class="token punctuation">.</span>_subjects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            total <span class="token operator">+=</span> subject<span class="token punctuation">.</span>average_grade<span class="token punctuation">(</span><span class="token punctuation">)</span>\n            count <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> total <span class="token operator">/</span> count\n\n\n<span class="token keyword">class</span> <span class="token class-name">Gradebook</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_students <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>Student<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_student</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_students<span class="token punctuation">[</span>name<span class="token punctuation">]</span>\n\n\nbook <span class="token operator">=</span> Gradebook<span class="token punctuation">(</span><span class="token punctuation">)</span>\nalbert <span class="token operator">=</span> book<span class="token punctuation">.</span>get_student<span class="token punctuation">(</span><span class="token string">\'Albert Einstein\'</span><span class="token punctuation">)</span>\nmath <span class="token operator">=</span> albert<span class="token punctuation">.</span>get_subject<span class="token punctuation">(</span><span class="token string">\'Math\'</span><span class="token punctuation">)</span>\nmath<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">)</span>\nmath<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">)</span>\nmath<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">0.80</span><span class="token punctuation">)</span>\ngym <span class="token operator">=</span> albert<span class="token punctuation">.</span>get_subject<span class="token punctuation">(</span><span class="token string">\'Gym\'</span><span class="token punctuation">)</span>\ngym<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0.40</span><span class="token punctuation">)</span>\ngym<span class="token punctuation">.</span>report_grade<span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">0.60</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>albert<span class="token punctuation">.</span>average_grade<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token number">80.25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这些类的代码所占篇幅，虽然比原来那种写法长了一倍，但理解起来却要容易得多。而且用这些类写出来的调用代码，也比原来更清晰、更便于扩展。</p>\n<p>另外，还可以提供一些向后兼容的方法，帮助大家把采用旧式 API 所写的代码迁移到这种通过对象体系所设计的方案之中。</p>\n<h3 id="总结-33"><a href="#%E6%80%BB%E7%BB%93-33" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>不要在字典里嵌套字典、长元组，以及用其他内置类型构造的复杂结构。</li>\n<li>namedtuple 能够实现出轻量级的容器，以存放不可变的数据，而且将来可以灵活地转化成普通的类。</li>\n<li>如果发现用字典来维护内部状态的那些代码已经越写越复杂了，那么就应该考虑改用多个类来实现。</li>\n</ol>\n<h2 id="第-38-条：让简单的接口接受函数，而不是类的实例"><a href="#%E7%AC%AC-38-%E6%9D%A1%EF%BC%9A%E8%AE%A9%E7%AE%80%E5%8D%95%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%8F%97%E5%87%BD%E6%95%B0%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 38 条：让简单的接口接受函数，而不是类的实例</h2>\n<p>Python 有许多内置的 API，都允许我们传入某个函数来定制它的行为。这种函数可以叫作挂钩（hook），API 在执行过程中，会回调（call back）这些挂钩函数。例如，list 类型的 sort 方法就带有可选的 key 参数，如果明确指定了这个参数，那么它就会按照你提供的挂钩函数来决定列表中每个元素的先后顺序（参见第 14 条）。下面的代码把内置的 len 函数当成挂钩传给 key 参数，让 sort 方法根据长度排列这些名字。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59246424674501940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`names = [\'Socrates\', \'Archimedes\', \'Plato\', \'Aristotle\']\nnames.sort(key=len)\nprint(names)\n\n>>>\n[\'Plato\', \'Socrates\', \'Aristotle\', \'Archimedes\']`, `59246424674501940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Socrates\'</span><span class="token punctuation">,</span> <span class="token string">\'Archimedes\'</span><span class="token punctuation">,</span> <span class="token string">\'Plato\'</span><span class="token punctuation">,</span> <span class="token string">\'Aristotle\'</span><span class="token punctuation">]</span>\nnames<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">[</span><span class="token string">\'Plato\'</span><span class="token punctuation">,</span> <span class="token string">\'Socrates\'</span><span class="token punctuation">,</span> <span class="token string">\'Aristotle\'</span><span class="token punctuation">,</span> <span class="token string">\'Archimedes\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在其他编程语言中，挂钩可能会用抽象类（abstract class）来定义。但在 Python 中，许多挂钩都是无状态的函数（stateless function），带有明确的参数与返回值。挂钩用函数来描述，要比定义成类更简单。用作挂钩的函数与别的函数一样，都是 Python 里的头等（first-class）对象，也就是说，这些函数与方法可以像 Python 中其他值那样传递与引用。</p>\n<p>例如，我们要定制 defaultdict 类的行为（相关的知识，参见第 17 条）。这种 defaultdict 数据结构允许调用者提供一个函数，用来在键名缺失的情况下，创建与这个键相对应的值。只要字典发现调用者想要访问的键不存在，就会触发这个函数，以返回应该与键相关联的默认值。下面定义一个 <code class="language-text">log_missing</code> 函数作为键名缺失时的挂钩，该函数总是会把这种键的默认值设为 0。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20441911375460696000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def log_missing():\n    print(\'Key added\')\n    return 0`, `20441911375460696000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">log_missing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Key added\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>下面这段代码通过定制的 defaultdict 字典，把 increments 列表里面描述的增量添加到 current 这个普通字典所提供的初始量上面，但字典里一开始没有 red 和 orange 这两个键，因此 <code class="language-text">log_missing</code> 这个挂钩函数会触发两次，每次它都会打印 Key added 信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87268939588277880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\ndef log_missing():\n    print(\'Key added\')\n    return 0\n\n\ncurrent = {\'green\': 12, \'blue\': 3}\nincrements = [\n    (\'red\', 5),\n    (\'blue\', 17),\n    (\'orange\', 9),\n]\nresult = defaultdict(log_missing, current)\nprint(\'Before:\', dict(result))\nfor key, amount in increments:\n    result[key] += amount\nprint(\'After:\', dict(result))\n\n>>>\nBefore: {\'green\': 12, \'blue\': 3}\nKey added\nKey added\nAfter: {\'green\': 12, \'blue\': 20, \'red\': 5, \'orange\': 9}`, `87268939588277880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">def</span> <span class="token function">log_missing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Key added\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token number">0</span>\n\n\ncurrent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'green\'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\nincrements <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'orange\'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\nresult <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>log_missing<span class="token punctuation">,</span> current<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Before:\'</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">for</span> key<span class="token punctuation">,</span> amount <span class="token keyword">in</span> increments<span class="token punctuation">:</span>\n    result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> amount\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After:\'</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nBefore<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'green\'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\nKey added\nKey added\nAfter<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'green\'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">\'red\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">\'orange\'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通过 <code class="language-text">log_missing</code> 这样的挂钩函数，我们很容易构建出便于测试的 API，这种 API 可以把挂钩所实现的附加效果（side effect）与数据本身所应具备的确定行为分开。例如，假设我们要在传给 defaultdict 的挂钩里面，统计它总共遇到了多少次键名缺失的情况。要实现这项功能，其中一个办法是采用有状态的闭包（stateful closure，参见第 21 条）。下面就定义一个辅助函数，把 missing 闭包当作挂钩传给 defaultdict 字典，以便为缺失的键提供默认值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38219425518663926000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def increment_with_report(current, increments):\n    added_count = 0\n\n    def missing():\n        nonlocal added_count  # Stateful closure\n        added_count += 1\n        return 0\n\n    result = defaultdict(missing, current)\n    for key, amount in increments:\n        result[key] += amount\n\n    return result, added_count`, `38219425518663926000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">increment_with_report</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> increments<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    added_count <span class="token operator">=</span> <span class="token number">0</span>\n\n    <span class="token keyword">def</span> <span class="token function">missing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">nonlocal</span> added_count  <span class="token comment"># Stateful closure</span>\n        added_count <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> <span class="token number">0</span>\n\n    result <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>missing<span class="token punctuation">,</span> current<span class="token punctuation">)</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> amount <span class="token keyword">in</span> increments<span class="token punctuation">:</span>\n        result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> amount\n\n    <span class="token keyword">return</span> result<span class="token punctuation">,</span> added_count</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行这个辅助函数处理前面的数据，可以得到预期的结果（可以看到，键名缺失的情况确实出现了两次，函数返回的 count 值也为 2）。统计键名缺失次数所用的 <code class="language-text">added_count</code> 状态是由 missing 挂钩维护的，采用挂钩来运作的 defaultdict 字典并不需要关注这个细节。于是，这就体现了把简单函数传给接口的另一个好处，也就是方便稍后添加新的功能，因为我们可以把实现这项功能所用的状态隐藏在这个简单的闭包里面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50015306775880245000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\ndef increment_with_report(current, increments):\n    added_count = 0\n\n    def missing():\n        nonlocal added_count  # Stateful closure\n        added_count += 1\n        return 0\n\n    result = defaultdict(missing, current)\n    for key, amount in increments:\n        result[key] += amount\n\n    return result, added_count\n\n\ncurrent = {\'green\': 12, \'blue\': 3}\nincrements = [\n    (\'red\', 5),\n    (\'blue\', 17),\n    (\'orange\', 9),\n]\nresult, count = increment_with_report(current, increments)\nassert count == 2`, `50015306775880245000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{25-26}"\n              >\n                <span class="gatsby-code-button-language">py{25-26}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">def</span> <span class="token function">increment_with_report</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> increments<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    added_count <span class="token operator">=</span> <span class="token number">0</span>\n\n    <span class="token keyword">def</span> <span class="token function">missing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">nonlocal</span> added_count  <span class="token comment"># Stateful closure</span>\n        added_count <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> <span class="token number">0</span>\n\n    result <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>missing<span class="token punctuation">,</span> current<span class="token punctuation">)</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> amount <span class="token keyword">in</span> increments<span class="token punctuation">:</span>\n        result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> amount\n\n    <span class="token keyword">return</span> result<span class="token punctuation">,</span> added_count\n\n\ncurrent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'green\'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\nincrements <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'orange\'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n<span class="gatsby-highlight-code-line">result<span class="token punctuation">,</span> count <span class="token operator">=</span> increment_with_report<span class="token punctuation">(</span>current<span class="token punctuation">,</span> increments<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">assert</span> count <span class="token operator">==</span> <span class="token number">2</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>与无状态的闭包函数相比，用有状态的闭包作为挂钩写出来的代码会难懂一些。为了让代码更清晰，可以专门定义一个小类，把原本由闭包所维护的状态给封装起来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30360088571824816000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class CountMissing:\n    def __init__(self):\n        self.added = 0\n\n    def missing(self):\n        self.added += 1\n        return 0`, `30360088571824816000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">CountMissing</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">=</span> <span class="token number">0</span>\n\n    <span class="token keyword">def</span> <span class="token function">missing</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在其他编程语言中，可能需要修改 defaultdict 以便与 CountMissing 接口相适应。但在 Python 中，方法与函数都是头等的（first-class）对象，因此可以直接通过对象引用它所属的 CountMissing 类里的 missing 方法，并把这个方法传给 defaultdict 充当挂钩，让字典可以用这个挂钩制作默认值。在 Python 中，这种通过对象实例而引用的方法，很容易就能满足函数的接口</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16900001517839059000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\nclass CountMissing:\n    def __init__(self):\n        self.added = 0\n\n    def missing(self):\n        self.added += 1\n        return 0\n\n\ncurrent = {\'green\': 12, \'blue\': 3}\nincrements = [\n    (\'red\', 5),\n    (\'blue\', 17),\n    (\'orange\', 9),\n]\ncounter = CountMissing()\nresult = defaultdict(counter.missing, current)  # Method ref\nfor key, amount in increments:\n    result[key] += amount\nassert counter.added == 2`, `16900001517839059000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{19-23}"\n              >\n                <span class="gatsby-code-button-language">py{19-23}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">class</span> <span class="token class-name">CountMissing</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">=</span> <span class="token number">0</span>\n\n    <span class="token keyword">def</span> <span class="token function">missing</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> <span class="token number">0</span>\n\n\ncurrent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'green\'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\nincrements <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'orange\'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n<span class="gatsby-highlight-code-line">counter <span class="token operator">=</span> CountMissing<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">result <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>counter<span class="token punctuation">.</span>missing<span class="token punctuation">,</span> current<span class="token punctuation">)</span>  <span class="token comment"># Method ref</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">for</span> key<span class="token punctuation">,</span> amount <span class="token keyword">in</span> increments<span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> amount</span><span class="gatsby-highlight-code-line"><span class="token keyword">assert</span> counter<span class="token punctuation">.</span>added <span class="token operator">==</span> <span class="token number">2</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>把有状态的闭包所具备的行为，改用辅助类来实现，要比前面的 <code class="language-text">increment_with_report</code> 函数更清晰。但如果单看这个类，可能没办法立刻了解它的意图。CountMissing 对象应该由谁构造？missing 方法应该由谁调用？这个类将来还会不会再增加 public 方法？这些疑惑都必须在看到 defaultdict 的用法之后才能解开。</p>\n<p>为了让这个类的意义更加明确，可以给它定义名为 <code class="language-text">__call__</code> 的特殊方法。这会让这个类的对象能够像函数那样得到调用。同时，也让内置的 callable 函数能够针对这种实例返回 True 值，用以表示这个实例与普通的函数或方法类似，都是可调用的。凡是能够像这样（在后面加一对括号来）执行的对象，都叫作 callable。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30072098244802458000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class BetterCountMissing:\n    def __init__(self):\n        self.added = 0\n\n    def __call__(self):\n        self.added += 1\n        return 0\n\n\ncounter = BetterCountMissing()\nassert counter() == 0\nassert callable(counter)`, `30072098244802458000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">BetterCountMissing</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">=</span> <span class="token number">0</span>\n\n    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> <span class="token number">0</span>\n\n\ncounter <span class="token operator">=</span> BetterCountMissing<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> counter<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>\n<span class="token keyword">assert</span> <span class="token builtin">callable</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面，就用这样的 BetterCountMissing 实例给 defaultdict 当挂钩，让它在字典里没有键名时，创建默认的键值，并把这种情况记入键名缺失的总次数里。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71462412227970120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections import defaultdict\n\n\nclass BetterCountMissing:\n    def __init__(self):\n        self.added = 0\n\n    def __call__(self):\n        self.added += 1\n        return 0\n\n\ncurrent = {\'green\': 12, \'blue\': 3}\nincrements = [\n    (\'red\', 5),\n    (\'blue\', 17),\n    (\'orange\', 9),\n]\ncounter = BetterCountMissing()\nresult = defaultdict(counter, current)\nfor key, amount in increments:\n    result[key] += amount\nassert counter.added == 2`, `71462412227970120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{19-23}"\n              >\n                <span class="gatsby-code-button-language">py{19-23}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict\n\n\n<span class="token keyword">class</span> <span class="token class-name">BetterCountMissing</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">=</span> <span class="token number">0</span>\n\n    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>added <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> <span class="token number">0</span>\n\n\ncurrent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'green\'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\nincrements <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token string">\'orange\'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n<span class="gatsby-highlight-code-line">counter <span class="token operator">=</span> BetterCountMissing<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">result <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>counter<span class="token punctuation">,</span> current<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">for</span> key<span class="token punctuation">,</span> amount <span class="token keyword">in</span> increments<span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> amount</span><span class="gatsby-highlight-code-line"><span class="token keyword">assert</span> counter<span class="token punctuation">.</span>added <span class="token operator">==</span> <span class="token number">2</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面这段代码要比 CountMissing 更清晰，因为它里面有 <code class="language-text">__call__</code> 方法，这说明这个类的实例可像普通的函数那样使用（例如可以传给 API 当挂钩）。即便是初次看到这段代码，也能明白这个类的主要目标。因为你应该会注意到那个比较显眼的 <code class="language-text">__call__</code> 方法。它强烈暗示着这个类可以像有状态的闭包那样使用。</p>\n<p>总之，最大的优势在于，defaultdict 仍然不需要关注 <code class="language-text">__call__</code> 方法触发之后究竟会做什么。它只知道自己可以用这样一个挂钩，来给缺失的键制作默认值。Python 很容易就能设计这种把挂钩函数当参数来用的接口，面对这种接口，调用者可以采用最适合自己的，把符合接口要求的东西传进去。</p>\n<h3 id="总结-34"><a href="#%E6%80%BB%E7%BB%93-34" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>如果想设计简单的 Python 接口，让组件之间能够通过接口交互，那么可以考虑让接口接受挂钩函数，而不一定非得定义新类，并要求使用者传入这种类的实例。</li>\n<li>Python 的函数与方法都是头等对象，这意味着它们可以像其他类型那样，用在表达式里。</li>\n<li>某个类如果定义了 <code class="language-text">__call__</code> 特殊方法，那么它的实例就可以像普通的 Python 函数那样调用。</li>\n<li>如果想用函数来维护状态，那么可以考虑定义一个带有 <code class="language-text">__call__</code> 方法的新类，而不要用有状态的闭包去实现。</li>\n</ol>\n<h2 id="第-39-条：通过-classmethod-多态来构造同一体系中的各类对象"><a href="#%E7%AC%AC-39-%E6%9D%A1%EF%BC%9A%E9%80%9A%E8%BF%87-classmethod-%E5%A4%9A%E6%80%81%E6%9D%A5%E6%9E%84%E9%80%A0%E5%90%8C%E4%B8%80%E4%BD%93%E7%B3%BB%E4%B8%AD%E7%9A%84%E5%90%84%E7%B1%BB%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 39 条：通过 @classmethod 多态来构造同一体系中的各类对象</h2>\n<p>在 Python 中，不仅对象支持多态，类也支持多态。类的多态是什么意思，这样做有什么好处？</p>\n<p>多态机制使同一体系中的多个类可以按照各自独有的方式来实现同一个方法，这意味着这些类都可以满足同一套接口，或者都可以当作某个抽象类来使用，同时，它们又能在这个前提下，实现各自的功能（参见第 43 条）。</p>\n<p>例如，要实现一套 MapReduce（映射-归纳/映射-化简）流程，并且以一个通用的类来表示输入数据。于是，笔者就定义了这样一个 InputData 类，并把 read 方法留给子类去实现。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87443918867466900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class InputData:\n    def read(self):\n        raise NotImplementedError`, `87443918867466900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">InputData</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后，编写一个具体的 InputData 子类，例如，可以从磁盘文件中读取数据的 PathInputData 类。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52903090466605700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class PathInputData(InputData):\n    def __init__(self, path):\n        super().__init__()\n        self.path = path\n\n    def read(self):\n        with open(self.path) as f:\n            return f.read()`, `52903090466605700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">PathInputData</span><span class="token punctuation">(</span>InputData<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>path <span class="token operator">=</span> path\n\n    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通用的 InputData 类以后可能会有很多个像 PathInputData 这样的子类，每个子类都会实现标准的 read 接口，并按照各自的方式把需要处理的数据读取进来。例如，有的 InputData 子类可从网上读取数据，有的 InputData 可读取压缩格式的数据并将其解压成普通数据，等等。</p>\n<p>除了输入数据要通用，我们还想让处理 MapReduce 任务的工作节点（Worker）也能有一套通用的抽象接口，这样不同的 Worker 就可以通过这套标准的接口来消耗输入数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84739444419421720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Worker:\n    def __init__(self, input_data):\n        self.input_data = input_data\n        self.result = None\n\n    def map(self):\n        raise NotImplementedError\n\n    def reduce(self, other):\n        raise NotImplementedError`, `84739444419421720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Worker</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_data<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>input_data <span class="token operator">=</span> input_data\n        self<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token boolean">None</span>\n\n    <span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n    <span class="token keyword">def</span> <span class="token function">reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面，我们定义一种具体的 Worker 子类，使它按照特定的方式实现 MapReduce。也就是统计每份数据里的换行符个数，然后把所有的统计值汇总起来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78501229991156090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class LineCountWorker(Worker):\n    def map(self):\n        data = self.input_data.read()\n        self.result = data.count(\'\\n\')\n\n    def reduce(self, other):\n        self.result += other.result`, `78501229991156090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">LineCountWorker</span><span class="token punctuation">(</span>Worker<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        data <span class="token operator">=</span> self<span class="token punctuation">.</span>input_data<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>result <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">\'\\n\'</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>result <span class="token operator">+=</span> other<span class="token punctuation">.</span>result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样实现似乎不错，但接下来会碰到一个大难题，也就是如何把这些组件拼接起来。输入数据与工作节点都有各自的类体系，而且这两套体系也抽象出了合理的接口，然而，它们都必须落实到具体的对象上面，只有构造出了具体对象，才能写出有用的程序。问题是，这些对象由谁来构造？构造出来之后，怎么编排 MapReduce 流程？</p>\n<p>最简单的办法，是编写几个辅助函数，手动构建这些对象并把它们连接起来。例如，可以采用下面的辅助函数读取目录中的内容，并给目录下每份文件构造一个 PathInputData 实例。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16196106077021467000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import os\n\n\ndef generate_inputs(data_dir):\n    for name in os.listdir(data_dir):\n        yield PathInputData(os.path.join(data_dir, name))`, `16196106077021467000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> os\n\n\n<span class="token keyword">def</span> <span class="token function">generate_inputs</span><span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> name <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> PathInputData<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来，再编写一个辅助函数，针对 <code class="language-text">generate_inputs</code> 返回的每个 InputData 实例分别创建相应的 LineCountWorker 对象。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61950096450958030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def create_workers(input_list):\n    workers = []\n    for input_data in input_list:\n        workers.append(LineCountWorker(input_data))\n    return workers`, `61950096450958030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">create_workers</span><span class="token punctuation">(</span>input_list<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    workers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> input_data <span class="token keyword">in</span> input_list<span class="token punctuation">:</span>\n        workers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>LineCountWorker<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> workers</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后，将这些 Worker 实例的映射（map）工作分发到多个线程中去执行（参见第 53 条）。反复调用 reduce，把这些 Worker 计算出的结果合并成一个值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84103022514869750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from threading import Thread\n\n\ndef execute(workers):\n    threads = [Thread(target=w.map) for w in workers]\n    for thread in threads:\n        thread.start()\n    for thread in threads:\n        thread.join()\n\n    first, *rest = workers\n    for worker in rest:\n        first.reduce(worker)\n    return first.result`, `84103022514869750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread\n\n\n<span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>workers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    threads <span class="token operator">=</span> <span class="token punctuation">[</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>w<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">)</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> workers<span class="token punctuation">]</span>\n    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>\n        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>\n        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    first<span class="token punctuation">,</span> <span class="token operator">*</span>rest <span class="token operator">=</span> workers\n    <span class="token keyword">for</span> worker <span class="token keyword">in</span> rest<span class="token punctuation">:</span>\n        first<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> first<span class="token punctuation">.</span>result</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后，编写一个函数，将刚才那三个环节串起来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56175365631511310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def mapreduce(data_dir):\n    inputs = generate_inputs(data_dir)\n    workers = create_workers(inputs)\n    return execute(workers)`, `56175365631511310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">mapreduce</span><span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    inputs <span class="token operator">=</span> generate_inputs<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span>\n    workers <span class="token operator">=</span> create_workers<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> execute<span class="token punctuation">(</span>workers<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，该函数可以很好地处理随机制造出的这批输入文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94340345338741800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import random\nfrom threading import Thread\nimport os\n\n\nclass InputData:\n    def read(self):\n        raise NotImplementedError\n\n\nclass PathInputData(InputData):\n    def __init__(self, path):\n        super().__init__()\n        self.path = path\n\n    def read(self):\n        with open(self.path) as f:\n            return f.read()\n\n\nclass Worker:\n    def __init__(self, input_data):\n        self.input_data = input_data\n        self.result = None\n\n    def map(self):\n        raise NotImplementedError\n\n    def reduce(self, other):\n        raise NotImplementedError\n\n\nclass LineCountWorker(Worker):\n    def map(self):\n        data = self.input_data.read()\n        self.result = data.count(\'\\n\')\n\n    def reduce(self, other):\n        self.result += other.result\n\n\ndef generate_inputs(data_dir):\n    for name in os.listdir(data_dir):\n        yield PathInputData(os.path.join(data_dir, name))\n\n\ndef create_workers(input_list):\n    workers = []\n    for input_data in input_list:\n        workers.append(LineCountWorker(input_data))\n    return workers\n\n\ndef mapreduce(data_dir):\n    inputs = generate_inputs(data_dir)\n    workers = create_workers(inputs)\n    return execute(workers)\n\n\ndef execute(workers):\n    threads = [Thread(target=w.map) for w in workers]\n    for thread in threads:\n        thread.start()\n    for thread in threads:\n        thread.join()\n\n    first, *rest = workers\n    for worker in rest:\n        first.reduce(worker)\n    return first.result\n\n\ndef write_test_files(tmpdir):\n    os.makedirs(tmpdir)\n    print(\'generate dir is:\', os.path.abspath(tmpdir))\n    for i in range(100):\n        with open(os.path.join(tmpdir, str(i)), \'w\') as f:\n            f.write(\'\\n\' * random.randint(0, 100))\n\n\ntmpdir = \'test_inputs\'\nwrite_test_files(tmpdir)\nresult = mapreduce(tmpdir)\nprint(f\'There are {result} lines\')\n\n>>>\ngenerate dir is: /home/123/Desktop/test_inputs\nThere are 4884 lines`, `94340345338741800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{73-84}"\n              >\n                <span class="gatsby-code-button-language">py{73-84}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> random\n<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread\n<span class="token keyword">import</span> os\n\n\n<span class="token keyword">class</span> <span class="token class-name">InputData</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n\n<span class="token keyword">class</span> <span class="token class-name">PathInputData</span><span class="token punctuation">(</span>InputData<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>path <span class="token operator">=</span> path\n\n    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">Worker</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_data<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>input_data <span class="token operator">=</span> input_data\n        self<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token boolean">None</span>\n\n    <span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n    <span class="token keyword">def</span> <span class="token function">reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n\n<span class="token keyword">class</span> <span class="token class-name">LineCountWorker</span><span class="token punctuation">(</span>Worker<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        data <span class="token operator">=</span> self<span class="token punctuation">.</span>input_data<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>result <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">\'\\n\'</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>result <span class="token operator">+=</span> other<span class="token punctuation">.</span>result\n\n\n<span class="token keyword">def</span> <span class="token function">generate_inputs</span><span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> name <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> PathInputData<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">create_workers</span><span class="token punctuation">(</span>input_list<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    workers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> input_data <span class="token keyword">in</span> input_list<span class="token punctuation">:</span>\n        workers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>LineCountWorker<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> workers\n\n\n<span class="token keyword">def</span> <span class="token function">mapreduce</span><span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    inputs <span class="token operator">=</span> generate_inputs<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span>\n    workers <span class="token operator">=</span> create_workers<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> execute<span class="token punctuation">(</span>workers<span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>workers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    threads <span class="token operator">=</span> <span class="token punctuation">[</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>w<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">)</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> workers<span class="token punctuation">]</span>\n    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>\n        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>\n        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    first<span class="token punctuation">,</span> <span class="token operator">*</span>rest <span class="token operator">=</span> workers\n    <span class="token keyword">for</span> worker <span class="token keyword">in</span> rest<span class="token punctuation">:</span>\n        first<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> first<span class="token punctuation">.</span>result\n\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">write_test_files</span><span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'generate dir is:\'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>tmpdir<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'\\n\'</span> <span class="token operator">*</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">tmpdir <span class="token operator">=</span> <span class="token string">\'test_inputs\'</span></span><span class="gatsby-highlight-code-line">write_test_files<span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">result <span class="token operator">=</span> mapreduce<span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'There are </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string"> lines\'</span></span><span class="token punctuation">)</span></span>\n<span class="token operator">>></span><span class="token operator">></span>\ngenerate <span class="token builtin">dir</span> <span class="token keyword">is</span><span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span><span class="token number">123</span><span class="token operator">/</span>Desktop<span class="token operator">/</span>test_inputs\nThere are <span class="token number">4884</span> lines</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而这样做有个大问题，就是 mapreduce 函数根本不通用。假如要使用其他的 InputData 或 Worker 子类，那就必须修改 <code class="language-text">generate_inputs</code>、<code class="language-text">create_workers</code> 与 mapreduce 的代码，以匹配新类的用法。</p>\n<p>这个问题的根本原因在于，构造对象的办法不够通用。在其他编程语言中，可以利用构造函数多态（constructor polymorphism）来解决，也就是子类不仅要具备与超类一致的构造函数，而且还必须各自提供一个特殊的构造函数以实现和自身有关的构造逻辑。这样，刚才那些辅助方法在编排 MapReduce 流程时，就可以按照超类的形式统一地构造这些对象，并使其根据所属的子类分别去触发相关的特殊构造函数（类似工厂模式）。但是我们在 Python 里不能这样做，因为 Python 的类只能有一个构造方法（即 <code class="language-text">__init__</code> 方法），没办法要求所有的 InputData 子类都采用同一种写法来定义 <code class="language-text">__init__</code>（因为它们必须用各自不同的数据来完成构造）。</p>\n<p>这个问题，最好是能够通过类方法多态（class method polymorphism）来解决。这种多态与 InputData.read 所体现的实例方法多态（instance method polymorphism）很像，只不过它针对的是类，而不是这些类的对象。</p>\n<p>我们现在运用方法多态来实现 MapReduce 流程所用到的这些类。首先改写 InputData 类，把 <code class="language-text">generate_inputs</code> 方法放到该类里面并声明成通用的 @classmethod，这样它的所有子类都可以通过同一个接口来新建具体的 InputData 实例。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69645056912686900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class GenericInputData:\n    def read(self):\n        raise NotImplementedError\n\n    @classmethod\n    def generate_inputs(cls, config):\n        raise NotImplementedError`, `69645056912686900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">GenericInputData</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n    @<span class="token builtin">classmethod</span>\n    <span class="token keyword">def</span> <span class="token function">generate_inputs</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>新的 <code class="language-text">generate_inputs</code> 方法带有一个叫作 config 的字典参数，调用者可以把一系列配置信息放到字典里中，让具体的 GenericInputData 子类去解读。例如 PathInputData 这个子类就会通过 <code class="language-text">data_dir</code> 键从字典里寻找含有输入文件的那个目录。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52399691667185700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class PathInputData(GenericInputData):\n    @classmethod\n    def generate_inputs(cls, config):\n        data_dir = config[\'data_dir\']\n        for name in os.listdir(data_dir):\n            yield cls(os.path.join(data_dir, name))`, `52399691667185700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">PathInputData</span><span class="token punctuation">(</span>GenericInputData<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    @<span class="token builtin">classmethod</span>\n    <span class="token keyword">def</span> <span class="token function">generate_inputs</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        data_dir <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">\'data_dir\'</span><span class="token punctuation">]</span>\n        <span class="token keyword">for</span> name <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> cls<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后，可以用类似的思路改写前面的 Worker 类。把名叫 <code class="language-text">create_workers</code> 的辅助方法移到这个类里面并且也声明成 @classmethod。新方法的 <code class="language-text">input_class</code> 参数将会是 GenericInputData 的某个子类，我们要通过这个参数触发那个子类的 <code class="language-text">generate_inputs</code> 方法，以创建出 Worker 所需的输入信息。有了输入信息之后，通过 <code class="language-text">cls(input_data)</code> 这个通用的形式来调用构造函数，这样创建的实例，其类型是 cls 所表示的具体 GenericWorker 子类。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99978062966784880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class GenericWorker:\n    def __init__(self, input_data):\n        self.input_data = input_data\n        self.result = None\n\n    def map(self):\n        raise NotImplementedError\n\n    def reduce(self, other):\n        raise NotImplementedError\n\n    @classmethod\n    def create_workers(cls, input_class, config):\n        workers = []\n        for input_data in input_class.generate_inputs(config):\n            workers.append(cls(input_data))\n        return workers`, `99978062966784880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">GenericWorker</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_data<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>input_data <span class="token operator">=</span> input_data\n        self<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token boolean">None</span>\n\n    <span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n    <span class="token keyword">def</span> <span class="token function">reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n    @<span class="token builtin">classmethod</span>\n    <span class="token keyword">def</span> <span class="token function">create_workers</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> input_class<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        workers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        <span class="token keyword">for</span> input_data <span class="token keyword">in</span> input_class<span class="token punctuation">.</span>generate_inputs<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            workers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cls<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> workers</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请注意，上面的代码创建输入信息时，用的是 <code class="language-text">input_class.generate_inputs</code> 这样的写法，这么写正是为了触发类多态机制，以便将 <code class="language-text">generate_inputs</code> 派发到 <code class="language-text">input_class</code> 所表示的那个实际子类上面。另外还要注意，在构造 GenericWorker 的子类对象时，用的是 <code class="language-text">cls(...)</code> 这样的通用写法，而没有直接调用 <code class="language-text">__init__</code> 方法。</p>\n<p>接下来要修改具体的 Worker 类，这其实很简单，只需要把超类的名称改为 GenericWorker 就好。</p>\n<p>最后，重新编写 mapreduce 函数，让它通过 <code class="language-text">worker_class.create_workers</code> 来创建工作节点，这样它就变得通用了。</p>\n<p>把原来那套实现方案所处理的随机文件，再采用这套新的工作节点来处理，可以产生相同的结果。区别只在于，这次调用 mapreduce 时，必须多传几个参数，因为它现在是个通用的函数，必须把实际的输入数据与实际的工作节点告诉它。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58424984021797920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import random\nfrom threading import Thread\nimport os\n\n\nclass GenericInputData:\n    def read(self):\n        raise NotImplementedError\n\n    @classmethod\n    def generate_inputs(cls, config):\n        raise NotImplementedError\n\n\nclass PathInputData(GenericInputData):\n    def __init__(self, path):\n        super().__init__()\n        self.path = path\n\n    def read(self):\n        with open(self.path) as f:\n            return f.read()\n\n    @classmethod\n    def generate_inputs(cls, config):\n        data_dir = config[\'data_dir\']\n        for name in os.listdir(data_dir):\n            yield cls(os.path.join(data_dir, name))\n\n\nclass GenericWorker:\n    def __init__(self, input_data):\n        self.input_data = input_data\n        self.result = None\n\n    def map(self):\n        raise NotImplementedError\n\n    def reduce(self, other):\n        raise NotImplementedError\n\n    @classmethod\n    def create_workers(cls, input_class, config):\n        workers = []\n        for input_data in input_class.generate_inputs(config):\n            workers.append(cls(input_data))\n        return workers\n\n\nclass LineCountWorker(GenericWorker):\n    def map(self):\n        data = self.input_data.read()\n        self.result = data.count(\'\\n\')\n\n    def reduce(self, other):\n        self.result += other.result\n\n\ndef mapreduce(worker_class, input_class, config):\n    workers = worker_class.create_workers(input_class, config)\n    return execute(workers)\n\n\ndef execute(workers):\n    threads = [Thread(target=w.map) for w in workers]\n    for thread in threads:\n        thread.start()\n    for thread in threads:\n        thread.join()\n\n    first, *rest = workers\n    for worker in rest:\n        first.reduce(worker)\n    return first.result\n\n\ndef write_test_files(tmpdir):\n    os.makedirs(tmpdir)\n    print(\'generate dir is:\', os.path.abspath(tmpdir))\n    for i in range(100):\n        with open(os.path.join(tmpdir, str(i)), \'w\') as f:\n            f.write(\'\\n\' * random.randint(0, 100))\n\n\ntmpdir = \'test_inputs\'\nwrite_test_files(tmpdir)\nconfig = {\n    \'data_dir\': tmpdir\n}\nresult = mapreduce(LineCountWorker, PathInputData, config)\nprint(f\'There are {result} lines\')\n\n>>>\ngenerate dir is: /home/123/Desktop/test_inputs\nThere are 5373 lines`, `58424984021797920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{6,10-12,15,24-28,31,42-47,50,59-61,87-90}"\n              >\n                <span class="gatsby-code-button-language">py{6,10-12,15,24-28,31,42-47,50,59-61,87-90}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> random\n<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread\n<span class="token keyword">import</span> os\n\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">GenericInputData</span><span class="token punctuation">:</span></span>    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n<span class="gatsby-highlight-code-line">    @<span class="token builtin">classmethod</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">generate_inputs</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">raise</span> NotImplementedError</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">PathInputData</span><span class="token punctuation">(</span>GenericInputData<span class="token punctuation">)</span><span class="token punctuation">:</span></span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>path <span class="token operator">=</span> path\n\n    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="gatsby-highlight-code-line">    @<span class="token builtin">classmethod</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">generate_inputs</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        data_dir <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">\'data_dir\'</span><span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">for</span> name <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            <span class="token keyword">yield</span> cls<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">GenericWorker</span><span class="token punctuation">:</span></span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_data<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>input_data <span class="token operator">=</span> input_data\n        self<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token boolean">None</span>\n\n    <span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n    <span class="token keyword">def</span> <span class="token function">reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> NotImplementedError\n\n<span class="gatsby-highlight-code-line">    @<span class="token builtin">classmethod</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">create_workers</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> input_class<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        workers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">for</span> input_data <span class="token keyword">in</span> input_class<span class="token punctuation">.</span>generate_inputs<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            workers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cls<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> workers</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">LineCountWorker</span><span class="token punctuation">(</span>GenericWorker<span class="token punctuation">)</span><span class="token punctuation">:</span></span>    <span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        data <span class="token operator">=</span> self<span class="token punctuation">.</span>input_data<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>result <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">\'\\n\'</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">reduce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>result <span class="token operator">+=</span> other<span class="token punctuation">.</span>result\n\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">mapreduce</span><span class="token punctuation">(</span>worker_class<span class="token punctuation">,</span> input_class<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    workers <span class="token operator">=</span> worker_class<span class="token punctuation">.</span>create_workers<span class="token punctuation">(</span>input_class<span class="token punctuation">,</span> config<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> execute<span class="token punctuation">(</span>workers<span class="token punctuation">)</span></span>\n\n<span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>workers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    threads <span class="token operator">=</span> <span class="token punctuation">[</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>w<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">)</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> workers<span class="token punctuation">]</span>\n    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>\n        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span>\n        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    first<span class="token punctuation">,</span> <span class="token operator">*</span>rest <span class="token operator">=</span> workers\n    <span class="token keyword">for</span> worker <span class="token keyword">in</span> rest<span class="token punctuation">:</span>\n        first<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> first<span class="token punctuation">.</span>result\n\n\n<span class="token keyword">def</span> <span class="token function">write_test_files</span><span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'generate dir is:\'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>tmpdir<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'\\n\'</span> <span class="token operator">*</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\ntmpdir <span class="token operator">=</span> <span class="token string">\'test_inputs\'</span>\nwrite_test_files<span class="token punctuation">(</span>tmpdir<span class="token punctuation">)</span>\n<span class="gatsby-highlight-code-line">config <span class="token operator">=</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token string">\'data_dir\'</span><span class="token punctuation">:</span> tmpdir</span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">result <span class="token operator">=</span> mapreduce<span class="token punctuation">(</span>LineCountWorker<span class="token punctuation">,</span> PathInputData<span class="token punctuation">,</span> config<span class="token punctuation">)</span></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'There are </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string"> lines\'</span></span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\ngenerate <span class="token builtin">dir</span> <span class="token keyword">is</span><span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span><span class="token number">123</span><span class="token operator">/</span>Desktop<span class="token operator">/</span>test_inputs\nThere are <span class="token number">5373</span> lines</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这套方案让我们能够随意编写其他的 GenericInputData 与 GenericWorker 子类，而不用再花时间去调整它们之间的拼接代码（glue code）。</p>\n<h3 id="总结-35"><a href="#%E6%80%BB%E7%BB%93-35" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>Python 只允许每个类有一个构造方法，也就是 <code class="language-text">__init__</code> 方法。</li>\n<li>如果想在超类中用通用的代码构造子类实例，那么可以考虑定义 @classmethod 方法，并在里面用 <code class="language-text">cls(...)</code> 的形式构造具体的子类对象。</li>\n<li>通过类方法多态机制，我们能够以通用的形式构造并拼接具体的子类对象。</li>\n</ol>\n<h2 id="第-40-条：通过-super-初始化超类"><a href="#%E7%AC%AC-40-%E6%9D%A1%EF%BC%9A%E9%80%9A%E8%BF%87-super-%E5%88%9D%E5%A7%8B%E5%8C%96%E8%B6%85%E7%B1%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 40 条：通过 super 初始化超类</h2>\n<p>以前有种简单的写法，能在子类里面执行超类的初始化逻辑，那就是直接在超类名称上调用 <code class="language-text">__init__</code> 方法并把子类实例传进去。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42649447510240130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyBaseClass:\n    def __init__(self, value):\n        self.value = value\n\n\nclass MyChildClass(MyBaseClass):\n    def __init__(self):\n        MyBaseClass.__init__(self, 5)`, `42649447510240130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n\n\n<span class="token keyword">class</span> <span class="token class-name">MyChildClass</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个办法能够应对比较简单的类体系，但是在其他的情况下容易出现问题。</p>\n<p>假如某个类继承了多个超类（一般来说不应该采用多重继承，笔者这里只是举例而已，参见第 41 条），那么直接调用超类的 <code class="language-text">__init__</code> 方法会让代码产生误会。</p>\n<p>直接调用 <code class="language-text">__init__</code> 方法所产生的第一个问题在于，超类的构造逻辑不一定会按照它们在子类 class 语句中的声明顺序执行。例如，在 MyBaseClass 之外再定义两个类，让它们也分别去操纵本实例的 value 字段。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5507204415268818000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class TimesTwo:\n    def __init__(self):\n        self.value *= 2\n\n\nclass PlusFive:\n    def __init__(self):\n        self.value += 5`, `5507204415268818000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">TimesTwo</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">*=</span> <span class="token number">2</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">PlusFive</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">5</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面这个子类继承了刚才那三个类，而且它在 class 语句里指定的超类顺序与它执行那些超类的 <code class="language-text">__init__</code> 时所用的顺序一致。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54736696895657435000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class OneWay(MyBaseClass, TimesTwo, PlusFive):\n    def __init__(self, value):\n        MyBaseClass.__init__(self, value)\n        TimesTwo.__init__(self)\n        PlusFive.__init__(self)`, `54736696895657435000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">OneWay</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">,</span> TimesTwo<span class="token punctuation">,</span> PlusFive<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        TimesTwo<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>\n        PlusFive<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写，程序会按正常顺序初始化那几个超类。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48590791089030880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyBaseClass:\n    def __init__(self, value):\n        self.value = value\n\n\nclass TimesTwo:\n    def __init__(self):\n        self.value *= 2\n\n\nclass PlusFive:\n    def __init__(self):\n        self.value += 5\n\n\nclass OneWay(MyBaseClass, TimesTwo, PlusFive):\n    def __init__(self, value):\n        MyBaseClass.__init__(self, value)\n        TimesTwo.__init__(self)\n        PlusFive.__init__(self)\n\n\nfoo = OneWay(5)\nprint(\'First ordering value is (5 * 2) + 5 =\', foo.value)\n\n>>>\nFirst ordering value is (5 * 2) + 5 = 15`, `48590791089030880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{23-24}"\n              >\n                <span class="gatsby-code-button-language">py{23-24}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n\n\n<span class="token keyword">class</span> <span class="token class-name">TimesTwo</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">*=</span> <span class="token number">2</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">PlusFive</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">5</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">OneWay</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">,</span> TimesTwo<span class="token punctuation">,</span> PlusFive<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        TimesTwo<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>\n        PlusFive<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>\n\n\n<span class="gatsby-highlight-code-line">foo <span class="token operator">=</span> OneWay<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'First ordering value is (5 * 2) + 5 =\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>\n<span class="token operator">>></span><span class="token operator">></span>\nFirst ordering value <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">15</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但如果子类在 class 语句里指定的超类顺序，与它执行那些超类的 <code class="language-text">__init__</code> 时的顺序不同，那么运行结果就会让人困惑（例如这次先声明它继承 PlusFive 类，然后才声明它继承 TimesTwo 类，但执行 <code class="language-text">__init__</code> 的顺序却刚好相反）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86026669390080200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class AnotherWay(MyBaseClass, PlusFive, TimesTwo):\n    def __init__(self, value):\n        MyBaseClass.__init__(self, value)\n        TimesTwo.__init_(self)\n        PlusFive.__init_(self)`, `86026669390080200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">AnotherWay</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">,</span> PlusFive<span class="token punctuation">,</span> TimesTwo<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        TimesTwo<span class="token punctuation">.</span>__init_<span class="token punctuation">(</span>self<span class="token punctuation">)</span>\n        PlusFive<span class="token punctuation">.</span>__init_<span class="token punctuation">(</span>self<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>该子类调整了两个超类的声明顺序，但没有相应调整构造逻辑的执行顺序，因此它还是会跟前面那个子类一样，先初始化 TimesTwo，然后初始化 PlusFive。这样写，就让初次看到这段代码的人很难理解程序的运行结果，他们以为程序先加 5，再乘 2，这样算出来是 20；但实际上，程序依照的是 <code class="language-text">__init__</code> 的调用顺序，而不是 class 语句中的声明顺序，这是个很难察觉的问题。</p>\n<p>直接调用 <code class="language-text">__init__</code> 所产生的第二个问题在于，无法正确处理菱形继承（diamond inheritance）。这种继承指的是子类通过类体系里两条不同路径的类继承了同一个超类。如果采用刚才那种常见的写法来调用超类的 <code class="language-text">__init__</code>，那么会让超类的初始化逻辑重复执行，从而引发混乱。例如，下面先从 MyBaseClass 派生出两个子类。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68169438338209010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyBaseClass:\n    def __init__(self, value):\n        self.value = value\n\n\nclass TimesSeven(MyBaseClass):\n    def __init__(self, value):\n        MyBaseClass.__init__(self, value)\n        self.value *= 7\n\n\nclass PlusNine(MyBaseClass):\n    def __init__(self, value):\n        MyBaseClass.__init__(self, value)\n        self.value += 9`, `68169438338209010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n\n\n<span class="token keyword">class</span> <span class="token class-name">TimesSeven</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">*=</span> <span class="token number">7</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">PlusNine</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">9</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后，定义最终的子类，让它分别继承刚才那两个类，这样 MyBaseClass 就会出现在菱形体系的顶端。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95800107635200590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyBaseClass:\n    def __init__(self, value):\n        self.value = value\n\n\nclass TimesSeven(MyBaseClass):\n    def __init__(self, value):\n        MyBaseClass.__init__(self, value)\n        self.value *= 7\n\n\nclass PlusNine(MyBaseClass):\n    def __init__(self, value):\n        MyBaseClass.__init__(self, value)\n        self.value += 9\n\n\nclass ThisWay(TimesSeven, PlusNine):\n    def __init__(self, value):\n        TimesSeven.__init__(self, value)\n        PlusNine.__init__(self, value)\n\n\nfoo = ThisWay(5)\nprint(\'Should be (5 * 7) + 9 = 44 but is\', foo.value)\n\n>>>\nShould be (5 * 7) + 9 = 44 but is 14`, `95800107635200590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{18-25}"\n              >\n                <span class="gatsby-code-button-language">py{18-25}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n\n\n<span class="token keyword">class</span> <span class="token class-name">TimesSeven</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">*=</span> <span class="token number">7</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">PlusNine</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        MyBaseClass<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">9</span>\n\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">ThisWay</span><span class="token punctuation">(</span>TimesSeven<span class="token punctuation">,</span> PlusNine<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        TimesSeven<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        PlusNine<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">foo <span class="token operator">=</span> ThisWay<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Should be (5 * 7) + 9 = 44 but is\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>\n<span class="token operator">>></span><span class="token operator">></span>\nShould be <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">9</span> <span class="token operator">=</span> <span class="token number">44</span> but <span class="token keyword">is</span> <span class="token number">14</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当 ThisWay 调用第二个超类的 <code class="language-text">__init__</code> 时，那个方法会再度触发 MyBaseClass 的 <code class="language-text">__init__</code>，导致 self.value 重新变成 5。所以，最后的结果是 5 + 9 = 14，而不是 <code class="language-text">(5 * 7) + 9 = 44</code>，因为早前由 <code class="language-text">TimesSeven.__init__</code> 所做的初始化效果已经被第二次执行的 <code class="language-text">MyBaseClass.__init__</code> 覆盖了。这是个违背直觉的结果，如果情况更为复杂，那么调试起来会特别困难。</p>\n<p>为了解决这些问题，Python 内置了 super 函数并且规定了标准的方法解析顺序（method resolution order，MRO）。super 能够确保菱形继承体系中的共同超类只初始化一次（其他案例参见第 48 条）。MRO 可以确定超类之间的初始化顺序，它遵循 C3 线性化（C3 linearization）算法。</p>\n<p>下面再创建一套菱形的类体系，但是这次，我们改用 <code class="language-text">super()</code> 来调用超类的初始化逻辑。</p>\n<p>位于菱形结构顶端的 MyBaseClass，会率先初始化，而且只会初始化一次。接下来，程序会参照菱形底端那个子类在 class 语句里声明超类时的顺序，来执行菱形结构中部的那两个超类。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96558002703342980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyBaseClass:\n    def __init__(self, value):\n        self.value = value\n\n\nclass TimesSevenCorrect(MyBaseClass):\n    def __init__(self, value):\n        super().__init__(value)\n        self.value *= 7\n\n\nclass PlusNineCorrect(MyBaseClass):\n    def __init__(self, value):\n        super().__init__(value)\n        self.value += 9\n\n\nclass GoodWay(TimesSevenCorrect, PlusNineCorrect):\n    def __init__(self, value):\n        super().__init__(value)\n\n\nfoo = GoodWay(5)\nprint(\'Should be 7 * (5 + 9) = 98 but is\', foo.value)\n\n>>>\nShould be 7 * (5 + 9) = 98 but is 98`, `96558002703342980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n\n\n<span class="token keyword">class</span> <span class="token class-name">TimesSevenCorrect</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">*=</span> <span class="token number">7</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">PlusNineCorrect</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">9</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">GoodWay</span><span class="token punctuation">(</span>TimesSevenCorrect<span class="token punctuation">,</span> PlusNineCorrect<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n\n\nfoo <span class="token operator">=</span> GoodWay<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Should be 7 * (5 + 9) = 98 but is\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nShould be <span class="token number">7</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">98</span> but <span class="token keyword">is</span> <span class="token number">98</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个执行顺序，似乎与看上去的相反。既然 GoodWay 在指定超类时，先写的是 TimesSevenCorrect，那就应该先执行 <code class="language-text">TimesSevenCorrect.__init__</code> 才对，这样结果应该是 <code class="language-text">(5 * 7) + 9 = 44</code>。但实际上并非如此。这两个超类之间的初始化顺序，要由子类的 MRO 确定，它可以通过 mro 方法来查询。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72604623152530310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mro_str = \'\\n\'.join(repr(cls) for cls in GoodWay.mro())\nprint(mro_str)\n\n>>>\n<class \'__main__.GoodWay\'>\n<class \'__main__.TimesSevenCorrect\'>\n<class \'__main__.PlusNineCorrect\'>\n<class \'__main__.MyBaseClass\'>\n<class \'object\'>`, `72604623152530310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">mro_str <span class="token operator">=</span> <span class="token string">\'\\n\'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span> <span class="token keyword">for</span> cls <span class="token keyword">in</span> GoodWay<span class="token punctuation">.</span>mro<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>mro_str<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'__main__.GoodWay\'</span><span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'__main__.TimesSevenCorrect\'</span><span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'__main__.PlusNineCorrect\'</span><span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'__main__.MyBaseClass\'</span><span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'object\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用 GoodWay(5) 时，会先触发 <code class="language-text">TimesSevenCorrect.__init__</code>，进而触发 <code class="language-text">PlusNineCorrect.__init__</code>，而这又会触发 <code class="language-text">MyBaseClass.__init__</code>。程序到达菱形结构的顶端后，开始执行 MyBaseClass 的初始化逻辑，然后按照与刚才相反的顺序，依次执行 PlusNineCorrect、TimesSevenCorrect 与 GoodWay 的初始化逻辑。所以，程序首先会在 <code class="language-text">MyBaseClass.__init__</code> 中，把 value 设为 5，然后在 <code class="language-text">PlusNineCorrect.__init__</code> 里面给它加 9，这样就成了 14，接着又会在 <code class="language-text">TimesSevenCorrect.__init__</code> 里面将它乘 7，于是等于 98。</p>\n<p>除了可以应对菱形继承结构，通过 super() 调用 <code class="language-text">__init__</code>，与在子类内通过类名直接调用 <code class="language-text">__init__</code> 相比，可使代码更容易维护。现在不用从子类里面指名调用 <code class="language-text">MyBaseClass.__init__</code> 方法了，因此可以把 MyBaseClass 改成其他名字，或者让 TimesSevenCorrect 与 PlusNineCorrect 从另外一个超类里面继承，这些改动都无须调整 super 这一部分的代码。假如像原来那样写，那就必须手工修改 <code class="language-text">__init__</code> 方法前面的类名。</p>\n<p>super 函数也可以用双参数的形式调用。第一个参数表示从这个类型开始（不含该类型本身）按照方法解析顺序（MRO）向上搜索，而解析顺序则要由第二个参数所在类型的 <code class="language-text">__mro__</code> 决定。例如，按照下面这种写法，如果在 super 所返回的内容上调用 <code class="language-text">__init__</code> 方法，那么程序会从 ExplicitTrisect 类型开始（不含该类型本身）按照 MRO 向上搜索，直至找到这样的 <code class="language-text">__init__</code> 方法为止，而解析顺序是由第二个参数（self）所属的类型（ExplicitTrisect）决定的，所以解析顺序是 <code class="language-text">ExplicitTrisect -&gt; MyBaseClass -&gt; object</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35451458111078502000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ExplicitTrisect(MyBaseClass):\n    def __init__(self, value):\n        super(ExplicitTrisect, self).__init__(value)\n        self.value /= 3`, `35451458111078502000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ExplicitTrisect</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span>ExplicitTrisect<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">/=</span> <span class="token number">3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一般来说，在类的 <code class="language-text">__init__</code> 方法里面通过 super 初始化实例时，不需要采用双参数的形式，而是可以直接采用不带参数的写法调用 super，这样 Python 编译器会自动将 <code class="language-text">__class__</code> 和 self 当成参数传递进去。所以，下面这两种写法跟刚才那种写法是同一个意思。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58028484300335110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyBaseClass:\n    def __init__(self, value):\n        self.value = value\n\n\nclass ExplicitTrisect(MyBaseClass):\n    def __init__(self, value):\n        super(ExplicitTrisect, self).__init__(value)\n        self.value /= 3\n\n\nclass AutomaticTrisect(MyBaseClass):\n    def __init__(self, value):\n        super(__class__, self).__init__(value)\n        self.value /= 3\n\n\nclass ImplicitTrisect(MyBaseClass):\n    def __init__(self, value):\n        super().__init__(value)\n        self.value /= 3\n\n\nassert ExplicitTrisect(9).value == 3\nassert AutomaticTrisect(9).value == 3\nassert ImplicitTrisect(9).value == 3`, `58028484300335110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n\n\n<span class="token keyword">class</span> <span class="token class-name">ExplicitTrisect</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span>ExplicitTrisect<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">/=</span> <span class="token number">3</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">AutomaticTrisect</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span>__class__<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">/=</span> <span class="token number">3</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">ImplicitTrisect</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">/=</span> <span class="token number">3</span>\n\n\n<span class="token keyword">assert</span> ExplicitTrisect<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">3</span>\n<span class="token keyword">assert</span> AutomaticTrisect<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">3</span>\n<span class="token keyword">assert</span> ImplicitTrisect<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只有一种情况需要明确给 super 指定参数，这就是：我们想从子类里面访问超类对某项功能所做的实现方案，而那种方案可能已经被子类覆盖掉了（例如，在封装或复用功能时，就会遇到这样的情况）。</p>\n<h3 id="总结-36"><a href="#%E6%80%BB%E7%BB%93-36" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>Python 有标准的方法解析顺序（MRO）规则，可以用来判定超类之间的初始化顺序，并解决菱形继承问题。</li>\n<li>可以通过 Python 内置的 super 函数正确触发超类的 <code class="language-text">__init__</code> 逻辑。一般情况下，不需要给这个函数指定参数。</li>\n</ol>\n<h2 id="第-41-条：考虑用-mix-in-类来表示可组合的功能"><a href="#%E7%AC%AC-41-%E6%9D%A1%EF%BC%9A%E8%80%83%E8%99%91%E7%94%A8-mix-in-%E7%B1%BB%E6%9D%A5%E8%A1%A8%E7%A4%BA%E5%8F%AF%E7%BB%84%E5%90%88%E7%9A%84%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 41 条：考虑用 mix-in 类来表示可组合的功能</h2>\n<p>Python 是面向对象的编程语言，而且内置了相关的机制，使开发者能够正确处理多重继承（参见第 40 条）。尽管如此，但还是应该尽量少用多重继承。</p>\n<p>如果既要通过多重继承来方便地封装逻辑，又想避开可能出现的问题，那么就应该把有待继承的类写成 mix-in 类。这种类只提供一小套方法给子类去沿用，而不定义自己实例级别的属性，也不需要 <code class="language-text">__init__</code> 构造函数。</p>\n<p>在 Python 里很容易编写 mix-in，因为无论对象是什么类型，我们都可以方便地检视（inspect）它当前的状态。这种动态检测机制，让我们只需要把通用的功能在 mix-in 实现一遍即可，将来也可以把这项功能应用到其他许多类里面。可以把这些 mix-in 类有层次地组合起来，从而用相当少的代码表达出丰富的功能。</p>\n<p>例如，现在要实现这样一个功能，把内存中的 Python 对象表示成字典形式以便做序列化（serialization）处理。不妨将这项功能写为通用代码，以供其他类使用。</p>\n<p>为了演示这种做法，笔者定义下面这个 mix-in，让它提供名为 <code class="language-text">to_dict</code> 的 public 方法。凡是想支持这项功能的类，都可以从 mix-in 继承。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87478467483076540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ToDictMixin:\n    def to_dict(self):\n        return self._traverse_dict(self.__dict__)`, `87478467483076540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ToDictMixin</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">to_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>具体的实现代码写得很直观，我们可以通过 isinstance 函数动态地检视值的类型，并利用 hasattr 函数判断值里面有没有叫作 <code class="language-text">__dict__</code> 的字典。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93609382372545990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def _traverse_dict(self, instance_dict):\n    output = {}\n    for key, value in instance_dict.items():\n        output[key] = self._traverse(key, value)\n    return output\n\n\ndef _traverse(self, key, value):\n    if isinstance(value, ToDictMixin):\n        return value.to_dict()\n    elif isinstance(value, dict):\n        return self._traverse_dict(value)\n    elif isinstance(value, list):\n        return [self._traverse(key, i) for i in value]\n    elif hasattr(value, \'__dict__\'):\n        return self._traverse_dict(value.__dict__)\n    else:\n        return value`, `93609382372545990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">_traverse_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    output <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> instance_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        output<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> output\n\n\n<span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> value<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n    <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> value<span class="token punctuation">]</span>\n    <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">\'__dict__\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> value</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面以二叉树为例，演示如何使表示二叉树的 BinaryTree 类具备刚才那个 mix-in 所提供的功能。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27272196504762690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class BinaryTree(ToDictMixin):\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right`, `27272196504762690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">BinaryTree</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>定义了这样的 BinaryTree 类后，很容易就能把二叉树里面那些相互关联的 Python 对象转换成字典的形式。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34563612824544140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ToDictMixin:\n    def _traverse_dict(self, instance_dict):\n        output = {}\n        for key, value in instance_dict.items():\n            output[key] = self._traverse(key, value)\n        return output\n\n    def _traverse(self, key, value):\n        if isinstance(value, ToDictMixin):\n            return value.to_dict()\n        elif isinstance(value, dict):\n            return self._traverse_dict(value)\n        elif isinstance(value, list):\n            return [self._traverse(key, i) for i in value]\n        elif hasattr(value, \'__dict__\'):\n            return self._traverse_dict(value.__dict__)\n        else:\n            return value\n\n    def to_dict(self):\n        return self._traverse_dict(self.__dict__)\n\n\nclass BinaryTree(ToDictMixin):\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right\n\n\ntree = BinaryTree(10,\n                  left=BinaryTree(7, right=BinaryTree(9)),\n                  right=BinaryTree(13, left=BinaryTree(11)))\nprint(tree.to_dict())\n\n>>>\n{\'value\': 10, \'left\': {\'value\': 7, \'left\': None, \'right\': {\'value\': 9, \'left\': None, \'right\': None}}, \'right\': {\'value\': 13, \'left\': {\'value\': 11, \'left\': None, \'right\': None}, \'right\': None}}`, `34563612824544140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{31-34}"\n              >\n                <span class="gatsby-code-button-language">py{31-34}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ToDictMixin</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">_traverse_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        output <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> instance_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            output<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> output\n\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> value<span class="token punctuation">]</span>\n        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">\'__dict__\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value\n\n    <span class="token keyword">def</span> <span class="token function">to_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">BinaryTree</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right\n\n\n<span class="gatsby-highlight-code-line">tree <span class="token operator">=</span> BinaryTree<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                  left<span class="token operator">=</span>BinaryTree<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> right<span class="token operator">=</span>BinaryTree<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                  right<span class="token operator">=</span>BinaryTree<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> left<span class="token operator">=</span>BinaryTree<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>mix-in 最妙的地方在于，子类既可以沿用它所提供的功能，又可以对其中一些地方做自己的处理。例如，我们从普通的二叉树（BinaryTree）派生了一个子类，让这种特殊的 BinaryTreeWithParent 二叉树能够把指向上级节点的引用保留下来。但问题是，这种二叉树的 <code class="language-text">to_dict</code> 方法是从 ToDictMixin 继承来的，它所触发的 <code class="language-text">_traverse</code> 方法，在面对循环引用时，会无休止地递归下去。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24456419233084215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class BinaryTreeWithParent(BinaryTree):\n    def __init__(self, value, left=None,\n                 right=None, parent=None):\n        super().__init__(value, left=left, right=right)\n        self.parent = parent`, `24456419233084215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">BinaryTreeWithParent</span><span class="token punctuation">(</span>BinaryTree<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n                 right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">,</span> left<span class="token operator">=</span>left<span class="token punctuation">,</span> right<span class="token operator">=</span>right<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>parent <span class="token operator">=</span> parent</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了避免无限循环，我们可以覆盖 <code class="language-text">BinaryTreeWithParent._traverse</code> 方法，让它对指向上级节点的引用做专门处理，而对于其他的值，则继续沿用从 mix-in 继承的 <code class="language-text">_traverse</code> 逻辑。下面这段代码，首先判断当前值是不是指向上级节点的引用。如果是，就直接返回上级节点的 value 值；如果不是，那就通过内置的 super 函数沿用由 mix-in 超类所给出默认实现方案。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29593123648249065000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def _traverse(self, key, value):\n   if (isinstance(value, BinaryTreeWithParent) and\n            key == \'parent\'):\n      return value.value  # Prevent cycles\n   else:\n      return super()._traverse(key, value)`, `29593123648249065000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> BinaryTreeWithParent<span class="token punctuation">)</span> <span class="token keyword">and</span>\n            key <span class="token operator">==</span> <span class="token string">\'parent\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n      <span class="token keyword">return</span> value<span class="token punctuation">.</span>value  <span class="token comment"># Prevent cycles</span>\n   <span class="token keyword">else</span><span class="token punctuation">:</span>\n      <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在调用 <code class="language-text">BinaryTreeWithParent.to_dict</code> 就没有问题了，因为它所触发的是 BinaryTreeWithParent 自己的 <code class="language-text">_traverse</code> 方法，该方法不会再递归地处理循环引用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37014939579408140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ToDictMixin:\n    def _traverse_dict(self, instance_dict):\n        output = {}\n        for key, value in instance_dict.items():\n            output[key] = self._traverse(key, value)\n        return output\n\n    def _traverse(self, key, value):\n        if isinstance(value, ToDictMixin):\n            return value.to_dict()\n        elif isinstance(value, dict):\n            return self._traverse_dict(value)\n        elif isinstance(value, list):\n            return [self._traverse(key, i) for i in value]\n        elif hasattr(value, \'__dict__\'):\n            return self._traverse_dict(value.__dict__)\n        else:\n            return value\n\n    def to_dict(self):\n        return self._traverse_dict(self.__dict__)\n\n\nclass BinaryTree(ToDictMixin):\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right\n\n\nclass BinaryTreeWithParent(BinaryTree):\n    def __init__(self, value, left=None,\n                 right=None, parent=None):\n        super().__init__(value, left=left, right=right)\n        self.parent = parent\n\n    def _traverse(self, key, value):\n        if (isinstance(value, BinaryTreeWithParent) and\n                key == \'parent\'):\n            return value.value  # Prevent cycles\n        else:\n            return super()._traverse(key, value)\n\n\nroot = BinaryTreeWithParent(10)\nroot.left = BinaryTreeWithParent(7, parent=root)\nroot.left.right = BinaryTreeWithParent(9, parent=root.left)\nprint(root.to_dict())\n\n>>>\n{\'value\': 10, \'left\': {\'value\': 7, \'left\': None, \'right\': {\'value\': 9, \'left\': None, \'right\': None, \'parent\': 7}, \'parent\': 10}, \'right\': None, \'parent\': None}`, `37014939579408140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{37-42}"\n              >\n                <span class="gatsby-code-button-language">py{37-42}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ToDictMixin</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">_traverse_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        output <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> instance_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            output<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> output\n\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> value<span class="token punctuation">]</span>\n        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">\'__dict__\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value\n\n    <span class="token keyword">def</span> <span class="token function">to_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">BinaryTree</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right\n\n\n<span class="token keyword">class</span> <span class="token class-name">BinaryTreeWithParent</span><span class="token punctuation">(</span>BinaryTree<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n                 right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">,</span> left<span class="token operator">=</span>left<span class="token punctuation">,</span> right<span class="token operator">=</span>right<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>parent <span class="token operator">=</span> parent\n\n<span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> BinaryTreeWithParent<span class="token punctuation">)</span> <span class="token keyword">and</span></span><span class="gatsby-highlight-code-line">                key <span class="token operator">==</span> <span class="token string">\'parent\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            <span class="token keyword">return</span> value<span class="token punctuation">.</span>value  <span class="token comment"># Prevent cycles</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span>\n\nroot <span class="token operator">=</span> BinaryTreeWithParent<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>\nroot<span class="token punctuation">.</span>left <span class="token operator">=</span> BinaryTreeWithParent<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> parent<span class="token operator">=</span>root<span class="token punctuation">)</span>\nroot<span class="token punctuation">.</span>left<span class="token punctuation">.</span>right <span class="token operator">=</span> BinaryTreeWithParent<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> parent<span class="token operator">=</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'parent\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'parent\'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'parent\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只要 <code class="language-text">BinaryTreeWithParent._traverse</code> 没问题，带有 BinaryTreeWithParent 属性的其他类就可以直接继承 ToDictMixin，这样的话，程序在把这种对象转化成字典时，会自动对其中的 BinaryTreeWithParent 属性做出正确处理。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48232201902708470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ToDictMixin:\n    def _traverse_dict(self, instance_dict):\n        output = {}\n        for key, value in instance_dict.items():\n            output[key] = self._traverse(key, value)\n        return output\n\n    def _traverse(self, key, value):\n        if isinstance(value, ToDictMixin):\n            return value.to_dict()\n        elif isinstance(value, dict):\n            return self._traverse_dict(value)\n        elif isinstance(value, list):\n            return [self._traverse(key, i) for i in value]\n        elif hasattr(value, \'__dict__\'):\n            return self._traverse_dict(value.__dict__)\n        else:\n            return value\n\n    def to_dict(self):\n        return self._traverse_dict(self.__dict__)\n\n\nclass BinaryTree(ToDictMixin):\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right\n\n\nclass BinaryTreeWithParent(BinaryTree):\n    def __init__(self, value, left=None,\n                 right=None, parent=None):\n        super().__init__(value, left=left, right=right)\n        self.parent = parent\n\n    def _traverse(self, key, value):\n        if (isinstance(value, BinaryTreeWithParent) and\n                key == \'parent\'):\n            return value.value  # Prevent cycles\n        else:\n            return super()._traverse(key, value)\n\n\nclass NamedSubTree(ToDictMixin):\n    def __init__(self, name, tree_with_parent):\n        self.name = name\n        self.tree_with_parent = tree_with_parent\n\n\nroot = BinaryTreeWithParent(10)\nroot.left = BinaryTreeWithParent(7, parent=root)\nroot.left.right = BinaryTreeWithParent(9, parent=root.left)\n\nmy_tree = NamedSubTree(\'foobar\', root.left.right)\nprint(my_tree.to_dict())  # No infinite loop\n\n>>>\n{\'name\': \'foobar\', \'tree_with_parent\': {\'value\': 9, \'left\': None, \'right\': None, \'parent\': 7}}`, `48232201902708470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{45-48,55-56}"\n              >\n                <span class="gatsby-code-button-language">py{45-48,55-56}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ToDictMixin</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">_traverse_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        output <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> instance_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            output<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> output\n\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> value<span class="token punctuation">]</span>\n        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">\'__dict__\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value\n\n    <span class="token keyword">def</span> <span class="token function">to_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">BinaryTree</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right\n\n\n<span class="token keyword">class</span> <span class="token class-name">BinaryTreeWithParent</span><span class="token punctuation">(</span>BinaryTree<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n                 right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>value<span class="token punctuation">,</span> left<span class="token operator">=</span>left<span class="token punctuation">,</span> right<span class="token operator">=</span>right<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>parent <span class="token operator">=</span> parent\n\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> BinaryTreeWithParent<span class="token punctuation">)</span> <span class="token keyword">and</span>\n                key <span class="token operator">==</span> <span class="token string">\'parent\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span>value  <span class="token comment"># Prevent cycles</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">NamedSubTree</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> tree_with_parent<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span><span class="gatsby-highlight-code-line">        self<span class="token punctuation">.</span>tree_with_parent <span class="token operator">=</span> tree_with_parent</span>\n\nroot <span class="token operator">=</span> BinaryTreeWithParent<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>\nroot<span class="token punctuation">.</span>left <span class="token operator">=</span> BinaryTreeWithParent<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> parent<span class="token operator">=</span>root<span class="token punctuation">)</span>\nroot<span class="token punctuation">.</span>left<span class="token punctuation">.</span>right <span class="token operator">=</span> BinaryTreeWithParent<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> parent<span class="token operator">=</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span>\n\n<span class="gatsby-highlight-code-line">my_tree <span class="token operator">=</span> NamedSubTree<span class="token punctuation">(</span><span class="token string">\'foobar\'</span><span class="token punctuation">,</span> root<span class="token punctuation">.</span>left<span class="token punctuation">.</span>right<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span>my_tree<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># No infinite loop</span></span>\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'name\'</span><span class="token punctuation">:</span> <span class="token string">\'foobar\'</span><span class="token punctuation">,</span> <span class="token string">\'tree_with_parent\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'value\'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">\'left\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'right\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">\'parent\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>多个 mix-in 可以组合起来用。例如，我们要再写一个 mix-in，让所有的类都可以通过继承它来实现 JSON 序列化功能。在编写这个 mix-in 时，假设继承了它的那个类肯定有自己的 <code class="language-text">to_dict</code> 方法（这个方法有可能是从另一个 mix-in（如 ToDictMixin）继承的）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9452760564086327000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import json\n\n\nclass JsonMixin:\n    @classmethod\n    def from_json(cls, data):\n        kwargs = json.loads(data)\n        return cls(**kwargs)\n\n    def to_json(self):\n        return json.dumps(self.to_dict())`, `9452760564086327000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> json\n\n\n<span class="token keyword">class</span> <span class="token class-name">JsonMixin</span><span class="token punctuation">:</span>\n    @<span class="token builtin">classmethod</span>\n    <span class="token keyword">def</span> <span class="token function">from_json</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        kwargs <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> cls<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">to_json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>self<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请注意，JsonMixin 既定义了实例方法，也定义了类方法。于是，继承了这个 mix-in 的其他类也会拥有这两种行为。在本例中，继承 JsonMixin 的类只需要提供 <code class="language-text">to_dict</code> 方法以及能够接受关键字参数的 <code class="language-text">__init__</code> 方法即可（参见第 23 条）。</p>\n<p>有了这样两个 mix-in，我们很容易就能创建一套含有工具类的体系，让其中的各种类型都可以把对象序列化成 JSON 格式并且能够根据 JSON 格式的数据创建这样的对象。而这只需要开发者按照固定的样式多写一点点代码即可。例如，可以用这样一套由数据类所构成的体系表示数据中心的各种设备与它们之间的结构关系。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17525712471552790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import json\n\n\nclass ToDictMixin:\n    def _traverse_dict(self, instance_dict):\n        output = {}\n        for key, value in instance_dict.items():\n            output[key] = self._traverse(key, value)\n        return output\n\n    def _traverse(self, key, value):\n        if isinstance(value, ToDictMixin):\n            return value.to_dict()\n        elif isinstance(value, dict):\n            return self._traverse_dict(value)\n        elif isinstance(value, list):\n            return [self._traverse(key, i) for i in value]\n        elif hasattr(value, \'__dict__\'):\n            return self._traverse_dict(value.__dict__)\n        else:\n            return value\n\n    def to_dict(self):\n        return self._traverse_dict(self.__dict__)\n\n\nclass JsonMixin:\n    @classmethod\n    def from_json(cls, data):\n        kwargs = json.loads(data)\n        return cls(**kwargs)\n\n    def to_json(self):\n        return json.dumps(self.to_dict())\n\n\nclass Switch(ToDictMixin, JsonMixin):\n    def __init__(self, ports=None, speed=None):\n        self.ports = ports\n        self.speed = speed\n\n\nclass Machine(ToDictMixin, JsonMixin):\n    def __init__(self, cores=None, ram=None, disk=None):\n        self.cores = cores\n        self.ram = ram\n        self.disk = disk\n\n\nclass DatacenterRack(ToDictMixin, JsonMixin):\n    def __init__(self, switch=None, machines=None):\n        self.switch = Switch(**switch)\n        self.machines = [\n            Machine(**kwargs) for kwargs in machines]\n\n\nserialized = &quot;&quot;&quot;{\n    &quot;switch&quot;: {&quot;ports&quot;: 5, &quot;speed&quot;: 1e9},\n    &quot;machines&quot;: [\n        {&quot;cores&quot;: 8, &quot;ram&quot;: 32e9, &quot;disk&quot;: 5e12},\n        {&quot;cores&quot;: 4, &quot;ram&quot;: 16e9, &quot;disk&quot;: 1e12},\n        {&quot;cores&quot;: 2, &quot;ram&quot;: 4e9, &quot;disk&quot;: 500e9}\n    ]\n}\n&quot;&quot;&quot;\n\ndeserialized = DatacenterRack.from_json(serialized)\nroundtrip = deserialized.to_json()\nassert json.loads(serialized) == json.loads(roundtrip)`, `17525712471552790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> json\n\n\n<span class="token keyword">class</span> <span class="token class-name">ToDictMixin</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">_traverse_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        output <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> instance_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            output<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> output\n\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> ToDictMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> value<span class="token punctuation">]</span>\n        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">\'__dict__\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>value<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> value\n\n    <span class="token keyword">def</span> <span class="token function">to_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_traverse_dict<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">JsonMixin</span><span class="token punctuation">:</span>\n    @<span class="token builtin">classmethod</span>\n    <span class="token keyword">def</span> <span class="token function">from_json</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        kwargs <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> cls<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">to_json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>self<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">Switch</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">,</span> JsonMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ports<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> speed<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>ports <span class="token operator">=</span> ports\n        self<span class="token punctuation">.</span>speed <span class="token operator">=</span> speed\n\n\n<span class="token keyword">class</span> <span class="token class-name">Machine</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">,</span> JsonMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cores<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> ram<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> disk<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>cores <span class="token operator">=</span> cores\n        self<span class="token punctuation">.</span>ram <span class="token operator">=</span> ram\n        self<span class="token punctuation">.</span>disk <span class="token operator">=</span> disk\n\n\n<span class="token keyword">class</span> <span class="token class-name">DatacenterRack</span><span class="token punctuation">(</span>ToDictMixin<span class="token punctuation">,</span> JsonMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> switch<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> machines<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>switch <span class="token operator">=</span> Switch<span class="token punctuation">(</span><span class="token operator">**</span>switch<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>machines <span class="token operator">=</span> <span class="token punctuation">[</span>\n            Machine<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token keyword">for</span> kwargs <span class="token keyword">in</span> machines<span class="token punctuation">]</span>\n\n\nserialized <span class="token operator">=</span> <span class="token triple-quoted-string string">"""{\n    "switch": {"ports": 5, "speed": 1e9},\n    "machines": [\n        {"cores": 8, "ram": 32e9, "disk": 5e12},\n        {"cores": 4, "ram": 16e9, "disk": 1e12},\n        {"cores": 2, "ram": 4e9, "disk": 500e9}\n    ]\n}\n"""</span>\n\ndeserialized <span class="token operator">=</span> DatacenterRack<span class="token punctuation">.</span>from_json<span class="token punctuation">(</span>serialized<span class="token punctuation">)</span>\nroundtrip <span class="token operator">=</span> deserialized<span class="token punctuation">.</span>to_json<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>serialized<span class="token punctuation">)</span> <span class="token operator">==</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>roundtrip<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写之后，我们很容易就能根据 JSON 格式的信息把这些对象还原出来，另外，也可以把它们再序列化成 JSON 格式。下面我们就先把 serialized 变量所指的一段 JSON 信息反序列化（也就是还原）成 DatacenterRack 对象，然后再把这个对象序列化成 JSON 信息并保存到 roundtrip 变量，最后通过 json.loads 方法验证这两个变量中的信息是否等效。</p>\n<p>对于 JsonMixin 这样的 mix-in 来说，即便直接继承它的那个类还通过类体系中的其他更高层类型间接地继承了它，程序也依然能够正常运行，因为 Python 可以把相关的方法正确地派发给 JsonMixin 类。</p>\n<h3 id="总结-37"><a href="#%E6%80%BB%E7%BB%93-37" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>超类最好能写成不带实例属性与 <code class="language-text">__init__</code> 方法的 mix-in 类，以避免由多重继承所引发的一些问题。</li>\n<li>如果子类要定制（或者说修改）mix-in 所提供的功能，那么可以在自己的代码里面覆盖相关的实例方法。</li>\n<li>根据需求，mix-in 可以只提供实例方法，也可以只提供类方法，还可以同时提供这两种方法。</li>\n<li>把每个 mix-in 所提供的简单功能组合起来，可以实现比较复杂的功能。</li>\n</ol>\n<h2 id="第-42-条：优先考虑用-public-属性表示应受保护的数据，不要用-private-属性表示"><a href="#%E7%AC%AC-42-%E6%9D%A1%EF%BC%9A%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E7%94%A8-public-%E5%B1%9E%E6%80%A7%E8%A1%A8%E7%A4%BA%E5%BA%94%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%B8%8D%E8%A6%81%E7%94%A8-private-%E5%B1%9E%E6%80%A7%E8%A1%A8%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 42 条：优先考虑用 public 属性表示应受保护的数据，不要用 private 属性表示</h2>\n<p>Python 类的属性只有两种访问级别，也就是 public 与 private。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20275612198741920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyObject:\n    def __init__(self):\n        self.public_field = 5\n        self.__private_field = 10\n\n    def get_private_field(self):\n        return self.__private_field`, `20275612198741920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>public_field <span class="token operator">=</span> <span class="token number">5</span>\n        self<span class="token punctuation">.</span>__private_field <span class="token operator">=</span> <span class="token number">10</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_private_field</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__private_field</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>public 属性能够公开访问，只需要在对象后面加上圆点操作符（dot operator），并写出属性的名称即可。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55427103566144400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyObject:\n    def __init__(self):\n        self.public_field = 5\n        self.__private_field = 10\n\n    def get_private_field(self):\n        return self.__private_field\n\n\nfoo = MyObject()\nassert foo.public_field == 5`, `55427103566144400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{10-11}"\n              >\n                <span class="gatsby-code-button-language">py{10-11}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>public_field <span class="token operator">=</span> <span class="token number">5</span>\n        self<span class="token punctuation">.</span>__private_field <span class="token operator">=</span> <span class="token number">10</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_private_field</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__private_field\n\n\n<span class="gatsby-highlight-code-line">foo <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">assert</span> foo<span class="token punctuation">.</span>public_field <span class="token operator">==</span> <span class="token number">5</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果属性名以两个下划线开头，那么即为 private 字段。属性所在的类可以通过实例方法访问该属性。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63293018474859220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyObject:\n    def __init__(self):\n        self.public_field = 5\n        self.__private_field = 10\n\n    def get_private_field(self):\n        return self.__private_field\n\n\nfoo = MyObject()\nassert foo.get_private_field() == 10`, `63293018474859220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{11}"\n              >\n                <span class="gatsby-code-button-language">py{11}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>public_field <span class="token operator">=</span> <span class="token number">5</span>\n        self<span class="token punctuation">.</span>__private_field <span class="token operator">=</span> <span class="token number">10</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_private_field</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__private_field\n\n\nfoo <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">assert</span> foo<span class="token punctuation">.</span>get_private_field<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但如果在类的外面直接通过对象访问 private 字段，那么程序就会抛出异常。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90842639578310890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyObject:\n    def __init__(self):\n        self.public_field = 5\n        self.__private_field = 10\n\n    def get_private_field(self):\n        return self.__private_field\n\n\nfoo = MyObject()\nfoo.__private_field\n\n>>>\nTraceback ...\nAttributeError: \'MyObject\' object has no attribute \'__private_field\'`, `90842639578310890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{11}"\n              >\n                <span class="gatsby-code-button-language">py{11}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>public_field <span class="token operator">=</span> <span class="token number">5</span>\n        self<span class="token punctuation">.</span>__private_field <span class="token operator">=</span> <span class="token number">10</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_private_field</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__private_field\n\n\nfoo <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="gatsby-highlight-code-line">foo<span class="token punctuation">.</span>__private_field</span>\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'MyObject\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'__private_field\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>类方法（@classmethod）可以访问本类的 private 属性，因为这种方法也是在这个类（class）的范围里面声明的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37104673458447030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyOtherObject:\n    def __init__(self):\n        self.__private_field = 71\n\n    @classmethod\n    def get_private_field_of_instance(cls, instance):\n        return instance.__private_field\n\n\nbar = MyOtherObject()\nassert MyOtherObject.get_private_field_of_instance(bar) == 71`, `37104673458447030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyOtherObject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__private_field <span class="token operator">=</span> <span class="token number">71</span>\n\n    @<span class="token builtin">classmethod</span>\n    <span class="token keyword">def</span> <span class="token function">get_private_field_of_instance</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> instance<span class="token punctuation">.</span>__private_field\n\n\nbar <span class="token operator">=</span> MyOtherObject<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> MyOtherObject<span class="token punctuation">.</span>get_private_field_of_instance<span class="token punctuation">(</span>bar<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">71</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>private 字段只给这个类自己使用，子类不能访问超类的 private 字段。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48139357105178870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyParentObject:\n    def __init__(self):\n        self.__private_field = 71\n\n\nclass MyChildObject(MyParentObject):\n    def get_private_field(self):\n        return self.__private_field\n\n\nbaz = MyChildObject()\nbaz.get_private_field()\n\n>>>\nTraceback ...\nAttributeError: \'MyChildObject\' object has no attribute \'_MyChildObject__private_field\'`, `48139357105178870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyParentObject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__private_field <span class="token operator">=</span> <span class="token number">71</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">MyChildObject</span><span class="token punctuation">(</span>MyParentObject<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">get_private_field</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__private_field\n\n\nbaz <span class="token operator">=</span> MyChildObject<span class="token punctuation">(</span><span class="token punctuation">)</span>\nbaz<span class="token punctuation">.</span>get_private_field<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'MyChildObject\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'_MyChildObject__private_field\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种防止其他类访问 private 属性的功能，其实仅仅是通过变换属性名称而实现的。当 Python 编译器看到 <code class="language-text">MyChildObject.get_private_field</code> 这样的方法想要访问 <code class="language-text">__private_field</code> 属性时，它会把下划线和类名加在这个属性名称的前面，所以代码实际上访问的是 <code class="language-text">_MyChildObject__private_field</code>。在上面的例子中，<code class="language-text">__private_field</code> 是在 MyParentObject 的 <code class="language-text">__init__</code> 里面定义的，所以，它变换之后的真实名称是 <code class="language-text">_MyParentObject__private_field</code>。子类不能通过 <code class="language-text">__private_field</code> 来访问这个属性，因为这样写实际上是在访问不存在的 <code class="language-text">_MyChildObject__private_field</code>，而不是 <code class="language-text">_MyParentObject__private_field</code>。</p>\n<p>了解名称变换规则后，我们就可以从任何一个类里面访问 private 属性。无论是子类还是外部的类，都可以不经许可就访问到这些属性。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8582246769504920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyParentObject:\n    def __init__(self):\n        self.__private_field = 71\n\n\nclass MyChildObject(MyParentObject):\n    def get_private_field(self):\n        return self.__private_field\n\n\nbaz = MyChildObject()\nassert baz._MyParentObject__private_field == 71`, `8582246769504920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{12}"\n              >\n                <span class="gatsby-code-button-language">py{12}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyParentObject</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__private_field <span class="token operator">=</span> <span class="token number">71</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">MyChildObject</span><span class="token punctuation">(</span>MyParentObject<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">get_private_field</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__private_field\n\n\nbaz <span class="token operator">=</span> MyChildObject<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">assert</span> baz<span class="token punctuation">.</span>_MyParentObject__private_field <span class="token operator">==</span> <span class="token number">71</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>查看该对象的属性字典，就会发现 private 属性的名称其实是以变换后的名称存储的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54201053862839820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(baz.__dict__)\n\n>>>\n{\'_MyParentObject__private_field\': 71}`, `54201053862839820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span>baz<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\n<span class="token punctuation">{</span><span class="token string">\'_MyParentObject__private_field\'</span><span class="token punctuation">:</span> <span class="token number">71</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为什么 Python 不从语法上严格禁止其他类访问 private 属性呢？这可以用一句常见的 Python 格言来回答：我们都是成年人了（We are all consenting adults here）。意思是说，我们用不着让编程语言把自己给拦住。你可以按照自己的想法扩展某个类的功能，同时也必须考虑到这样做的风险，并为此负责。Python 开发者相信，虽然开放访问权限可能导致别人不按默认方式扩展这个类，但总比封闭起来要好。</p>\n<p>另外，Python 里面还有一些挂钩函数可以访问到这种属性（参见第 47 条），我们可以通过这些机制按需操纵对象的内部数据。既然这样，那即便 Python 阻止我们通过圆点加名称的办法访问 private 属性，我们也还是有其他办法能访问到，那么 Python 阻止 private 属性访问又有何意义？</p>\n<p>为了减少在不知情情况下访问内部数据而造成的损伤，Python 开发者会按照风格指南里面建议的方式来给字段命名（参见第 2 条）。以单下划线开头的字段（例如 <code class="language-text">_protected_field</code>），习惯上叫作受保护的（protected）字段，表示这个类以外的用户在使用这种字段时必须慎重。</p>\n<p>尽管如此，有许多 Python 新手还是喜欢把内部的 API 设计成 private 字段，想通过这种写法防止子类或外部类访问这些字段。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57087217151380185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyStringClass:\n    def __init__(self, value):\n        self.__value = value\n\n    def get_value(self):\n        return str(self.__value)\n\n\nfoo = MyStringClass(5)\nassert foo.get_value() == \'5\'`, `57087217151380185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyStringClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__value <span class="token operator">=</span> value\n\n    <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__value<span class="token punctuation">)</span>\n\n\nfoo <span class="token operator">=</span> MyStringClass<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> foo<span class="token punctuation">.</span>get_value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'5\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这么写不对。因为总会有开发者（也包括你自己）想要继承这个类，并给里面添加新的行为，或采用更高效的办法来实现已有的行为（例如他可能觉得，<code class="language-text">MyStringClass.get_value</code> 总是返回字符串的方式的效率不高）。如果把属性设为 private，那么子类在覆盖或扩充这个类的时候，就必须采用变换之后的名称来访问那个属性，这会让代码变得很容易出错。例如，在写这样一个子类时，就不得不去访问超类中的 private 字段。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4268204745821813000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyStringClass:\n    def __init__(self, value):\n        self.__value = value\n\n    def get_value(self):\n        return str(self.__value)\n\n\nclass MyIntegerSubclass(MyStringClass):\n    def get_value(self):\n        return int(self._MyStringClass__value)\n\n\nfoo = MyIntegerSubclass(\'5\')\nassert foo.get_value() == 5`, `4268204745821813000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyStringClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__value <span class="token operator">=</span> value\n\n    <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__value<span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">MyIntegerSubclass</span><span class="token punctuation">(</span>MyStringClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_MyStringClass__value<span class="token punctuation">)</span>\n\n\nfoo <span class="token operator">=</span> MyIntegerSubclass<span class="token punctuation">(</span><span class="token string">\'5\'</span><span class="token punctuation">)</span>\n<span class="token keyword">assert</span> foo<span class="token punctuation">.</span>get_value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样写的问题是，如果类体系发生变动，那么引用 private 属性的那些代码就失效了。例如，MyIntegerSubclass 类的直接超类（也就是 MyStringClass）本身现在也继承自一个类（叫作 MyBaseClass），而且它把早前的 <code class="language-text">__value</code> 属性移到了那个类里面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50772785632028180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyBaseClass:\n    def __init__(self, value):\n        self.__value = value\n\n    def get_value(self):\n        return self.__value\n\n\nclass MyStringClass(MyBaseClass):\n    def get_value(self):\n        return str(super().get_value())  # Updated\n\n\nclass MyIntegerSubclass(MyStringClass):\n    def get_value(self):\n        return int(self._MyStringClass__value)  # Not updated\n\n\nfoo = MyIntegerSubclass(5)\nfoo.get_value()\n\n>>>\nTraceback ...\nAttributeError: \'MyIntegerSubclass\' object has no attribute \'_MyStringClass__value\'`, `50772785632028180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__value <span class="token operator">=</span> value\n\n    <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__value\n\n\n<span class="token keyword">class</span> <span class="token class-name">MyStringClass</span><span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Updated</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">MyIntegerSubclass</span><span class="token punctuation">(</span>MyStringClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_MyStringClass__value<span class="token punctuation">)</span>  <span class="token comment"># Not updated</span>\n\n\nfoo <span class="token operator">=</span> MyIntegerSubclass<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>\nfoo<span class="token punctuation">.</span>get_value<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'MyIntegerSubclass\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'_MyStringClass__value\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在的 <code class="language-text">__value</code> 属性，是在 MyBaseClass 里面设置的，而不是在 MyStringClass 里面，所以 MyIntegerSubclass 没办法再通过 <code class="language-text">self._MyStringClass__value</code> 访问这个属性。</p>\n<p>一般来说，这种属性应该设置成 protected 字段，这样虽然有可能导致子类误用，但还是要比直接设为 private 好。我们可以在每个 protected 字段的文档里面详细解释，告诉用户这是属于可以由子类来操作的内部 API，还是属于完全不应该触碰的数据。这样的文档，既可以给别人提供建议，也可以指导自己安全地扩充代码。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12138274574669672000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyStringClass:\n    def __init__(self, value):\n        # This stores the user-supplied value for the object.\n        # It should be coercible to a string. Once assigned in\n        # the object it should be treated as immutable.\n        self._value = value`, `12138274574669672000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyStringClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token comment"># This stores the user-supplied value for the object.</span>\n        <span class="token comment"># It should be coercible to a string. Once assigned in</span>\n        <span class="token comment"># the object it should be treated as immutable.</span>\n        self<span class="token punctuation">.</span>_value <span class="token operator">=</span> value</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只有一种情况是可以考虑用 private 属性解决的，就是子类属性有可能与超类重名的情况。如果子类定义属性时使用的名称，恰巧与超类相同，那就会出现这个问题。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1466171002782901200"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ApiClass:\n    def __init__(self):\n        self._value = 5\n\n    def get(self):\n        return self._value\n\n\nclass Child(ApiClass):\n    def __init__(self):\n        super().__init__()\n        self._value = \'hello\'  # Conflicts\n\n\na = Child()\nprint(f\'{a.get()} and {a._value} should be different\')`, `1466171002782901200`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ApiClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token number">5</span>\n\n    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_value\n\n\n<span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>ApiClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token string">\'hello\'</span>  <span class="token comment"># Conflicts</span>\n\n\na <span class="token operator">=</span> Child<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">.</span>_value<span class="token punctuation">}</span></span><span class="token string"> should be different\'</span></span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果超类属于开放给外界使用的 API，那么你就没办法预料哪些子类会继承它，也不知道那些子类会添加什么属性，此时很有可能出现这个问题，而且你无法通过重构代码来解决。属性名越常见（如本例中的 value），越容易发生冲突。为了减少冲突，我们可以把超类的属性设计成 private 属性，使子类的属性名不太可能与超类重复。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8699807819558502000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ApiClass:\n    def __init__(self):\n        self.__value = 5  # Double underscore\n\n    def get(self):\n        return self.__value  # Double underscore\n\n\nclass Child(ApiClass):\n    def __init__(self):\n        super().__init__()\n        self._value = \'hello\'  # OK!\n\n\na = Child()\nprint(f\'{a.get()} and {a._value} are different\')`, `8699807819558502000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ApiClass</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__value <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># Double underscore</span>\n\n    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__value  <span class="token comment"># Double underscore</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>ApiClass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>_value <span class="token operator">=</span> <span class="token string">\'hello\'</span>  <span class="token comment"># OK!</span>\n\n\na <span class="token operator">=</span> Child<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">.</span>_value<span class="token punctuation">}</span></span><span class="token string"> are different\'</span></span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="总结-38"><a href="#%E6%80%BB%E7%BB%93-38" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>Python 编译器无法绝对禁止外界访问 private 属性。</li>\n<li>从一开始就应该考虑允许其他类能继承这个类，并利用其中的内部 API 与属性去实现更多功能，而不是把它们藏起来。</li>\n<li>把需要保护的数据设计成 protected 字段，并用文档加以解释，而不要通过 private 属性限制访问。</li>\n<li>只有在子类不受控制且名称有可能与超类冲突时，才可以考虑给超类设计 private 属性。</li>\n</ol>\n<h2 id="第-43-条：自定义的容器类型应该从-collectionsabc-继承"><a href="#%E7%AC%AC-43-%E6%9D%A1%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AE%B9%E5%99%A8%E7%B1%BB%E5%9E%8B%E5%BA%94%E8%AF%A5%E4%BB%8E-collectionsabc-%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第 43 条：自定义的容器类型应该从 collections.abc 继承</h2>\n<p>编写 Python 程序时，要花很多精力来定义类，以存放数据并描述这种对象与其他对象之间的关系。每个 Python 类其实都是某种容器，可以把属性与功能封装进来。除了自定义的类之外，Python 本身还提供了一些内置的容器类型，例如列表（list）、元组（tuple）、集合（set）、字典（dict）等，也可以用来管理数据。</p>\n<p>如果要定义的是那种用法比较简单的类，那么我们自然就会想到直接从 Python 内置的容器类型里面继承，例如通过继承 list 类型实现某种序列。下面就是笔者自己定制的一种 list 类型，它在 list 的基础上提供了 frequency 方法，用来计算每个元素出现的次数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54444670518686740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class FrequencyList(list):\n    def __init__(self, members):\n        super().__init__(members)\n\n    def frequency(self):\n        counts = {}\n        for item in self:\n            counts[item] = counts.get(item, 0) + 1\n        return counts`, `54444670518686740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">FrequencyList</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> members<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>members<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">frequency</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        counts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">for</span> item <span class="token keyword">in</span> self<span class="token punctuation">:</span>\n            counts<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> counts<span class="token punctuation">.</span>get<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> counts</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>继承 list 类，可以自动获得标准的 Python 列表所具备的各项功能。这样的话，其他开发者就可以像使用普通列表那样使用 FrequencyList 了。此外，我们还可以定义其他一些方法，来提供想要实现的各种行为。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64295309502802560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class FrequencyList(list):\n    def __init__(self, members):\n        super().__init__(members)\n\n    def frequency(self):\n        counts = {}\n        for item in self:\n            counts[item] = counts.get(item, 0) + 1\n        return counts\n\n\nfoo = FrequencyList([\'a\', \'b\', \'a\', \'c\', \'b\', \'a\', \'d\'])\nprint(\'Length is\', len(foo))\n\nprint(foo.pop())\nprint(\'After pop:\', repr(foo))\nprint(\'Frequency:\', foo.frequency())\n\n>>>\nLength is 7\nd\nAfter pop: [\'a\', \'b\', \'a\', \'c\', \'b\', \'a\']\nFrequency: {\'a\': 3, \'b\': 2, \'c\': 1}`, `64295309502802560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{12-17}"\n              >\n                <span class="gatsby-code-button-language">py{12-17}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">FrequencyList</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> members<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>members<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">frequency</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        counts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">for</span> item <span class="token keyword">in</span> self<span class="token punctuation">:</span>\n            counts<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> counts<span class="token punctuation">.</span>get<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token keyword">return</span> counts\n\n\n<span class="gatsby-highlight-code-line">foo <span class="token operator">=</span> FrequencyList<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Length is\'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'After pop:\'</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Frequency:\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">.</span>frequency<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n<span class="token operator">>></span><span class="token operator">></span>\nLength <span class="token keyword">is</span> <span class="token number">7</span>\nd\nAfter pop<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">]</span>\nFrequency<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'a\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有的时候，某个对象所属的类本身虽然不是 list 的子类，但我们还是想让它能像 list 那样，可以通过下标来访问。例如，下面这个表示二叉树节点的 BinaryNode 类就不是 list 的子类，但我们想让它能够像序列（list 或 tuple 等）那样，通过下标来访问。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66994994353953100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class BinaryNode:\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right`, `66994994353953100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">BinaryNode</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们需要怎么做，才能让这个类可以像序列一样访问呢？答案是，需要实现一些名称特殊的实例方法。当通过下标访问序列中的元素时：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77462026615328880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`bar = [1, 2, 3]\nbar[0]`, `77462026615328880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">bar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>\nbar<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>Python 会把访问操作解读为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74949036801674900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`bar.__getitem__(0)`, `74949036801674900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">bar<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>所以，为了让 BinaryNode 类能像序列那样使用，我们可以定义 <code class="language-text">__getitem__</code> 方法（一般叫作 dunder getitem，其中的 dunder 为 double underscore（双下划线）的简称）。这个方法可以按照深度优先的方式遍历 BinaryNode 对象所表示的二叉树。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42409128939203880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class BinaryNode:\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right\n\n\nclass IndexableNode(BinaryNode):\n    def _traverse(self):\n        if self.left is not None:\n            yield from self.left._traverse()\n        yield self\n        if self.right is not None:\n            yield from self.right._traverse()\n\n    def __getitem__(self, index):\n        for i, item in enumerate(self._traverse()):\n            if i == index:\n                return item.value\n        raise IndexError(f\'Index {index} is out of range\')\n\n\ntree = IndexableNode(\n    10,\n    left=IndexableNode(\n        5,\n        left=IndexableNode(2),\n        right=IndexableNode(\n            6,\n            right=IndexableNode(7))),\n    right=IndexableNode(\n        15,\n        left=IndexableNode(11)))\n\nprint(\'LRR is\', tree.left.right.right.value)\nprint(\'Index 0 is\', tree[0])\nprint(\'Index 1 is\', tree[1])\nprint(\'11 in the tree?\', 11 in tree)\nprint(\'17 in the tree?\', 17 in tree)\nprint(\'Tree is\', list(tree))\n\n>>>\nLRR is 7\nIndex 0 is 2\nIndex 1 is 5\n11 in the tree? True\n17 in the tree? False\nTree is [2, 5, 6, 7, 10, 11, 15]`, `42409128939203880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">BinaryNode</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right\n\n\n<span class="token keyword">class</span> <span class="token class-name">IndexableNode</span><span class="token punctuation">(</span>BinaryNode<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">yield</span> self\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">if</span> i <span class="token operator">==</span> index<span class="token punctuation">:</span>\n                <span class="token keyword">return</span> item<span class="token punctuation">.</span>value\n        <span class="token keyword">raise</span> IndexError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Index </span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string"> is out of range\'</span></span><span class="token punctuation">)</span>\n\n\ntree <span class="token operator">=</span> IndexableNode<span class="token punctuation">(</span>\n    <span class="token number">10</span><span class="token punctuation">,</span>\n    left<span class="token operator">=</span>IndexableNode<span class="token punctuation">(</span>\n        <span class="token number">5</span><span class="token punctuation">,</span>\n        left<span class="token operator">=</span>IndexableNode<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        right<span class="token operator">=</span>IndexableNode<span class="token punctuation">(</span>\n            <span class="token number">6</span><span class="token punctuation">,</span>\n            right<span class="token operator">=</span>IndexableNode<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    right<span class="token operator">=</span>IndexableNode<span class="token punctuation">(</span>\n        <span class="token number">15</span><span class="token punctuation">,</span>\n        left<span class="token operator">=</span>IndexableNode<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'LRR is\'</span><span class="token punctuation">,</span> tree<span class="token punctuation">.</span>left<span class="token punctuation">.</span>right<span class="token punctuation">.</span>right<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Index 0 is\'</span><span class="token punctuation">,</span> tree<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Index 1 is\'</span><span class="token punctuation">,</span> tree<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'11 in the tree?\'</span><span class="token punctuation">,</span> <span class="token number">11</span> <span class="token keyword">in</span> tree<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'17 in the tree?\'</span><span class="token punctuation">,</span> <span class="token number">17</span> <span class="token keyword">in</span> tree<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Tree is\'</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nLRR <span class="token keyword">is</span> <span class="token number">7</span>\nIndex <span class="token number">0</span> <span class="token keyword">is</span> <span class="token number">2</span>\nIndex <span class="token number">1</span> <span class="token keyword">is</span> <span class="token number">5</span>\n<span class="token number">11</span> <span class="token keyword">in</span> the tree? <span class="token boolean">True</span>\n<span class="token number">17</span> <span class="token keyword">in</span> the tree? <span class="token boolean">False</span>\nTree <span class="token keyword">is</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以像使用 BinaryNode 那样，用这种定制过的 IndexableNode 对象来构造二叉树。</p>\n<p>我们既可以像访问列表那样来访问二叉树中的节点，也可以明确通过 left 与 right 属性来访问。</p>\n<p>但问题是，除了下标索引，list 实例还支持其他一些功能，所以只实现 <code class="language-text">__getitem__</code> 这样一个特殊方法是不够的。例如，我们现在还是没办法像查询 list 长度那样查询这种二叉树的长度（元素总数）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72775579458644615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`len(tree)\n\n>>>\nTraceback ...\nTypeError: object of type \'IndexableNode\' has no len()`, `72775579458644615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token builtin">len</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> <span class="token builtin">object</span> of <span class="token builtin">type</span> <span class="token string">\'IndexableNode\'</span> has no <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要想让定制的二叉树支持内置的 len 函数，必须再实现一个特殊方法，也就是 <code class="language-text">__len__</code> 方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39295648848866050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class BinaryNode:\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right\n\n\nclass SequenceNode(BinaryNode):\n    def _traverse(self):\n        if self.left is not None:\n            yield from self.left._traverse()\n        yield self\n        if self.right is not None:\n            yield from self.right._traverse()\n\n    def __getitem__(self, index):\n        for i, item in enumerate(self._traverse()):\n            if i == index:\n                return item.value\n        raise IndexError(f\'Index {index} is out of range\')\n\n    def __len__(self):\n        for count, _ in enumerate(self._traverse(), 1):\n            pass\n        return count\n\n\ntree = SequenceNode(\n    10,\n    left=SequenceNode(\n        5,\n        left=SequenceNode(2),\n        right=SequenceNode(\n            6,\n            right=SequenceNode(7))),\n    right=SequenceNode(\n        15,\n        left=SequenceNode(11)))\n\nprint(\'Tree length is\', len(tree))\n\n>>>\nTree length is 7`, `39295648848866050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py{22-25}"\n              >\n                <span class="gatsby-code-button-language">py{22-25}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">BinaryNode</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right\n\n\n<span class="token keyword">class</span> <span class="token class-name">SequenceNode</span><span class="token punctuation">(</span>BinaryNode<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">yield</span> self\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">if</span> i <span class="token operator">==</span> index<span class="token punctuation">:</span>\n                <span class="token keyword">return</span> item<span class="token punctuation">.</span>value\n        <span class="token keyword">raise</span> IndexError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Index </span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string"> is out of range\'</span></span><span class="token punctuation">)</span>\n\n<span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">for</span> count<span class="token punctuation">,</span> _ <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">            <span class="token keyword">pass</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> count</span>\n\ntree <span class="token operator">=</span> SequenceNode<span class="token punctuation">(</span>\n    <span class="token number">10</span><span class="token punctuation">,</span>\n    left<span class="token operator">=</span>SequenceNode<span class="token punctuation">(</span>\n        <span class="token number">5</span><span class="token punctuation">,</span>\n        left<span class="token operator">=</span>SequenceNode<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        right<span class="token operator">=</span>SequenceNode<span class="token punctuation">(</span>\n            <span class="token number">6</span><span class="token punctuation">,</span>\n            right<span class="token operator">=</span>SequenceNode<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    right<span class="token operator">=</span>SequenceNode<span class="token punctuation">(</span>\n        <span class="token number">15</span><span class="token punctuation">,</span>\n        left<span class="token operator">=</span>SequenceNode<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Tree length is\'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTree length <span class="token keyword">is</span> <span class="token number">7</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实现完这样两个方法之后，我们仍然没办法让这种二叉树具备列表所应支持的全套功能。因为，有些 Python 开发者可能还想在二叉树上面调用 count 与 index 等方法，他们觉得，既然 list 或 tuple 这样的序列支持这些方法，那二叉树也应该支持才对。这样看来，要定制一个与标准容器兼容的类，似乎比想象中麻烦。</p>\n<p>为了方便大家定制容器，Python 内置的 collections.abc 模块定义了一系列抽象基类（abstract base class），把每种容器类型应该提供的所有常用方法都写了出来。我们只需要从这样的抽象基类里面继承就好。同时，如果忘了实现某些必备的方法，那么程序会报错，提醒我们这些方法必须实现。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62675297542832740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections.abc import Sequence\n\n\nclass BadType(Sequence):\n    pass\n\n\nfoo = BadType()\n\n>>>\nTraceback ...\nTypeError: Can\'t instantiate abstract class BadType with abstract methods __getitem__, __len__`, `62675297542832740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Sequence\n\n\n<span class="token keyword">class</span> <span class="token class-name">BadType</span><span class="token punctuation">(</span>Sequence<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\nfoo <span class="token operator">=</span> BadType<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nTraceback <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTypeError<span class="token punctuation">:</span> Can\'t instantiate abstract <span class="token keyword">class</span> <span class="token class-name">BadType</span> <span class="token keyword">with</span> abstract methods __getitem__<span class="token punctuation">,</span> __len__</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果这些必备的方法都已经实现好了，那我们就可以从 collections.abc 模块的抽象基类里面继承了。例如，下面这个 BetterNode 二叉树类就是正确的，因为它已经通过继承前面的 SequenceNode 类实现了序列容器所应支持的全部必备方法，至于其他一些方法（例如 index 与 count）则会由 Sequence 这个抽象基类自动帮我们实现（它在实现的时候，会借助 BetterNode 从 SequenceNode 继承的那些必备方法）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14886201566419600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from collections.abc import Sequence\n\n\nclass BinaryNode:\n    def __init__(self, value, left=None, right=None):\n        self.value = value\n        self.left = left\n        self.right = right\n\n\nclass SequenceNode(BinaryNode):\n    def _traverse(self):\n        if self.left is not None:\n            yield from self.left._traverse()\n        yield self\n        if self.right is not None:\n            yield from self.right._traverse()\n\n    def __getitem__(self, index):\n        for i, item in enumerate(self._traverse()):\n            if i == index:\n                return item.value\n        raise IndexError(f\'Index {index} is out of range\')\n\n    def __len__(self):\n        for count, _ in enumerate(self._traverse(), 1):\n            pass\n        return count\n\n\nclass BetterNode(SequenceNode, Sequence):\n    pass\n\n\ntree = BetterNode(\n    10,\n    left=BetterNode(\n        5,\n        left=BetterNode(2),\n        right=BetterNode(\n            6,\n            right=BetterNode(7))),\n    right=BetterNode(\n        15,\n        left=BetterNode(11))\n)\n\nprint(\'Index of 7 is\', tree.index(7))\nprint(\'Count of 10 is\', tree.count(10))\n\n>>>\nIndex of 7 is 3\nCount of 10 is 1`, `14886201566419600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Sequence\n\n\n<span class="token keyword">class</span> <span class="token class-name">BinaryNode</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        self<span class="token punctuation">.</span>left <span class="token operator">=</span> left\n        self<span class="token punctuation">.</span>right <span class="token operator">=</span> right\n\n\n<span class="token keyword">class</span> <span class="token class-name">SequenceNode</span><span class="token punctuation">(</span>BinaryNode<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">yield</span> self\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">if</span> i <span class="token operator">==</span> index<span class="token punctuation">:</span>\n                <span class="token keyword">return</span> item<span class="token punctuation">.</span>value\n        <span class="token keyword">raise</span> IndexError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'Index </span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string"> is out of range\'</span></span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> count<span class="token punctuation">,</span> _ <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_traverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">pass</span>\n        <span class="token keyword">return</span> count\n\n\n<span class="token keyword">class</span> <span class="token class-name">BetterNode</span><span class="token punctuation">(</span>SequenceNode<span class="token punctuation">,</span> Sequence<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\ntree <span class="token operator">=</span> BetterNode<span class="token punctuation">(</span>\n    <span class="token number">10</span><span class="token punctuation">,</span>\n    left<span class="token operator">=</span>BetterNode<span class="token punctuation">(</span>\n        <span class="token number">5</span><span class="token punctuation">,</span>\n        left<span class="token operator">=</span>BetterNode<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        right<span class="token operator">=</span>BetterNode<span class="token punctuation">(</span>\n            <span class="token number">6</span><span class="token punctuation">,</span>\n            right<span class="token operator">=</span>BetterNode<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    right<span class="token operator">=</span>BetterNode<span class="token punctuation">(</span>\n        <span class="token number">15</span><span class="token punctuation">,</span>\n        left<span class="token operator">=</span>BetterNode<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Index of 7 is\'</span><span class="token punctuation">,</span> tree<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Count of 10 is\'</span><span class="token punctuation">,</span> tree<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span>\nIndex of <span class="token number">7</span> <span class="token keyword">is</span> <span class="token number">3</span>\nCount of <span class="token number">10</span> <span class="token keyword">is</span> <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于定制集合或可变映射等复杂的容器类型来说，继承 collections.abc 模块里的 Set 或 MutableMapping 等抽象基类所带来的好处会更加明显。假如自己从头开始实现，那必须编写大量的特殊方法才能让这些容器类的对象也能像标准的 Python 容器那样使用。</p>\n<p>collections.abc 模块要求子类必须实现某些特殊方法，另外，Python 在比较或排列对象时，还会用到其他一些特殊方法，无论定制的是不是容器类，有时为了支持某些功能，你都必须定义相关的特殊方法才行（案例参见第 73 条）。</p>\n<h3 id="总结-39"><a href="#%E6%80%BB%E7%BB%93-39" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>如果要编写的新类比较简单，那么可以直接从 Python 的容器类型（例如 list 或 dict）里面继承。</li>\n<li>如果想让定制的容器类型能像标准的 Python 容器那样使用，那么有可能要编写许多特殊方法。</li>\n<li>可以从 collections.abc 模块里的抽象基类之中派生自己的容器类型，这样可以让容器自动具备相关的功能，同时又可以保证没有把实现这些功能所必备的方法给漏掉。</li>\n</ol>\n<p>// TODO 编写高质量 Python 待完成</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/编写高质量Python/index.md absPath of file >>> MarkdownRemark",timeToRead:123,frontmatter:{date:"2022-10-12 14:46:04",path:"/writing-high-quality-python/",tags:"后端, python, 读书笔记",title:"编写高质量Python",draft:null}},{excerpt:"源码结构 重点介绍标红行的内容 对象模型 概述 Python 是一门面向对象语言，实现了一个完整的面向对象体系，简洁而优雅。 一切皆对象 首先，在 Python 世界，基本类型也是对象，与通常意义的“对象”形成一个有机统一。换句话讲，Python 不再区别对待基本类型和对象，所有基本类型内部均由对象实现。一个整数是一个对象，一个字符串也是一个对象： 其次，Python 中的类型也是一种对象，称为类型对象。整数类型是一个对象，字符串类型是一个对象，程序中通过 class…",html:'<h1 id="源码结构"><a href="#%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>源码结构</h1>\n<p>重点介绍标红行的内容</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99499424119227740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ cd Python-3.7.4\n\\$ tree -L 1\n.\n├── CODE_OF_CONDUCT.rst\n├── Doc # 文档相关\n├── Grammar # 语法规则\n├── Include # 头文件\n├── LICENSE\n├── Lib # 标准库\n├── Mac\n├── Makefile.pre.in\n├── Misc\n├── Modules\n├── Objects # 内建对象实现\n├── PC\n├── PCbuild\n├── Parser # 语法分析相关\n├── Programs\n├── Python # 虚拟机执行相关\n├── README.rst\n├── Tools\n├── aclocal.m4\n├── config.guess\n├── config.sub\n├── configure\n├── configure.ac\n├── install-sh\n├── m4\n├── pyconfig.h.in\n└── setup.py`, `99499424119227740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{7,14,19}"\n              >\n                <span class="gatsby-code-button-language">bash{7,14,19}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token builtin class-name">cd</span> Python-3.7.4\n$ tree -L <span class="token number">1</span>\n<span class="token builtin class-name">.</span>\n├── CODE_OF_CONDUCT.rst\n├── Doc <span class="token comment"># 文档相关</span>\n├── Grammar <span class="token comment"># 语法规则</span>\n<span class="gatsby-highlight-code-line">├── Include <span class="token comment"># 头文件</span></span>├── LICENSE\n├── Lib <span class="token comment"># 标准库</span>\n├── Mac\n├── Makefile.pre.in\n├── Misc\n├── Modules\n<span class="gatsby-highlight-code-line">├── Objects <span class="token comment"># 内建对象实现</span></span>├── PC\n├── PCbuild\n├── Parser <span class="token comment"># 语法分析相关</span>\n├── Programs\n<span class="gatsby-highlight-code-line">├── Python <span class="token comment"># 虚拟机执行相关</span></span>├── README.rst\n├── Tools\n├── aclocal.m4\n├── config.guess\n├── config.sub\n├── configure\n├── configure.ac\n├── install-sh\n├── m4\n├── pyconfig.h.in\n└── setup.py</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="对象模型"><a href="#%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对象模型</h1>\n<h2 id="概述"><a href="#%E6%A6%82%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>概述</h2>\n<p>Python 是一门面向对象语言，实现了一个完整的面向对象体系，简洁而优雅。</p>\n<h3 id="一切皆对象"><a href="#%E4%B8%80%E5%88%87%E7%9A%86%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一切皆对象</h3>\n<p>首先，在 Python 世界，基本类型也是对象，与通常意义的“对象”形成一个有机统一。换句话讲，Python 不再区别对待基本类型和对象，所有基本类型内部均由对象实现。一个整数是一个对象，一个字符串也是一个对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85618834098303550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = 1\n>>> b = \'abc\'`, `85618834098303550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> <span class="token string">\'abc\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>其次，Python 中的类型也是一种对象，称为类型对象。整数类型是一个对象，字符串类型是一个对象，程序中通过 class 关键字定义的类也是一个对象。</p>\n<p>举个例子，整数类型在 Python 内部是一个对象，称为类型对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34729721751990338000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> int\n<class \'int\'>`, `34729721751990338000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> int\n<span class="token operator">&lt;</span>class <span class="token string">\'int\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>通过整数类型实例化可以得到一个整数对象，称为实例对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86972166548086110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> int(\'1024\')\n1024`, `86972166548086110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> int<span class="token punctuation">(</span><span class="token string">\'1024\'</span><span class="token punctuation">)</span>\n<span class="token number">1024</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>面向对象理论中的“类”和“对象”这两个基本概念，在 Python 内部都是通过对象实现的，这是 Python 最大的特点。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-06-58-cfca5e9f930b12991d1d8c14a4274a22-eca56.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 554px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.87725631768953%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABP0lEQVQY022R207DMAyG+95c8RJcIyEkXmAIAUIDjZsVEEyo2lZYtR7XLV1b2qaJGyek7TSOVi5s2f5tfzGUUlJ+vb19c9sKgY2UuAt2jjLUH0OpBLY6frT2o7hg6McZ5RCR+fDh9MW+AcGE1FrS0FWUYQ2ScllD2zQPirtJuMq4v0rcKKk4BqSkXHjx6/X42LQGjWC7ye6mNu3UnJFHO3la5EUtKi5IziigG22X4VZ0OzYIiKJfm0Fpe+Y2D41pUN1b64uxc/vsj+dpWjY9hZ8nY3+n7BIFTc4uD63FyNCjnLj2CFtumBNTfe2eVl7WXkRkx6uq05C8kcxHKQTyf4Bp4UYoJ66uTGcaFN66sJcxAOiU3vPk/GAwOtLYdXMHvwP265/SEt7DLCkgSsrJzLVs94NWiMCAQtOiEgh95SeK+sak83RjOQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 06 58" title="" data-src="/static/2022-09-26-14-06-58-cfca5e9f930b12991d1d8c14a4274a22-eca56.png" data-srcset="/static/2022-09-26-14-06-58-cfca5e9f930b12991d1d8c14a4274a22-77254.png 200w,\n/static/2022-09-26-14-06-58-cfca5e9f930b12991d1d8c14a4274a22-789d0.png 400w,\n/static/2022-09-26-14-06-58-cfca5e9f930b12991d1d8c14a4274a22-eca56.png 554w" data-sizes="(max-width: 554px) 100vw, 554px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="类型、对象体系"><a href="#%E7%B1%BB%E5%9E%8B%E3%80%81%E5%AF%B9%E8%B1%A1%E4%BD%93%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类型、对象体系</h3>\n<p>a 是一个整数对象（实例对象），其类型是整数类型（类型对象）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39626644444530390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = 1\n>>> type(a)\n<class \'int\'>\n>>> isinstance(a, int)\nTrue`, `39626644444530390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'int\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> isinstance<span class="token punctuation">(</span>a, int<span class="token punctuation">)</span>\nTrue</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么整数类型的类型又是什么呢？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77973410565743180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> type(int)\n<class \'type\'>`, `77973410565743180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>int<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'type\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>可以看到，整数类型的类型还是一种类型，即类型的类型。只是这个类型比较特殊，它的实例对象还是类型对象。</p>\n<p>Python 中还有一个特殊类型 object，所有其他类型均继承于 object，换句话讲 object 是所有类型的基类：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95243758772781800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> issubclass(int, object)\nTrue`, `95243758772781800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> issubclass<span class="token punctuation">(</span>int, object<span class="token punctuation">)</span>\nTrue</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>综合以上关系，得到以下关系图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-27-03-d003b10d203dbb41db1f5dfa1040a0c0-88eb7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 411px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.65936739659367%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABX0lEQVQoz5WQ20vCABTG9//3Ug8RRfSQhEEUFWmEJWQXTZrXbTWrLeduLltq0dX5a1MkU3rogw8OHM7vnPMJlmWTTqfJ5XK0Wi0m1TAMUqkU+Xyedrs91Q+CAEmSB/Pd7jNCRkmQVrY4lDbJSEm+vnrIsoyqqjz5PgeFGtuixvblHUnxhk4I1XWdcrnE69sHVvWIpriBW9jEFHcQktIq6xdzxEMnyrHwykds28bzPCqlImunCkundywcq8Tz+mCZaZq4rkPtVse8iNM8nkU7mMHLLiNcG2VUK3KJWkOaeumq7lDUbEqag1J3cRwHI4xhpI57SydkdM0qj/UqwiSg3+//8qSidyP7YRwD4Ms7Nd1CazRxHp4QolDHPQ6J6iD4cS/sjxTle39f56qQQT7bRcnuUc3uT1/4l0aLxpe+f/bw5QTuyTze+RK+uPY/4Ag0rIfXupUkZmYRJ7uCcR7jG2PNUfvdx+1RAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 27 03" title="" data-src="/static/2022-09-26-14-27-03-d003b10d203dbb41db1f5dfa1040a0c0-88eb7.png" data-srcset="/static/2022-09-26-14-27-03-d003b10d203dbb41db1f5dfa1040a0c0-e0906.png 200w,\n/static/2022-09-26-14-27-03-d003b10d203dbb41db1f5dfa1040a0c0-4c29a.png 400w,\n/static/2022-09-26-14-27-03-d003b10d203dbb41db1f5dfa1040a0c0-88eb7.png 411w" data-sizes="(max-width: 411px) 100vw, 411px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>内置类型已经搞清楚了，自定义类型及对象关系又如何呢？定义一个简单的类来实验：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60414057138589100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Dog(object):\n\n    def yelp(self):\n        print(\'woof\')`, `60414057138589100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">yelp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'woof\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>创建一个 Dog 实例，毫无疑问，其类型是 Dog：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94522193637371530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> dog = Dog()\n>>> dog.yelp()\nwoof\n>>> type(dog)\n<class \'__main__.Dog\'>`, `94522193637371530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> dog <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> dog.yelp<span class="token punctuation">(</span><span class="token punctuation">)</span>\nwoof\n<span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>dog<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'__main__.Dog\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Dog 类的类型自然也是 type，其基类是 object (就算不显式继承也是如此)：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64696857020465150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> type(Dog)\n<class \'type\'>\n>>> issubclass(Dog, object)\nTrue`, `64696857020465150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>Dog<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'type\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> issubclass<span class="token punctuation">(</span>Dog, object<span class="token punctuation">)</span>\nTrue</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-31-23-001ef654f1c6a7054988e658d131dffa-6a9ea.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 413px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.847457627118644%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACEUlEQVQoz3WS7U/TYBTF+//7xQ+IHyTxg+9ANAhEWEGYTDY69wYtVtaOrls327Vso5vt6NjPpzUahXiTm9z0pOfec84jDfwB8p5MsVSk/73P3bKsNru5nMBLjMfje/gsjtHUM0rFY+IoQioZMvv6OrL6hgNtg8lkShRHxLMZvueyUzd5W7VYL7fYbVgZ6UxgsSBKZ6e6yaDyGq+6inn0DKnQes96ZZlVZYkd9QWu6xEEAVfDIdpZgzXFYOWzyUrBYOPUQdM0ut0uYRiytbVF6/AJXmEZJ79EN7+M1L+ycUMbb9LBCax7krr+GCuYYF/9EHjIYrHIFg7FwtFoxDSwSYZt5uMOo34TaZGA1/OxjA7T6ygjub29zTqtRSKk9x1MXSOehtk313UxDCObe27A12abunqBP5wgNcwSn9QPHIk+OT/857qFIK2ZHT6eNpFrOlUxp94OBgPG19eYpomu7GB9EdLLm+jFTeHh5QbvGo9ZqwgPz5/T6/XxPA/fD6iUFba1Dq/qNi9FMPutAFVV6TlO5rGu69iFp1i5B8LHR1zKD5FqrWNKTZnjb7uc6AfM5/M/cpObG8pNm6OLLnm9TaXlZB7+tiVJEhwtT6++javmMBVx4d0QFvz6IX0SURTfCykNIiX6X0npxr87rRtxWa1Wy4x3nF52TYqkb1RRFGzbzlJO1YTCy9FoKJL3mU4n/AT3NN2N5kFDZwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 31 23" title="" data-src="/static/2022-09-26-14-31-23-001ef654f1c6a7054988e658d131dffa-6a9ea.png" data-srcset="/static/2022-09-26-14-31-23-001ef654f1c6a7054988e658d131dffa-7efe1.png 200w,\n/static/2022-09-26-14-31-23-001ef654f1c6a7054988e658d131dffa-33ab6.png 400w,\n/static/2022-09-26-14-31-23-001ef654f1c6a7054988e658d131dffa-6a9ea.png 413w" data-sizes="(max-width: 413px) 100vw, 413px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>自定义子类及实例对象在图中又处于什么位置？定义一个猎犬类进行实验：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85298813516730810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Sleuth(Dog):\n\n    def hunt(self):\n        pass`, `85298813516730810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Sleuth</span><span class="token punctuation">(</span>Dog<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">hunt</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，猎犬对象(sleuth)是猎犬类(Sleuth)的实例，Sleuth 的类型同样是 type：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73934063917340430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> sleuth = Sleuth()\n>>> sleuth.hunt()\n>>> type(sleuth)\n<class \'__main__.Sleuth\'>\n>>> type(Sleuth)\n<class \'type\'>`, `73934063917340430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> sleuth <span class="token operator">=</span> Sleuth<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> sleuth.hunt<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>sleuth<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'__main__.Sleuth\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>Sleuth<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'type\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同时，Sleuth 类继承自 Dog 类，是 Dog 的子类，当然也是 object 的子类：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92722320163384150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> issubclass(Sleuth, Dog)\nTrue\n>>> issubclass(Sleuth, object)\nTrue`, `92722320163384150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> issubclass<span class="token punctuation">(</span>Sleuth, Dog<span class="token punctuation">)</span>\nTrue\n<span class="token operator">>></span><span class="token operator">></span> issubclass<span class="token punctuation">(</span>Sleuth, object<span class="token punctuation">)</span>\nTrue</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-34-40-b3d92d6a1012d777104d5533b3e6464e-88eb7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 411px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.82968369829685%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACxklEQVQ4y3WU62/aSBTF/f9/qrRbrZrNt6rpqi1NqnbzaMijaVMIEIMXAzEPm0dsXsa8DcbAr+ORUnWT3SsdjT1z59x7z9wZpdPucHFxSeomhTfweGytZpOzeJxMOs14NHqyvgrXFEt3JBJJZnMf5VvxiHN9nzP9PVf5Ixb+giAIWK1WIoBLPFfhIF0VqHCaqzGZTAjDkOVyyVz42vkz2rcx2uo+9dQ+ymdjj7e3vwv8xt/aS9y+y3A4lBv/yWV5kzLZTTbYuTZ5l7PRdZ1ut8t8Pufq6zW1yz8ZJZ7jXD6j9/0FSsXRMd2CRMUuPCnJsPvk7wcU7KH4HsjsPc+ThJFUjVKKoFfCb+t4DQ1lE8CwN8FpdlkHW0my2WwkpIUBY7eL0zBZziZyKiJUVVXKMpwsKFs2Rq1Fxx2jaOUU11qcK/UErZx+kqFutfiSLXKeyZOr1GUg13UxDIPW/T0l9Ypi8pCCQCl9hnJefcNHfZePhV2O83s4Tpter8dAZHErTvao2OJ9sUNMd4jXXDRNwzRNarUad0aZ+5vX9L49Z5DcoX29g5KonvDFOOC8FCNR/ky4CmUW2+2WyXhE0uxwLEgP83WS9b483fF4LLHebOnop7TTf9HPxWil3qEs/YBgsWIpMB3PJFFkD+MmXOGI0pp1C38++6lhpJ+UeL0lFMRyXG9Q7solND1H0dC5SSefaFiz6txkVBKpDBk1y2KxoN/v/yvor6ZEDX2i73GsvxKNG5OlTKdTZrMZdcvkNG/yQbM4yFlcGDZNcXOish8IH0M5zr9iP/uCmPoHn25fCsKJJIxug2XW+KSZvFYt9sRtOSy0ZKCH1vovUqXj2fRGNt0InvMz9ag1fNG83synPZzSGU2F3xTbtvF9//9LfjwROUU6Re1RrVbF49CIZuXacuGTzWZpNBpSx/V6zUg8GIPBQP5Hcv0A338E+PnREMsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 34 40" title="" data-src="/static/2022-09-26-14-34-40-b3d92d6a1012d777104d5533b3e6464e-88eb7.png" data-srcset="/static/2022-09-26-14-34-40-b3d92d6a1012d777104d5533b3e6464e-e0906.png 200w,\n/static/2022-09-26-14-34-40-b3d92d6a1012d777104d5533b3e6464e-4c29a.png 400w,\n/static/2022-09-26-14-34-40-b3d92d6a1012d777104d5533b3e6464e-88eb7.png 411w" data-sizes="(max-width: 411px) 100vw, 411px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>现在不可避免需要讨论 type 以及 object 这两个特殊的类型。</p>\n<p>理论上，object 是所有类型的基类，本质上是一种类型，因此其类型必然是 type。而 type 是所有类型的类型，本质上也是一种类型，因此其类型必须是它自己！</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75341684272667670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> type(object)\n<class \'type\'>\n>>> type(object) is type\nTrue`, `75341684272667670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>object<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'type\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>object<span class="token punctuation">)</span> is <span class="token builtin class-name">type</span>\nTrue</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43689213610206970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> type(type)\n<class \'type\'>\n>>> type(type) is type\nTrue`, `43689213610206970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>type<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>class <span class="token string">\'type\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>type<span class="token punctuation">)</span> is <span class="token builtin class-name">type</span>\nTrue</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外，由于 object 是所有类型的基类，理论上也是 type 的基类(<code class="language-text">__base__</code> 属性)：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93819090461857700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> issubclass(type, object)\nTrue\n>>> type.__base__\n<class \'object\'>`, `93819090461857700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> issubclass<span class="token punctuation">(</span>type, object<span class="token punctuation">)</span>\nTrue\n<span class="token operator">>></span><span class="token operator">></span> type.__base__\n<span class="token operator">&lt;</span>class <span class="token string">\'object\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是 object 自身便不能有基类了。为什么呢？对于存在继承关系的类，成员属性和成员方法查找需要回溯继承链，不断查找基类。因此，继承链必须有一个终点，不然就死循环了。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-39-00-0dbb7a586e3c39186f9c3f19df34840b-9e231.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 444px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACoElEQVQ4y22TW2/bRhBG+f8fA7RBihh9SGKkhmo4jes6TerEdqqIlawLRVuyJVO8iJR4E0lRlqjr6YotDDvJAAPsfuB+O3N2KAVBQLH4N9XqBWma8jCWyyXlcpkvpRKmafJ1zGYzmk2FdruVr+fzOVKp84Gj+iuOGi8ptf8im82ZLxaslguUmx57cpfXxTb7FQ3HC1mvVizERZPJBLv2Frv0Arf8CuX8gIaiCkP9HW8az3nb3OG8fUToj4iThFHgcyLX+KU+ZOdMGKoeSquDZRpMRTWFQgH9/GdCeQe/+Ix+45iOpiOFiUcwHuLFNqMkeNRStlhiBxGDKMX2I9YbGIvLhsMh9XqdyLPpXl7g9K5YTMdCd5Em6QS9Z3CpXrFdfx19y6SpNLAMPd9vW61Wqzlfw+xzevYZ+Z8KyTjF932kC+2UP5U93qt7lG9OmU0zMgF3Mc9o90yOVYPDWoeTaxvb9Rk4tnggC1VV6X7ZxyrtCo67WOo5hmUjyeYx+7VnHCg/8fn6dzw3IIojAs/jtFLnsBOyK1/zTotoa0ZuaFl9HFsYF19gnjwhKD7lVj5gFKdIXjwgmDi4iUWQuN8wNAW7S83CGY1zbTq9I8uyfJ2GNtPQ4M7XuUv8XJO8oY+umWhdnZ6mPzKci4P6bRelVqV9qeZzGoYhKzE6m83mG95bTSp3PvFeKfCh+Svy1af/GWbCbEZLtPhHvcvhxbVg3MN0BqTj8f3hzWb9IMV+W+FZ5zcK1R9F/sBH9Y2Yv0i82Jg0iXOGr6s9Xso3FBomThjlZuv1+oHp45QGI4t+eIsl0h3Z9+VHUUS2XGGNUowgwYnv8IJQMJzem30vpO9xcF2XSqVCu9UiDv8b9vX2V1QUWkKzbfu+0jiO8++32pbvv0YbvajiQ91/AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 39 00" title="" data-src="/static/2022-09-26-14-39-00-0dbb7a586e3c39186f9c3f19df34840b-9e231.png" data-srcset="/static/2022-09-26-14-39-00-0dbb7a586e3c39186f9c3f19df34840b-f72be.png 200w,\n/static/2022-09-26-14-39-00-0dbb7a586e3c39186f9c3f19df34840b-0eb67.png 400w,\n/static/2022-09-26-14-39-00-0dbb7a586e3c39186f9c3f19df34840b-9e231.png 444w" data-sizes="(max-width: 444px) 100vw, 444px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这就完整了！</p>\n<p>可以看到，所有类型的基类收敛于 object，所有类型的类型都是 type，包括它自己！这就是 Python 类型、对象体系全图，设计简洁、优雅、严谨。</p>\n<p>该图将成为后续阅读源码、探索 Python 对象模型的有力工具，像地图一样指明方向。图中所有实体在 Python 内部均以对象形式存在，至于对象到底长啥样，相互关系如何描述，这些问题先按下不表，后续一起到源码中探寻答案。</p>\n<h3 id="变量只是名字"><a href="#%E5%8F%98%E9%87%8F%E5%8F%AA%E6%98%AF%E5%90%8D%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量只是名字</h3>\n<p>先看一个例子，定义一个变量 a，并通过 id 内建函数取出其“地址”：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13462711719839703000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = 1\n>>> id(a)\n4302704784`, `13462711719839703000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n<span class="token number">4302704784</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>定义另一个变量 b，以 a 赋值，并取出 b 的“地址”：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22041010494689940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> b = a\n>>> id(b)\n4302704784`, `22041010494689940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> a\n<span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span>b<span class="token punctuation">)</span>\n<span class="token number">4302704784</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>惊奇地看到，a 和 b 这两个变量的地址居然是相同的！这不合常理呀！</p>\n<p>对于大多数语言（C 语言为例），定义变量 a 即为其分配内存并存储变量值</p>\n<p>变量 b 内存空间与 a 独立，<code class="language-text">赋值时进行拷贝，不赋值时还是原来地址</code></p>\n<p>在 Python 中，一切皆对象，整数也是如此，变量只是一个与对象关联的名字</p>\n<p>而变量赋值，只是将当前对象与另一个名字进行关联，背后的对象是同一个</p>\n<p>因此，在 Python 内部，变量只是一个名字，保存指向实际对象的指针，进而与其绑定。变量赋值只拷贝指针，并不拷贝指针背后的对象</p>\n<h3 id="可变对象与不可变对象"><a href="#%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E4%B8%8E%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可变对象与不可变对象</h3>\n<p>定义一个整数变量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46097464694368590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = 1\n>>> id(a)\n4302704784`, `46097464694368590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n<span class="token number">4302704784</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后，对其自增 1：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31448016011529490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a += 1\n>>> a\n2\n>>> id(a)\n4302704816`, `31448016011529490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">+=</span> <span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> a\n<span class="token number">2</span>\n<span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n<span class="token number">4302704816</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>数值符合预期，但是对象变了！初学者一脸懵逼，这是什么鬼？</p>\n<p>一切要从可变对象和不可变对象说起。可变对象在对象创建后，其值可以进行修改；而不可变对象在对象创建后的整个生命周期，其值都不可修改。</p>\n<p>在 Python 中，整数类型是不可变类型，整数对象是不可变对象。修改整数对象时，Python 将以新数值创建一个新对象，变量名与新对象进行绑定；旧对象如无其他引用，将被释放。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-ec22f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 21.51851851851852%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAr0lEQVQI14WPSwvCMBCE8///ih5V8FjrQajgwWMv1SilD9OmTfPaJGva4tmPXVgYmJkl2kIvpAVnrGlYxUXnvQ8LiLiqAA4xaJji+ODxB6GfMcmrlst+aNLHJi22fGLs0z0p1Uq+e3nKq7obtRVZecjKHVctBgSA6E7i+iXEeTdINkwsHjF8lmMFxDVqUuJWJPfXmQ2NVoZzbq0l+I+As7UBdaXHS7FnYz2/o7Vz7gvDneSUGtVpiAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 55 02" title="" data-src="/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-fee1c.png" data-srcset="/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-a67b7.png 200w,\n/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-0b187.png 400w,\n/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-fee1c.png 800w,\n/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-b1a91.png 1200w,\n/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-95179.png 1600w,\n/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-5d5ba.png 2400w,\n/static/2022-09-26-14-55-02-61f5df318944c4f90b04a91b7409dae8-ec22f.png 2700w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<blockquote>\n<p>每次修改整数对象都要创建新对象、回收旧对象，效率不是很低吗？确实是，后续章节将从源码角度来解答：Python 如何通过小整数池等手段进行优化。</p>\n</blockquote>\n<p>可变对象是指创建后可以修改的对象，典型的例子是列表（list）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27489061315691753000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> l = [1, 2]\n>>> l\n[1, 2]\n>>> id(l)\n4385900424`, `27489061315691753000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> l\n<span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span>l<span class="token punctuation">)</span>\n<span class="token number">4385900424</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>往列表里头追加数据，发现列表对象还是原来那个，只不过多了一个元素了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99491861912630560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> l.append(3)\n>>> l\n[1, 2, 3]\n>>> id(l)\n4385900424`, `99491861912630560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> l.append<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> l\n<span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span>l<span class="token punctuation">)</span>\n<span class="token number">4385900424</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际上，列表对象内部维护了一个动态数组，存储元素对象的指针：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-57-36-8fb4b5c2d45febca5adcc9bc13d62ef7-8132c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.74509803921568%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACHUlEQVQoz5VSXW/SUBjm/3i3C3+BV8b4G0w0aoyaGBOjMf4CLxbDQshIhhplMRpBZqcEGGOMjTIYCgPKKP3go0JKaUtLy+mnB2jYUi6M70nOx5vzPO/7nPN4bNu2TNMyDcsy7X+FNY/l0aPr+l6F+FFl8hg1FnhBFHmBB2A644Tj0lUXywwMlxrFIIfF9oAzTQMGzCoimKrABYBlZEkRR5KuGU7lWRaADk0uYOKER0rB8Il/O/MmWgoU8NSiEgCA40YtppqrJ1As2fpzZpqmZ0kMD3DuDom7H9cefLp6y7d2e/vKZuolTE6nKscNDd3KNCPJzlasFYhjHzRN87heojckn4evv0Juvvh641n0Wuj4tW3a7JBdUJNMM33y8/A0gVFlp+0lUtfMVgfzZh5uFp8ECk+9ufvhgn86gTWAqqqSJPGcWCs3Br0hUHUHfNG5bhFdbD19z5d/5EMfrx/d+ZLfUCQgiIIsSxrQBnynThdrdJHhKUczx3H1eh3DMFEY9wZ05MwbIwNQ2M75xhGOzEjnFrAMO0chaeZ9qv3ugPjsaJZlud/vsywrS5Nun96tbO3hoWQzFMOCaDNxWVejXUmg0f0CUsbz7rbhB9I94ttvX7wVjDfffsf82cbuHOyYT1GU8wZOkbQ0llYfzOizvSweRWnkmNjJkpFqB136aXXjWTWdPJZLp7/S+wckQbncCa0yGo1mAmXZDf7f+AuJrfiQOuleQwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 57 36" title="" data-src="/static/2022-09-26-14-57-36-8fb4b5c2d45febca5adcc9bc13d62ef7-fee1c.png" data-srcset="/static/2022-09-26-14-57-36-8fb4b5c2d45febca5adcc9bc13d62ef7-a67b7.png 200w,\n/static/2022-09-26-14-57-36-8fb4b5c2d45febca5adcc9bc13d62ef7-0b187.png 400w,\n/static/2022-09-26-14-57-36-8fb4b5c2d45febca5adcc9bc13d62ef7-fee1c.png 800w,\n/static/2022-09-26-14-57-36-8fb4b5c2d45febca5adcc9bc13d62ef7-b1a91.png 1200w,\n/static/2022-09-26-14-57-36-8fb4b5c2d45febca5adcc9bc13d62ef7-8132c.png 1275w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>列表对象增减元素，需要修改该数组。例如，追加元素 3 ：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-14-57-53-b75f6f655ad3d4d5d29ed0c570c863a6-8132c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAACk0lEQVQ4y5VTW08TQRjd/+SD8c0XY3zzB/jmiwQVMCYmxhjj9c0Ho1IwoUJipEITbgaWCkIpUgq0pbSlpdnu2na7pVv2fp+ZrbNt00iVKF92Z2dn53xzvu+cJZrNJkIQAIAQav4r3FZ0XwkI4XqaXsqw27mfiiTKsixKomWZbtNFLsLXWVk8MH5kmOrCZpyq8h4BAPCqqTqGbrV2nQIYuqFImqnbnZPxDWybKuQBcPDcdqxwdjaUmgxGRr5np7ZyZBuPi5JEqcwxKTq6dbBS4PZVXSa6HFBrlHVhMHD5zvSlm76LfYELz+dvtIk3Gjx03HQptsx8+Eb7F3LD5TpFtAngxO0UsiY8mrn+cOHa/cDVB3NXXpN9ECBBEAzT8FJItY0kGU6Q0fSqZirE7w3A+ypc6V144P12vy828DZ6ayzyGLO1bRv3Vdd1TdGzB3kqz0gnaqfmbkCI2Fp5OHJvZGfAFxsajt32R55gBRRFEUXRMAxZFSt1Olc8aCicaRkeGMvDMAxN04qs1njWFx0aTd4dTQz6Ev0TsaeaqmMJ3FbfDtm975XxVWYiVBxjG7QHxlkpisJgUZCOee7T3stA9kUg8+pz5lkw/kaWvWNV1eNZ4Ytr6dn11Fw4PS8o/GnaAHI19mvST+bGycPxpUN/KBVotdLFYJxCEuTtHzupRKbEsJ2a8be2NwGAtTq3mp/cqgaj1ZlNdnrjaBZB1FXEti3+5JguUQ60IAREj+lweSdiYzceC62Q8eQudkIH2ZI7V44vH31cTPsXM2PVBkP81bqOAwzDxGOPmYtcdq3wZb0QXDuaqktV4izT/zn3zodoP7mfiCeKVLFX5//5JbFhTMO0LOvcYNwzTdMkScK2OTe4J34BwVHZTr9/vF8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 14 57 53" title="" data-src="/static/2022-09-26-14-57-53-b75f6f655ad3d4d5d29ed0c570c863a6-fee1c.png" data-srcset="/static/2022-09-26-14-57-53-b75f6f655ad3d4d5d29ed0c570c863a6-a67b7.png 200w,\n/static/2022-09-26-14-57-53-b75f6f655ad3d4d5d29ed0c570c863a6-0b187.png 400w,\n/static/2022-09-26-14-57-53-b75f6f655ad3d4d5d29ed0c570c863a6-fee1c.png 800w,\n/static/2022-09-26-14-57-53-b75f6f655ad3d4d5d29ed0c570c863a6-b1a91.png 1200w,\n/static/2022-09-26-14-57-53-b75f6f655ad3d4d5d29ed0c570c863a6-8132c.png 1275w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="定长对象与变长对象"><a href="#%E5%AE%9A%E9%95%BF%E5%AF%B9%E8%B1%A1%E4%B8%8E%E5%8F%98%E9%95%BF%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>定长对象与变长对象</h3>\n<p>Python 一个对象多大呢？相同类型对象大小是否相同呢？想回答类似的问题，需要考察影响对象大小的因素。</p>\n<p>标准库 sys 模块提供了一个查看对象大小的函数 getsizeof：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87853775529148430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import sys\n>>> sys.getsizeof(1)\n28`, `87853775529148430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> <span class="token function">import</span> sys\n<span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token number">28</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>先观察整数对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26347105382459970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> sys.getsizeof(1)\n28\n>>> sys.getsizeof(100000000000000000)\n32\n>>> sys.getsizeof(100000000000000000000000000000000000000000000)\n44`, `26347105382459970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token number">28</span>\n<span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token number">100000000000000000</span><span class="token punctuation">)</span>\n<span class="token number">32</span>\n<span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token number">100000000000000000000000000000000000000000000</span><span class="token punctuation">)</span>\n<span class="token number">44</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可见整数对象的大小跟其数值有关，像这样大小不固定的对象称为变长对象。</p>\n<p>我们知道，位数固定的整数能够表示的数值范围是有限的，可能导致溢出。Python 为解决这个问题，采用类似 C++ 中大整数类的思路实现整数对象——串联多个普通 32 位整数，以便支持更大的数值范围。至于需要多少个 32 位整数，则视具体数值而定，数值不大的一个足矣，避免浪费</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-15-04-06-f9d21975c1f631190eec7c3ac84cc722-6cf8d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.55555555555555%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4klEQVQoz6WS3U/aYBTG/RuXbLqbJUt2MYNY4jKWqDde7MpNAZViRYqKjpSrOXVxtjATNiilUuvKhzEg9JPRpssyaI1tse8wXCxmW+LJyclJzvk975ucZ6R/jxjRf6ocX6hKRTdrEl2TaU4g63JlMLYsuyYwFZECU5muymCtItDd3i8As408fOJZP5tCSlCk6F0tQuHSc6y4OIB7XSNOzSKsd43xRWjvKj2JMJPRkxe83AAw1ypEWWgu9cQfe+SPjUKhB/Pppx/K4SGc5F6/wZ+9io29XHvoj47OJB5vlaeF9iWAzxpkmPTCeR+c80XyvpUstEyOY4XAADZ6JkrOhinP0pcJd20p61khJxBqild+w7Umu/sNxuvxPQ55fwoTjY39auSIwYYv77HreCuKN1G8GSOaKMGjBxVEVHgAX/Bl/Hwry6eI8+1DbiPbSqXriWNudwCbhvmxlIh/mt9JB3c+BzePFrYzgeTxstKRANwzunJHUFSxrUluuo3c4VX9++23DXO/hL77+hbLhzAymMwF3IrlQlJbAPDfL3llXlEXaUYiGDHDiG6TOZUz9CWu6R0AO3eH/aeM3XesvnVtW9eObTm3JvmnjYBU39F/6KqmKm1FEAVNU/8XHkrcYc/7ePsGRxGkqN1hNrgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 15 04 06" title="" data-src="/static/2022-09-26-15-04-06-f9d21975c1f631190eec7c3ac84cc722-fee1c.png" data-srcset="/static/2022-09-26-15-04-06-f9d21975c1f631190eec7c3ac84cc722-a67b7.png 200w,\n/static/2022-09-26-15-04-06-f9d21975c1f631190eec7c3ac84cc722-0b187.png 400w,\n/static/2022-09-26-15-04-06-f9d21975c1f631190eec7c3ac84cc722-fee1c.png 800w,\n/static/2022-09-26-15-04-06-f9d21975c1f631190eec7c3ac84cc722-6cf8d.png 900w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这样一来，整数对象需要在头部额外存储一些信息，记录对象用了多少个 32 位整数。这就是变长对象典型的结构，先有个大概印象即可，后续讲解整数对象源码时再展开。</p>\n<p>接着观察字符串对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51790378977821975000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> sys.getsizeof(\'a\')\n50\n>>> sys.getsizeof(\'abc\')\n52`, `51790378977821975000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span>\n<span class="token number">50</span>\n<span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">)</span>\n<span class="token number">52</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-15-04-55-0a81d23ed0d5655a52117dc0a2ea7582-6cf8d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2klEQVQoz6WO3U/aUBjG/RcX4262uyVKBJPFDLzZ/olStiLtmqGii8yLTYaMMUtV2try3UItCJzKp5MylSVSXbeDpy67WCbJnrznnCfneX/nPVM//0NTcJ0O2jnAKm1O6cBKwT2nJ3uDFuoYpyes3LIjpcPndbZnNG1Yqn7B07P+zAKWmvNyDp/gxKQnYjWBYKm668vNEpkFL+/AOAfOz8NmoRK34TzYI7KuF6HHi8S05/XDxVfT+OEcfB7B+ca+P+d8vvYIRm5y5in+4KU4n20wd5O1JJZ0LXNuSlqixKUA7/HuOyWNsScfsd4DF5F6Fjh0k6JnWXBjey5BTdhwGWQ+12juNBwtkRE5wPU2E4CGlwhW9XyyGRJ6WzH1TVSh+e7WLlgtg6wNa0COFVbYyruIFIykg9DE5JUjUESwfJz5IPvjWjAs+DZ5PF4Jvi8Qxapow2NZt/XbWMiOj1I9G1Uppr4e5n1vDzCmsf6xRMo16Q/4b7IsG/5UoZl6aKdE75RvjUrJtfSkcPyYZvWN7UJgu0hCE9MopX4fjHT5/aL1tdE507tGs9tvdvon7TNwMTyfCEYyTXN4Ofw2ODf6A6NvoE/dD1tj/bi5uTavTVgjc3Q1upoU/od+Abcf3lePqnEOAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 15 04 55" title="" data-src="/static/2022-09-26-15-04-55-0a81d23ed0d5655a52117dc0a2ea7582-fee1c.png" data-srcset="/static/2022-09-26-15-04-55-0a81d23ed0d5655a52117dc0a2ea7582-a67b7.png 200w,\n/static/2022-09-26-15-04-55-0a81d23ed0d5655a52117dc0a2ea7582-0b187.png 400w,\n/static/2022-09-26-15-04-55-0a81d23ed0d5655a52117dc0a2ea7582-fee1c.png 800w,\n/static/2022-09-26-15-04-55-0a81d23ed0d5655a52117dc0a2ea7582-6cf8d.png 900w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>字符串对象也是变长对象，这个行为非常好理解，毕竟字符串长度不尽相同嘛。此外，注意到字符串对象大小比字符串本身大，因为对象同样需要维护一些额外的信息。至于具体需要维护哪些信息，同样留到源码剖析环节中详细介绍。</p>\n<p>那么，有啥对象是定长的呢——浮点数对象 float：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37639938204989630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> sys.getsizeof(1.)\n24\n>>> sys.getsizeof(1000000000000000000000000000000000.)\n24`, `37639938204989630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token number">1</span>.<span class="token punctuation">)</span>\n<span class="token number">24</span>\n<span class="token operator">>></span><span class="token operator">></span> sys.getsizeof<span class="token punctuation">(</span><span class="token number">1000000000000000000000000000000000</span>.<span class="token punctuation">)</span>\n<span class="token number">24</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>浮点数背后是由一个 double 实现，就算表示很大的数，浮点数对象的大小也不变。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-26-15-05-08-d4223cd68f989b97fbc9b2048d1f3626-6cf8d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABm0lEQVQoz6WSyU/CUBDG+Qs9mODNg1FDAsoS0aPxQtREQcNusQJKJMEYoyIQQYrIIi1Ci7hQZSkCKhAxnoC2+KDlrmHy3mRe5vvNN4cn6I0QAnDrrRpO3WSr8YdavJ+rcbwcrjSKnOL754soR7KVGGgNurfEW6Tw8cTDyVdEh4kgXK5PiPWo2IRJtclp5PGYg3NUxpSSQLjUiEmAwJCYM6REp2kzDxNUxJyeX3ZOyg3jS/CEXDu+FZ2JFc57bB9+eXuA7xUrrkklJFy0CCWbYxvBqUvS3mM4ZzKkQUS6sNQYkxuiMn1Ypr6eDWZ4Z7KUNaOKncTCDroAJZUWbNGIzp+gEO/8TOH+vDX+eeR9hJGSI/ruCpZt6XyEc85TOYtXZfWvw741kCG3yhpYDWXOhnCRcONwkHSeYrsewnaVO/Rk4TQZ5ZwL5Ze9i42Dyy27T+MIbNu8mn2/Grk752GGYTog2h2aprvdbmfwADUHsyxYoL8D22MZhmb7chocHv5LgKGtr1az0ax/1iuVarvd/gc8XIEvuFowyg/7BUt0OQa8sN4OAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 26 15 05 08" title="" data-src="/static/2022-09-26-15-05-08-d4223cd68f989b97fbc9b2048d1f3626-fee1c.png" data-srcset="/static/2022-09-26-15-05-08-d4223cd68f989b97fbc9b2048d1f3626-a67b7.png 200w,\n/static/2022-09-26-15-05-08-d4223cd68f989b97fbc9b2048d1f3626-0b187.png 400w,\n/static/2022-09-26-15-05-08-d4223cd68f989b97fbc9b2048d1f3626-fee1c.png 800w,\n/static/2022-09-26-15-05-08-d4223cd68f989b97fbc9b2048d1f3626-6cf8d.png 900w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>为啥 64 位的 double 可以表示这么大的范围呢？答案是：牺牲了精度。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68192016343953310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> int(1000000000000000000000000000000000.)\n999999999999999945575230987042816`, `68192016343953310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> int<span class="token punctuation">(</span><span class="token number">1000000000000000000000000000000000</span>.<span class="token punctuation">)</span>\n<span class="token number">999999999999999945575230987042816</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>由于浮点数存储位数是固定的，它能表示的数值范围也是有限的，超出便会抛锚：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23458763220384006000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> 10. ** 1000\nTraceback (most recent call last):\n   File &quot;<stdin>&quot;, line 1, in <module>\nOverflowError: (34, \'Result too large\')`, `23458763220384006000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> <span class="token number">10</span>. ** <span class="token number">1000</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n   File <span class="token string">"&lt;stdin>"</span>, line <span class="token number">1</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nOverflowError: <span class="token punctuation">(</span><span class="token number">34</span>, <span class="token string">\'Result too large\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO Python 源码剖析 <a href="https://fasionchan.com/python-source/object-model/pyobject/" target="_blank" rel="nofollow noreferrer noopener">https://fasionchan.com/python-source/object-model/pyobject/</a></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Python源码剖析/index.md absPath of file >>> MarkdownRemark",timeToRead:7,frontmatter:{date:"2022-09-26 11:08:48",path:"/python-source-analysis/",tags:"后端, python, 读书笔记",title:"Python源码剖析",draft:null}},{excerpt:"背景知识 系统设计 系统设计主题：从这里开始 认识以下一般性原则 可扩展性视频讲座 哈佛大学可扩展性讲座 垂直扩展（Vertical scaling） 水平扩展（Horizontal scaling） 缓存 负载均衡 数据库复制 数据库分区 可扩展性文章 Clones 数据库 缓存 异步 接下来的步骤 接下来，我们将看看高阶的权衡和取舍: 性能与可扩展性 延迟与吞吐量 可用性与一致性 记住每个方面都面临取舍和权衡。 然后，我们将深入更具体的主题，如 DNS、CDN…",html:'<h1 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h1>\n<p><a href="https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md" target="_blank" rel="nofollow noreferrer noopener">系统设计</a></p>\n<h1 id="系统设计主题：从这里开始"><a href="#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%EF%BC%9A%E4%BB%8E%E8%BF%99%E9%87%8C%E5%BC%80%E5%A7%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>系统设计主题：从这里开始</h1>\n<p>认识以下一般性原则</p>\n<h2 id="可扩展性视频讲座"><a href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E8%A7%86%E9%A2%91%E8%AE%B2%E5%BA%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可扩展性视频讲座</h2>\n<p><a href="https://www.youtube.com/watch?v=-W9F__D3oY4" target="_blank" rel="nofollow noreferrer noopener">哈佛大学可扩展性讲座</a></p>\n<ul>\n<li>垂直扩展（Vertical scaling）</li>\n<li>水平扩展（Horizontal scaling）</li>\n<li>缓存</li>\n<li>负载均衡</li>\n<li>数据库复制</li>\n<li>数据库分区</li>\n</ul>\n<h2 id="可扩展性文章"><a href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E6%96%87%E7%AB%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可扩展性文章</h2>\n<ul>\n<li><a href="http://www.lecloud.net/post/7295452622/scalability-for-dummies-part-1-clones" target="_blank" rel="nofollow noreferrer noopener">Clones</a></li>\n<li><a href="http://www.lecloud.net/post/7994751381/scalability-for-dummies-part-2-database" target="_blank" rel="nofollow noreferrer noopener">数据库</a></li>\n<li><a href="http://www.lecloud.net/post/9246290032/scalability-for-dummies-part-3-cache" target="_blank" rel="nofollow noreferrer noopener">缓存</a></li>\n<li><a href="http://www.lecloud.net/post/9699762917/scalability-for-dummies-part-4-asynchronism" target="_blank" rel="nofollow noreferrer noopener">异步</a></li>\n</ul>\n<h2 id="接下来的步骤"><a href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E6%AD%A5%E9%AA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>接下来的步骤</h2>\n<p>接下来，我们将看看高阶的权衡和取舍:</p>\n<ul>\n<li>性能与可扩展性</li>\n<li>延迟与吞吐量</li>\n<li>可用性与一致性</li>\n</ul>\n<p>记住每个方面都面临取舍和权衡。</p>\n<p>然后，我们将深入更具体的主题，如 DNS、CDN 和负载均衡器。</p>\n<h1 id="性能与拓展性"><a href="#%E6%80%A7%E8%83%BD%E4%B8%8E%E6%8B%93%E5%B1%95%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>性能与拓展性</h1>\n<p>如果服务性能的增长与资源的增加是成比例的，服务就是可扩展的。通常，提高性能意味着服务于更多的工作单元，另一方面，当数据集增长时，同样也可以处理更大的工作单位。</p>\n<p>另一个角度来看待性能与可扩展性:</p>\n<ul>\n<li>如果你的系统有性能问题，对于单个用户来说是缓慢的。</li>\n<li>如果你的系统有可扩展性问题，单个用户较快但在高负载下会变慢。</li>\n</ul>\n<h1 id="延迟与吞吐量"><a href="#%E5%BB%B6%E8%BF%9F%E4%B8%8E%E5%90%9E%E5%90%90%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>延迟与吞吐量</h1>\n<p>延迟是执行操作或运算结果所花费的时间。</p>\n<p>吞吐量是单位时间内（执行）此类操作或运算的数量。</p>\n<p>通常，你应该以可接受级延迟下最大化吞吐量为目标。</p>\n<h1 id="可用性与一致性"><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E4%B8%8E%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可用性与一致性</h1>\n<h2 id="cap-理论"><a href="#cap-%E7%90%86%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CAP 理论</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-24-16-55-19-95e3c530279ee1a48f0bfe24387dffb1-28759.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 500px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.6%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABhElEQVQoz4VSa4+iMBTt//9PfjBqTHx9Yc2sjqKOWAQKLbQ8WlrYM7hjzGYzc0KacpJze+65l/TfIhMlS2WScG3sgykrnaQyvsdSliQMw/l8Pp1OR6PRZDLZbrdPpbWORuLt/Zb73vkSFrLOhApouvOjj7dfnDFirS3LsigKKWU+4Cnuuu5Ks+NHQsOUC9W5zjnHMnkO2OWW1rol39uG/vP8Hwn8IK4bg6+sGvclMK0dGG2MJUKI4/F4GLDf75umedZ2rgvu/PeBJlkRRuKhobEAA+fonzDGNpvNarVar9fL5RK1XsVXmr77IeKlEa9qrarmdueHc4ye8fuDbZXn6rrLlUFUD6Z1vUqoSiOUJ3gEgbsvdC8YwnG91f+WbHXvPsdO/ub5cr6misEkmUJ7VW0wUmfaXNYRK2BelQ05nU7YjfF4vFgsPM/DtqD52WyG8KD3L/HGOyMtP2ACjSbiFLDtLkAW2BlijHluiNYad1w450opiPECosKeYUL94AsuoHwwfwCQ4Kr6X89LaQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 24 16 55 19" title="" data-src="/static/2022-08-24-16-55-19-95e3c530279ee1a48f0bfe24387dffb1-28759.png" data-srcset="/static/2022-08-24-16-55-19-95e3c530279ee1a48f0bfe24387dffb1-6ac48.png 200w,\n/static/2022-08-24-16-55-19-95e3c530279ee1a48f0bfe24387dffb1-4b8bf.png 400w,\n/static/2022-08-24-16-55-19-95e3c530279ee1a48f0bfe24387dffb1-28759.png 500w" data-sizes="(max-width: 500px) 100vw, 500px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在一个分布式计算系统中，只能同时满足下列的两点:</p>\n<ul>\n<li>一致性 ─ 每次访问都能获得最新数据但可能会收到错误响应</li>\n<li>可用性 ─ 每次访问都能收到非错响应，但不保证获取到最新数据</li>\n<li>分区容错性 ─ 在任意分区网络故障的情况下系统仍能继续运行</li>\n</ul>\n<p>网络并不可靠，所以你应要支持分区容错性，并需要在软件可用性和一致性间做出取舍。</p>\n<h3 id="cp---一致性和分区容错性"><a href="#cp---%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CP - 一致性和分区容错性</h3>\n<p>等待分区节点的响应可能会导致延时错误。如果你的业务需求需要原子读写，CP 是一个不错的选择。</p>\n<h3 id="ap---可用性和分区容错性"><a href="#ap---%E5%8F%AF%E7%94%A8%E6%80%A7%E5%92%8C%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AP - 可用性和分区容错性</h3>\n<p>响应节点上可用数据的最近版本可能并不是最新的。当分区解析完后，写入（操作）可能需要一些时间来传播。</p>\n<p>如果业务需求允许最终一致性，或当有外部故障时要求系统继续运行，AP 是一个不错的选择。</p>\n<h1 id="一致模式"><a href="#%E4%B8%80%E8%87%B4%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一致模式</h1>\n<p>有同一份数据的多份副本，我们面临着怎样同步它们的选择，以便让客户端有一致的显示数据。回想 CAP 理论中的一致性定义 ─ 每次访问都能获得最新数据但可能会收到错误响应</p>\n<h2 id="弱一致性"><a href="#%E5%BC%B1%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>弱一致性</h2>\n<p>在写入之后，访问可能看到，也可能看不到（写入数据）。尽力优化之让其能访问最新数据。</p>\n<p>这种方式可以在 memcached 等系统中看到。弱一致性在 VoIP，视频聊天和实时多人游戏等真实用例中表现不错。打个比方，如果你在通话中丢失信号几秒钟时间，当重新连接时你是听不到这几秒钟所说的话的。</p>\n<h2 id="最终一致性"><a href="#%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最终一致性</h2>\n<p>在写入后，访问最终能看到写入数据（通常在数毫秒内）。数据被异步复制。</p>\n<p>DNS 和 email 等系统使用的是此种方式。最终一致性在高可用性系统中效果不错。</p>\n<h2 id="强一致性"><a href="#%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>强一致性</h2>\n<p>在写入后，访问立即可见。数据被同步复制。</p>\n<p>文件系统和关系型数据库（RDBMS）中使用的是此种方式。强一致性在需要记录的系统中运作良好。</p>\n<h1 id="可用性模式"><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可用性模式</h1>\n<p>有两种支持高可用性的模式: 故障切换（fail-over）和复制（replication）。</p>\n<h2 id="故障切换"><a href="#%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>故障切换</h2>\n<h3 id="工作到备用切换（active-passive）"><a href="#%E5%B7%A5%E4%BD%9C%E5%88%B0%E5%A4%87%E7%94%A8%E5%88%87%E6%8D%A2%EF%BC%88active-passive%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工作到备用切换（Active-passive）</h3>\n<p>关于工作到备用的故障切换流程是，工作服务器发送周期信号给待机中的备用服务器。如果周期信号中断，备用服务器切换成工作服务器的 IP 地址并恢复服务。</p>\n<p>宕机时间取决于备用服务器处于“热”待机状态还是需要从“冷”待机状态进行启动。只有工作服务器处理流量。</p>\n<p>工作到备用的故障切换也被称为主从切换。</p>\n<h3 id="双工作切换（active-active）"><a href="#%E5%8F%8C%E5%B7%A5%E4%BD%9C%E5%88%87%E6%8D%A2%EF%BC%88active-active%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>双工作切换（Active-active）</h3>\n<p>在双工作切换中，双方都在管控流量，在它们之间分散负载。</p>\n<p>如果是外网服务器，DNS 将需要对两方都了解。如果是内网服务器，应用程序逻辑将需要对两方都了解。</p>\n<p>双工作切换也可以称为主主切换。</p>\n<h3 id="缺点"><a href="#%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>故障切换需要添加额外硬件并增加复杂性。</li>\n<li>如果新写入数据在能被复制到备用系统之前，工作系统出现了故障，则有可能会丢失数据。</li>\n</ul>\n<h2 id="复制"><a href="#%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复制</h2>\n<h3 id="主-─-从复制和主-─-主复制"><a href="#%E4%B8%BB-%E2%94%80-%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%92%8C%E4%B8%BB-%E2%94%80-%E4%B8%BB%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主 ─ 从复制和主 ─ 主复制</h3>\n<p>这个主题进一步探讨了数据库部分:</p>\n<ul>\n<li>主 ─ 从复制</li>\n<li>主 ─ 主复制</li>\n</ul>\n<h1 id="域名系统"><a href="#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>域名系统</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-82fb5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 638px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.37617554858933%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACVklEQVQoz3WTz2/SYBjHuXjy5tmTif4ZXox/gRcvJiZejAdNiFs86KKJiTGabUxDDGbIlMUZs4MG9TCNY7ARNn4M6AotPzoptF2B0pbSH7Tv+9oXxoIZPnkPzfs+n+f5Pj/q6ff7giBIktRoNGS5U68fVqtljmuwLMvzvGVZCCEIIZpmHheLx+MEQWxv7+zt7bsnFkuQJB2LxYrFomEYIz/HcTqdjtRpy92u+6HrOoYnAtkQCAAICElyt+KSFEVBAEZvuqEVCDJbrKYIejeTa7daGHYlAWC7PgDkJOkcQVyo1c4qypWNn79y+YLrAaADEUBD4f6lpdc+P750nJPMuCiIVNPcUtWU2gtb1vq16zfW10LIBg7E8VtGpqqHgu98kS/fMTxU5EHTDVQqrConzOwnScqXtQ+sujGwtVEmNO4fhnW7zasZQUtz6o5iMlgpwoF7qEkyc9XoojlQjwUiNNl3DNO90ELW83Lz/EL6TEKccW8Mp0SLD/LNO0fKZ4F4CKgDW1H6fw6NOmvU63A8AgybtphmgixfaEklDZE1fZMznzPsJYq6XCpdlLWrhvhDCKwkb95K3vMW7noHFD2sDHicYd8Cy+GZF6FnH7993XrUFV5ZYkSg3zdLYbVx32wFb3tnVxd9qFJTOU7neGCax5lxDYZBR3+v+QOrb5Yjb1es8q56sCUXkjKR1Iopmdyfn/clU+nTq4ZlW7l8zTtLPnnKzD22otGRpBNX4Uh0V5VhGF3rj7s2AbsTt9ptV7+DF8bdh38Pgv8Z5+ScIUTTfgA4ttNPfwFNM/CdeOepqAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 24 17 52 24" title="" data-src="/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-82fb5.png" data-srcset="/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-38c7c.png 200w,\n/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-c00bc.png 400w,\n/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-82fb5.png 638w" data-sizes="(max-width: 638px) 100vw, 638px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>域名系统是把 www.example.com 等域名转换成 IP 地址。</p>\n<p>域名系统是分层次的，一些 DNS 服务器位于顶层。当查询（域名）IP 时，路由或 ISP 提供连接 DNS 服务器的信息。较底层的 DNS 服务器缓存映射，它可能会因为 DNS 传播延时而失效。DNS 结果可以缓存在浏览器或操作系统中一段时间，时间长短取决于存活时间 TTL。</p>\n<ul>\n<li>NS 记录（域名服务）─ 指定解析域名或子域名的 DNS 服务器。</li>\n<li>MX 记录（邮件交换）─ 指定接收信息的邮件服务器。</li>\n<li>A 记录（地址）─ 指定域名对应的 IP 地址记录。</li>\n<li>CNAME（规范）─ 一个域名映射到另一个域名或 CNAME 记录（example.com 指向 www.example.com）或映射到一个 A 记录。</li>\n</ul>\n<p>CloudFlare 和 Route 53 等平台提供管理 DNS 的功能。某些 DNS 服务通过集中方式来路由流量:</p>\n<ul>\n<li>\n<p>加权轮询调度</p>\n<ul>\n<li>防止流量进入维护中的服务器</li>\n<li>在不同大小集群间负载均衡</li>\n<li>A/B 测试</li>\n</ul>\n</li>\n<li>基于延迟路由</li>\n<li>基于地理位置路由</li>\n</ul>\n<h2 id="dns-缺点"><a href="#dns-%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DNS 缺点</h2>\n<ul>\n<li>虽说缓存可以减轻 DNS 延迟，但连接 DNS 服务器还是带来了轻微的延迟。</li>\n<li>虽然它们通常由政府，网络服务提供商和大公司管理，但 DNS 服务管理仍可能是复杂的。</li>\n<li>DNS 服务最近遭受 DDoS 攻击，阻止不知道 Twitter IP 地址的用户访问 Twitter。</li>\n</ul>\n<h1 id="cdn"><a href="#cdn" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-25-16-41-38-193731eb279e8a21a5ee3ee9d21af44d-00a75.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 710px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.70422535211269%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACOUlEQVQoz22TW1PaUBSF+fd96t/odNqHjmgHatUiKjUCgiAiEO7lVhKSkAsJSfh6goRS65k5ueyTvfbaa+0kOFimbaMtTRaGTq3+RKMp78+c1Qpv7WGL+2az2cZczztM38YTYRgSioe17zOdz9CXBhNV5egoyXUmw8xwiL4xLQs/CAjCDYazotHvMRr3sWxrWyguklA0hf6gzWgypDvo0Oh1MUyD52aDWquJ6bjMlisWItYd/aIht7k4PeVD+oy6XGcwlEW+LMAHaIZGwrZNKrLMTalE87lCofaEoi0YKyoj1cB01wxqNfInRxQqD2R/5vjxLcWtlKMngCbjLuPpUOyRkMMhEVNVVYUn6Qope0mhWmU4m+P7ARPB7u7TR87ev6NYLlNtNcg/Vri5L9Jp1bgq3aPoupAifGk5BgyEPtnrK76eHPOwM0MzbWa6yWz60mokR6X+yGnuJ6l0mtRxklKrjeO6f02JLjFovdtnLIxZeS7rIEQR7Oa6Rr4oUcjf0Ww3mCtTWsIQSbDNSnfCRHObG+5wEjFyDGq7HqV6nfOz74LZlN8Ljap4L2QvyFxmWIdBlIElvnvsDETBJVGzwW5a/gN01z5loaF0nqbba+9n7FZodSuMi873synmsHhfplypbs0Lw1eAm52wvr3kJneN5/t7bartNroYnbi9aM0Nk2QqzecvSdSl9WLKa4aRds+tFnPhenz2eh3Ko1oO3eFo+ye92bK1EhrKnSjIP+wP9luFIil8QeYPPaeE0Pm8T7QAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 25 16 41 38" title="" data-src="/static/2022-08-25-16-41-38-193731eb279e8a21a5ee3ee9d21af44d-00a75.png" data-srcset="/static/2022-08-25-16-41-38-193731eb279e8a21a5ee3ee9d21af44d-139c8.png 200w,\n/static/2022-08-25-16-41-38-193731eb279e8a21a5ee3ee9d21af44d-08302.png 400w,\n/static/2022-08-25-16-41-38-193731eb279e8a21a5ee3ee9d21af44d-00a75.png 710w" data-sizes="(max-width: 710px) 100vw, 710px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>内容分发网络（CDN）是一个全球性的代理服务器分布式网络，它从靠近用户的位置提供内容。通常 HTML/CSS/JS，图片和视频等静态内容由 CDN 提供，虽然亚马逊 CloudFront 等也支持动态内容。CDN 的 DNS 解析会告知客户端连接哪台服务器。</p>\n<p>将内容存储在 CDN 上可以从两个方面来提供性能:</p>\n<ul>\n<li>从靠近用户的数据中心提供资源</li>\n<li>通过 CDN 你的服务器不必真的处理请求</li>\n</ul>\n<h2 id="cdn-推送"><a href="#cdn-%E6%8E%A8%E9%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 推送</h2>\n<p>当你服务器上内容发生变动时，推送 CDN 接受新内容。直接推送给 CDN 并重写 URL 地址以指向你的内容的 CDN 地址。你可以配置内容到期时间及何时更新。内容只有在更改或新增时才推送，流量最小化，但储存最大化。</p>\n<h2 id="cdn-拉取"><a href="#cdn-%E6%8B%89%E5%8F%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 拉取</h2>\n<p>CDN 拉取是当第一个用户请求该资源时，从服务器上拉取资源。你将内容留在自己的服务器上并重写 URL 指向 CDN 地址。直到内容被缓存在 CDN 上为止，这样请求只会更慢，</p>\n<p>存活时间（TTL）决定缓存多久时间。CDN 拉取方式最小化 CDN 上的储存空间，但如果过期文件没有在实际更改之前被拉取，则会导致冗余的流量。</p>\n<p>高流量站点使用 CDN 拉取效果不错，因为只有最近请求的内容保存在 CDN 中，流量才能更平衡地分散。</p>\n<h2 id="缺点-1"><a href="#%E7%BC%BA%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>CDN 成本可能因流量而异，可能在权衡之后你将不会使用 CDN。</li>\n<li>如果在 TTL 过期之前更新内容，CDN 缓存内容可能会过时。</li>\n<li>CDN 需要更改静态内容的 URL 地址以指向 CDN。</li>\n</ul>\n<h1 id="负载均衡器"><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>负载均衡器</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-25-16-56-03-751da38a9a8fa8360baefe0497573266-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.08542713567839%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACnklEQVQ4y22TSW8TQRCF5zdx4cqRX8ERuHBAXJFA4sQBjohFIFZBAAECERABkZgktmPHIXY8ZrzHwcQeJx6PPYtn/ejpIHAiWirNdFfX61dVr5RKYwet3mKjVKFY1ihrdYqqRn6jxEZRldbVhwRhRLLiOOboimfOlcFwjO+56HqfbDZDPp9joOs4to1lTZi6DmPLxfODvwBBEBBFEWEYyu9fYAGqGBNH/EQYhkGxWGRlZYV2u32IgWk5+EESHEvgtVye1LdlVjNrFDa+40496ZMMRxP3IMgck8vlJKCqqlSrVdLpNGPTxHI8CepOfaaej+N6eN6UMPCJQl8ytZ0pjvArv/p7jIwhjUaDUqnEej4vUs+iaRrNZlOk57Nv2oxt9xDrzZbBwmZPWJ9t3ZJnErBUqQk2GouLS6yupslksnxdXKSz3abdaqL3e+zumdju9KBOMrWYu5/rnLk2z/mbKeZSdV69+0DrZ0+k7ATYPliJeRGuH2F7IRM3xBSkDDtm34rxo38dDUXNs5rOm+wO7/JdCtVffPrylZ3dAcqw/p3tT/fZTc0x6rYYDgaC1ZBW+Qvl92dpzJ9i++1JBsVb7O9b9CoqzfU8N+ZVTl//yLkbKV6n26ytb0p5Kd1vL9m6cwHt8UX09SUmW2XMWgf9xwLVueOUnpyg9vQYeu4qY7VFMOgjdMZWZ8RCocNSaVcyfPT0BbV2FyUQNbGMPWxzxFHJ+r4rauYJPY5Fd71DQuY/u6mQlHLYFwuASBrx7EUhYvFwLP0HTXm+3ObSwwxXnhVY2upJ2ZliABR5acZmVZ8IPglOhJtobZbPq3SHyw+WufqiwJuVGrfvPUKtd44wPDqjfx4IxJQ4yTSIfZiMnBy7iIRsYo6QVKXaYM8Y8xv5QsOaYQYC3AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 25 16 56 03" title="" data-src="/static/2022-08-25-16-56-03-751da38a9a8fa8360baefe0497573266-f1168.png" data-srcset="/static/2022-08-25-16-56-03-751da38a9a8fa8360baefe0497573266-ad772.png 200w,\n/static/2022-08-25-16-56-03-751da38a9a8fa8360baefe0497573266-4f4c3.png 400w,\n/static/2022-08-25-16-56-03-751da38a9a8fa8360baefe0497573266-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>负载均衡器将传入的请求分发到应用服务器和数据库等计算资源。无论哪种情况，负载均衡器将从计算资源来的响应返回给恰当的客户端。负载均衡器的效用在于:</p>\n<ul>\n<li>防止请求进入不好的服务器</li>\n<li>防止资源过载</li>\n<li>帮助消除单一的故障点</li>\n</ul>\n<p>负载均衡器可以通过硬件（昂贵）或 HAProxy 等软件来实现。增加的好处包括:</p>\n<ul>\n<li>SSL 终结 ─ 解密传入的请求并加密服务器响应，这样的话后端服务器就不必再执行这些潜在高消耗运算了。不需要在每台服务器上安装 X.509 证书。</li>\n<li>Session 留存 ─ 如果 Web 应用程序不追踪会话，发出 cookie 并将特定客户端的请求路由到同一实例。</li>\n</ul>\n<p>通常会设置采用工作 ─ 备用或双工作模式的多个负载均衡器，以免发生故障。</p>\n<p>负载均衡器能基于多种方式来路由流量:</p>\n<ul>\n<li>随机</li>\n<li>最少负载</li>\n<li>Session / Cookie</li>\n<li>轮询调度或加权轮询调度算法</li>\n<li>四层负载均衡</li>\n<li>七层负载均衡</li>\n</ul>\n<h2 id="四层负载均衡"><a href="#%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>四层负载均衡</h2>\n<p>四层负载均衡根据传输层的信息来决定如何分发请求。通常，这会涉及来源，目标 IP 地址和请求头中的端口，但不包括数据包（报文）内容。四层负载均衡执行网络地址转换（NAT）来向上游服务器转发网络数据包。</p>\n<h2 id="七层负载均衡"><a href="#%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>七层负载均衡</h2>\n<p>七层负载均衡器根据监控应用层来决定怎样分发请求。这会涉及请求头的内容，消息和 cookie。七层负载均衡器终结网络流量，读取消息，做出负载均衡判定，然后传送给特定服务器。比如，一个七层负载均衡器能直接将视频流量连接到托管视频的服务器，同时将更敏感的用户账单流量引导到安全性更强的服务器。</p>\n<p>以损失灵活性为代价，四层负载均衡比七层负载均衡花费更少时间和计算资源，虽然这对现代商用硬件的性能影响甚微。</p>\n<h2 id="水平扩展"><a href="#%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>水平扩展</h2>\n<p>负载均衡器还能帮助水平扩展，提高性能和可用性。使用商业硬件的性价比更高，并且比在单台硬件上垂直扩展更贵的硬件具有更高的可用性。相比招聘特定企业系统人才，招聘商业硬件方面的人才更加容易。</p>\n<h3 id="缺点-2"><a href="#%E7%BC%BA%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>\n<p>水平扩展引入了复杂度并涉及服务器复制</p>\n<ul>\n<li>服务器应该是无状态的，它们也不该包含像 session 或资料图片等与用户关联的数据。</li>\n<li>session 可以集中存储在数据库或持久化缓存（Redis、Memcached）的数据存储区中。</li>\n</ul>\n</li>\n<li>缓存和数据库等下游服务器需要随着上游服务器进行扩展，以处理更多的并发连接。</li>\n</ul>\n<h2 id="缺点-3"><a href="#%E7%BC%BA%E7%82%B9-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>如果没有足够的资源配置或配置错误，负载均衡器会变成一个性能瓶颈。</li>\n<li>引入负载均衡器以帮助消除单点故障但导致了额外的复杂性。</li>\n<li>单个负载均衡器会导致单点故障，但配置多个负载均衡器会进一步增加复杂性。</li>\n</ul>\n<h1 id="反向代理（web-服务器）"><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%EF%BC%88web-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>反向代理（web 服务器）</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-05-39-d807d98fa50b9cfaf0402ae85a690a75-58792.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 385px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.103896103896105%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABdElEQVQoz21R207CUBDk6/Q79FGjJPqi0e8hUUh49A0fTAiFlHIv0BYRyj3cCr1QCuPuGjUmbrI5ye6e2ZnZGCiiKMJms8F/YZkmskoeiqKg2mzB933sdjsEQYAwDLFarbBYLKTOODH+VKlUkcspaDR0WFYHy+VKhgMaWmy3aCUSaF9eoE2vu9/Dd10BnU6nKBQKyOfzsG1bajHDMASw2/0QME0rIZvNSnNLrO3RCNr9HebnZ9AfHzBmNp6HkPr1eh2qqkLXdck9LYspJMc0LQHkLBY1ZDKvIslxHNjDId5ub/ByeoJMPI7JfA6XWLNEBkmn00gmk6jVal+ALtEvqkXa1hDJzWaTpMzEvz3J9mjISKVQvr5C6/kJEdUPUSR9XsjesqLxePzrYa/XEx8mk8mfg/AAezmazaCWyggPx5/e8XhEp/MOg47GZFzPF1UCyFQ9zxUZ38OcHAzIXjrrNfr9vuRgMIRNL/s/J0+XdGnH2cjsJwJ+AGC7H7nrAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 05 39" title="" data-src="/static/2022-08-26-14-05-39-d807d98fa50b9cfaf0402ae85a690a75-58792.png" data-srcset="/static/2022-08-26-14-05-39-d807d98fa50b9cfaf0402ae85a690a75-f436a.png 200w,\n/static/2022-08-26-14-05-39-d807d98fa50b9cfaf0402ae85a690a75-58792.png 385w" data-sizes="(max-width: 385px) 100vw, 385px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>反向代理是一种可以集中地调用内部服务，并提供统一接口给公共客户的 web 服务器。来自客户端的请求先被反向代理服务器转发到可响应请求的服务器，然后代理再把服务器的响应结果返回给客户端。</p>\n<p>带来的好处包括：</p>\n<ul>\n<li>增加安全性 - 隐藏后端服务器的信息，屏蔽黑名单中的 IP，限制每个客户端的连接数。</li>\n<li>提高可扩展性和灵活性 - 客户端只能看到反向代理服务器的 IP，这使你可以增减服务器或者修改它们的配置。</li>\n<li>\n<p>本地终结 SSL 会话 - 解密传入请求，加密服务器响应，这样后端服务器就不必完成这些潜在的高成本的操作。</p>\n<ul>\n<li>免除了在每个服务器上安装 X.509 证书的需要</li>\n</ul>\n</li>\n<li>压缩 - 压缩服务器响应</li>\n<li>缓存 - 直接返回命中的缓存结果</li>\n<li>\n<p>静态内容 - 直接提供静态内容</p>\n<ul>\n<li>HTML/CSS/JS</li>\n<li>图片</li>\n<li>视频</li>\n<li>等等</li>\n</ul>\n</li>\n</ul>\n<h2 id="负载均衡与反向代理"><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%8E%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>负载均衡与反向代理</h2>\n<ul>\n<li>当你有多个服务器时，部署负载均衡器非常有用。通常，负载均衡器将流量路由给一组功能相同的服务器上。</li>\n<li>即使只有一台 web 服务器或者应用服务器时，反向代理也有用，可以参考上一节介绍的好处。</li>\n<li>NGINX 和 HAProxy 等解决方案可以同时支持第七层反向代理和负载均衡。</li>\n</ul>\n<h2 id="缺点-4"><a href="#%E7%BC%BA%E7%82%B9-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>引入反向代理会增加系统的复杂度。</li>\n<li>单独一个反向代理服务器仍可能发生单点故障，配置多台反向代理服务器（如故障转移）会进一步增加复杂度。</li>\n</ul>\n<h1 id="应用层"><a href="#%E5%BA%94%E7%94%A8%E5%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用层</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-07-56-bdfaad5c34389e816d6157e60cc75e4a-c05da.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 772px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 28.238341968911918%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABcUlEQVQY022RW0/iYBCG+///hdklbnZls6uCWgrZUsBmpdADpfagYKmwRBDLKVmxffzEGy+cZPJmkskz885IfIg8z/f6EPikrRZPUUCcPFI+D/nbjnl5+c9w+E/UHlorZjKZMusarIw2S5GLjoGUP2fkWU62y2D3DlwIIKbJMvTp2D5fCyoVxWCzWXGpdykcapTOTBzHZfUGFMMftTo7y0LytxHGzMROXcLtDQ/bBUnXJC6XhHZw+jeclj1UzSNJ7mg22/z8bVD949Pr9emcnnCrKEQVmUCoJA9qFK1fHHtlLsIqbuwT6TqDk2NGwoLVCyl8a6HUTEajIaqq86PY5kzu74FBrcq4XudeVUkaGlK6SJnNZ8znczbL9d7yMorAtlmJG/b9O7Ghi9a8Zr1OubqyOSrqyIqL5wVsLZONfslTs0Hm2Eh8EvcCNpFlpq7DIJ5y8KWBUrXE03YEYcz3oy4l8ZjxeEpYV4lEb6RU9pZfAToTp7SpvfYyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 07 56" title="" data-src="/static/2022-08-26-14-07-56-bdfaad5c34389e816d6157e60cc75e4a-c05da.png" data-srcset="/static/2022-08-26-14-07-56-bdfaad5c34389e816d6157e60cc75e4a-fc8a7.png 200w,\n/static/2022-08-26-14-07-56-bdfaad5c34389e816d6157e60cc75e4a-51a5a.png 400w,\n/static/2022-08-26-14-07-56-bdfaad5c34389e816d6157e60cc75e4a-c05da.png 772w" data-sizes="(max-width: 772px) 100vw, 772px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>将 Web 服务层与应用层（也被称作平台层）分离，可以独立缩放和配置这两层。添加新的 API 只需要添加应用服务器，而不必添加额外的 web 服务器。</p>\n<p>单一职责原则提倡小型的，自治的服务共同合作。小团队通过提供小型的服务，可以更激进地计划增长。</p>\n<p>应用层中的工作进程也有可以实现异步化。</p>\n<h2 id="微服务"><a href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微服务</h2>\n<p>与此讨论相关的话题是微服务，可以被描述为一系列可以独立部署的小型的，模块化服务。每个服务运行在一个独立的线程中，通过明确定义的轻量级机制通讯，共同实现业务目标。</p>\n<p>例如，Pinterest 可能有这些微服务： 用户资料、关注者、Feed 流、搜索、照片上传等。</p>\n<h2 id="服务发现"><a href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>服务发现</h2>\n<p>像 Consul，Etcd 和 Zookeeper 这样的系统可以通过追踪注册名、地址、端口等信息来帮助服务互相发现对方。Health checks 可以帮助确认服务的完整性和是否经常使用一个 HTTP 路径。Consul 和 Etcd 都有一个内建的 key-value 存储用来存储配置信息和其他的共享信息。</p>\n<h2 id="缺点-5"><a href="#%E7%BC%BA%E7%82%B9-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>添加由多个松耦合服务组成的应用层，从架构、运营、流程等层面来讲将非常不同（相对于单体系统）。</li>\n<li>微服务会增加部署和运营的复杂度。</li>\n</ul>\n<h1 id="数据库"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据库</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-09-39-4af8fae22754e1fc6ee896d0edc8b0f6-23829.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 773px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.33376455368693%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAC7UlEQVQozy2TS28bZRiF5w+w6poFUPUPsGOFBEJcNhULWKAuUBUoVGxQkEBqF1RKuQWpJRJUhXJRoyY4pAk0Na6TpsZO7GQyviW1Pa4TT2xPZsbx+G7P2M7l4YthcRbfq6PzvdJ5XunJwm20L98hf2MU3axQlAPkv3kXbeIjSmoavdxA81xjZ+xttJnr6DUHfdFD/PO3iHz3MZVyhXa3T7Pl0Gq5SPnrF7Fel7DOP407gMbSJNZZif1zp2g92aR7AJUrb2C+JmZjZ+kBtV8+oyze5sgzmLohAgcisDsMlQq3r1K/cBr90xcp2hb26iz2h2fY++QFjGyMVu8Qa+ICtZFnsX74AKMPhamvsUeeo3DpZXS9hOMeUW90aTS7SEWtQGo1hC8o8yC9gz8ZZ/avafzBvwmqCv5UjHBylXsLHh4qMQLZFIGkgs83R3h9BbWQwrANBoND+kJSLPmYQCjCUjhOYtfmj4jKXX+InxeWmNtIs6Kq/PZomW9n7jC9/CdzMYV/EmGmvR6mfPNktITwLfDFZJgJj4xklauYxj5a0UTJ7rKayhPLFnkU3+a+kiO4tctsJMNiPMtkKEEwnREbyqyn1vEqATRrC084yEuXZd68qiC1Oz0cp0+16XJv02I+URIq4kvt4U8bLGds1vNVVnJltq02ke0KnqjOHbnAZrFKtW4QSm9xZa7C+P0qUr3pMHB7PEhUOf+9ys2HBupejcJ+g+XHNhd/ynHNq9MQDTri827X5e6ayfs3d5gO7eM6A5zuIa22M5R00g6HR9zy5Tn1/DnGZ9IM+oKVgwO8ssnpV0Z57ysvHfcYu9aCY/hxPs5TZ15ldHyWE2u90f6fQxHYEBv23T7KdodLvyZYTNZxewfDTdRSh7GpDL+HTHr9Y068PeGN5hpcvrHEoqKLZo+GuDQF1EMOO4LyYkkUokRJp7OEwxFyOQ3TstnY+G8mywrJzRTtTh9DXFM0GiOjbrO2JpPXSnSdwTDsRP8CJSHk/QNZ/AAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 09 39" title="" data-src="/static/2022-08-26-14-09-39-4af8fae22754e1fc6ee896d0edc8b0f6-23829.png" data-srcset="/static/2022-08-26-14-09-39-4af8fae22754e1fc6ee896d0edc8b0f6-a6bd7.png 200w,\n/static/2022-08-26-14-09-39-4af8fae22754e1fc6ee896d0edc8b0f6-ee980.png 400w,\n/static/2022-08-26-14-09-39-4af8fae22754e1fc6ee896d0edc8b0f6-23829.png 773w" data-sizes="(max-width: 773px) 100vw, 773px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="关系型数据库管理系统（rdbms）"><a href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%88rdbms%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关系型数据库管理系统（RDBMS）</h2>\n<p>像 SQL 这样的关系型数据库是一系列以表的形式组织的数据项集合。</p>\n<p>ACID 用来描述关系型数据库事务的特性。</p>\n<ul>\n<li>原子性 - 每个事务内部所有操作要么全部完成，要么全部不完成。</li>\n<li>一致性 - 任何事务都使数据库从一个有效的状态转换到另一个有效状态。</li>\n<li>隔离性 - 并发执行事务的结果与顺序执行事务的结果相同。</li>\n<li>持久性 - 事务提交后，对系统的影响是永久的。</li>\n</ul>\n<p>关系型数据库扩展包括许多技术：主从复制、主主复制、联合、分片、非规范化和 SQL 调优。</p>\n<h3 id="主从复制"><a href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主从复制</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-10-32-c36e945a0bdab324fb8ff787eac788c9-c1ca4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 752px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.76063829787235%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABqklEQVQ4y2WTx67CQAxF8/9fwYqvYMOCBaEKEL230Htvfjp+8igES9Ykjuf62tfxXq+XmIfN3h+Ph5zPZ7ndbuq8Xy4XjXFer1c9+UbMm0wmMpvNZLlc6lkqlaRcLuvZbDZlv99r8vP51CLb7VZqtZr0ej3pdDqy2+0cCYp5xWJRARqNhiYdDgfZbDaaiNszcdgAEovF1OPxuIzHYwX7fD7/gPV6XSqVilSrVWURNWLv99tdWq1WkkqlJJlMSiKRkCAIvhlGAbiMcxmj3fv9rs/H41Hm87m0Wi3p9/sKxgiYIUbeD6BZGNAEsnnxzYrSAeNwDKmKOjiB6XQq6/X6S23igLXbbRXJClhRKwS4R9JwOFQgREHZbrfrVoOCiEYOG8FJLAroRMnlcoIXCgVZLBYu0XbsdDppIXJ835dMJqOxMCBzdC2PRiMxllCGBasSFsnURQTOsDECuoK1igIgicwN5fjIrsECtz0kGUckm7vlsov2c3jpdFqy2ay2xEqYEFymBS7TPuwthsMaIO7n83mdM6Q8WkAQm1/U7N81dmGmxAeDgYrIyOjoD96I3IQDbF1FAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 10 32" title="" data-src="/static/2022-08-26-14-10-32-c36e945a0bdab324fb8ff787eac788c9-c1ca4.png" data-srcset="/static/2022-08-26-14-10-32-c36e945a0bdab324fb8ff787eac788c9-d3808.png 200w,\n/static/2022-08-26-14-10-32-c36e945a0bdab324fb8ff787eac788c9-471e5.png 400w,\n/static/2022-08-26-14-10-32-c36e945a0bdab324fb8ff787eac788c9-c1ca4.png 752w" data-sizes="(max-width: 752px) 100vw, 752px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>主库同时负责读取和写入操作，并复制写入到一个或多个从库中，从库只负责读操作。树状形式的从库再将写入复制到更多的从库中去。如果主库离线，系统可以以只读模式运行，直到某个从库被提升为主库或有新的主库出现。</p>\n<h4 id="缺点-6"><a href="#%E7%BC%BA%E7%82%B9-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>将从库提升为主库需要额外的逻辑。</li>\n<li>主从复制和主主复制共同的问题。</li>\n</ul>\n<h3 id="主主复制"><a href="#%E4%B8%BB%E4%B8%BB%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主主复制</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-13-53-51d1481a4f26fb9a51fbd5cd428db345-d985b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.62162162162162%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABmElEQVQoz41TyYrCQBTs//8BFQQ95RgPnjwIKgTjguK+oXHFXXHfraHe0KJhhHlQJOn2VVdXPRX+WefzGZvNBqfT6QWuEcfjUbBer6EWi4X8kB98Hg4HDIdDjEYj9Pt99Ho9LJdL3G43Ib5cLpjP59hut7LOHl3sVd1uF+12WxqJTqeDXC6HTCaDYrGIfD6PcrksJNPpFIlEAtFoFPF4HJZloVarvQj3+z0Um+v1OprNJgqFgpzyV3H9er0inU7D5/MhEAjA7/cjlUrJ/vP5/CWsVquwbRvJZFKU6s13aA/5TmtisRgMwxC1VK6LPiq3EjfZ4/F4ERLvilutFiqVCkqlkthDcsWm+/0upms131JmICxenRYxEIZD7HY7gRoMBphMJpjNZmI6k+OJtIJh0FcGRzIeTBUkIzgF7P24suM4aDQakq5OmwRs4JP7XONh4/EYkUgEpmkiFAohHA7LVbVVMjaMnqORzWYlQT1v7uIgs+iZx+NBMBiE1+uV8fqYw9VqJUqogl58S/n9n0GbCF6Zo8LgCHr4A2eGNspTQTNnAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 13 53" title="" data-src="/static/2022-08-26-14-13-53-51d1481a4f26fb9a51fbd5cd428db345-d985b.png" data-srcset="/static/2022-08-26-14-13-53-51d1481a4f26fb9a51fbd5cd428db345-7a5d1.png 200w,\n/static/2022-08-26-14-13-53-51d1481a4f26fb9a51fbd5cd428db345-99472.png 400w,\n/static/2022-08-26-14-13-53-51d1481a4f26fb9a51fbd5cd428db345-d985b.png 740w" data-sizes="(max-width: 740px) 100vw, 740px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>两个主库都负责读操作和写操作，写入操作时互相协调。如果其中一个主库挂机，系统可以继续读取和写入。</p>\n<h4 id="缺点-7"><a href="#%E7%BC%BA%E7%82%B9-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>你需要添加负载均衡器或者在应用逻辑中做改动，来确定写入哪一个数据库。</li>\n<li>多数主-主系统要么不能保证一致性（违反 ACID），要么因为同步产生了写入延迟。</li>\n<li>随着更多写入节点的加入和延迟的提高，如何解决冲突显得越发重要。</li>\n<li>主从复制和主主复制共同的问题。</li>\n</ul>\n<h3 id="缺点-8"><a href="#%E7%BC%BA%E7%82%B9-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>如果主库在将新写入的数据复制到其他节点前挂掉，则有数据丢失的可能。</li>\n<li>写入会被重放到负责读取操作的副本。副本可能因为过多写操作阻塞住，导致读取功能异常。</li>\n<li>读取从库越多，需要复制的写入数据就越多，导致更严重的复制延迟。</li>\n<li>在某些数据库系统中，写入主库的操作可以用多个线程并行写入，但读取副本只支持单线程顺序地写入。</li>\n<li>复制意味着更多的硬件和额外的复杂度。</li>\n</ul>\n<h3 id="联合"><a href="#%E8%81%94%E5%90%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>联合</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-17-09-ca750852e3aec1afbb1a9df3982ff012-24f57.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 471px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 148.83227176220808%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAE6UlEQVRIx5WVbUzTVxTG+2nftzkTjTHZsmTOzJAtkS1z+2A0TqPLJmzZjHMjYU42mHEzmyEucZn6QZM5p3NmcRpBHAwpiMMBtgVBsECxrVSgUBQSEIEW+gIttP+2v937bwvlxZfd5OS2t81znnPOc87RBENRpoKReTbzHiWkwFQowhnTKLuvDHBAP0S/RzyKc8Hs4uuKB+RWD9LjnETDQ044ErvlFQnDWCDKzrwWdpxrJf3UDRodLrweHzlaB+8d+pstJxrQ94yjqazSYbG00WbrUK2urgGL1aZ+vnSplJs3m1FCYbwCee2Xh3lu5RqWrPkAXccw7R12tp6oZ2nqFl787AjVdwXDpmYT9fWNNDQYuaarQW+oRTpps7Wj1V5WHShKBG8Q0o6UseydL0j5/CjdrqAaQU6JnRfS9/FS1ikMvYFYyNEkmxuyfJM5DClRHO4wOsc4/1gHKLa5OW108qfJSe09P833g3gmI2gSBUjY3O/JFvOqoG+28WlBJ9vOmskuu4c/GPOuCMeaoBJ9KEDCJDvJMiAqTjhKlw9WZ59g2Wvr2Xz8OsMBASbJCNPEwnmURafvSQkYidLujJDyzXmWp+Wy7qgBoRahhJjzxwLOsEQFDIXANaFw0TLKSZHDYquLiamIyi7OMBFSdAYoNP9tOoePOFKvGpVBMDqvS+YWSP75zoMAZW0uqjrdDPlCRITDzuFJyu94qOz0MuJT0CjhBTwlkZlmKMAP1gySeXmQjNJ+9A6P+vuxhhF2XOxmW4GdK+1uNE6Xmzop7EajuBswGlu4096JoeY65/Py8foChIVTkToyftay6qPvePnjXPLr7PT1ONiVb+aV93NIyfqVgtsCcMzto/qanoqrlZRfqVCBZNsZm1ooLi7B4/VPA354uJCnlq7gmdfTKGrqE6EofFXUzuK1GSzamMPZVtfCISfnPlEQCfqXaZDsvCZyS25j7PVy3xMk75aTPReM7C1qpWUgECvKQqNrVlHilU8ci62LA7p+siud/GR4wNhUnIhomDmymW+qBuOgAaE3WdnuoQnePaYjNfMgm8W0sY9MEg3HhP8EncK0sKVwo2LyDApGb+w9w7Mp61j9/QW6xmId9IStR5wp03oc9othW2Bl0y91bD9npt8dUsNVAR8/GJh1y7Dk7RPj8L4fNX9T8fd5gAvtlGSw8BxFyLxJSz5qyJFH9Ggy2KhfodAyxh/GYf61e5CjzyuGakmbGLZNY1SKN41vPEBpWTk1tfXcEGug4moVJpNZXQM6fa06udWxJY55wC9arIuM4l6ySh34JhW6xezaXthF+umb5JTdRTM+MUnP3T6xcLrETjGoe0V2S61wIC0Yio0mqXbTYIjnN2ayYlMGb+06RM+Ai9IbNt7cV8DyNVtJP1kX65RExHLbSbatt6yzQk4wlHtj8fqdLHp1A2/v+Q2ZUrmsUn/Q8nRqGusOls10igzNYm2julqPWaxVNdSp8KzxNSIG63nTEEeqHRTeGsLcP4HB4eX3xkGO6xyU2kYTnRJPfNKmm6luUmGUGNOgz02+wUpmuRhl2n7yLK6ZKs/V23z9zf7un4p5LRBDYeUnP7Jq+372V/aqKgiISDVzhfswQSf6OZHPvNYRFm/azZINWXyrbVff/kfrxcNWYt0gT2PfONmX7Ows6hBsh9Q8yd/+A4yLb1Ru6KzbAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 17 09" title="" data-src="/static/2022-08-26-14-17-09-ca750852e3aec1afbb1a9df3982ff012-24f57.png" data-srcset="/static/2022-08-26-14-17-09-ca750852e3aec1afbb1a9df3982ff012-ea629.png 200w,\n/static/2022-08-26-14-17-09-ca750852e3aec1afbb1a9df3982ff012-c47ea.png 400w,\n/static/2022-08-26-14-17-09-ca750852e3aec1afbb1a9df3982ff012-24f57.png 471w" data-sizes="(max-width: 471px) 100vw, 471px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>联合（或按功能划分）将数据库按对应功能分割。例如，你可以有三个数据库：论坛、用户和产品，而不仅是一个单体数据库，从而减少每个数据库的读取和写入流量，减少复制延迟。较小的数据库意味着更多适合放入内存的数据，进而意味着更高的缓存命中几率。没有只能串行写入的中心化主库，你可以并行写入，提高负载能力。</p>\n<h4 id="缺点-9"><a href="#%E7%BC%BA%E7%82%B9-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>如果你的数据库模式需要大量的功能和数据表，联合的效率并不好。</li>\n<li>你需要更新应用程序的逻辑来确定要读取和写入哪个数据库。</li>\n<li>用 server link 从两个库联结数据更复杂。</li>\n<li>联合需要更多的硬件和额外的复杂度。</li>\n</ul>\n<h3 id="分片"><a href="#%E5%88%86%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分片</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-18-22-cea9048e3bf0b201e2394c4d3f64bf56-0f51d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 586px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.45733788395904%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAACFklEQVQ4y5VV147CQAzc//+wnJAQTyA6pBEgDQKEDr6M7xyZBXSHpWibPTsu6xi6E/GH4X6vx6IoaLVa0Xq9pu12y3P5LpdLrSc2IkYA9WGWZVSsC14fDgcqy5LKXclnuCiKos8AF4sFzedznkfziLrdHk2nbm3kuu6DN4+ASjTD4XDIbDAXydKM+v1+BT79m6GwhNxuN2bRbrep0+lQo9GgVqtFvV6vZv6K3RPDd0qbzYYZ+75PnufRbrf7jCFGsMQHSdOUXUfGMZ7P5/8B2uUDOZ1ONJuFXDovPbm/cVluE0WUy3g8Js/1KIkTmoUhDQbDOkm2/gOg3tSJGY1G5DgOJ+Try6Fms8k1abur7Y3e1GDH4/HX3RkDAhyskRCc2QRkNDb1/X7PwccIY2QYgkQgjtfrlUfZt+0fXAaADj6MwFbOsZYMw3VdPk8u48HjZYgASNZaR1+IczDWTGtA3CixkTrUbonbwgoCfZul0e5IIQsbW1niqPfAUifmLSCMdYnYDLVnyH4NiAniYBuDoVaUvVd6mrWRW5IkebpZty6Jmd4TXdjKRSYIAi7eyWTCI9iiwUpnCcKAazKOY4IuChwdG3sAxBytzvd/cAyaZZ7j37GisHqviCUO8jyvvoz7H8BgKP8UrNMs5Zj61SXQxWPAhQYs0qoTZ5UCjBAPgMAN7C2XS56DNdxF18YaIAAEibhaAxD231PUrx6d0pRQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 18 22" title="" data-src="/static/2022-08-26-14-18-22-cea9048e3bf0b201e2394c4d3f64bf56-0f51d.png" data-srcset="/static/2022-08-26-14-18-22-cea9048e3bf0b201e2394c4d3f64bf56-e7e34.png 200w,\n/static/2022-08-26-14-18-22-cea9048e3bf0b201e2394c4d3f64bf56-15827.png 400w,\n/static/2022-08-26-14-18-22-cea9048e3bf0b201e2394c4d3f64bf56-0f51d.png 586w" data-sizes="(max-width: 586px) 100vw, 586px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>分片将数据分配在不同的数据库上，使得每个数据库仅管理整个数据集的一个子集。以用户数据库为例，随着用户数量的增加，越来越多的分片会被添加到集群中。</p>\n<p>类似联合的优点，分片可以减少读取和写入流量，减少复制并提高缓存命中率。也减少了索引，通常意味着查询更快，性能更好。如果一个分片出问题，其他的仍能运行，你可以使用某种形式的冗余来防止数据丢失。类似联合，没有只能串行写入的中心化主库，你可以并行写入，提高负载能力。</p>\n<p>常见的做法是用户姓氏的首字母或者用户的地理位置来分隔用户表。</p>\n<h4 id="缺点-10"><a href="#%E7%BC%BA%E7%82%B9-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>你需要修改应用程序的逻辑来实现分片，这会带来复杂的 SQL 查询。</li>\n<li>\n<p>分片不合理可能导致数据负载不均衡。例如，被频繁访问的用户数据会导致其所在分片的负载相对其他分片高。</p>\n<ul>\n<li>再平衡会引入额外的复杂度。基于一致性哈希的分片算法可以减少这种情况。</li>\n</ul>\n</li>\n<li>联结多个分片的数据操作更复杂。</li>\n<li>分片需要更多的硬件和额外的复杂度。</li>\n</ul>\n<h3 id="非规范化"><a href="#%E9%9D%9E%E8%A7%84%E8%8C%83%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>非规范化</h3>\n<p>非规范化试图以写入性能为代价来换取读取性能。在多个表中冗余数据副本，以避免高成本的联结操作。一些关系型数据库，比如 PostgreSQL 和 Oracle 支持物化视图，可以处理冗余信息存储和保证冗余副本一致。</p>\n<p>当数据使用诸如联合和分片等技术被分割，进一步提高了处理跨数据中心的联结操作复杂度。非规范化可以规避这种复杂的联结操作。</p>\n<p>在多数系统中，读取操作的频率远高于写入操作，比例可达到 100:1，甚至 1000:1。需要复杂的数据库联结的读取操作成本非常高，在磁盘操作上消耗了大量时间。</p>\n<h4 id="缺点-11"><a href="#%E7%BC%BA%E7%82%B9-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>数据会冗余。</li>\n<li>约束可以帮助冗余的信息副本保持同步，但这样会增加数据库设计的复杂度。</li>\n<li>非规范化的数据库在高写入负载下性能可能比规范化的数据库差。</li>\n</ul>\n<h3 id="sql-调优"><a href="#sql-%E8%B0%83%E4%BC%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQL 调优</h3>\n<p>SQL 调优是一个范围很广的话题，有很多相关的书可以作为参考。</p>\n<p>利用基准测试和性能分析来模拟和发现系统瓶颈很重要。</p>\n<ul>\n<li>基准测试 - 用 ab 等工具模拟高负载情况。</li>\n<li>性能分析 - 通过启用如慢查询日志等工具来辅助追踪性能问题。</li>\n</ul>\n<p>基准测试和性能分析可能会指引你到以下优化方案。</p>\n<h4 id="改进模式"><a href="#%E6%94%B9%E8%BF%9B%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>改进模式</h4>\n<ul>\n<li>为了实现快速访问，MySQL 在磁盘上用连续的块存储数据。</li>\n<li>\n<p>使用 CHAR 类型存储固定长度的字段，不要用 VARCHAR。</p>\n<ul>\n<li>CHAR 在快速、随机访问时效率很高。如果使用 VARCHAR，如果你想读取下一个字符串，不得不先读取到当前字符串的末尾。</li>\n</ul>\n</li>\n<li>使用 TEXT 类型存储大块的文本，例如博客正文。TEXT 还允许布尔搜索。使用 TEXT 字段需要在磁盘上存储一个用于定位文本块的指针。</li>\n<li>使用 INT 类型存储高达 2^32 或 40 亿的较大数字。</li>\n<li>使用 DECIMAL 类型存储货币可以避免浮点数表示错误。</li>\n<li>避免使用 BLOBS 存储实际对象，而是用来存储存放对象的位置。</li>\n<li>VARCHAR(255) 是以 8 位数字存储的最大字符数，在某些关系型数据库中，最大限度地利用字节。</li>\n<li>在适用场景中设置 NOT NULL 约束来提高搜索性能。</li>\n</ul>\n<h4 id="使用正确的索引"><a href="#%E4%BD%BF%E7%94%A8%E6%AD%A3%E7%A1%AE%E7%9A%84%E7%B4%A2%E5%BC%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用正确的索引</h4>\n<ul>\n<li>你正查询（SELECT、GROUP BY、ORDER BY、JOIN）的列如果用了索引会更快。</li>\n<li>索引通常表示为自平衡的 B 树，可以保持数据有序，并允许在对数时间内进行搜索，顺序访问，插入，删除操作。</li>\n<li>设置索引，会将数据存在内存中，占用了更多内存空间。</li>\n<li>写入操作会变慢，因为索引需要被更新。</li>\n<li>加载大量数据时，禁用索引再加载数据，然后重建索引，这样也许会更快。</li>\n</ul>\n<h4 id="避免高成本的联结操作"><a href="#%E9%81%BF%E5%85%8D%E9%AB%98%E6%88%90%E6%9C%AC%E7%9A%84%E8%81%94%E7%BB%93%E6%93%8D%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>避免高成本的联结操作</h4>\n<ul>\n<li>有性能需要，可以进行非规范化。</li>\n</ul>\n<h4 id="分割数据表"><a href="#%E5%88%86%E5%89%B2%E6%95%B0%E6%8D%AE%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分割数据表</h4>\n<ul>\n<li>将热点数据拆分到单独的数据表中，可以有助于缓存。</li>\n</ul>\n<h4 id="调优查询缓存"><a href="#%E8%B0%83%E4%BC%98%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调优查询缓存</h4>\n<ul>\n<li>在某些情况下，查询缓存可能会导致性能问题。</li>\n</ul>\n<h2 id="nosql"><a href="#nosql" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NoSQL</h2>\n<p>NoSQL 是键-值数据库、文档型数据库、列型数据库或图数据库的统称。数据库是非规范化的，表联结大多在应用程序代码中完成。大多数 NoSQL 无法实现真正符合 ACID 的事务，支持最终一致。</p>\n<p>BASE 通常被用于描述 NoSQL 数据库的特性。相比 CAP 理论，BASE 强调可用性超过一致性。</p>\n<ul>\n<li>基本可用 - 系统保证可用性。</li>\n<li>软状态 - 即使没有输入，系统状态也可能随着时间变化。</li>\n<li>最终一致性 - 经过一段时间之后，系统最终会变一致，因为系统在此期间没有收到任何输入。</li>\n</ul>\n<p>除了在 SQL 还是 NoSQL 之间做选择，了解哪种类型的 NoSQL 数据库最适合你的用例也是非常有帮助的。我们将在下一节中快速了解下键-值存储、文档型存储、列型存储和图存储数据库。</p>\n<h3 id="键-值存储"><a href="#%E9%94%AE-%E5%80%BC%E5%AD%98%E5%82%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>键-值存储</h3>\n<blockquote>\n<p>抽象模型：哈希表</p>\n</blockquote>\n<p>键-值存储通常可以实现 O(1) 时间读写，用内存或 SSD 存储数据。数据存储可以按字典顺序维护键，从而实现键的高效检索。键-值存储可以用于存储元数据。</p>\n<p>键-值存储性能很高，通常用于存储简单数据模型或频繁修改的数据，如存放在内存中的缓存。键-值存储提供的操作有限，如果需要更多操作，复杂度将转嫁到应用程序层面。</p>\n<p>键-值存储是如文档存储，在某些情况下，甚至是图存储等更复杂的存储系统的基础。</p>\n<h3 id="文档存储"><a href="#%E6%96%87%E6%A1%A3%E5%AD%98%E5%82%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>文档存储</h3>\n<blockquote>\n<p>抽象模型：将文档作为值的键-值存储</p>\n</blockquote>\n<p>文档类型存储以文档（XML、JSON、二进制文件等）为中心，文档存储了指定对象的全部信息。文档存储根据文档自身的内部结构提供 API 或查询语句来实现查询。请注意，许多键-值存储数据库有用值存储元数据的特性，这也模糊了这两种存储类型的界限。</p>\n<p>基于底层实现，文档可以根据集合、标签、元数据或者文件夹组织。尽管不同文档可以被组织在一起或者分成一组，但相互之间可能具有完全不同的字段。</p>\n<p>MongoDB 和 CouchDB 等一些文档类型存储还提供了类似 SQL 语言的查询语句来实现复杂查询。DynamoDB 同时支持键-值存储和文档类型存储。</p>\n<p>文档类型存储具备高度的灵活性，常用于处理偶尔变化的数据。</p>\n<h3 id="列型存储"><a href="#%E5%88%97%E5%9E%8B%E5%AD%98%E5%82%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列型存储</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-23-39-26f9b6c5be5be64c54c3537c546e2cdc-49396.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 526px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.06463878326996%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQozzWSW08aURSF/dd9ayx9KV5IbdpGvFsbqlAUL1i5CAiiMzgwCHaAwQ5UoUURKFhJbJP5utX0YWWf7LPWytpnnxF7OIR2GzqdJ9zcSBVcX4OqgqKArkMmA7kcxONwfg69nnDbT/z/GtGP0O0STCu89G0xsRFkTDARCDG5EcIVCOP07uBYXGN0YZUXy77H/uT6Hq7H+4jUsOjCuNZDtNoPhuKaCEaZ9YdZFsIH3x7uj0u89i0wtTqLc24c54yT8fkxJqdfMeVbZGpjBZd3gQnPO+G5ebM+J303P60qI/bfP9RPqxiNO4yLPma1RznloVSa5ii9hH/TQyQRIJWNoif9FLLvyRdmOFbcfN72kFBDKIUEKS1Cr3MtCes1TKPOUa1HstREtwZYiUX6xjiWFiCye8r+7gkH+yUqMZWLmAMr7qCpTBPbUsnsn1E8stAPyvR/3YphPk9ZDNXGkJOLATkxrMbnaWijmKqXgP+Q6O6x7OMH5uYX6tvPaMSfc6O8JeQJc7iZJB/VyYaz9EumGMrGLosVDLNJudqgUqzRkNFaxhqXX1No6SJ59YyqpG/u7EmyZZr5T3SMINpBDqtQ45vALFjclSpiaNtwO0DywqAv36ErkLP1HTT5JuUynGjIo2JfXQnnN8hotl7gYTquWqK/fdLf3/MP/VAdvj7T6KEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 23 39" title="" data-src="/static/2022-08-26-14-23-39-26f9b6c5be5be64c54c3537c546e2cdc-49396.png" data-srcset="/static/2022-08-26-14-23-39-26f9b6c5be5be64c54c3537c546e2cdc-68c83.png 200w,\n/static/2022-08-26-14-23-39-26f9b6c5be5be64c54c3537c546e2cdc-d339c.png 400w,\n/static/2022-08-26-14-23-39-26f9b6c5be5be64c54c3537c546e2cdc-49396.png 526w" data-sizes="(max-width: 526px) 100vw, 526px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<blockquote>\n<p>抽象模型：嵌套的 <code class="language-text">ColumnFamily&lt;RowKey, Columns&lt;ColKey, Value, Timestamp&gt;&gt;</code> 映射</p>\n</blockquote>\n<p>类型存储的基本数据单元是列（名/值对）。列可以在列族（类似于 SQL 的数据表）中被分组。超级列族再分组普通列族。你可以使用行键独立访问每一列，具有相同行键值的列组成一行。每个值都包含版本的时间戳用于解决版本冲突。</p>\n<p>Google 发布了第一个列型存储数据库 Bigtable，它影响了 Hadoop 生态系统中活跃的开源数据库 HBase 和 Facebook 的 Cassandra。像 BigTable，HBase 和 Cassandra 这样的存储系统将键以字母顺序存储，可以高效地读取键列。</p>\n<p>列型存储具备高可用性和高可扩展性。通常被用于大数据相关存储。</p>\n<h3 id="图数据库"><a href="#%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图数据库</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-24-30-96f72c9683531229b3cd331e6a85000c-571e1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 584px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.34931506849314%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACnUlEQVQ4y31TC0/aUBjlZ+8PLHHJEp1mUaMzzsc2N7UKEmwKCEwZr4KWRxHKq1JeLSAotuV1dluEoHH7ki/39t58p+e753wWvBHj8Xi2zuf82Wg0Mr9rUgkXtn24Tndwl7+F5X9gr8+nIPPhPNmBj6bwx0uDob6+DTgFMwBkWYaqqrP7Xq8HRVFQq9dBHR9if+0DnA4rmHM77D83J4Cv25oyaTQaYFkWLpcLPp8P4XAYHMeZSdM0qFMbaOsB7D/WzfScU7CMx6M5diMMh0Nzb6xutxsURSEUCplMdV2HJElgo1Gkk0n06hIKXBTWzRUkriPQ9P6EYb/fR+/xYQbc7XYRJUXxeByDwcA8q1arCAaDSBKgzn0baqMC4cqFLBuEJGRmtRa5VsZvxwG8Z/vgrwNIpXgwDGOCiaKISCRiMjRaNNYyYTjQNSg5HumrC3RaTQgRP3pKfQJIH22DsR3A73XC9n0Ny4sfEbvhUCyJKN2VofcHaLXbiJN3EwTBfFddUyGyfkjZNBqlPDKE6eDpcQJ4svcZbgeR/dJLANfB7K6hVhDQkWvolIskC6gKaTxp2gs3PNy3kAn7UUxyaJZyGD8LaYlHgzjaXob12yqchOmN34fElQeVXBbibQrJSzcSzjNUeG7mgnZNQsz+C8zGItqKbMhJnDER0xRFKovIkmKNqGhEs15FIXmDhliASsTqkJaLfMIUQGADuCQEosc7COytIuU5f+Ffy+uJMOKpJUPO3SIT8CJH7JDnYhDTSSQI+7OVBQR2V1GMhZBibPB8WYL2bPwZoNG/YeYpuNq9R4fMaJMoqQi8eT/9b54wty+8A0/Gzb+1BNfWCoZz4/rPWTbN3dcxIIrOT9GQgAccJ7B9eg/HxhIqpcKk7pnQX0Q//TTVq6J+AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 24 30" title="" data-src="/static/2022-08-26-14-24-30-96f72c9683531229b3cd331e6a85000c-571e1.png" data-srcset="/static/2022-08-26-14-24-30-96f72c9683531229b3cd331e6a85000c-2fa92.png 200w,\n/static/2022-08-26-14-24-30-96f72c9683531229b3cd331e6a85000c-52932.png 400w,\n/static/2022-08-26-14-24-30-96f72c9683531229b3cd331e6a85000c-571e1.png 584w" data-sizes="(max-width: 584px) 100vw, 584px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<blockquote>\n<p>抽象模型： 图</p>\n</blockquote>\n<p>在图数据库中，一个节点对应一条记录，一个弧对应两个节点之间的关系。图数据库被优化用于表示外键繁多的复杂关系或多对多关系。</p>\n<p>图数据库为存储复杂关系的数据模型，如社交网络，提供了很高的性能。它们相对较新，尚未广泛应用，查找开发工具或者资源相对较难。许多图只能通过 REST API 访问。</p>\n<h2 id="sql-还是-nosql"><a href="#sql-%E8%BF%98%E6%98%AF-nosql" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQL 还是 NoSQL</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-25-39-8930b47c9803a7c3193b0fbf92bb9495-9c82e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 495px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.93939393939393%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACG0lEQVQoz22SSY/TQBCF8/9/BBckbggBc5gTyUxWZ9+8t9tO4o5DNuIlmSFeHuUeAhKhpCeXWqWv33N1pShyjJ2vGLJPGLEvpM+YOA/o6B+wO7koK88zUo4Cf0v1T1Lse4wO26Nt7+R5pZyy+Ay6NYJuj2DYYxhsjJnexSk8/AbmUmUVRQEziNB1DmCbGPo6xMfuEg1zi59pTkAqXyywWHokjuXKk+IuQ5LEd8DocgUnV1leSPjDSGDkHWFvIrxcszegt2RwXItkEsgC9yxYTEUch3fA5DWFLkJopSjyfHWCRY7L/lUCKfJy5cL1HBKDu3DgkZhjIk6iO2DposcPeN9w8e7JweM0gLdL5CXSYVECfY8gnJw6FNuVcrj1X2B4foEpTnAoNt/GEMczVBFBsTa4puktsk0RdVrIHKatUq/BsGb0D++BwZ5gm7fz0znFdBmhOmK0SI70ekXlcrlgHaxpMT4Wi9KpB0H9OhA4Ho9/NnsD/ggjzLnAUHdQ683x2J5hphnYrAUlSlDhnONbtYau0kWvN4CiKJhMJhgMhmg0mhJWKssyCdQ0jWY7aLUaUNotKK06zY9RrzfQ7/dRsW0bk+kUhmHCMEmGAZO+UzpTNfWfp5NBN3Roug7f92meXoNlwSTZNpN9ZbvdIggC9AcDVGs1VKtV6UwIgWAT4HI5S+DNYRiGGAyHaJO75+c6ak81NJtNmWx/OOAXhsMquKEqkSEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 25 39" title="" data-src="/static/2022-08-26-14-25-39-8930b47c9803a7c3193b0fbf92bb9495-9c82e.png" data-srcset="/static/2022-08-26-14-25-39-8930b47c9803a7c3193b0fbf92bb9495-84a0c.png 200w,\n/static/2022-08-26-14-25-39-8930b47c9803a7c3193b0fbf92bb9495-afbfd.png 400w,\n/static/2022-08-26-14-25-39-8930b47c9803a7c3193b0fbf92bb9495-9c82e.png 495w" data-sizes="(max-width: 495px) 100vw, 495px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>选取 SQL 的原因:</p>\n<ul>\n<li>结构化数据</li>\n<li>严格的模式</li>\n<li>关系型数据</li>\n<li>需要复杂的联结操作</li>\n<li>事务</li>\n<li>清晰的扩展模式</li>\n<li>既有资源更丰富：开发者、社区、代码库、工具等</li>\n<li>通过索引进行查询非常快</li>\n</ul>\n<p>选取 NoSQL 的原因：</p>\n<ul>\n<li>半结构化数据</li>\n<li>动态或灵活的模式</li>\n<li>非关系型数据</li>\n<li>不需要复杂的联结操作</li>\n<li>存储 TB （甚至 PB）级别的数据</li>\n<li>高数据密集的工作负载</li>\n<li>IOPS 高吞吐量</li>\n</ul>\n<p>适合 NoSQL 的示例数据：</p>\n<ul>\n<li>埋点数据和日志数据</li>\n<li>排行榜或者得分数据</li>\n<li>临时数据，如购物车</li>\n<li>频繁访问的（“热”）表</li>\n<li>元数据/查找表</li>\n</ul>\n<h1 id="缓存"><a href="#%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缓存</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-27-15-5d65ae45e20953d29c896cea47cd5d53-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.904522613065325%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACa0lEQVQoz12TW08TURSF+3t89B8YfwFv+gd8NTEkxkd90ERNTIgYXzAkKvUCiAgBESRCoHJrbQuF6YWWTgtlOtOZaefSmbbzeZgiGNbJelnZZ2ets/eJyDUVRTM4VrSQimbScn2atofV7tBoOjRMmzN0ul26vR4bG5ss/VxmbT3G5tY27bYX6hAQyUgFspLEwsICqysrxONxZFlGLpdDXdMamHYbR1yyXQ/X87mKTqeL2/ZFjU+kJJ+Iy0f8jsVIJOKkkkli6+tks1lSqSSmaaAaFp5/2Ug3m8ztVBhbzvJh9ZCThhPqYUOl0aJSq5OR8qQzEge5Q1J7Erbj0gtANR1qmtV3ImjUahzniwzN7HNveIGH0T98W03z7uMX9KZNpBda7tC7EsO0HCqndWy7KajjWBZ6Po+n67SEw/l4hU/rMpMbFfYKVXYSKZqWS+Q0sUR+/BnlmZfUc2m0kxOqFRU59Zn999fJjd/gMHqNeuI1rVwVWz2lLFI8GU9x5/ksg282mfstMb/4KzQRqe38IBN9THF6iMZ+AlvK0iwdi+ZLlGYHyH+9xeHMAFpyDLeqge+FCY6UFrtFhZJis5crMTE9Jxw6/ci+5+GLSV1FQ+9i7x2Fb+e32jQLeQxVDVfEEqulmi6G7V3Ut70OEYLgQgiCnmDQpzhSMc1BehXFVOie13UNg3w6w9PJXe4OL3F/dJtYpkqhWOq/4UWDkIjJ9sdTNco8WrzN4NRNhtceiD27TOCLnZzdkhn9vstETGYxlubVyFvxASzh8AqCcyeGozOVGiG69YKVwgwtEe3spwT/JfqHrtDrDTNc/L/YYyNRypZTDAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 27 15" title="" data-src="/static/2022-08-26-14-27-15-5d65ae45e20953d29c896cea47cd5d53-f1168.png" data-srcset="/static/2022-08-26-14-27-15-5d65ae45e20953d29c896cea47cd5d53-ad772.png 200w,\n/static/2022-08-26-14-27-15-5d65ae45e20953d29c896cea47cd5d53-4f4c3.png 400w,\n/static/2022-08-26-14-27-15-5d65ae45e20953d29c896cea47cd5d53-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>缓存可以提高页面加载速度，并可以减少服务器和数据库的负载。在这个模型中，分发器先查看请求之前是否被响应过，如果有则将之前的结果直接返回，来省掉真正的处理。</p>\n<p>数据库分片均匀分布的读取是最好的。但是热门数据会让读取分布不均匀，这样就会造成瓶颈，如果在数据库前加个缓存，就会抹平不均匀的负载和突发流量对数据库的影响。</p>\n<h2 id="客户端缓存"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端缓存</h2>\n<p>缓存可以位于客户端（操作系统或者浏览器），服务端或者不同的缓存层。</p>\n<h2 id="cdn-缓存"><a href="#cdn-%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 缓存</h2>\n<p>CDN 也被视为一种缓存。</p>\n<h2 id="web-服务器缓存"><a href="#web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web 服务器缓存</h2>\n<p>反向代理和缓存（比如 Varnish）可以直接提供静态和动态内容。Web 服务器同样也可以缓存请求，返回相应结果而不必连接应用服务器。</p>\n<h2 id="数据库缓存"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据库缓存</h2>\n<p>数据库的默认配置中通常包含缓存级别，针对一般用例进行了优化。调整配置，在不同情况下使用不同的模式可以进一步提高性能。</p>\n<h2 id="应用缓存"><a href="#%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用缓存</h2>\n<p>基于内存的缓存比如 Memcached 和 Redis 是应用程序和数据存储之间的一种键值存储。由于数据保存在 RAM 中，它比存储在磁盘上的典型数据库要快多了。RAM 比磁盘限制更多，所以例如 Least Recently Used (LRU) 的缓存无效算法可以将「热门数据」放在 RAM 中，而对一些比较「冷门」的数据不做处理。</p>\n<p>Redis 有下列附加功能：</p>\n<ul>\n<li>持久性选项</li>\n<li>内置数据结构比如有序集合和列表</li>\n</ul>\n<p>有多个缓存级别，分为两大类：数据库查询和对象：</p>\n<ul>\n<li>行级别</li>\n<li>查询级别</li>\n<li>完整的可序列化对象</li>\n<li>完全渲染的 HTML</li>\n</ul>\n<p>一般来说，你应该尽量避免基于文件的缓存，因为这使得复制和自动缩放很困难。</p>\n<h2 id="数据库查询级别的缓存"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据库查询级别的缓存</h2>\n<p>当你查询数据库的时候，将查询语句的哈希值与查询结果存储到缓存中。这种方法会遇到以下问题：</p>\n<ul>\n<li>很难用复杂的查询删除已缓存结果。</li>\n<li>如果一条数据比如表中某条数据的一项被改变，则需要删除所有可能包含已更改项的缓存结果。</li>\n</ul>\n<h2 id="对象级别的缓存"><a href="#%E5%AF%B9%E8%B1%A1%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对象级别的缓存</h2>\n<p>将您的数据视为对象，就像对待你的应用代码一样。让应用程序将数据从数据库中组合到类实例或数据结构中：</p>\n<ul>\n<li>如果对象的基础数据已经更改了，那么从缓存中删掉这个对象。</li>\n<li>允许异步处理：workers 通过使用最新的缓存对象来组装对象。</li>\n</ul>\n<p>建议缓存的内容：</p>\n<ul>\n<li>用户会话</li>\n<li>完全渲染的 Web 页面</li>\n<li>活动流</li>\n<li>用户图数据</li>\n</ul>\n<h2 id="何时更新缓存"><a href="#%E4%BD%95%E6%97%B6%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>何时更新缓存</h2>\n<p>由于你只能在缓存中存储有限的数据，所以你需要选择一个适用于你用例的缓存更新策略。</p>\n<h3 id="缓存模式"><a href="#%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缓存模式</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-29-42-2a537e05e57d5d05900fc376f3bdb577-a2e9a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 687px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.174672489082965%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABhUlEQVQoz32SfWvaUBSH8/0/wChF2EpFWOwLUZNo7AirtaPYxdhsMZm11vmHr6HWiWKiPrtJ0TLW7cCPe8/lnueelyvxH9tut39pZ/P5HFVVKZVKGIZBPp+n3W4jRVHEcrlkuVi8SvhRGP4B2FkozhfiTqVSQVEUZFkmnU4n+xgq6ZZN/ptL0W9R9FrJmnNc9Hpjn2UMCIKAfr/PcDhkMplQq9U4PT3jWMAymQzZ7AmapiGd2w7aY493ukHK/MzhJ5PCQ5ePtxaWZSWQ8XicQONqXtuxEdAbqtXKXs/PU6QTq0FBAA8uTA7KJofmJcp9B/mrje/7jEajRLPZjNVqtQf2en2s+j2Nxk9suyvUwXFaSNeuh+n9oPrwmOiq3Xnxm94+OAZNp1MGg0GScRCMxTBuODu3KBku5QsfveiiandIInc2Ucg6fNEmVlzaG5ONbb3eiNKeuKo2kbNfODoqkkrleP9B5875hSRC3v4y//g2uweaXldkVccof6eg1lFyop/XTX4Dw2BDbuGvDfUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 29 42" title="" data-src="/static/2022-08-26-14-29-42-2a537e05e57d5d05900fc376f3bdb577-a2e9a.png" data-srcset="/static/2022-08-26-14-29-42-2a537e05e57d5d05900fc376f3bdb577-b5b37.png 200w,\n/static/2022-08-26-14-29-42-2a537e05e57d5d05900fc376f3bdb577-68786.png 400w,\n/static/2022-08-26-14-29-42-2a537e05e57d5d05900fc376f3bdb577-a2e9a.png 687w" data-sizes="(max-width: 687px) 100vw, 687px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>应用从存储器读写。缓存不和存储器直接交互，应用执行以下操作：</p>\n<ul>\n<li>在缓存中查找记录，如果所需数据不在缓存中</li>\n<li>从数据库中加载所需内容</li>\n<li>将查找到的结果存储到缓存中</li>\n<li>返回所需内容</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67028306438078360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_user(self, user_id):\n    user = cache.get(&quot;user.{0}&quot;, user_id)\n    if user is None:\n        user = db.query(&quot;SELECT * FROM users WHERE user_id = {0}&quot;, user_id)\n        if user is not None:\n            key = &quot;user.{0}&quot;.format(user_id)\n            cache.set(key, json.dumps(user))\n    return user`, `67028306438078360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    user <span class="token operator">=</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user.{0}"</span><span class="token punctuation">,</span> user_id<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        user <span class="token operator">=</span> db<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"SELECT * FROM users WHERE user_id = {0}"</span><span class="token punctuation">,</span> user_id<span class="token punctuation">)</span>\n        <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            key <span class="token operator">=</span> <span class="token string">"user.{0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span>\n            cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> user</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Memcached 通常用这种方式使用。</p>\n<p>添加到缓存中的数据读取速度很快。缓存模式也称为延迟加载。只缓存所请求的数据，这避免了没有被请求的数据占满了缓存空间。</p>\n<h4 id="缺点-12"><a href="#%E7%BC%BA%E7%82%B9-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>请求的数据如果不在缓存中就需要经过三个步骤来获取数据，这会导致明显的延迟。</li>\n<li>如果数据库中的数据更新了会导致缓存中的数据过时。这个问题需要通过设置 TTL 强制更新缓存或者直写模式来缓解这种情况。</li>\n<li>当一个节点出现故障的时候，它将会被一个新的节点替代，这增加了延迟的时间。</li>\n</ul>\n<h3 id="直写模式"><a href="#%E7%9B%B4%E5%86%99%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直写模式</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-31-34-51ac6e0bac614d18406ddf507d49af11-8c2fd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 381px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 182.41469816272968%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsSAAALEgHS3X78AAADZElEQVRIx52WWVPqQBCF8///hQ9WuaCWoE/IxdJiU8t9B5VFwX1DliDQl2+wQ0iCcG9TU5kkw+me7j5nYknPut2u6PXr60vq9brc399LoVCQYrHojNvbW3l4eJBKpWJGtVoVNcWwdAIIAAAxnp+fxWtvb2/y8fEhtm2b9eVy2Thyg1pM2u22XF1dSaPRGAJQZ7/Zy8uLiXwI8OnpSbLZrCg4LxSMaGr1mrRatnQ6HecdcyyTycj5+bmZ88wAfn9/y+rqqhwfHzueut3+HyqVsoQjYYmurRlng/d9hzc3N5LP5wcR6ovT01M5OjpyPGkUDLsXHU71TzzTnWB7e3smp6YoGiEPR5kb3GupVEo2Nzf9EfIiFApJLpuTz89PqdVqcnZ2JtfX1z4QnMfjcZmbmzOparVafkCMHC4uLsrU1JQZ8/PzMj09LTMzM7KysiLhcNjcs2ZjY2PImdOHQe1BfjRn5CaZTJqoyPHj46MvHW5iWO4bLYbbms2mvL6++hwyNK/uYamHoKERwohJzXI3atBo9waAMIIipdNpk08amlbb2toypFhfX5dEItHP4TgjylKpZPjNlVzmcjkjFCoah4eHBthCCC4uLiQWi8n29racnJyY7ufZ7u6uWQg1GRNtGQXBCy1DJdkWngBjOwBSWdZ5CzJI1SBlE20Zydrf3w9k0OCmP3xFwZAx8nJ3d2eiI2pSQmEoEM+ZD/WhF9AtSagHYsvWUGWoWG/Ue2peNc6g5cHBwVBDO4BeAcAQW1Vs225KOpOWRCopxV6F1citrh8LCEeJgHOj1CtYvpD/iTpvUkH09OFQhFrlIE5yUEWjUVlaWpJIJCILoQUjCjT08vKyea4q7WWX9WvlXHwO6kM3owIB3VvwRgwBJjm4JgKEerSKdgA5RmBhFsWBijs7OzI7Ozuisbv+vNJ/KmVwGGrCLjpCPwgo5FimKCD96BXXsVsetXUF1MJ4Jc5NjMAqBwFSGAX05tjMf37WuK2qkR/4rBH61nmZEhQhYooqU2EYQuIpzuXlpSlKoDiMioxTD8mCfqo6bJk5PYleIhojuewF5CMJ9XZOut429WjFiFBFN5DLXkC+BmhYBaGBY3/izjpS8f7+/v8RdrrD3zbk8Z8i5MqRyfnCEUC+GMwpEJ8iCK0X8C/568u1YLo87QAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 31 34" title="" data-src="/static/2022-08-26-14-31-34-51ac6e0bac614d18406ddf507d49af11-8c2fd.png" data-srcset="/static/2022-08-26-14-31-34-51ac6e0bac614d18406ddf507d49af11-65055.png 200w,\n/static/2022-08-26-14-31-34-51ac6e0bac614d18406ddf507d49af11-8c2fd.png 381w" data-sizes="(max-width: 381px) 100vw, 381px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>应用使用缓存作为主要的数据存储，将数据读写到缓存中，而缓存负责从数据库中读写数据。</p>\n<ul>\n<li>应用向缓存中添加/更新数据</li>\n<li>缓存同步地写入数据存储</li>\n<li>返回所需内容</li>\n</ul>\n<p>应用代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29725106822642220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`set_user(12345, {&quot;foo&quot;:&quot;bar&quot;})`, `29725106822642220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">set_user<span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"foo"</span><span class="token punctuation">:</span><span class="token string">"bar"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>缓存代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47364996332945880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def set_user(user_id, values):\n    user = db.query(&quot;UPDATE Users WHERE id = {0}&quot;, user_id, values)\n    cache.set(user_id, user)`, `47364996332945880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">set_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    user <span class="token operator">=</span> db<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"UPDATE Users WHERE id = {0}"</span><span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> values<span class="token punctuation">)</span>\n    cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> user<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>由于存写操作所以直写模式整体是一种很慢的操作，但是读取刚写入的数据很快。相比读取数据，用户通常比较能接受更新数据时速度较慢。缓存中的数据不会过时。</p>\n<h4 id="缺点-13"><a href="#%E7%BC%BA%E7%82%B9-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>由于故障或者缩放而创建的新的节点，新的节点不会缓存，直到数据库更新为止。缓存应用直写模式可以缓解这个问题。</li>\n<li>写入的大多数数据可能永远都不会被读取，用 TTL 可以最小化这种情况的出现。</li>\n</ul>\n<h3 id="回写模式"><a href="#%E5%9B%9E%E5%86%99%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>回写模式</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-33-01-1d083ad9c54fe3d550907afaed7c3924-4d589.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 713px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 96.07293127629733%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAB2ElEQVQ4y5WU6W7CMBCE8/6Pxg8QEgIR7hsSCJBwH9nybbFrmdAWS4uDY8/OzK4TyGPs93vZbDayXq9lt9vpzP/tdiv3+50tkuf540e+Ry6vz88IDoeDzGYzexDA6/Wqz1EUKbABVNC/AGHX7/fFjMViIZfLRQzz6XT6GSBsms2mHhwMBrJarSRJVtJqtaRWq0mWZZ8BsnY8HmU4HMp4PJZ6vS69Xs9KNcOA2VmcBM4I/IXT6aQJkiTRosAYn12WfrhFCziEbzBaLpdaYYoBY2aswMt3wwcNAEBqHMcKMp/PLSMSjEYj9bbb7erMe1Sw53w+v4BaychkAyCwTdNUGSKZZKwz428UR2oHSVDnehuY/iOzKQpMOAiYP+iISqUi1WpVwjDUxPSulWyQYdjpdBSo3W6r1CKfUIECwlwAWut2u/1ILiq/v85hGh5F/n78xFcFdCvEZhMuIwpHo08mE1ugRqOhcglz51Wy2OZ/7S1sMP7gbblc1iiVSnr/i9QF7vXxbwMy8AdmMKQIYTNUj2FJmxGwNhH4d9PNiBQYAow0vMqyVBudRCZ4x8zeQoYAmDai2nj432E9dNmtnx9bGJKZ5n13j/0oZEiP4RtSaG7Tk7Zgv3y+vgDu1MH/4DsDrAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 33 01" title="" data-src="/static/2022-08-26-14-33-01-1d083ad9c54fe3d550907afaed7c3924-4d589.png" data-srcset="/static/2022-08-26-14-33-01-1d083ad9c54fe3d550907afaed7c3924-b9753.png 200w,\n/static/2022-08-26-14-33-01-1d083ad9c54fe3d550907afaed7c3924-7c7b5.png 400w,\n/static/2022-08-26-14-33-01-1d083ad9c54fe3d550907afaed7c3924-4d589.png 713w" data-sizes="(max-width: 713px) 100vw, 713px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在回写模式中，应用执行以下操作：</p>\n<ul>\n<li>在缓存中增加或者更新条目</li>\n<li>异步写入数据，提高写入性能。</li>\n</ul>\n<h4 id="缺点-14"><a href="#%E7%BC%BA%E7%82%B9-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>缓存可能在其内容成功存储之前丢失数据。</li>\n<li>执行直写模式比缓存或者回写模式更复杂。</li>\n</ul>\n<h3 id="刷新"><a href="#%E5%88%B7%E6%96%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>刷新</h3>\n<p>你可以将缓存配置成在到期之前自动刷新最近访问过的内容。</p>\n<p>如果缓存可以准确预测将来可能请求哪些数据，那么刷新可能会导致延迟与读取时间的降低。</p>\n<h4 id="缺点-15"><a href="#%E7%BC%BA%E7%82%B9-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>不能准确预测到未来需要用到的数据可能会导致性能不如不使用刷新。</li>\n</ul>\n<h3 id="缺点-16"><a href="#%E7%BC%BA%E7%82%B9-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>需要保持缓存和真实数据源之间的一致性，比如数据库根据缓存无效。</li>\n<li>需要改变应用程序比如增加 Redis 或者 memcached。</li>\n<li>无效缓存是个难题，什么时候更新缓存是与之相关的复杂问题。</li>\n</ul>\n<h1 id="异步"><a href="#%E5%BC%82%E6%AD%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-35-21-aca9875021a34a2e3e1e469c84e54bdb-82c98.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 781px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 20.614596670934702%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAABAUlEQVQY0yWPy26CUABE+f9/0YWbptWqMSitgoiAlYdtQ0WgYvBRQK1wek0nmcXM4kxGQqi6VtR1TfV7E+He1Jj2FlUvmJklY+3E13pPeTrwrU5YPD2yU1V2YYDjbRkqMb2+j6ZnSJ/7gEXu8BprGAcL9+edNEswrYyXSSF8EOArrp+wjTc4vR6jZgOv2yWNQqZmQKOlCY95HqyQtJVOx+/T1Fo8vLXpuzJB+IExT5GVjO4gFND8HxitiS2LveeS2DapsySYaiTmnKPvEVkm0v3iOT9TFiVFXnC73D9XWIsMwwJ7CVPjJkaOHJOIQlFgblAJ0KbTJpNlMGYw08lGQ/4AgdofqXPWmyAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 35 21" title="" data-src="/static/2022-08-26-14-35-21-aca9875021a34a2e3e1e469c84e54bdb-82c98.png" data-srcset="/static/2022-08-26-14-35-21-aca9875021a34a2e3e1e469c84e54bdb-ee9e5.png 200w,\n/static/2022-08-26-14-35-21-aca9875021a34a2e3e1e469c84e54bdb-b8c14.png 400w,\n/static/2022-08-26-14-35-21-aca9875021a34a2e3e1e469c84e54bdb-82c98.png 781w" data-sizes="(max-width: 781px) 100vw, 781px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>异步工作流有助于减少那些原本顺序执行的请求时间。它们可以通过提前进行一些耗时的工作来帮助减少请求时间，比如定期汇总数据。</p>\n<h2 id="消息队列"><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息队列</h2>\n<p>消息队列接收，保留和传递消息。如果按顺序执行操作太慢的话，你可以使用有以下工作流的消息队列：</p>\n<ul>\n<li>应用程序将作业发布到队列，然后通知用户作业状态</li>\n<li>一个 worker 从队列中取出该作业，对其进行处理，然后显示该作业完成</li>\n</ul>\n<p>不去阻塞用户操作，作业在后台处理。在此期间，客户端可能会进行一些处理使得看上去像是任务已经完成了。例如，如果要发送一条推文，推文可能会马上出现在你的时间线上，但是可能需要一些时间才能将你的推文推送到你的所有关注者那里去。</p>\n<p>Redis 是一个令人满意的简单的消息代理，但是消息有可能会丢失。</p>\n<p>RabbitMQ 很受欢迎但是要求你适应「AMQP」协议并且管理你自己的节点。</p>\n<p>Amazon SQS 是被托管的，但可能具有高延迟，并且消息可能会被传送两次。</p>\n<h2 id="任务队列"><a href="#%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>任务队列</h2>\n<p>任务队列接收任务及其相关数据，运行它们，然后传递其结果。 它们可以支持调度，并可用于在后台运行计算密集型作业。</p>\n<p>Celery 支持调度，主要是用 Python 开发的。</p>\n<h2 id="背压"><a href="#%E8%83%8C%E5%8E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背压</h2>\n<p>如果队列开始明显增长，那么队列大小可能会超过内存大小，导致高速缓存未命中，磁盘读取，甚至性能更慢。背压可以通过限制队列大小来帮助我们，从而为队列中的作业保持高吞吐率和良好的响应时间。一旦队列填满，客户端将得到服务器忙或者 HTTP 503 状态码，以便稍后重试。客户端可以在稍后时间重试该请求，也许是指数退避。</p>\n<h2 id="缺点-17"><a href="#%E7%BC%BA%E7%82%B9-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>简单的计算和实时工作流等用例可能更适用于同步操作，因为引入队列可能会增加延迟和复杂性。</li>\n</ul>\n<h1 id="通讯"><a href="#%E9%80%9A%E8%AE%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>通讯</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-38-49-035534acaaf4673f2c31d50b3e16edde-b03fa.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.61538461538461%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAAEeklEQVQ4y0WU209UVxTGz9/QP6LxpQ99aFObtrFaRGmqNvFJqEljo03TmF6s2Bhf1EGwFRlAKIqiplaBggwCzsDMnLnfzswww1xgrswwUrkJKJRbib/uc4ztSVb23jnZ3/r2+r61pLW1NRYXF1ldXWVzc5PZ2VmCwSCJRIJQKEQgENDC7/fj8/mYmJggFotp/wqFAktLSywvL/+HIa1trpPKpFlcXmJ9a4OVv1d5sfIC9Xv58iVTU1OUSiWePHnC9PQ0W1tbvP6ePXumgVssFi2BepYuNNdwpaMBXWstl278QtvjWxjkAQI+P3aHHZ/Xh18wS6VSRKNRopEIY2JNi3M2myWfz2M0GjXmCwsLSJd79dR1X6W2s55fHzZRP9RMp9VA/6Nh+gaM9BqGePBnH90PH2n7x2YbI7KL0FiS8UyemZkZjeXs3Jz2bKm6/TzfNZ7l5OVqzt6u4cz9GjoG7iNb7JitMlabnWAojMvtRQmGicTixBLjKOFRsSZZWVlhToA9f/6c+fl5pGPXTnH8+hlOtFVzvOU0X908zX1XP8lEhkg8QTgSI5nKEEumiI+nSIj9eDon9mlyk0XS6bQmlrqqoNKhK99wsF5Ew7ccajpJ+b3vuWi8hcfmw2i24nB5GTKZsdicDBqHBbOoAMswJhIk1ATCDR6Ph3g8rj1fevN8JW9d+pIdNV/wdtPXvNFylB9st0mH4/iCCiHxNPXJ6hoIhhgTFyNClPhEir/m5jUgVbBcLseiqnJZeyV7O6oobz/C/huV7Lp5GN1QC15XmBG7E6vDjd3tx2J3Izu9gqkLhy9I0Okm7vESiUQJh8Mkk0nmRS2l1pYDXGs6yNUrFdzpOETngzJCSgOxeF5kfWWLXC5PVjBQozBZYPWfbab/6KDUWMfm9jbbIjY2Nl6p3H13D3d/K+e6vox77fsw9u7EYr4o7KFoNRyWnVgcHgaMFgyDJsHYw2i2iHKtkby+jumnTzUPql2jGfvuuY/pulDGQ90eLI2fMnHjXQpmHf7RFErglXrFYpFMJqPFpGCcnSoRbm0k01DHgmClCqNaR21DKV7/Do6LO7FdeI/R+g8o6HcwOaLDE83j9St4AqKfQ1H8InzKKG6vgjuSJNveSlFfy4qYBWrC116UjHW78DTvRm7Yi7+1jNK994kOnqdvyI7JZMImhDFbbJqxHUII9Wyxi055PEjKbMLpcmt9PCpckBOtKBkbPsHVthdbyz4cbRXEf/+ICVlHv0m9bEcWAA6XB7MsQD1+orEENocLu08hPTVNT0+PNo0iAjAlaikF9OXINQcwnPuMsP4AheYPCXbrGJKFVQSIySxrxh62/L+3qgyjcc3YqmVUL/YKYHVwSLeq9tNaVcH1oxV0nfgc+dhuonfqcQYjuJ0uFCWEV0wcRQmKIRAXiqYoFKeEujMsi5qptVNnqGyxEhsbQ/L8fIThU5WYfjyC6acqgtWHcXboedBvorunjx7DAF09Brp6DXSK84hgF8tMksyXiKWyrK+vawMiGFDIZrL8C9AJiGjWS10WAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 38 49" title="" data-src="/static/2022-08-26-14-38-49-035534acaaf4673f2c31d50b3e16edde-b03fa.png" data-srcset="/static/2022-08-26-14-38-49-035534acaaf4673f2c31d50b3e16edde-6fb5f.png 200w,\n/static/2022-08-26-14-38-49-035534acaaf4673f2c31d50b3e16edde-d11a1.png 400w,\n/static/2022-08-26-14-38-49-035534acaaf4673f2c31d50b3e16edde-b03fa.png 650w" data-sizes="(max-width: 650px) 100vw, 650px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="超文本传输协议（http）"><a href="#%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE%EF%BC%88http%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>超文本传输协议（HTTP）</h2>\n<p>HTTP 是一种在客户端和服务器之间编码和传输数据的方法。它是一个请求/响应协议：客户端和服务端针对相关内容和完成状态信息的请求和响应。HTTP 是独立的，允许请求和响应流经许多执行负载均衡，缓存，加密和压缩的中间路由器和服务器。</p>\n<p>一个基本的 HTTP 请求由一个动词（方法）和一个资源（端点）组成。 以下是常见的 HTTP 动词：</p>\n<table>\n<thead>\n<tr>\n<th align="left">动词</th>\n<th align="left">描述</th>\n<th align="left">*\n幂等</th>\n<th align="left">安全性</th>\n<th align="left">可缓存</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">GET</td>\n<td align="left">读取资源</td>\n<td align="left">Yes</td>\n<td align="left">Yes</td>\n<td align="left">Yes</td>\n</tr>\n<tr>\n<td align="left">POST</td>\n<td align="left">创建资源或触发处理数据的进程</td>\n<td align="left">No</td>\n<td align="left">No</td>\n<td align="left">Yes，如果回应包含刷新信息</td>\n</tr>\n<tr>\n<td align="left">PUT</td>\n<td align="left">创建或替换资源</td>\n<td align="left">Yes</td>\n<td align="left">No</td>\n<td align="left">No</td>\n</tr>\n<tr>\n<td align="left">PATCH</td>\n<td align="left">部分更新资源</td>\n<td align="left">No</td>\n<td align="left">No</td>\n<td align="left">Yes，如果回应包含刷新信息</td>\n</tr>\n<tr>\n<td align="left">DELETE</td>\n<td align="left">删除资源</td>\n<td align="left">Yes</td>\n<td align="left">No</td>\n<td align="left">No</td>\n</tr>\n</tbody>\n</table>\n<p>多次执行不会产生不同的结果。</p>\n<p>HTTP 是依赖于较低级协议（如 TCP 和 UDP）的应用层协议。</p>\n<h2 id="传输控制协议（tcp）"><a href="#%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE%EF%BC%88tcp%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>传输控制协议（TCP）</h2>\n<p>TCP 是通过 IP 网络的面向连接的协议。 使用握手建立和断开连接。 发送的所有数据包保证以原始顺序到达目的地，用以下措施保证数据包不被损坏：</p>\n<ul>\n<li>每个数据包的序列号和校验码。</li>\n<li>确认包和自动重传</li>\n</ul>\n<p>如果发送者没有收到正确的响应，它将重新发送数据包。如果多次超时，连接就会断开。TCP 实行流量控制和拥塞控制。这些确保措施会导致延迟，而且通常导致传输效率比 UDP 低。</p>\n<p>为了确保高吞吐量，Web 服务器可以保持大量的 TCP 连接，从而导致高内存使用。在 Web 服务器线程间拥有大量开放连接可能开销巨大，消耗资源过多，也就是说，一个 memcached 服务器。连接池可以帮助除了在适用的情况下切换到 UDP。</p>\n<p>TCP 对于需要高可靠性但时间紧迫的应用程序很有用。比如包括 Web 服务器，数据库信息，SMTP，FTP 和 SSH。</p>\n<p>以下情况使用 TCP 代替 UDP：</p>\n<ul>\n<li>你需要数据完好无损。</li>\n<li>你想对网络吞吐量自动进行最佳评估。</li>\n</ul>\n<h2 id="用户数据报协议（udp）"><a href="#%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE%EF%BC%88udp%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用户数据报协议（UDP）</h2>\n<p>UDP 是无连接的。数据报（类似于数据包）只在数据报级别有保证。数据报可能会无序的到达目的地，也有可能会遗失。UDP 不支持拥塞控制。虽然不如 TCP 那样有保证，但 UDP 通常效率更高。</p>\n<p>UDP 可以通过广播将数据报发送至子网内的所有设备。这对 DHCP 很有用，因为子网内的设备还没有分配 IP 地址，而 IP 对于 TCP 是必须的。</p>\n<p>UDP 可靠性更低但适合用在网络电话、视频聊天，流媒体和实时多人游戏上。</p>\n<p>以下情况使用 UDP 代替 TCP：</p>\n<ul>\n<li>你需要低延迟</li>\n<li>相对于数据丢失更糟的是数据延迟</li>\n<li>你想实现自己的错误校正方法</li>\n</ul>\n<h2 id="远程控制调用协议（rpc）"><a href="#%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AE%EF%BC%88rpc%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>远程控制调用协议（RPC）</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-42-55-2b25f498e3c5647d7329efb1ce139ddd-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.599728629579374%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABnklEQVQozz2RbY/SQBSF+///gyb6WddI3Lgas9mIrgHWFYHCtlAK1JZSWgrLdAqF9vHSGCc5mQ9z7j0vY/hBRbjKGZg2T082pmkRLJWgoiypzyaFP37FwlPEsWI+9+j1BgwGpsxZRGslbxo/KDHW65zjMSdNU8IwJIljDgfNavWMZc8Yj+160XgSodRzLbDf70mShCiK6rmyPJNlGfPFDkPrHK11TSzFUlVV9aM7m9EfDBkOTXHj0u32yPOcoihE8MD5fP6Pyw6oRCjH2G4VOlPkQkrTrbjIZCBnMnHp9Uc406kgwXU9Edr/W6BrXJxebqWUmDkRJwpj4qQcDwWjkcmH62ts2xKikjgFm00m/SXsJOl8oVku4zrFJbptjWg03tP81mQnBNcNpJoDxturW1odB8/bSclTHh6G/Oou+N0PyfSprsJ1N/TNNfc/bPkEnyDY4/s77HGA46xFTPHxpsXtXQ+j3XakH59leHFxxBzG3Hx64MXLN0Txtl74tfnIq9cNOj9ntDsuV+/u+Pyly9w7sYoQZwWt1oTv9xZ/AaMoBE+YgL0LAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 42 55" title="" data-src="/static/2022-08-26-14-42-55-2b25f498e3c5647d7329efb1ce139ddd-160dc.png" data-srcset="/static/2022-08-26-14-42-55-2b25f498e3c5647d7329efb1ce139ddd-fc7b9.png 200w,\n/static/2022-08-26-14-42-55-2b25f498e3c5647d7329efb1ce139ddd-cea17.png 400w,\n/static/2022-08-26-14-42-55-2b25f498e3c5647d7329efb1ce139ddd-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在 RPC 中，客户端会去调用另一个地址空间（通常是一个远程服务器）里的方法。调用代码看起来就像是调用的是一个本地方法，客户端和服务器交互的具体过程被抽象。远程调用相对于本地调用一般较慢而且可靠性更差，因此区分两者是有帮助的。热门的 RPC 框架包括 Protobuf、Thrift 和 Avro。</p>\n<p>RPC 是一个“请求-响应”协议：</p>\n<ul>\n<li>客户端程序 ── 调用客户端存根程序。就像调用本地方法一样，参数会被压入栈中。</li>\n<li>客户端 stub 程序 ── 将请求过程的 id 和参数打包进请求信息中。</li>\n<li>客户端通信模块 ── 将信息从客户端发送至服务端。</li>\n<li>服务端通信模块 ── 将接受的包传给服务端存根程序。</li>\n<li>服务端 stub 程序 ── 将结果解包，依据过程 id 调用服务端方法并将参数传递过去。</li>\n</ul>\n<p>RPC 调用示例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86610535712173640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`GET /someoperation?data=anId\n\nPOST /anotheroperation\n{\n  &quot;data&quot;:&quot;anId&quot;;\n  &quot;anotherdata&quot;: &quot;another value&quot;\n}`, `86610535712173640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">GET /someoperation?data=anId\n\nPOST /anotheroperation\n{\n  &quot;data&quot;:&quot;anId&quot;;\n  &quot;anotherdata&quot;: &quot;another value&quot;\n}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>RPC 专注于暴露方法。RPC 通常用于处理内部通讯的性能问题，这样你可以手动处理本地调用以更好的适应你的情况。</p>\n<p>当以下情况时选择本地库（也就是 SDK）：</p>\n<ul>\n<li>你知道你的目标平台。</li>\n<li>你想控制如何访问你的“逻辑”。</li>\n<li>你想对发生在你的库中的错误进行控制。</li>\n<li>性能和终端用户体验是你最关心的事。</li>\n</ul>\n<p>遵循 REST 的 HTTP API 往往更适用于公共 API。</p>\n<h3 id="缺点-18"><a href="#%E7%BC%BA%E7%82%B9-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>RPC 客户端与服务实现捆绑地很紧密。</li>\n<li>一个新的 API 必须在每一个操作或者用例中定义。</li>\n<li>RPC 很难调试。</li>\n<li>你可能没办法很方便的去修改现有的技术。举个例子，如果你希望在 Squid 这样的缓存服务器上确保 RPC 被正确缓存的话可能需要一些额外的努力了。</li>\n</ul>\n<h2 id="表述性状态转移（rest）"><a href="#%E8%A1%A8%E8%BF%B0%E6%80%A7%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%EF%BC%88rest%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>表述性状态转移（REST）</h2>\n<p>REST 是一种强制的客户端/服务端架构设计模型，客户端基于服务端管理的一系列资源操作。服务端提供修改或获取资源的接口。所有的通信必须是无状态和可缓存的。</p>\n<p>RESTful 接口有四条规则：</p>\n<ul>\n<li>标志资源（HTTP 里的 URI） ── 无论什么操作都使用同一个 URI。</li>\n<li>表示的改变（HTTP 的动作） ── 使用动作, headers 和 body。</li>\n<li>可自我描述的错误信息（HTTP 中的 status code） ── 使用状态码，不要重新造轮子。</li>\n<li>HATEOAS（HTTP 中的 HTML 接口） ── 你的 web 服务器应该能够通过浏览器访问。</li>\n</ul>\n<p>REST 请求的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32222963640308077000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`GET /someresources/anId\n\nPUT /someresources/anId\n{&quot;anotherdata&quot;: &quot;another value&quot;}`, `32222963640308077000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">GET /someresources/anId\n\nPUT /someresources/anId\n{&quot;anotherdata&quot;: &quot;another value&quot;}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>REST 关注于暴露数据。它减少了客户端/服务端的耦合程度，经常用于公共 HTTP API 接口设计。REST 使用更通常与规范化的方法来通过 URI 暴露资源，通过 header 来表述并通过 GET、POST、PUT、DELETE 和 PATCH 这些动作来进行操作。因为无状态的特性，REST 易于横向扩展和隔离。</p>\n<h3 id="缺点-19"><a href="#%E7%BC%BA%E7%82%B9-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>由于 REST 将重点放在暴露数据，所以当资源不是自然组织的或者结构复杂的时候它可能无法很好的适应。举个例子，返回过去一小时中与特定事件集匹配的更新记录这种操作就很难表示为路径。使用 REST，可能会使用 URI 路径，查询参数和可能的请求体来实现。</li>\n<li>REST 一般依赖几个动作（GET、POST、PUT、DELETE 和 PATCH），但有时候仅仅这些没法满足你的需要。举个例子，将过期的文档移动到归档文件夹里去，这样的操作可能没法简单的用上面这几个 verbs 表达。</li>\n<li>为了渲染单个页面，获取被嵌套在层级结构中的复杂资源需要客户端，服务器之间多次往返通信。例如，获取博客内容及其关联评论。对于使用不确定网络环境的移动应用来说，这些多次往返通信是非常麻烦的。</li>\n<li>随着时间的推移，更多的字段可能会被添加到 API 响应中，较旧的客户端将会接收到所有新的数据字段，即使是那些它们不需要的字段，结果它会增加负载大小并引起更大的延迟。</li>\n</ul>\n<h2 id="rpc-与-rest-比较"><a href="#rpc-%E4%B8%8E-rest-%E6%AF%94%E8%BE%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RPC 与 REST 比较</h2>\n<table>\n<thead>\n<tr>\n<th>操作</th>\n<th>RPC</th>\n<th>REST</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>注册</td>\n<td><strong>POST</strong>\n /signup</td>\n<td><strong>POST</strong>\n /persons</td>\n</tr>\n<tr>\n<td>注销</td>\n<td><strong>POST</strong>\n /resign\n<br/>\n{\n<br/>\n“personid”: “1234”\n<br/>\n}</td>\n<td><strong>DELETE</strong>\n /persons/1234</td>\n</tr>\n<tr>\n<td>读取用户信息</td>\n<td><strong>GET</strong>\n /readPerson?personid=1234</td>\n<td><strong>GET</strong>\n /persons/1234</td>\n</tr>\n<tr>\n<td>读取用户物品列表</td>\n<td><strong>GET</strong>\n /readUsersItemsList?personid=1234</td>\n<td><strong>GET</strong>\n /persons/1234/items</td>\n</tr>\n<tr>\n<td>向用户物品列表添加一项</td>\n<td><strong>POST</strong>\n /addItemToUsersItemsList\n<br/>\n{\n<br/>\n“personid”: “1234”;\n<br/>\n“itemid”: “456”\n<br/>\n}</td>\n<td><strong>POST</strong>\n /persons/1234/items\n<br/>\n{\n<br/>\n“itemid”: “456”\n<br/>\n}</td>\n</tr>\n<tr>\n<td>更新一个物品</td>\n<td><strong>POST</strong>\n /modifyItem\n<br/>\n{\n<br/>\n“itemid”: “456”;\n<br/>\n“key”: “value”\n<br/>\n}</td>\n<td><strong>PUT</strong>\n /items/456\n<br/>\n{\n<br/>\n“key”: “value”\n<br/>\n}</td>\n</tr>\n<tr>\n<td>删除一个物品</td>\n<td><strong>POST</strong>\n /removeItem\n<br/>\n{\n<br/>\n“itemid”: “456”\n<br/>\n}</td>\n<td><strong>DELETE</strong>\n /items/456</td>\n</tr>\n</tbody>\n</table>\n<h1 id="安全"><a href="#%E5%AE%89%E5%85%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安全</h1>\n<ul>\n<li>在运输和等待过程中加密</li>\n<li>对所有的用户输入和从用户那里发来的参数进行处理以防止 XSS 和 SQL 注入。</li>\n<li>使用参数化的查询来防止 SQL 注入。</li>\n<li>使用最小权限原则。</li>\n</ul>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/系统设计入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:22,frontmatter:{date:"2022-08-26 15:07:36",path:"/system-design-practice-learn/",tags:"后端, 系统设计, 读书笔记",title:"系统设计入门学习",draft:null}},{excerpt:"背景知识 Rust 语言圣经 变量绑定与解构 绑定和可变性 变量只有在初始化后才能被使用 我的解答 可以使用 mut 将变量标记为可变 我的解答 变量作用域 作用域是一个变量在程序中能够保持合法的范围 问题一 我的解答 最佳解答 问题二 我的解答 最佳解答 变量遮蔽（Shadowing） 若后面的变量声明的名称和之前的变量相同，则我们说：第一个变量被第二个同名变量遮蔽了（shadowing） 我的解答 删除一行代码以通过编译 我的解答 未使用的变量 使用以下方法来修复编译器输出的 warning…",html:'<h1 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h1>\n<p><a href="https://course.rs/about-book.html" target="_blank" rel="nofollow noreferrer noopener">Rust 语言圣经</a></p>\n<h1 id="变量绑定与解构"><a href="#%E5%8F%98%E9%87%8F%E7%BB%91%E5%AE%9A%E4%B8%8E%E8%A7%A3%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量绑定与解构</h1>\n<h2 id="绑定和可变性"><a href="#%E7%BB%91%E5%AE%9A%E5%92%8C%E5%8F%AF%E5%8F%98%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>绑定和可变性</h2>\n<h3 id="变量只有在初始化后才能被使用"><a href="#%E5%8F%98%E9%87%8F%E5%8F%AA%E6%9C%89%E5%9C%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%8E%E6%89%8D%E8%83%BD%E8%A2%AB%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量只有在初始化后才能被使用</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46376717472360680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let x: i32; // 未初始化，但被使用\n    let y: i32; // 未初始化，也未被使用\n    println!(&quot;x is equal to {}&quot;, x);\n}`, `46376717472360680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">;</span> <span class="token comment">// 未初始化，但被使用</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">;</span> <span class="token comment">// 未初始化，也未被使用</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is equal to {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95774239396961570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let x: i32 = 0; // 未初始化，但被使用\n    let _y: i32; // 未初始化，也未被使用\n    println!(&quot;x is equal to {}&quot;, x);\n}`, `95774239396961570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 未初始化，但被使用</span>\n    <span class="token keyword">let</span> _y<span class="token punctuation">:</span> i32<span class="token punctuation">;</span> <span class="token comment">// 未初始化，也未被使用</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is equal to {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="可以使用-mut-将变量标记为可变"><a href="#%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-mut-%E5%B0%86%E5%8F%98%E9%87%8F%E6%A0%87%E8%AE%B0%E4%B8%BA%E5%8F%AF%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可以使用 mut 将变量标记为可变</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30851317194099438000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 完形填空，让代码编译\nfn main() {\n    let __ =  1;\n    __ += 2;\n\n    println!(&quot;x = {}&quot;, x);\n}`, `30851317194099438000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 完形填空，让代码编译</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> __ <span class="token operator">=</span>  <span class="token number">1</span><span class="token punctuation">;</span>\n    __ <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x = {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-1"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18439373957805283000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 完形填空，让代码编译\nfn main() {\n    let mut x = 1;\n    x += 2;\n\n    println!(&quot;x = {}&quot;, x);\n}`, `18439373957805283000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 完形填空，让代码编译</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x = {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="变量作用域"><a href="#%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量作用域</h2>\n<h3 id="作用域是一个变量在程序中能够保持合法的范围"><a href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%E5%9C%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E8%83%BD%E5%A4%9F%E4%BF%9D%E6%8C%81%E5%90%88%E6%B3%95%E7%9A%84%E8%8C%83%E5%9B%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>作用域是一个变量在程序中能够保持合法的范围</h3>\n<h4 id="问题一"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90480255830167830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并使用尽可能少的改变\nfn main() {\n    let x: i32 = 10;\n    {\n        let y: i32 = 5;\n        println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n    }\n    println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n}`, `90480255830167830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并使用尽可能少的改变</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-2"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13243562392533725000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并使用尽可能少的改变\nfn main() {\n    let x: i32 = 10;\n    let y: i32 = 5;\n    {\n        println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n    }\n    println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n}`, `13243562392533725000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并使用尽可能少的改变</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="最佳解答"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20557296673575330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x: i32 = 10;\n    {\n        let y: i32 = 5;\n        println!(&quot;The value of x is {} and value of y is {}&quot;, x, y);\n    }\n    println!(&quot;The value of x is {}&quot;, x);\n}`, `20557296673575330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x is {} and value of y is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="问题二"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83390328226041800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    println!(&quot;{}, world&quot;, x);\n}\n\nfn define_x() {\n    let x = &quot;hello&quot;;\n}`, `83390328226041800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, world"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-3"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87584975173508250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let x = define_x();\n    println!(&quot;{}, world&quot;, x);\n}\n\nfn define_x() -> &\'static str {\n    let x = &quot;hello&quot;;\n    x\n}`, `87584975173508250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, world"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> str <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n    x\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="最佳解答-1"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47360877257955550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = define_x();\n    println!(&quot;{}, world&quot;, x);\n}\n\nfn define_x() -> String {\n    let x = &quot;hello&quot;.to_string();\n    x\n}`, `47360877257955550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, world"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    x\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="变量遮蔽（shadowing）"><a href="#%E5%8F%98%E9%87%8F%E9%81%AE%E8%94%BD%EF%BC%88shadowing%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量遮蔽（Shadowing）</h2>\n<h3 id="若后面的变量声明的名称和之前的变量相同，则我们说：第一个变量被第二个同名变量遮蔽了（shadowing）"><a href="#%E8%8B%A5%E5%90%8E%E9%9D%A2%E7%9A%84%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E7%9A%84%E5%90%8D%E7%A7%B0%E5%92%8C%E4%B9%8B%E5%89%8D%E7%9A%84%E5%8F%98%E9%87%8F%E7%9B%B8%E5%90%8C%EF%BC%8C%E5%88%99%E6%88%91%E4%BB%AC%E8%AF%B4%EF%BC%9A%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%E8%A2%AB%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%90%8C%E5%90%8D%E5%8F%98%E9%87%8F%E9%81%AE%E8%94%BD%E4%BA%86%EF%BC%88shadowing%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>若后面的变量声明的名称和之前的变量相同，则我们说：第一个变量被第二个同名变量遮蔽了（shadowing）</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="480668511180160060"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只允许修改 \\`assert_eq!\\` 来让 \\`println!\\` 工作(在终端输出 \\`42\\`)\nfn main() {\n    let x: i32 = 5;\n    {\n        let x = 12;\n        assert_eq!(x, 5);\n    }\n\n    assert_eq!(x, 12);\n\n    let x = 42;\n    println!(&quot;{}&quot;, x); // 输出 &quot;42&quot;.\n}`, `480668511180160060`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 只允许修改 `assert_eq!` 来让 `println!` 工作(在终端输出 `42`)</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 "42".</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-4"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18350795790442232000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只允许修改 \\`assert_eq!\\` 来让 \\`println!\\` 工作(在终端输出 \\`42\\`)\nfn main() {\n    let x: i32 = 5;\n    {\n        let x = 12;\n        assert_eq!(x, 12);\n    }\n\n    assert_eq!(x, 5);\n\n    let x = 42;\n    println!(&quot;{}&quot;, x); // 输出 &quot;42&quot;.\n}`, `18350795790442232000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 只允许修改 `assert_eq!` 来让 `println!` 工作(在终端输出 `42`)</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 "42".</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="删除一行代码以通过编译"><a href="#%E5%88%A0%E9%99%A4%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E4%BB%A5%E9%80%9A%E8%BF%87%E7%BC%96%E8%AF%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除一行代码以通过编译</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38030766515211110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut x: i32 = 1;\n    x = 7;\n    // 遮蔽且再次绑定\n    let x = x;\n    x += 3;\n\n\n    let y = 4;\n    // 遮蔽\n    let y = &quot;I can also be bound to text!&quot;;\n}`, `38030766515211110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    x <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽且再次绑定</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">"I can also be bound to text!"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-5"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53780667737587606000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut x: i32 = 1;\n    x = 7;\n    // 遮蔽且再次绑定\n    let x = x;\n\n    let y = 4;\n    // 遮蔽\n    let y = &quot;I can also be bound to text!&quot;;\n}`, `53780667737587606000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    x <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽且再次绑定</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> x<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">"I can also be bound to text!"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="未使用的变量"><a href="#%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未使用的变量</h2>\n<h3 id="使用以下方法来修复编译器输出的-warning"><a href="#%E4%BD%BF%E7%94%A8%E4%BB%A5%E4%B8%8B%E6%96%B9%E6%B3%95%E6%9D%A5%E4%BF%AE%E5%A4%8D%E7%BC%96%E8%AF%91%E5%99%A8%E8%BE%93%E5%87%BA%E7%9A%84-warning" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用以下方法来修复编译器输出的 warning:</h3>\n<ul>\n<li>一种方法</li>\n<li>两种方法</li>\n</ul>\n<blockquote>\n<p>注意: 你可以使用两种方法解决，但是它们没有一种是移除 <code class="language-text">let x = 1</code> 所在的代码行</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40240189512175230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 1;\n}\n\n// compiler warning: unused variable: \\`x\\``, `40240189512175230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// compiler warning: unused variable: `x`</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-6"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48071141550506934000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _x = 1;\n}\n\n// compiler warning: unused variable: \\`x\\``, `48071141550506934000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// compiler warning: unused variable: `x`</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86761596333678760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[allow(unused_variables)]\nfn main() {\n    let x = 1;\n}\n\n// compiler warning: unused variable: \\`x\\``, `86761596333678760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[allow(unused_variables)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// compiler warning: unused variable: `x`</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="变量解构"><a href="#%E5%8F%98%E9%87%8F%E8%A7%A3%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量解构</h2>\n<h3 id="我们可以将-let-跟一个模式一起使用来解构一个元组，最终将它解构为多个独立的变量"><a href="#%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%B0%86-let-%E8%B7%9F%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%BC%8F%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E6%9D%A5%E8%A7%A3%E6%9E%84%E4%B8%80%E4%B8%AA%E5%85%83%E7%BB%84%EF%BC%8C%E6%9C%80%E7%BB%88%E5%B0%86%E5%AE%83%E8%A7%A3%E6%9E%84%E4%B8%BA%E5%A4%9A%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我们可以将 let 跟一个模式一起使用来解构一个元组，最终将它解构为多个独立的变量</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64091280091908770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let (x, y) = (1, 2);\n    x += 2;\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 2);\n}`, `64091280091908770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-7"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74855172405342540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let (mut x, y) = (1, 2);\n    x += 2;\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 2);\n}`, `74855172405342540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">mut</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3522795984838023000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let (x, y) = (1, 2);\n    let x = 3;\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 2);\n}`, `3522795984838023000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="解构式赋值"><a href="#%E8%A7%A3%E6%9E%84%E5%BC%8F%E8%B5%8B%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解构式赋值</h2>\n<h3 id="在赋值语句的左式中使用元组、切片或结构体进行匹配赋值。"><a href="#%E5%9C%A8%E8%B5%8B%E5%80%BC%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B7%A6%E5%BC%8F%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%85%83%E7%BB%84%E3%80%81%E5%88%87%E7%89%87%E6%88%96%E7%BB%93%E6%9E%84%E4%BD%93%E8%BF%9B%E8%A1%8C%E5%8C%B9%E9%85%8D%E8%B5%8B%E5%80%BC%E3%80%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在赋值语句的左式中使用元组、切片或结构体进行匹配赋值。</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90969006854114930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y);\n    (x, ..) = (3, 4);\n    [.., y] = [1, 2];\n    // 填空，让代码工作\n    assert_eq!([x, y], __);\n}`, `90969006854114930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空，让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-8"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50665137037265674000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y);\n    (x, ..) = (3, 4);\n    [.., y] = [1, 2];\n    // 填空，让代码工作\n    assert_eq!([x, y], [3, 2]);\n}`, `50665137037265674000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空，让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="基本类型"><a href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本类型</h1>\n<h2 id="数值类型"><a href="#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数值类型</h2>\n<h3 id="整数"><a href="#%E6%95%B4%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>整数</h3>\n<h4 id="如果我们没有显式的给予变量一个类型，那编译器会自动帮我们推导一个类型"><a href="#%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E6%B2%A1%E6%9C%89%E6%98%BE%E5%BC%8F%E7%9A%84%E7%BB%99%E4%BA%88%E5%8F%98%E9%87%8F%E4%B8%80%E4%B8%AA%E7%B1%BB%E5%9E%8B%EF%BC%8C%E9%82%A3%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%B8%AE%E6%88%91%E4%BB%AC%E6%8E%A8%E5%AF%BC%E4%B8%80%E4%B8%AA%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如果我们没有显式的给予变量一个类型，那编译器会自动帮我们推导一个类型</h4>\n<h5 id="问题一-1"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10703903753940724000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除某个部分让代码工作\nfn main() {\n    let x: i32 = 5;\n    let mut y: u32 = 5;\n\n    y = x;\n\n    let z = 10; // 这里 z 的类型是?\n}`, `10703903753940724000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除某个部分让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> u32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 这里 z 的类型是?</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="我的解答-9"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61585986312363980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除某个部分让代码工作\nfn main() {\n    let x: i32 = 5;\n    let mut y: u32 = 5;\n\n    // y = x;\n\n    let z = 10; // 这里 z 的类型是?\n}`, `61585986312363980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除某个部分让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> u32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// y = x;</span>\n\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 这里 z 的类型是?</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="最佳解答-2"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51620101868340314000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x: i32 = 5;\n    let mut y = 5;\n\n    y = x;\n\n    let z = 10; // type of z : i32\n}`, `51620101868340314000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// type of z : i32</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="问题二-1"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98297570498671720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let v: u16 = 38_u8 as __;\n}`, `98297570498671720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> u16 <span class="token operator">=</span> <span class="token number">38_u8</span> <span class="token keyword">as</span> __<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="我的解答-10"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16308597474751707000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let v: u16 = 38_u8 as u16;\n}`, `16308597474751707000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> u16 <span class="token operator">=</span> <span class="token number">38_u8</span> <span class="token keyword">as</span> u16<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="问题三"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74960286305910780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//  修改 \\`assert_eq!\\` 让代码工作\nfn main() {\n    let x = 5;\n    assert_eq!(&quot;u32&quot;.to_string(), type_of(&x));\n}\n\n// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  &quot;i8&quot;, &quot;u8&quot;, &quot;i32&quot;, &quot;u32&quot;\nfn type_of<T>(_: &T) -> String {\n    format!(&quot;{}&quot;, std::any::type_name::<T>())\n}`, `74960286305910780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//  修改 `assert_eq!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"u32"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type_of</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  "i8", "u8", "i32", "u32"</span>\n<span class="token keyword">fn</span> type_of<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> std<span class="token punctuation">::</span>any<span class="token punctuation">::</span>type_name<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="我的解答-11"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71505086140415770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//  修改 \\`assert_eq!\\` 让代码工作\nfn main() {\n    let x = 5;\n    assert_eq!(&quot;i32&quot;.to_string(), type_of(&x));\n}\n\n// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  &quot;i8&quot;, &quot;u8&quot;, &quot;i32&quot;, &quot;u32&quot;\nfn type_of<T>(_: &T) -> String {\n    format!(&quot;{}&quot;, std::any::type_name::<T>())\n}`, `71505086140415770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//  修改 `assert_eq!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"i32"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type_of</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  "i8", "u8", "i32", "u32"</span>\n<span class="token keyword">fn</span> type_of<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> std<span class="token punctuation">::</span>any<span class="token punctuation">::</span>type_name<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="问题四"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47656422952814000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nfn main() {\n    assert_eq!(i8::MAX, __);\n    assert_eq!(u8::MAX, __);\n}`, `47656422952814000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>i8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>u8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="我的解答-12"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22757881470602113000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nfn main() {\n    assert_eq!(i8::MAX, 127);\n    assert_eq!(u8::MAX, 255);\n}`, `22757881470602113000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>i8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>u8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="问题五"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31136868335368573000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 解决代码中的错误和 \\`panic\\`\nfn main() {\n   let v1 = 251_u8 + 8;\n   let v2 = i8::checked_add(251, 8).unwrap();\n   println!(&quot;{},{}&quot;,v1,v2);\n}`, `31136868335368573000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 解决代码中的错误和 `panic`</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">251_u8</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> v2 <span class="token operator">=</span> i8<span class="token punctuation">::</span><span class="token function">checked_add</span><span class="token punctuation">(</span><span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="我的解答-13"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22856245784074256000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 解决代码中的错误和 \\`panic\\`\nfn main() {\n    let v1 = 251_u16 + 8;\n    let v2 = i16::checked_add(251, 8).unwrap();\n    println!(&quot;{},{}&quot;, v1, v2);\n}`, `22856245784074256000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 解决代码中的错误和 `panic`</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">251_u16</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v2 <span class="token operator">=</span> i16<span class="token punctuation">::</span><span class="token function">checked_add</span><span class="token punctuation">(</span><span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="最佳解答-3"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53728233374685460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v1 = 247_u8 + 8;\n    let v2 = i8::checked_add(119, 8).unwrap();\n    println!(&quot;{},{}&quot;, v1, v2);\n}`, `53728233374685460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">247_u8</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v2 <span class="token operator">=</span> i8<span class="token punctuation">::</span><span class="token function">checked_add</span><span class="token punctuation">(</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="问题六"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18953834432422425000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改 \\`assert!\\` 让代码工作\nfn main() {\n    let v = 1_024 + 0xff + 0o77 + 0b1111_1111;\n    assert!(v == 1579);\n}`, `18953834432422425000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改 `assert!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token number">1_024</span> <span class="token operator">+</span> <span class="token number">0xff</span> <span class="token operator">+</span> <span class="token number">0o77</span> <span class="token operator">+</span> <span class="token number">0b1111_1111</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">1579</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h6 id="我的解答-14"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h6>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85501649125808010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改 \\`assert!\\` 让代码工作\nfn main() {\n    let v = 1_024 + 0xff + 0o77 + 0b1111_1111;\n    assert!(v == 1597);\n}`, `85501649125808010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改 `assert!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token number">1_024</span> <span class="token operator">+</span> <span class="token number">0xff</span> <span class="token operator">+</span> <span class="token number">0o77</span> <span class="token operator">+</span> <span class="token number">0b1111_1111</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">1597</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="浮点数"><a href="#%E6%B5%AE%E7%82%B9%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浮点数</h3>\n<h4 id="问题一-2"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54423890698143790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将 ? 替换成你的答案\nfn main() {\n    let x = 1_000.000_1; // ?\n    let y: f32 = 0.12; // f32\n    let z = 0.01_f64; // f64\n}`, `54423890698143790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 将 ? 替换成你的答案</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1_000.000_1</span><span class="token punctuation">;</span> <span class="token comment">// ?</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> f32 <span class="token operator">=</span> <span class="token number">0.12</span><span class="token punctuation">;</span> <span class="token comment">// f32</span>\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">0.01_f64</span><span class="token punctuation">;</span> <span class="token comment">// f64</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-15"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44036713035677470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将 ? 替换成你的答案\nfn main() {\n    let x = 1_000.000_1; // f64\n    let y: f32 = 0.12; // f32\n    let z = 0.01_f64; // f64\n}`, `44036713035677470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 将 ? 替换成你的答案</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1_000.000_1</span><span class="token punctuation">;</span> <span class="token comment">// f64</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> f32 <span class="token operator">=</span> <span class="token number">0.12</span><span class="token punctuation">;</span> <span class="token comment">// f32</span>\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">0.01_f64</span><span class="token punctuation">;</span> <span class="token comment">// f64</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="问题二-2"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h4>\n<p>使用两种方法来让下面代码工作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14640995840405369000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert!(0.1 + 0.2 == 0.3);\n}`, `14640995840405369000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">==</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-16"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9765748726343993000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert!((0.1_f64 + 0.2 - 0.3).abs() < 0.00001);\n}`, `9765748726343993000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.1_f64</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">-</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.00001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91959714424665460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert!(0.1_f32 + 0.2_f32 == 0.3_f32);\n}`, `91959714424665460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">0.1_f32</span> <span class="token operator">+</span> <span class="token number">0.2_f32</span> <span class="token operator">==</span> <span class="token number">0.3_f32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="序列-range"><a href="#%E5%BA%8F%E5%88%97-range" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>序列 Range</h3>\n<h4 id="问题一-3"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h4>\n<p>两个目标:</p>\n<ol>\n<li>修改 assert! 让它工作</li>\n<li>让 println! 输出: 97 - 122</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44304005845472230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut sum = 0;\n    for i in -3..2 {\n        sum += i\n    }\n\n    assert!(sum == -3);\n\n    for c in \'a\'..=\'z\' {\n        println!(&quot;{}&quot;, c);\n    }\n}`, `44304005845472230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        sum <span class="token operator">+=</span> i\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token char string">\'a\'</span><span class="token punctuation">..=</span><span class="token char string">\'z\'</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-17"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90798671642288140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut sum = 0;\n    for i in -3..2 {\n        sum += i\n    }\n\n    assert!(sum == -5);\n\n    for c in \'a\'..=\'z\' {\n        println!(&quot;{}&quot;, c);\n    }\n}`, `90798671642288140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        sum <span class="token operator">+=</span> i\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token char string">\'a\'</span><span class="token punctuation">..=</span><span class="token char string">\'z\'</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="最佳解答-4"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30727187982354010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut sum = 0;\n    for i in -3..2 {\n        sum += i\n    }\n\n    assert!(sum == -5);\n\n    for c in \'a\'..=\'z\' {\n        println!(&quot;{}&quot;, c as u8);\n    }\n}`, `30727187982354010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        sum <span class="token operator">+=</span> i\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token char string">\'a\'</span><span class="token punctuation">..=</span><span class="token char string">\'z\'</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c <span class="token keyword">as</span> u8<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="问题二-3"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97540686245429900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::ops::{Range, RangeInclusive};\nfn main() {\n    assert_eq!((1..__), Range{ start: 1, end: 5 });\n    assert_eq!((1..__), RangeInclusive::new(1, 5));\n}`, `97540686245429900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span><span class="token punctuation">{</span>Range<span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span>__<span class="token punctuation">)</span><span class="token punctuation">,</span> Range<span class="token punctuation">{</span> start<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span>__<span class="token punctuation">)</span><span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-18"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71460448701630220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::ops::{Range, RangeInclusive};\nfn main() {\n    assert_eq!((1..5), Range { start: 1, end: 5 });\n    assert_eq!((1..=5), RangeInclusive::new(1, 5));\n}`, `71460448701630220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span><span class="token punctuation">{</span>Range<span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Range <span class="token punctuation">{</span> start<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="计算"><a href="#%E8%AE%A1%E7%AE%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>计算</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21052449432456122000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，并解决错误\nfn main() {\n    // 整数加法\n    assert!(1u32 + 2 == __);\n\n    // 整数减法\n    assert!(1i32 - 2 == __);\n    assert!(1u8 - 2 == -1);\n\n    assert!(3 * 50 == __);\n\n    assert!(9.6 / 3.2 == 3.0); // error ! 修改它让代码工作\n\n    assert!(24 % 5 == __);\n\n    // 逻辑与或非操作\n    assert!(true && false == __);\n    assert!(true || false == __);\n    assert!(!true == __);\n\n    // 位操作\n    println!(&quot;0011 AND 0101 is {:04b}&quot;, 0b0011u32 & 0b0101);\n    println!(&quot;0011 OR 0101 is {:04b}&quot;, 0b0011u32 | 0b0101);\n    println!(&quot;0011 XOR 0101 is {:04b}&quot;, 0b0011u32 ^ 0b0101);\n    println!(&quot;1 << 5 is {}&quot;, 1u32 << 5);\n    println!(&quot;0x80 >> 2 is 0x{:x}&quot;, 0x80u32 >> 2);\n}`, `21052449432456122000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，并解决错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 整数加法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1u32</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 整数减法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1i32</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1u8</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">9.6</span> <span class="token operator">/</span> <span class="token number">3.2</span> <span class="token operator">==</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error ! 修改它让代码工作</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 逻辑与或非操作</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">||</span> <span class="token keyword">false</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">true</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 位操作</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 AND 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">&amp;</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 OR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">|</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 XOR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">^</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"1 &lt;&lt; 5 is {}"</span><span class="token punctuation">,</span> <span class="token number">1u32</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0x80 >> 2 is 0x{:x}"</span><span class="token punctuation">,</span> <span class="token number">0x80u32</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-19"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6042634483399345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，并解决错误\nfn main() {\n    // 整数加法\n    assert!(1u32 + 2 == 3);\n\n    // 整数减法\n    assert!(1i32 - 2 == -1);\n    assert!(1i8 - 2 == -1);\n\n    assert!(3 * 50 == 150);\n\n    assert!(9.6_f32 / 3.2_f32 == 3.0_f32); // error ! 修改它让代码工作\n\n    assert!(24 % 5 == 4);\n\n    // 逻辑与或非操作\n    assert!(true && false == false);\n    assert!(true || false == true);\n    assert!(!true == false);\n\n    // 位操作\n    println!(&quot;0011 AND 0101 is {:04b}&quot;, 0b0011u32 & 0b0101);\n    println!(&quot;0011 OR 0101 is {:04b}&quot;, 0b0011u32 | 0b0101);\n    println!(&quot;0011 XOR 0101 is {:04b}&quot;, 0b0011u32 ^ 0b0101);\n    println!(&quot;1 << 5 is {}&quot;, 1u32 << 5);\n    println!(&quot;0x80 >> 2 is 0x{:x}&quot;, 0x80u32 >> 2);\n}`, `6042634483399345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，并解决错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 整数加法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1u32</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 整数减法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1i32</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1i8</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">==</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">9.6_f32</span> <span class="token operator">/</span> <span class="token number">3.2_f32</span> <span class="token operator">==</span> <span class="token number">3.0_f32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error ! 修改它让代码工作</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 逻辑与或非操作</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span> <span class="token operator">==</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">||</span> <span class="token keyword">false</span> <span class="token operator">==</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">true</span> <span class="token operator">==</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 位操作</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 AND 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">&amp;</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 OR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">|</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 XOR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">^</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"1 &lt;&lt; 5 is {}"</span><span class="token punctuation">,</span> <span class="token number">1u32</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0x80 >> 2 is 0x{:x}"</span><span class="token punctuation">,</span> <span class="token number">0x80u32</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="字符、布尔、单元类型"><a href="#%E5%AD%97%E7%AC%A6%E3%80%81%E5%B8%83%E5%B0%94%E3%80%81%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符、布尔、单元类型</h2>\n<h3 id="字符"><a href="#%E5%AD%97%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符</h3>\n<h4 id="问题一-4"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26265948222425720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//  修改 2 处 \\`assert_eq!\\` 让代码工作\n\nuse std::mem::size_of_val;\nfn main() {\n    let c1 = \'a\';\n    assert_eq!(size_of_val(&c1), 1);\n\n    let c2 = \'中\';\n    assert_eq!(size_of_val(&c2), 3);\n\n    println!(&quot;Success!&quot;)\n}`, `26265948222425720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//  修改 2 处 `assert_eq!` 让代码工作</span>\n\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token char string">\'a\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-20"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38342157812719436000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改 2 处 \\`assert_eq!\\` 让代码工作\n\nuse std::mem::size_of_val;\nfn main() {\n    let c1 = \'a\';\n    assert_eq!(size_of_val(&c1), 4);\n\n    let c2 = \'中\';\n    assert_eq!(size_of_val(&c2), 4);\n\n    println!(&quot;Success!&quot;)\n}`, `38342157812719436000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改 2 处 `assert_eq!` 让代码工作</span>\n\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token char string">\'a\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="问题二-4"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48169223989151736000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改一行让代码正常打印\nfn main() {\n    let c1 = &quot;中&quot;;\n    print_char(c1);\n}\n\nfn print_char(c : char) {\n    println!(&quot;{}&quot;, c);\n}`, `48169223989151736000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改一行让代码正常打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token string">"中"</span><span class="token punctuation">;</span>\n    <span class="token function">print_char</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_char</span><span class="token punctuation">(</span>c <span class="token punctuation">:</span> char<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-21"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57192677450018260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改一行让代码正常打印\nfn main() {\n    let c1 = \'中\';\n    print_char(c1);\n}\n\nfn print_char(c: char) {\n    println!(&quot;{}&quot;, c);\n}`, `57192677450018260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改一行让代码正常打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n    <span class="token function">print_char</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_char</span><span class="token punctuation">(</span>c<span class="token punctuation">:</span> char<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="布尔"><a href="#%E5%B8%83%E5%B0%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>布尔</h3>\n<h4 id="问题一-5"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1061249596797697500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使成功打印\nfn main() {\n    let _f: bool = false;\n\n    let t = true;\n    if !t {\n        println!(&quot;Success!&quot;)\n    }\n}`, `1061249596797697500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使成功打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _f<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token operator">!</span>t <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-22"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49486744933013996000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使成功打印\nfn main() {\n    let _f: bool = false;\n\n    let t = true;\n    if t {\n        println!(&quot;Success!&quot;)\n    }\n}`, `49486744933013996000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使成功打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _f<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> t <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="问题二-5"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46907818042438975000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let f = true;\n    let t = true && false;\n    assert_eq!(t, f);\n\n    println!(&quot;Success!&quot;)\n}`, `46907818042438975000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-23"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41484969121593580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let f = true;\n    let t = true && false;\n    assert_eq!(t, !f);\n\n    println!(&quot;Success!&quot;)\n}`, `41484969121593580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="单元类型"><a href="#%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单元类型</h3>\n<h4 id="问题一-6"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26965441605902217000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作，但不要修改 \\`implicitly_ret_unit\\` !\nfn main() {\n    let _v: () = ();\n\n    let v = (2, 3);\n    assert_eq!(v, implicitly_ret_unit());\n\n    println!(&quot;Success!&quot;)\n}\n\nfn implicitly_ret_unit() {\n    println!(&quot;I will return a ()&quot;)\n}\n\n// 不要使用下面的函数，它只用于演示！\nfn explicitly_ret_unit() -> () {\n    println!(&quot;I will return a ()&quot;)\n}`, `26965441605902217000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作，但不要修改 `implicitly_ret_unit` !</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _v<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 不要使用下面的函数，它只用于演示！</span>\n<span class="token keyword">fn</span> <span class="token function">explicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-24"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55353323311561930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作，但不要修改 \\`implicitly_ret_unit\\` !\nfn main() {\n    let _v: () = ();\n\n    let v = ();\n    assert_eq!(v, implicitly_ret_unit());\n\n    println!(&quot;Success!&quot;)\n}\n\nfn implicitly_ret_unit() {\n    println!(&quot;I will return a ()&quot;)\n}\n\n// 不要使用下面的函数，它只用于演示！\nfn explicitly_ret_unit() -> () {\n    println!(&quot;I will return a ()&quot;)\n}`, `55353323311561930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作，但不要修改 `implicitly_ret_unit` !</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _v<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 不要使用下面的函数，它只用于演示！</span>\n<span class="token keyword">fn</span> <span class="token function">explicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="问题二-6"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h4>\n<p>单元类型占用的内存大小是多少？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66740687025428660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作：修改 \\`assert!\\` 中的 \\`4\\`\nuse std::mem::size_of_val;\nfn main() {\n    let unit: () = ();\n    assert!(size_of_val(&unit) == 4);\n\n    println!(&quot;Success!&quot;)\n}`, `66740687025428660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作：修改 `assert!` 中的 `4`</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> unit<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>unit<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="我的解答-25"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31253822527461896000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作：修改 \\`assert!\\` 中的 \\`4\\`\nuse std::mem::size_of_val;\nfn main() {\n    let unit: () = ();\n    assert!(size_of_val(&unit) == 0);\n\n    println!(&quot;Success!&quot;)\n}`, `31253822527461896000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作：修改 `assert!` 中的 `4`</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> unit<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>unit<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="语句与表达式"><a href="#%E8%AF%AD%E5%8F%A5%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语句与表达式</h2>\n<h3 id="问题一-7"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16681903433274071000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用两种方法让代码工作起来\nfn main() {\n    let v = {\n        let mut x = 1;\n        x += 2\n    };\n\n    assert_eq!(v, 3);\n}`, `16681903433274071000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用两种方法让代码工作起来</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        x <span class="token operator">+=</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-26"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68236575657272300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = {\n        let mut x = 1;\n        x += 2\n    };\n\n    assert_eq!(v, ());\n}`, `68236575657272300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        x <span class="token operator">+=</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28360041457037832000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = {\n        let mut x = 1;\n        x += 2;\n        x\n    };\n\n    assert_eq!(v, 3);\n}`, `28360041457037832000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n        x\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-7"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55783854888375630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = (let x = 3);\n\n    assert!(v == 3);\n}`, `55783854888375630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-27"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54366133448244810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = {\n        let x = 3;\n        x\n    };\n\n    assert!(v == 3);\n}`, `54366133448244810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n        x\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-1"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61643870451742020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = sum(1, 2);\n    assert_eq!(s, 3);\n}\n\nfn sum(x: i32, y: i32) -> i32 {\n    x + y;\n}`, `61643870451742020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-28"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69629235583115980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = sum(1, 2);\n    assert_eq!(s, 3);\n}\n\nfn sum(x: i32, y: i32) -> i32 {\n    x + y\n}`, `69629235583115980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="函数"><a href="#%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数</h2>\n<h3 id="问题一-8"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10572362310253580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 不要修改下面两行代码!\n    let (x, y) = (1, 2);\n    let s = sum(x, y);\n\n    assert_eq!(s, 3);\n}\n\nfn sum(x, y: i32) {\n    x + y;\n}`, `10572362310253580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 不要修改下面两行代码!</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-29"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67843791490249376000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y) = (1, 2);\n    let s = sum(x, y);\n\n    assert_eq!(s, 3);\n}\n\nfn sum(x: i32, y: i32) -> i32 {\n    x + y\n}`, `67843791490249376000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-8"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94502688799495210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    print();\n}\n\n// 使用另一个类型来替代 i32\nfn print() -> i32 {\n    println!(&quot;hello,world&quot;);\n}`, `94502688799495210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用另一个类型来替代 i32</span>\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"hello,world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-30"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27072501078197187000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    print();\n}\n\nfn print() -> () {\n    println!(&quot;hello,world&quot;);\n}`, `27072501078197187000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"hello,world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-2"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42485826299618300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 用两种方法求解\nfn main() {\n    never_return();\n}\n\nfn never_return() -> ! {\n    // 实现这个函数，不要修改函数签名!\n}`, `42485826299618300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 用两种方法求解</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 实现这个函数，不要修改函数签名!</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-31"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38536438239542210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    never_return();\n}\n\nfn never_return() -> ! {\n    loop {}\n}`, `38536438239542210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token keyword">loop</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72437790088410560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    never_return();\n}\n\nfn never_return() -> ! {\n    panic!(&quot;error&quot;)\n}`, `72437790088410560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-1"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1071332672073666000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    println!(&quot;Success!&quot;);\n}\n\nfn get_option(tp: u8) -> Option<i32> {\n    match tp {\n        1 => {\n        }\n        _ => {\n        }\n    };\n\n    // 这里与其返回一个 None，不如使用发散函数替代\n    never_return_fn()\n}\n\n// 使用三种方法实现以下发散函数\nfn never_return_fn() -> ! {}`, `1071332672073666000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">get_option</span><span class="token punctuation">(</span>tp<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> tp <span class="token punctuation">{</span>\n        <span class="token number">1</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token punctuation">}</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 这里与其返回一个 None，不如使用发散函数替代</span>\n    <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用三种方法实现以下发散函数</span>\n<span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-32"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-32" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95680729488013620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn never_return_fn() -> ! {\n    panic!()\n}`, `95680729488013620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80969314106054400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn never_return_fn() -> ! {\n    todo!();\n}`, `80969314106054400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token function">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97551958075527400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn never_return_fn() -> ! {\n    loop {\n        std::thread::sleep(std::time::Duration::from_secs(1))\n    }\n}`, `97551958075527400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span><span class="token function">sleep</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>time<span class="token punctuation">::</span>Duration<span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-1"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50641842380232016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空\n    let b = __;\n\n    let _v = match b {\n        true => 1,\n        // 发散函数也可以用于 \\`match\\` 表达式，用于替代任何类型的值\n        false => {\n            println!(&quot;Success!&quot;);\n            panic!(&quot;we have no value for \\`false\\`, but we can panic&quot;)\n        }\n    };\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}`, `50641842380232016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> b <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _v <span class="token operator">=</span> <span class="token keyword">match</span> b <span class="token punctuation">{</span>\n        <span class="token keyword">true</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span>\n        <span class="token comment">// 发散函数也可以用于 `match` 表达式，用于替代任何类型的值</span>\n        <span class="token keyword">false</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"we have no value for `false`, but we can panic"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-33"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-33" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78528157050680600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let b = false;\n\n    let _v = match b {\n        true => 1,\n        // 发散函数也可以用于 \\`match\\` 表达式，用于替代任何类型的值\n        false => {\n            println!(&quot;Success!&quot;);\n            panic!(&quot;we have no value for \\`false\\`, but we can panic&quot;)\n        }\n    };\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}`, `78528157050680600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _v <span class="token operator">=</span> <span class="token keyword">match</span> b <span class="token punctuation">{</span>\n        <span class="token keyword">true</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span>\n        <span class="token comment">// 发散函数也可以用于 `match` 表达式，用于替代任何类型的值</span>\n        <span class="token keyword">false</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"we have no value for `false`, but we can panic"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="所有权与借用"><a href="#%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%80%9F%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>所有权与借用</h1>\n<h2 id="所有权"><a href="#%E6%89%80%E6%9C%89%E6%9D%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>所有权</h2>\n<h3 id="问题一-9"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31899828391158235000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 使用尽可能多的方法来通过编译\n    let x = String::from(&quot;hello, world&quot;);\n    let y = x;\n    println!(&quot;{},{}&quot;, x, y);\n}`, `31899828391158235000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用尽可能多的方法来通过编译</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-34"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-34" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20352067748749780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = String::from(&quot;hello, world&quot;);\n    let y = x.clone();\n    println!(&quot;{},{}&quot;, x, y);\n}`, `20352067748749780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55079146507942450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = String::from(&quot;hello, world&quot;);\n    let y = &x;\n    println!(&quot;{},{}&quot;, x, y);\n}`, `55079146507942450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18849704258826994000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = &quot;hello, world&quot;;\n    let y = x;\n    println!(&quot;{},{}&quot;, x, y);\n}`, `18849704258826994000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73070571096674345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = String::from(&quot;hello, world&quot;);\n    let y = x.as_str();\n    println!(&quot;{},{}&quot;, x, y);\n}`, `73070571096674345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-9"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29783996856978500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不要修改 main 中的代码\nfn main() {\n    let s1 = String::from(&quot;hello, world&quot;);\n    let s2 = take_ownership(s1);\n\n    println!(&quot;{}&quot;, s2);\n}\n\n// 只能修改下面的代码!\nfn take_ownership(s: String) {\n    println!(&quot;{}&quot;, s);\n}`, `29783996856978500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 不要修改 main 中的代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 只能修改下面的代码!</span>\n<span class="token keyword">fn</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-35"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-35" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64737062822795985000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hello, world&quot;);\n    let s2 = take_ownership(s1);\n\n    println!(&quot;{}&quot;, s2);\n}\n\nfn take_ownership(s: String) -> String {\n    println!(&quot;{}&quot;, s);\n    s\n}`, `64737062822795985000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-3"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26992462040646136000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = give_ownership();\n    println!(&quot;{}&quot;, s);\n}\n\n// 只能修改下面的代码!\nfn give_ownership() -> String {\n    let s = String::from(&quot;hello, world&quot;);\n    // convert String to Vec\n    // 将 String 转换成 Vec 类型\n    let _s = s.into_bytes();\n    s\n}`, `26992462040646136000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 只能修改下面的代码!</span>\n<span class="token keyword">fn</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// convert String to Vec</span>\n    <span class="token comment">// 将 String 转换成 Vec 类型</span>\n    <span class="token keyword">let</span> _s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">into_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-36"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-36" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65644788230361240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = give_ownership();\n    println!(&quot;{}&quot;, s);\n}\n\nfn give_ownership() -> String {\n    let s = String::from(&quot;hello, world&quot;);\n    // convert String to Vec\n    // 将 String 转换成 Vec 类型\n    let _s = s.as_bytes();\n    s\n}`, `65644788230361240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// convert String to Vec</span>\n    <span class="token comment">// 将 String 转换成 Vec 类型</span>\n    <span class="token keyword">let</span> _s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84673327984891820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = give_ownership();\n    println!(&quot;{}&quot;, s);\n}\n\n// Only modify the code below!\nfn give_ownership() -> String {\n    let s = String::from(&quot;hello, world&quot;);\n    s\n}`, `84673327984891820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Only modify the code below!</span>\n<span class="token keyword">fn</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-2"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30633355621105828000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要删除任何代码行\nfn main() {\n    let s = String::from(&quot;hello, world&quot;);\n\n    print_str(s);\n\n    println!(&quot;{}&quot;, s);\n}\n\nfn print_str(s: String)  {\n    println!(&quot;{}&quot;,s)\n}`, `30633355621105828000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要删除任何代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-37"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-37" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28034314301703578000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, world&quot;);\n\n    print_str(&s);\n\n    println!(&quot;{}&quot;, s);\n}\n\nfn print_str(s: &String) {\n    println!(&quot;{}&quot;, s)\n}`, `28034314301703578000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45142085550528210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, world&quot;);\n\n    print_str(s.clone());\n\n    println!(&quot;{}&quot;, s);\n}\n\nfn print_str(s: String)  {\n    println!(&quot;{}&quot;,s)\n}`, `45142085550528210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-2"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3784936436276575700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不要使用 clone，使用 copy 的方式替代\nfn main() {\n    let x = (1, 2, (), &quot;hello&quot;.to_string());\n    let y = x.clone();\n    println!(&quot;{:?}, {:?}&quot;, x, y);\n}`, `3784936436276575700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 不要使用 clone，使用 copy 的方式替代</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-38"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-38" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18484540960479113000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = (1, 2, (), &quot;hello&quot;);\n    let y = x;\n    println!(&quot;{:?}, {:?}&quot;, x, y);\n}`, `18484540960479113000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-1"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16715573756772483000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, &quot;);\n\n    // 只修改下面这行代码 !\n    let s1 = s;\n\n    s1.push_str(&quot;world&quot;)\n}`, `16715573756772483000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 只修改下面这行代码 !</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> s<span class="token punctuation">;</span>\n\n    s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-39"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-39" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3152608522437594600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, &quot;);\n\n    let mut s1 = s;\n\n    s1.push_str(&quot;world&quot;)\n}`, `3152608522437594600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s1 <span class="token operator">=</span> s<span class="token punctuation">;</span>\n\n    s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32286339482885330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = Box::new(5);\n\n    let ...      // 完成该行代码，不要修改其它行！\n\n    *y = 4;\n\n    assert_eq!(*x, 5);\n}`, `32286339482885330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token punctuation">...</span>      <span class="token comment">// 完成该行代码，不要修改其它行！</span>\n\n    <span class="token operator">*</span>y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-40"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-40" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52274563703478490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = Box::new(5);\n\n    let mut y = Box::new(1);    // 完成该行代码，不要修改其它行！\n\n    *y = 4;\n\n    assert_eq!(*x, 5);\n}`, `52274563703478490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y <span class="token operator">=</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 完成该行代码，不要修改其它行！</span>\n\n    <span class="token operator">*</span>y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75185781985055010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n   let _s = t.0;\n\n   // 仅修改下面这行代码，且不要使用 \\`_s\\`\n   println!(&quot;{:?}&quot;, t);\n}`, `75185781985055010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> _s <span class="token operator">=</span> t<span class="token number">.0</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 仅修改下面这行代码，且不要使用 `_s`</span>\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-41"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-41" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32536565041767584000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n    let _s = t.0;\n\n    println!(&quot;{:?}&quot;, t.1);\n}`, `32536565041767584000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _s <span class="token operator">=</span> t<span class="token number">.0</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> t<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85990957388096340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n   // 填空，不要修改其它代码\n   let (__, __) = __;\n\n   println!(&quot;{:?}, {:?}, {:?}&quot;, s1, s2, t); // -> &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)\n}`, `85990957388096340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 填空，不要修改其它代码</span>\n   <span class="token keyword">let</span> <span class="token punctuation">(</span>__<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}, {:?}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> "hello", "world", ("hello", "world")</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-42"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-42" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35083710146207880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n    // 填空，不要修改其它代码\n    let (ref s1, ref s2) = t;\n\n    println!(&quot;{:?}, {:?}, {:?}&quot;, s1, s2, t); // -> &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)\n}`, `35083710146207880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空，不要修改其它代码</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">ref</span> s1<span class="token punctuation">,</span> <span class="token keyword">ref</span> s2<span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}, {:?}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> "hello", "world", ("hello", "world")</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88566345132646240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n    // 填空，不要修改其它代码\n    let (ref s1, ref s2) = t.clone();\n\n    println!(&quot;{:?}, {:?}, {:?}&quot;, s1, s2, t); // -> &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)\n}`, `88566345132646240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空，不要修改其它代码</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">ref</span> s1<span class="token punctuation">,</span> <span class="token keyword">ref</span> s2<span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}, {:?}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> "hello", "world", ("hello", "world")</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="引用与借用"><a href="#%E5%BC%95%E7%94%A8%E4%B8%8E%E5%80%9F%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引用与借用</h2>\n<h3 id="问题一-10"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42444743184358200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let x = 5;\n   // 填写空白处\n   let p = __;\n\n   println!(&quot;x 的内存地址是 {:p}&quot;, p); // output: 0x16fa3ac84\n}`, `42444743184358200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n   <span class="token comment">// 填写空白处</span>\n   <span class="token keyword">let</span> p <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的内存地址是 {:p}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: 0x16fa3ac84</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-43"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-43" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90803010646402020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 5;\n    // 填写空白处\n    let p = &x;\n\n    println!(&quot;x 的内存地址是 {:p}&quot;, p); // output: 0x16fa3ac84\n}`, `90803010646402020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填写空白处</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的内存地址是 {:p}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: 0x16fa3ac84</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-10"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12904557731110478000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 5;\n    let y = &x;\n\n    // 只能修改以下行\n    assert_eq!(5, y);\n}`, `12904557731110478000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n\n    <span class="token comment">// 只能修改以下行</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-44"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-44" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13811997672376132000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 5;\n    let y = &x;\n\n    // 只能修改以下行\n    assert_eq!(5, *y);\n}`, `13811997672376132000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n\n    <span class="token comment">// 只能修改以下行</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">*</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-4"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90158753323727040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    borrow_object(s)\n}\n\nfn borrow_object(s: &String) {}`, `90158753323727040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-45"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-45" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48891768536206246000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    borrow_object(&s)\n}\n\nfn borrow_object(s: &String) {}`, `48891768536206246000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-3"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23424773142812127000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    push_str(s)\n}\n\nfn push_str(s: &mut String) {\n    s.push_str(&quot;world&quot;)\n}`, `23424773142812127000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">push_str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">push_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-46"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-46" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88345538045949430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    push_str(&mut s)\n}\n\nfn push_str(s: &mut String) {\n    s.push_str(&quot;world&quot;)\n}`, `88345538045949430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">push_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">push_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-3"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50197743308336730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    // 填写空白处，让代码工作\n    let p = __;\n\n    p.push_str(&quot;world&quot;);\n}`, `50197743308336730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填写空白处，让代码工作</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-47"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-47" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49090876042281705000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    // 填写空白处，让代码工作\n    let p = &mut s;\n\n    p.push_str(&quot;world&quot;);\n}`, `49090876042281705000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填写空白处，让代码工作</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-2"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40693576514439390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let c = \'中\';\n\n    let r1 = &c;\n    // 填写空白处，但是不要修改其它行的代码\n    let __ r2 = c;\n\n    assert_eq!(*r1, *r2);\n\n    // 判断两个内存地址的字符串是否相等\n    assert_eq!(get_addr(r1),get_addr(r2));\n}\n\n// 获取传入引用的内存地址的字符串形式\nfn get_addr(r: &char) -> String {\n    format!(&quot;{:p}&quot;, r)\n}`, `40693576514439390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>c<span class="token punctuation">;</span>\n    <span class="token comment">// 填写空白处，但是不要修改其它行的代码</span>\n    <span class="token keyword">let</span> __ r2 <span class="token operator">=</span> c<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>r1<span class="token punctuation">,</span> <span class="token operator">*</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 判断两个内存地址的字符串是否相等</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">get_addr</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">get_addr</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 获取传入引用的内存地址的字符串形式</span>\n<span class="token keyword">fn</span> <span class="token function">get_addr</span><span class="token punctuation">(</span>r<span class="token punctuation">:</span> <span class="token operator">&amp;</span>char<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{:p}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-48"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-48" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87483989805635680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let c = \'中\';\n\n    let r1 = &c;\n    // 填写空白处，但是不要修改其它行的代码\n    let ref r2 = c;\n\n    assert_eq!(*r1, *r2);\n\n    // 判断两个内存地址的字符串是否相等\n    assert_eq!(get_addr(r1), get_addr(r2));\n}\n\n// 获取传入引用的内存地址的字符串形式\nfn get_addr(r: &char) -> String {\n    format!(&quot;{:p}&quot;, r)\n}`, `87483989805635680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>c<span class="token punctuation">;</span>\n    <span class="token comment">// 填写空白处，但是不要修改其它行的代码</span>\n    <span class="token keyword">let</span> <span class="token keyword">ref</span> r2 <span class="token operator">=</span> c<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>r1<span class="token punctuation">,</span> <span class="token operator">*</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 判断两个内存地址的字符串是否相等</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">get_addr</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get_addr</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 获取传入引用的内存地址的字符串形式</span>\n<span class="token keyword">fn</span> <span class="token function">get_addr</span><span class="token punctuation">(</span>r<span class="token punctuation">:</span> <span class="token operator">&amp;</span>char<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{:p}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-1"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44761788903739030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除代码某个部分，让它工作\n// 你不能移除整行的代码！\nfn main() {\n    let mut s = String::from(&quot;hello&quot;);\n\n    let r1 = &mut s;\n    let r2 = &mut s;\n\n    println!(&quot;{}, {}&quot;, r1, r2);\n}`, `44761788903739030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除代码某个部分，让它工作</span>\n<span class="token comment">// 你不能移除整行的代码！</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-49"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-49" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63277602567196060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除代码某个部分，让它工作\n// 你不能移除整行的代码！\nfn main() {\n    let mut s = String::from(&quot;hello&quot;);\n\n    let r1 = &s;\n    let r2 = &s;\n\n    println!(&quot;{}, {}&quot;, r1, r2);\n}`, `63277602567196060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除代码某个部分，让它工作</span>\n<span class="token comment">// 你不能移除整行的代码！</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-1"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92325731846688820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 通过修改下面一行代码来修复错误\n    let s = String::from(&quot;hello, &quot;);\n\n    borrow_object(&mut s)\n}\n\nfn borrow_object(s: &mut String) {}`, `92325731846688820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 通过修改下面一行代码来修复错误</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-50"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-50" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71022600538941960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 通过修改下面一行代码来修复错误\n    let mut s = String::from(&quot;hello, &quot;);\n\n    borrow_object(&mut s)\n}\n\nfn borrow_object(s: &mut String) {}`, `71022600538941960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 通过修改下面一行代码来修复错误</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-1"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11359027760859574000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 注释掉一行代码让它工作\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    r1.push_str(&quot;world&quot;);\n    let r2 = &mut s;\n    r2.push_str(&quot;!&quot;);\n\n    println!(&quot;{}&quot;,r1);\n}`, `11359027760859574000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 注释掉一行代码让它工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r2<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-51"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-51" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37499702427650390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 注释掉一行代码让它工作\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    r1.push_str(&quot;world&quot;);\n    let r2 = &mut s;\n    r2.push_str(&quot;!&quot;);\n\n    // println!(&quot;{}&quot;,r1);\n}`, `37499702427650390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 注释掉一行代码让它工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r2<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// println!("{}",r1);</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28570866357585236000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    let r2 = &mut s;\n\n    // 在下面增加一行代码人为制造编译错误：cannot borrow \\`s\\` as mutable more than once at a time\n    // 你不能同时使用 r1 和 r2\n}`, `28570866357585236000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    <span class="token comment">// 在下面增加一行代码人为制造编译错误：cannot borrow `s` as mutable more than once at a time</span>\n    <span class="token comment">// 你不能同时使用 r1 和 r2</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-52"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-52" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4733334569918913000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    let r2 = &mut s;\n\n    // 在下面增加一行代码人为制造编译错误：cannot borrow \\`s\\` as mutable more than once at a time\n    // 你不能同时使用 r1 和 r2\n    println!(&quot;{}&quot;, r1)\n}`, `4733334569918913000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    <span class="token comment">// 在下面增加一行代码人为制造编译错误：cannot borrow `s` as mutable more than once at a time</span>\n    <span class="token comment">// 你不能同时使用 r1 和 r2</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="复合类型"><a href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复合类型</h1>\n<h2 id="字符串"><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符串</h2>\n<h3 id="问题一-11"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25312679844869046000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要新增代码行\nfn main() {\n    let s: str = &quot;hello, world&quot;;\n}`, `25312679844869046000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要新增代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-53"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-53" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87273428684742690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s: &str = &quot;hello, world&quot;;\n}`, `87273428684742690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-11"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91445275671618470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用至少两种方法来修复错误\nfn main() {\n    let s: Box<str> = &quot;hello, world&quot;.into();\n    greetings(s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;,s)\n}`, `91445275671618470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用至少两种方法来修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span>str<span class="token operator">></span> <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-54"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-54" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60716908312210640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s: Box<str> = &quot;hello, world&quot;.into();\n    greetings(&s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;, s)\n}`, `60716908312210640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span>str<span class="token operator">></span> <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48330048153450260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s: Box<&str> = &quot;hello, world&quot;.into();\n    greetings(*s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;, s);\n}`, `48330048153450260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span><span class="token operator">&amp;</span>str<span class="token operator">></span> <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-5"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39070171475246160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut s = __;\n    s.push_str(&quot;hello, world&quot;);\n    s.push(\'!\');\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n}`, `39070171475246160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> __<span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-55"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-55" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26050200063495786000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;&quot;);\n    s.push_str(&quot;hello, world&quot;);\n    s.push(\'!\');\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n}`, `26050200063495786000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75317855111760540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::new();\n    s.push_str(&quot;hello, world&quot;);\n    s.push(\'!\');\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n}`, `75317855111760540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-4"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5686264558694387000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有错误，并且不要新增代码行\nfn main() {\n    let  s = String::from(&quot;hello&quot;);\n    s.push(\',\');\n    s.push(&quot; world&quot;);\n    s += &quot;!&quot;.to_string();\n\n    println!(&quot;{}&quot;, s)\n}`, `5686264558694387000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有错误，并且不要新增代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span>  s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">" world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s <span class="token operator">+=</span> <span class="token string">"!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-56"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-56" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78593045736052200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello&quot;);\n    s.push(\',\');\n    s.push_str(&quot; world&quot;);\n    s += &quot;!&quot;;\n\n    println!(&quot;{}&quot;, s)\n}`, `78593045736052200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s <span class="token operator">+=</span> <span class="token string">"!"</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-4"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97337284850731060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let s = String::from(&quot;I like dogs&quot;);\n    // 以下方法会重新分配一块内存空间，然后将修改后的字符串存在这里\n    let s1 = s.__(&quot;dogs&quot;, &quot;cats&quot;);\n\n    assert_eq!(s1, &quot;I like cats&quot;)\n}`, `97337284850731060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 以下方法会重新分配一块内存空间，然后将修改后的字符串存在这里</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token string">"dogs"</span><span class="token punctuation">,</span> <span class="token string">"cats"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">"I like cats"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-57"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-57" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11646545803062591000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;I like dogs&quot;);\n    let s1 = s.replace(&quot;dogs&quot;, &quot;cats&quot;);\n\n    assert_eq!(s1, &quot;I like cats&quot;)\n}`, `11646545803062591000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"dogs"</span><span class="token punctuation">,</span> <span class="token string">"cats"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">"I like cats"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-3"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62478584230652355000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有错误，不要删除任何一行代码\nfn main() {\n    let s1 = String::from(&quot;hello,&quot;);\n    let s2 = String::from(&quot;world!&quot;);\n    let s3 = s1 + s2;\n    assert_eq!(s3,&quot;hello,world!&quot;);\n    println!(&quot;{}&quot;,s1);\n}`, `62478584230652355000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有错误，不要删除任何一行代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s3 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s3<span class="token punctuation">,</span><span class="token string">"hello,world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-58"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-58" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97081998294205990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hello,&quot;);\n    let s2 = String::from(&quot;world!&quot;);\n    let s3 = s1.clone() + &s2;\n    assert_eq!(s3, &quot;hello,world!&quot;);\n    println!(&quot;{}&quot;, s1);\n}`, `97081998294205990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s3 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s3<span class="token punctuation">,</span> <span class="token string">"hello,world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-2"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82428687506045220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用至少两种方法来修复错误\nfn main() {\n    let s = &quot;hello, world&quot;;\n    greetings(s)\n}\n\nfn greetings(s: String) {\n    println!(&quot;{}&quot;,s)\n}`, `82428687506045220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用至少两种方法来修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-59"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-59" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55085658535715650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;;\n    greetings(s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;, s)\n}`, `55085658535715650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54477754991408430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    greetings(s)\n}\n\nfn greetings(s: String) {\n    println!(&quot;{}&quot;, s)\n}`, `54477754991408430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50147229213087850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, world&quot;);\n    greetings(s)\n}\n\nfn greetings(s: String) {\n    println!(&quot;{}&quot;, s)\n}`, `50147229213087850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-2"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48760669876344150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用两种方法来解决错误，不要新增代码行\nfn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = s;\n}`, `48760669876344150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用两种方法来解决错误，不要新增代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-60"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-60" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74278941893166220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = &s;\n}`, `74278941893166220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22200155679654700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;;\n    let s1: &str = &s;\n}`, `22200155679654700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95160847959596940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = &s[..];\n}`, `95160847959596940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16901021490939950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = s.as_str();\n}`, `16901021490939950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-2"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97175046733185800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 你可以使用转义的方式来输出想要的字符，这里我们使用十六进制的值，例如 \\x73 会被转义成小写字母 \'s\'\n    // 填空以输出 &quot;I\'m writing Rust&quot;\n    let byte_escape = &quot;I\'m writing Ru\\x73__!&quot;;\n    println!(&quot;What are you doing\\x3F (\\\\x3F means ?) {}&quot;, byte_escape);\n\n    // 也可以使用 Unicode 形式的转义字符\n    let unicode_codepoint = &quot;\\u{211D}&quot;;\n    let character_name = &quot;\\&quot;DOUBLE-STRUCK CAPITAL R\\&quot;&quot;;\n\n    println!(&quot;Unicode character {} (U+211D) is called {}&quot;,\n                unicode_codepoint, character_name );\n\n    // 还能使用 \\ 来连接多行字符串\n    let long_string = &quot;String literals\n                        can span multiple lines.\n                        The linebreak and indentation here \\\n                         can be escaped too!&quot;;\n    println!(&quot;{}&quot;, long_string);\n}`, `97175046733185800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 你可以使用转义的方式来输出想要的字符，这里我们使用十六进制的值，例如 \\x73 会被转义成小写字母 \'s\'</span>\n    <span class="token comment">// 填空以输出 "I\'m writing Rust"</span>\n    <span class="token keyword">let</span> byte_escape <span class="token operator">=</span> <span class="token string">"I\'m writing Ru\\x73__!"</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"What are you doing\\x3F (\\\\x3F means ?) {}"</span><span class="token punctuation">,</span> byte_escape<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 也可以使用 Unicode 形式的转义字符</span>\n    <span class="token keyword">let</span> unicode_codepoint <span class="token operator">=</span> <span class="token string">"\\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> character_name <span class="token operator">=</span> <span class="token string">"\\"DOUBLE-STRUCK CAPITAL R\\""</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Unicode character {} (U+211D) is called {}"</span><span class="token punctuation">,</span>\n                unicode_codepoint<span class="token punctuation">,</span> character_name <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 还能使用 \\ 来连接多行字符串</span>\n    <span class="token keyword">let</span> long_string <span class="token operator">=</span> "String literals\n                        can span multiple lines<span class="token punctuation">.</span>\n                        The linebreak and indentation here \\\n                         can <span class="token keyword">be</span> escaped <span class="token macro-rules function">too!</span>"<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> long_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-61"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-61" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16987867565831750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let byte_escape = &quot;I\'m writing Ru\\x73\\x74!&quot;;\n    println!(&quot;What are you doing\\x3F (\\\\x3F means ?) {}&quot;, byte_escape);\n\n    let unicode_codepoint = &quot;\\u{211D}&quot;;\n    let character_name = &quot;\\&quot;DOUBLE-STRUCK CAPITAL R\\&quot;&quot;;\n\n    println!(&quot;Unicode character {} (U+211D) is called {}&quot;,\n                unicode_codepoint, character_name );\n\n   let long_string = &quot;String literals\n                        can span multiple lines.\n                        The linebreak and indentation here \\\n                         can be escaped too!&quot;;\n    println!(&quot;{}&quot;, long_string);\n}`, `16987867565831750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> byte_escape <span class="token operator">=</span> <span class="token string">"I\'m writing Ru\\x73\\x74!"</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"What are you doing\\x3F (\\\\x3F means ?) {}"</span><span class="token punctuation">,</span> byte_escape<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> unicode_codepoint <span class="token operator">=</span> <span class="token string">"\\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> character_name <span class="token operator">=</span> <span class="token string">"\\"DOUBLE-STRUCK CAPITAL R\\""</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Unicode character {} (U+211D) is called {}"</span><span class="token punctuation">,</span>\n                unicode_codepoint<span class="token punctuation">,</span> character_name <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> long_string <span class="token operator">=</span> "String literals\n                        can span multiple lines<span class="token punctuation">.</span>\n                        The linebreak and indentation here \\\n                         can <span class="token keyword">be</span> escaped <span class="token macro-rules function">too!</span>"<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> long_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十-1"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86855944186053950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 填空并修复所有错误 */\nfn main() {\n    let raw_str = r&quot;Escapes don\'t work here: \\x3F \\u{211D}&quot;;\n    // 修改上面的行让代码工作\n    assert_eq!(raw_str, &quot;Escapes don\'t work here: ? ℝ&quot;);\n\n    // 如果你希望在字符串中使用双引号，可以使用以下形式\n    let quotes = r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#;\n    println!(&quot;{}&quot;, quotes);\n\n    // 如果希望在字符串中使用 # 号，可以如下使用：\n    let  delimiter = r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###;\n    println!(&quot;{}&quot;, delimiter);\n\n    // 填空\n    let long_delimiter = __;\n    assert_eq!(long_delimiter, &quot;Hello, \\&quot;##\\&quot;&quot;)\n}`, `86855944186053950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 填空并修复所有错误 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> raw_str <span class="token operator">=</span> <span class="token string">r"Escapes don\'t work here: \\x3F \\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token comment">// 修改上面的行让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>raw_str<span class="token punctuation">,</span> <span class="token string">"Escapes don\'t work here: ? ℝ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 如果你希望在字符串中使用双引号，可以使用以下形式</span>\n    <span class="token keyword">let</span> quotes <span class="token operator">=</span> <span class="token string">r#"And then I said: "There is no escape!""#</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> quotes<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 如果希望在字符串中使用 # 号，可以如下使用：</span>\n    <span class="token keyword">let</span>  delimiter <span class="token operator">=</span> <span class="token string">r###"A string with "# in it. And even "##!"###</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> long_delimiter <span class="token operator">=</span> __<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>long_delimiter<span class="token punctuation">,</span> <span class="token string">"Hello, \\"##\\""</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-62"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-62" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71336925215451340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let raw_str = &quot;Escapes don\'t work here: \\x3F \\u{211D}&quot;;\n    assert_eq!(raw_str, &quot;Escapes don\'t work here: ? ℝ&quot;);\n\n    let quotes = r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#;\n    println!(&quot;{}&quot;, quotes);\n\n    let delimiter = r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###;\n    println!(&quot;{}&quot;, delimiter);\n\n    // 填空\n    let long_delimiter = r###&quot;Hello, &quot;##&quot;&quot;###;\n    assert_eq!(long_delimiter, &quot;Hello, \\&quot;##\\&quot;&quot;)\n}`, `71336925215451340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> raw_str <span class="token operator">=</span> <span class="token string">"Escapes don\'t work here: \\x3F \\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>raw_str<span class="token punctuation">,</span> <span class="token string">"Escapes don\'t work here: ? ℝ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> quotes <span class="token operator">=</span> <span class="token string">r#"And then I said: "There is no escape!""#</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> quotes<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> delimiter <span class="token operator">=</span> <span class="token string">r###"A string with "# in it. And even "##!"###</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> long_delimiter <span class="token operator">=</span> <span class="token string">r###"Hello, "##""###</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>long_delimiter<span class="token punctuation">,</span> <span class="token string">"Hello, \\"##\\""</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十一"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5835357020537324000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hi,中国&quot;);\n    let h = s1[0]; // 修改当前行来修复错误，提示: \\`h\\` 字符在 UTF-8 格式中只需要 1 个字节来表示\n    assert_eq!(h, &quot;h&quot;);\n\n    let h1 = &s1[3..5];// 修改当前行来修复错误，提示: \\`中\\` 字符在 UTF-8 格式中需要 3 个字节来表示\n    assert_eq!(h1, &quot;中&quot;);\n}`, `5835357020537324000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi,中国"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> h <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 修改当前行来修复错误，提示: `h` 字符在 UTF-8 格式中只需要 1 个字节来表示</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> h1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 修改当前行来修复错误，提示: `中` 字符在 UTF-8 格式中需要 3 个字节来表示</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h1<span class="token punctuation">,</span> <span class="token string">"中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-63"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-63" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36325537818943540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hi,中国&quot;);\n    let h = &s1[0..1];\n    assert_eq!(h, &quot;h&quot;);\n\n    let h1 = &s1[3..6];\n    assert_eq!(h1, &quot;中&quot;);\n}`, `36325537818943540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi,中国"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> h1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h1<span class="token punctuation">,</span> <span class="token string">"中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十二"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25403118838487270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空，打印出 &quot;你好，世界&quot; 中的每一个字符\n    for c in &quot;你好，世界&quot;.__ {\n        println!(&quot;{}&quot;, c)\n    }\n}`, `25403118838487270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空，打印出 "你好，世界" 中的每一个字符</span>\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"你好，世界"</span><span class="token punctuation">.</span>__ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-64"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-64" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62384614381335265000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    for c in &quot;你好，世界&quot;.chars() {\n        println!(&quot;{}&quot;, c)\n    }\n}`, `62384614381335265000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"你好，世界"</span><span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十三"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7882592344040784000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use utf8_slice;\nfn main() {\n    let s = &quot;The 🚀 goes to the 🌑!&quot;;\n\n    let rocket = utf8_slice::slice(s, 4, 5);\n    // 结果是 &quot;🚀&quot;，索引的是字符\n}`, `7882592344040784000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> utf8_slice<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"The 🚀 goes to the 🌑!"</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> rocket <span class="token operator">=</span> utf8_slice<span class="token punctuation">::</span><span class="token function">slice</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 结果是 "🚀"，索引的是字符</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="数组"><a href="#%E6%95%B0%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数组</h2>\n<h3 id="问题一-12"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29069285345535144000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 使用合适的类型填空\n    let arr: __ = [1, 2, 3, 4, 5];\n\n    // 修改以下代码，让它顺利运行\n    assert!(arr.len() == 4);\n}`, `29069285345535144000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用合适的类型填空</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> __ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 修改以下代码，让它顺利运行</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-65"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-65" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57272340009790554000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [i32; 5] = [1, 2, 3, 4, 5];\n\n    assert!(arr.len() == 5);\n}`, `57272340009790554000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-12"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64143079918019060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 很多时候，我们可以忽略数组的部分类型，也可以忽略全部类型，让编译器帮助我们推导\n    let arr0 = [1, 2, 3];\n    let arr: [_; 3] = [\'a\', \'b\', \'c\'];\n\n    // 填空\n    // 数组分配在栈上， \\`std::mem::size_of_val\\` 函数会返回整个数组占用的内存空间\n    // 数组中的每个 char 元素占用 4 字节的内存空间，因为在 Rust 中， char 是 Unicode 字符\n    assert!(std::mem::size_of_val(&arr) == __);\n}`, `64143079918019060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 很多时候，我们可以忽略数组的部分类型，也可以忽略全部类型，让编译器帮助我们推导</span>\n    <span class="token keyword">let</span> arr0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>_<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token comment">// 数组分配在栈上， `std::mem::size_of_val` 函数会返回整个数组占用的内存空间</span>\n    <span class="token comment">// 数组中的每个 char 元素占用 4 字节的内存空间，因为在 Rust 中， char 是 Unicode 字符</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arr<span class="token punctuation">)</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-66"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-66" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26005656176813940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr0 = [1, 2, 3];\n    let arr: [_; 3] = [\'a\', \'b\', \'c\'];\n\n    assert!(std::mem::size_of_val(&arr) == 12);\n}`, `26005656176813940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>_<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-6"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1719869441252130800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空\n    let list: [i32; 100] = __ ;\n\n    assert!(list[0] == 1);\n    assert!(list.len() == 100);\n}`, `1719869441252130800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ <span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-67"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-67" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30819707633636307000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let list: [i32; 100] = [1; 100];\n\n    assert!(list[0] == 1);\n    assert!(list.len() == 100);\n}`, `30819707633636307000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-5"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64778609022590580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 修复错误\n    let _arr = [1, 2, \'3\'];\n}`, `64778609022590580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 修复错误</span>\n    <span class="token keyword">let</span> _arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token char string">\'3\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-68"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-68" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29367197255117830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _arr = [1, 2, 3];\n}`, `29367197255117830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-5"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74161256676718870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr = [\'a\', \'b\', \'c\'];\n\n    let ele = arr[1]; // 只修改此行来让代码工作\n\n    assert!(ele == \'a\');\n}`, `74161256676718870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 只修改此行来让代码工作</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>ele <span class="token operator">==</span> <span class="token char string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-69"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-69" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64500705202438046000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr = [\'a\', \'b\', \'c\'];\n\n    let ele = arr[0];\n\n    assert!(ele == \'a\');\n}`, `64500705202438046000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>ele <span class="token operator">==</span> <span class="token char string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-4"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4398877795102129700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码中的错误\nfn main() {\n    let names = [String::from(&quot;Sunfei&quot;), &quot;Sunface&quot;.to_string()];\n\n    // \\`get\\` 返回 \\`Option<T>\\` 类型，因此它的使用非常安全\n    let name0 = names.get(0).unwrap();\n\n    // 但是下标索引就存在越界的风险了\n    let _name1 = &names[2];\n}`, `4398877795102129700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码中的错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// `get` 返回 `Option&lt;T>` 类型，因此它的使用非常安全</span>\n    <span class="token keyword">let</span> name0 <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 但是下标索引就存在越界的风险了</span>\n    <span class="token keyword">let</span> _name1 <span class="token operator">=</span> <span class="token operator">&amp;</span>names<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-70"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-70" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48059916158595600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let names = [String::from(&quot;Sunfei&quot;), &quot;Sunface&quot;.to_string()];\n\n    let name0 = names.get(0).unwrap();\n\n    let _name1 = &names[1];\n}`, `48059916158595600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> name0 <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _name1 <span class="token operator">=</span> <span class="token operator">&amp;</span>names<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="切片"><a href="#%E5%88%87%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切片</h2>\n<h3 id="问题一-13"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20721152864363733000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码中的错误，不要新增代码行!\nfn main() {\n    let arr = [1, 2, 3];\n    let s1: [i32] = arr[0..2];\n\n    let s2: str = &quot;hello, world&quot; as str;\n}`, `20721152864363733000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码中的错误，不要新增代码行!</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> s2<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"hello, world"</span> <span class="token keyword">as</span> str<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-71"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-71" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63984524034038250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr = [1, 2, 3];\n    let s1: &[i32] = &arr[0..2];\n\n    let s2: &str = &quot;hello, world&quot;;\n}`, `63984524034038250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>i32<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-13"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63203740941378930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [char; 3] = [\'中\', \'国\', \'人\'];\n\n    let slice = &arr[..2];\n\n    // 修改数字 \\`8\\` 让代码工作\n    // 小提示: 切片和数组不一样，它是引用。如果是数组的话，那下面的 \\`assert!\\` 将会通过： \'中\'和\'国\'是char类型，char类型是Unicode编码，大小固定为4字节，两个字符为8字节。\n    assert!(std::mem::size_of_val(&slice) == 8);\n}`, `63203740941378930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>char<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'中\'</span><span class="token punctuation">,</span> <span class="token char string">\'国\'</span><span class="token punctuation">,</span> <span class="token char string">\'人\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 修改数字 `8` 让代码工作</span>\n    <span class="token comment">// 小提示: 切片和数组不一样，它是引用。如果是数组的话，那下面的 `assert!` 将会通过： \'中\'和\'国\'是char类型，char类型是Unicode编码，大小固定为4字节，两个字符为8字节。</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>slice<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-72"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-72" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12451828680532584000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [char; 3] = [\'中\', \'国\', \'人\'];\n\n    let slice = &arr[..2];\n\n    // 16 是切片大小\n    assert!(std::mem::size_of_val(&slice) == 16);\n    // 8 是数组大小\n    assert!(std::mem::size_of_val(slice) == 8);\n}`, `12451828680532584000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>char<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'中\'</span><span class="token punctuation">,</span> <span class="token char string">\'国\'</span><span class="token punctuation">,</span> <span class="token char string">\'人\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 16 是切片大小</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>slice<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 8 是数组大小</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-7"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2723723079488538000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let arr: [i32; 5] = [1, 2, 3, 4, 5];\n  // 填空让代码工作起来\n  let slice: __ = __;\n  assert_eq!(slice, &[2, 3, 4]);\n}`, `2723723079488538000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token comment">// 填空让代码工作起来</span>\n  <span class="token keyword">let</span> slice<span class="token punctuation">:</span> __ <span class="token operator">=</span> __<span class="token punctuation">;</span>\n  <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-73"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-73" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79513646550198040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [i32; 5] = [1, 2, 3, 4, 5];\n    // let slice: &[i32] = &arr[1..=3];\n    let slice: &[i32] = &arr[1..4];\n    assert_eq!(slice, &[2, 3, 4]);\n}`, `79513646550198040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// let slice: &amp;[i32] = &amp;arr[1..=3];</span>\n    <span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>i32<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-6"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59089043493970240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello&quot;);\n\n    let slice1 = &s[0..2];\n    // 填空，不要再使用 0..2\n    let slice2 = &s[__];\n\n    assert_eq!(slice1, slice2);\n}`, `59089043493970240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空，不要再使用 0..2</span>\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span>__<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-74"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-74" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52433773747743540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello&quot;);\n\n    let slice1 = &s[0..2];\n    // let slice2 = &s[..=1];\n    let slice2 = &s[..2];\n\n    assert_eq!(slice1, slice2);\n}`, `52433773747743540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// let slice2 = &amp;s[..=1];</span>\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-6"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8093189236917398000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;你好，世界&quot;;\n    // 修改以下代码行，让代码工作起来\n    let slice = &s[0..2];\n\n    assert!(slice == &quot;你&quot;);\n}`, `8093189236917398000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"你好，世界"</span><span class="token punctuation">;</span>\n    <span class="token comment">// 修改以下代码行，让代码工作起来</span>\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>slice <span class="token operator">==</span> <span class="token string">"你"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-75"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-75" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53902197031019905000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;你好，世界&quot;;\n    let slice = &s[0..3];\n\n    assert!(slice == &quot;你&quot;);\n}`, `53902197031019905000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"你好，世界"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>slice <span class="token operator">==</span> <span class="token string">"你"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-5"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67627262033231930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有错误\nfn main() {\n    let mut s = String::from(&quot;hello world&quot;);\n\n    // 这里, &s 是 \\`&String\\` 类型，但是 \\`first_character\\` 函数需要的是 \\`&str\\` 类型。\n    // 尽管两个类型不一样，但是代码仍然可以工作，原因是 \\`&String\\` 会被隐式地转换成 \\`&str\\` 类型，如果大家想要知道更多，可以看看 Deref 章节: https://course.rs/advance/smart-pointer/deref.html\n    let ch = first_character(&s);\n\n    s.clear(); // error!\n\n    println!(&quot;the first character is: {}&quot;, ch);\n}\nfn first_character(s: &str) -> &str {\n    &s[..1]\n}`, `67627262033231930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 这里, &amp;s 是 `&amp;String` 类型，但是 `first_character` 函数需要的是 `&amp;str` 类型。</span>\n    <span class="token comment">// 尽管两个类型不一样，但是代码仍然可以工作，原因是 `&amp;String` 会被隐式地转换成 `&amp;str` 类型，如果大家想要知道更多，可以看看 Deref 章节: https://course.rs/advance/smart-pointer/deref.html</span>\n    <span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token function">first_character</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    s<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error!</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the first character is: {}"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">first_character</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n    <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-76"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-76" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11088216079582636000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello world&quot;);\n\n    let ch = first_character(&s);\n\n    println!(&quot;the first character is: {}&quot;, ch);\n\n    s.clear(); // error!\n}\n\nfn first_character(s: &str) -> &str {\n    &s[..1]\n}`, `11088216079582636000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token function">first_character</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the first character is: {}"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    s<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error!</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">first_character</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n    <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="元组"><a href="#%E5%85%83%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>元组</h2>\n<h3 id="问题一-14"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64140078723102240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _t0: (u8,i16) = (0, -1);\n    // 元组的成员还可以是一个元组\n    let _t1: (u8, (i16, u32)) = (0, (-1, 1));\n    // 填空让代码工作\n    let t: (u8, __, i64, __, __) = (1u8, 2u16, 3i64, &quot;hello&quot;, String::from(&quot;, world&quot;));\n}`, `64140078723102240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _t0<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span>i16<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 元组的成员还可以是一个元组</span>\n    <span class="token keyword">let</span> _t1<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> <span class="token punctuation">(</span>i16<span class="token punctuation">,</span> u32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空让代码工作</span>\n    <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> __<span class="token punctuation">,</span> i64<span class="token punctuation">,</span> __<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1u8</span><span class="token punctuation">,</span> <span class="token number">2u16</span><span class="token punctuation">,</span> <span class="token number">3i64</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-77"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-77" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6694311275196862000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _t0: (u8,i16) = (0, -1);\n    let _t1: (u8, (i16, u32)) = (0, (-1, 1));\n    let t: (u8, u16, i64, &str, String) = (1u8, 2u16, 3i64, &quot;hello&quot;, String::from(&quot;, world&quot;));\n}`, `6694311275196862000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _t0<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span>i16<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _t1<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> <span class="token punctuation">(</span>i16<span class="token punctuation">,</span> u32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> u16<span class="token punctuation">,</span> i64<span class="token punctuation">,</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> String<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1u8</span><span class="token punctuation">,</span> <span class="token number">2u16</span><span class="token punctuation">,</span> <span class="token number">3i64</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-14"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22371409067541980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改合适的地方，让代码工作\nfn main() {\n    let t = (&quot;i&quot;, &quot;am&quot;, &quot;sunface&quot;);\n    assert_eq!(t.1, &quot;sunface&quot;);\n}`, `22371409067541980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改合适的地方，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token number">.1</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-78"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-78" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18113246805392746000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (&quot;i&quot;, &quot;am&quot;, &quot;sunface&quot;);\n    assert_eq!(t.2, &quot;sunface&quot;);\n}`, `18113246805392746000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token number">.2</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-8"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92672155877278300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码错误\nfn main() {\n    let too_long_tuple = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13);\n    println!(&quot;too long tuple: {:?}&quot;, too_long_tuple);\n}`, `92672155877278300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> too_long_tuple <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"too long tuple: {:?}"</span><span class="token punctuation">,</span> too_long_tuple<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-79"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-79" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97652252385754680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let too_long_tuple = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12);\n    println!(&quot;too long tuple: {:?}&quot;, too_long_tuple);\n}`, `97652252385754680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> too_long_tuple <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"too long tuple: {:?}"</span><span class="token punctuation">,</span> too_long_tuple<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-7"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53624111503613620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let tup = (1, 6.4, &quot;hello&quot;);\n\n    // 填空\n    let __ = tup;\n\n    assert_eq!(x, 1);\n    assert_eq!(y, &quot;hello&quot;);\n    assert_eq!(z, 6.4);\n}`, `53624111503613620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> tup <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> __ <span class="token operator">=</span> tup<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-80"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7664221919452463000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let tup = (1, 6.4, &quot;hello&quot;);\n\n    let (x, z, y) = tup;\n\n    assert_eq!(x, 1);\n    assert_eq!(y, &quot;hello&quot;);\n    assert_eq!(z, 6.4);\n}`, `7664221919452463000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> tup <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> z<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> tup<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-7"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96910520455866000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y, z);\n\n    // 填空\n    __ = (1, 2, 3);\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 1);\n    assert_eq!(z, 2);\n}`, `96910520455866000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    __ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-81"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11848154556819579000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y, z);\n\n    (y, z, x) = (1, 2, 3);\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 1);\n    assert_eq!(z, 2);\n}`, `11848154556819579000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token punctuation">(</span>y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-6"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7868971737706865000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空，需要稍微计算下\n    let (x, y) = sum_multiply(__);\n\n    assert_eq!(x, 5);\n    assert_eq!(y, 6);\n}\n\nfn sum_multiply(nums: (i32, i32)) -> (i32, i32) {\n    (nums.0 + nums.1, nums.0 * nums.1)\n}`, `7868971737706865000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空，需要稍微计算下</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">(</span>nums<span class="token number">.0</span> <span class="token operator">+</span> nums<span class="token number">.1</span><span class="token punctuation">,</span> nums<span class="token number">.0</span> <span class="token operator">*</span> nums<span class="token number">.1</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-82"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66609113523652890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y) = sum_multiply((2, 3));\n\n    assert_eq!(x, 5);\n    assert_eq!(y, 6);\n}\n\nfn sum_multiply(nums: (i32, i32)) -> (i32, i32) {\n    (nums.0 + nums.1, nums.0 * nums.1)\n}`, `66609113523652890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">(</span>nums<span class="token number">.0</span> <span class="token operator">+</span> nums<span class="token number">.1</span><span class="token punctuation">,</span> nums<span class="token number">.0</span> <span class="token operator">*</span> nums<span class="token number">.1</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="结构体"><a href="#%E7%BB%93%E6%9E%84%E4%BD%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结构体</h2>\n<h3 id="问题一-15"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52967356873916030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// fix the error\nstruct Person {\n    name: String,\n    age: u8,\n    hobby: String\n}\nfn main() {\n    let age = 30;\n    let p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n    };\n}`, `52967356873916030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// fix the error</span>\n<span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n    hobby<span class="token punctuation">:</span> String\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-83"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50789826210941770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Person {\n    name: String,\n    age: u8,\n    hobby: String,\n}\nfn main() {\n    let age = 30;\n    let p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n        hobby: String::from(&quot;dsa&quot;),\n    };\n}`, `50789826210941770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n    hobby<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n        hobby<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"dsa"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-15"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8169613709612533000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Unit;\ntrait SomeTrait {\n    // ...定义一些行为\n}\n\n// 我们并不关心结构体中有什么数据( 字段 )，但我们关心它的行为。\n// 因此这里我们使用没有任何字段的单元结构体，然后为它实现一些行为\nimpl SomeTrait for Unit {  }\nfn main() {\n    let u = Unit;\n    do_something_with_unit(u);\n}\n\n// 填空，让代码工作\nfn do_something_with_unit(u: __) {   }`, `8169613709612533000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Unit<span class="token punctuation">;</span>\n<span class="token keyword">trait</span> SomeTrait <span class="token punctuation">{</span>\n    <span class="token comment">// ...定义一些行为</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 我们并不关心结构体中有什么数据( 字段 )，但我们关心它的行为。</span>\n<span class="token comment">// 因此这里我们使用没有任何字段的单元结构体，然后为它实现一些行为</span>\n<span class="token keyword">impl</span> SomeTrait <span class="token keyword">for</span> Unit <span class="token punctuation">{</span>  <span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u <span class="token operator">=</span> Unit<span class="token punctuation">;</span>\n    <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> __<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-84"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="605622942756611700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Unit;\ntrait SomeTrait {\n}\n\nimpl SomeTrait for Unit {}\nfn main() {\n    let u = Unit;\n    do_something_with_unit(u);\n}\n\nfn do_something_with_unit(u: Unit) {}`, `605622942756611700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Unit<span class="token punctuation">;</span>\n<span class="token keyword">trait</span> SomeTrait <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> SomeTrait <span class="token keyword">for</span> Unit <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u <span class="token operator">=</span> Unit<span class="token punctuation">;</span>\n    <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-9"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70605996143150750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nstruct Color(i32, i32, i32);\nstruct Point(i32, i32, i32);\nfn main() {\n    let v = Point(__, __, __);\n    check_color(v);\n}\n\nfn check_color(p: Color) {\n   let (x, _, _) = p;\n   assert_eq!(x, 0);\n   assert_eq!(p.1, 127);\n   assert_eq!(__, 255);\n}`, `70605996143150750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">struct</span> <span class="token function">Color</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">struct</span> <span class="token function">Point</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> __<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">check_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">check_color</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> Color<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p<span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-85"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78006466203127700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Color(i32, i32, i32);\nstruct Point(i32, i32, i32);\nfn main() {\n    let v = Point(0, 127, 255);\n    check_color(v);\n}\n\nfn check_color(p: Point) {\n    let Point(x, y, z) = p;\n    assert_eq!(x, 0);\n    assert_eq!(p.1, 127);\n    assert_eq!(z, 255);\n}`, `78006466203127700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> <span class="token function">Color</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">struct</span> <span class="token function">Point</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">check_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">check_color</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token function">Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p<span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-8"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97802002932449620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误，不要增加或移除代码行\nstruct Person {\n    name: String,\n    age: u8,\n}\nfn main() {\n    let age = 18;\n    let p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n    };\n\n    // how can you believe sunface is only 18?\n    p.age = 30;\n\n    // 填空\n    __ = String::from(&quot;sunfei&quot;);\n}`, `97802002932449620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误，不要增加或移除代码行</span>\n<span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// how can you believe sunface is only 18?</span>\n    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    __ <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-86"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34033022716175032000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Person {\n    name: String,\n    age: u8,\n}\nfn main() {\n    let age = 18;\n    let mut p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n    };\n\n    p.age = 30;\n\n    p.name = String::from(&quot;sunfei&quot;);\n}`, `34033022716175032000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span>name <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-8"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32574629292346335000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nstruct Person {\n    name: String,\n    age: u8,\n}\nfn main() {}\n\nfn build_person(name: String, age: u8) -> Person {\n    Person {\n        age,\n        __\n    }\n}`, `32574629292346335000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">build_person</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> String<span class="token punctuation">,</span> age<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> Person <span class="token punctuation">{</span>\n    Person <span class="token punctuation">{</span>\n        age<span class="token punctuation">,</span>\n        __\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-87"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52644032716041360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Person {\n    name: String,\n    age: u8,\n}\nfn main() {}\n\nfn build_person(name: String, age: u8) -> Person {\n    Person {\n        age,\n        name\n    }\n}`, `52644032716041360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">build_person</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> String<span class="token punctuation">,</span> age<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> Person <span class="token punctuation">{</span>\n    Person <span class="token punctuation">{</span>\n        age<span class="token punctuation">,</span>\n        name\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-7"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19619810496868050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nstruct User {\n    active: bool,\n    username: String,\n    email: String,\n    sign_in_count: u64,\n}\nfn main() {\n    let u1 = User {\n        email: String::from(&quot;someone@example.com&quot;),\n        username: String::from(&quot;sunface&quot;),\n        active: true,\n        sign_in_count: 1,\n    };\n\n    let u2 = set_email(u1);\n}\n\nfn set_email(u: User) -> User {\n    User {\n        email: String::from(&quot;contact@im.dev&quot;),\n        __\n    }\n}`, `19619810496868050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">struct</span> User <span class="token punctuation">{</span>\n    active<span class="token punctuation">:</span> bool<span class="token punctuation">,</span>\n    username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    email<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    sign_in_count<span class="token punctuation">:</span> u64<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u1 <span class="token operator">=</span> User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        username<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        active<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>\n        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> u2 <span class="token operator">=</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">-></span> User <span class="token punctuation">{</span>\n    User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"contact@im.dev"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        __\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-88"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46116657922146320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct User {\n    active: bool,\n    username: String,\n    email: String,\n    sign_in_count: u64,\n}\nfn main() {\n    let u1 = User {\n        email: String::from(&quot;someone@example.com&quot;),\n        username: String::from(&quot;sunface&quot;),\n        active: true,\n        sign_in_count: 1,\n    };\n\n    let u2 = set_email(u1);\n}\n\nfn set_email(u: User) -> User {\n    User {\n        email: String::from(&quot;contact@im.dev&quot;),\n        ..u\n    }\n}`, `46116657922146320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> User <span class="token punctuation">{</span>\n    active<span class="token punctuation">:</span> bool<span class="token punctuation">,</span>\n    username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    email<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    sign_in_count<span class="token punctuation">:</span> u64<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u1 <span class="token operator">=</span> User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        username<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        active<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>\n        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> u2 <span class="token operator">=</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">-></span> User <span class="token punctuation">{</span>\n    User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"contact@im.dev"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">..</span>u\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-3"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56178327425055640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\n#[__]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nfn main() {\n    let scale = 2;\n    let rect1 = Rectangle {\n        width: dbg!(30 * scale), // 打印 debug 信息到标准错误输出 stderr,并将 \\`30 * scale\\` 的值赋给 \\`width\\`\n        height: 50,\n    };\n\n    dbg!(&rect1); // 打印 debug 信息到标准错误输出 stderr\n\n    println!(__, rect1); // 打印 debug 信息到标准输出 stdout\n}`, `56178327425055640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token attribute attr-name">#[__]</span>\n<span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>\n        width<span class="token punctuation">:</span> <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 打印 debug 信息到标准错误输出 stderr,并将 `30 * scale` 的值赋给 `width`</span>\n        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印 debug 信息到标准错误输出 stderr</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> rect1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印 debug 信息到标准输出 stdout</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-89"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87019793276949020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nfn main() {\n    let scale = 2;\n    let rect1 = Rectangle {\n        width: dbg!(30 * scale),\n        height: 50,\n    };\n\n    dbg!(&rect1);\n\n    println!(&quot;{:#?}&quot;, rect1);\n}`, `87019793276949020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>\n        width<span class="token punctuation">:</span> <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:#?}"</span><span class="token punctuation">,</span> rect1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-3"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88246055917268650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    #[derive(Debug)]\n    struct Person {\n        name: String,\n        age: Box<u8>,\n    }\n\n    let person = Person {\n        name: String::from(&quot;Alice&quot;),\n        age: Box::new(20),\n    };\n\n    // 通过这种解构式模式匹配，person.name 的所有权被转移给新的变量 \\`name\\`\n    // 但是，这里 \\`age\\` 变量确是对 person.age 的引用, 这里 ref 的使用相当于: let age = &person.age\n    let Person { name, ref age } = person;\n\n    println!(&quot;The person\'s age is {}&quot;, age);\n\n    println!(&quot;The person\'s name is {}&quot;, name);\n\n    // Error! 原因是 person 的一部分已经被转移了所有权，因此我们无法再使用它\n    //println!(&quot;The person struct is {:?}&quot;, person);\n\n    // 虽然 \\`person\\` 作为一个整体无法再被使用，但是 \\`person.age\\` 依然可以使用\n    println!(&quot;The person\'s age from person struct is {}&quot;, person.age);\n}`, `88246055917268650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token attribute attr-name">#[derive(Debug)]</span>\n    <span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n        age<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">let</span> person <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">:</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 通过这种解构式模式匹配，person.name 的所有权被转移给新的变量 `name`</span>\n    <span class="token comment">// 但是，这里 `age` 变量确是对 person.age 的引用, 这里 ref 的使用相当于: let age = &amp;person.age</span>\n    <span class="token keyword">let</span> Person <span class="token punctuation">{</span> name<span class="token punctuation">,</span> <span class="token keyword">ref</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> person<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The person\'s age is {}"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The person\'s name is {}"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Error! 原因是 person 的一部分已经被转移了所有权，因此我们无法再使用它</span>\n    <span class="token comment">//println!("The person struct is {:?}", person);</span>\n\n    <span class="token comment">// 虽然 `person` 作为一个整体无法再被使用，但是 `person.age` 依然可以使用</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The person\'s age from person struct is {}"</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-3"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99746727957322580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\n#[derive(Debug)]\nstruct File {\n    name: String,\n    data: String,\n}\nfn main() {\n    let f = File {\n        name: String::from(&quot;readme.md&quot;),\n        data: &quot;Rust By Practice&quot;.to_string()\n    };\n\n    let _name = f.name;\n\n    // 只能修改这一行\n    println!(&quot;{}, {}, {:?}&quot;,f.name, f.data, f);\n}`, `99746727957322580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> File <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    data<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> File <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"readme.md"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        data<span class="token punctuation">:</span> <span class="token string">"Rust By Practice"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _name <span class="token operator">=</span> f<span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n\n    <span class="token comment">// 只能修改这一行</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}, {:?}"</span><span class="token punctuation">,</span>f<span class="token punctuation">.</span>name<span class="token punctuation">,</span> f<span class="token punctuation">.</span>data<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-90"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87743999928898720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct File {\n    name: String,\n    data: String,\n}\nfn main() {\n    let f = File {\n        name: String::from(&quot;readme.md&quot;),\n        data: &quot;Rust By Practice&quot;.to_string(),\n    };\n\n    let _name = f.name;\n\n    println!(&quot;{}, {}&quot;, _name, f.data);\n}`, `87743999928898720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> File <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    data<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> File <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"readme.md"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        data<span class="token punctuation">:</span> <span class="token string">"Rust By Practice"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _name <span class="token operator">=</span> f<span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> _name<span class="token punctuation">,</span> f<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="枚举"><a href="#%E6%9E%9A%E4%B8%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>枚举</h2>\n<h3 id="问题一-16"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8344539042629595000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nenum Number {\n    Zero,\n    One,\n    Two,\n}\n\nenum Number1 {\n    Zero = 0,\n    One,\n    Two,\n}\n\n// C语言风格的枚举定义\nenum Number2 {\n    Zero = 0.0,\n    One = 1.0,\n    Two = 2.0,\n}\n\n\nfn main() {\n    // 通过 \\`as\\` 可以将枚举值强转为整数类型\n    assert_eq!(Number::One, Number1::One);\n    assert_eq!(Number1::One, Number2::One);\n}`, `8344539042629595000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">enum</span> Number <span class="token punctuation">{</span>\n    Zero<span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Number1 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// C语言风格的枚举定义</span>\n<span class="token keyword">enum</span> Number2 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span>\n    One <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">,</span>\n    Two <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 通过 `as` 可以将枚举值强转为整数类型</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number<span class="token punctuation">::</span>One<span class="token punctuation">,</span> Number1<span class="token punctuation">::</span>One<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number1<span class="token punctuation">::</span>One<span class="token punctuation">,</span> Number2<span class="token punctuation">::</span>One<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-91"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53255573885999820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Number {\n    Zero,\n    One,\n    Two,\n}\n\nenum Number1 {\n    Zero = 0,\n    One,\n    Two,\n}\n\nenum Number2 {\n    Zero = 0,\n    One = 1,\n    Two = 2,\n}\n\n\nfn main() {\n    assert_eq!(Number::One as u8, Number1::One as u8);\n    assert_eq!(Number1::One as u8, Number2::One as u8);\n}`, `53255573885999820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Number <span class="token punctuation">{</span>\n    Zero<span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Number1 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Number2 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    One <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    Two <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">,</span> Number1<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number1<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">,</span> Number2<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-16"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42314910933316520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg1 = Message::Move{__}; // 使用x = 1, y = 2 来初始化\n    let msg2 = Message::Write(__); // 使用 &quot;hello, world!&quot; 来初始化\n}`, `42314910933316520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg1 <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>__<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 使用x = 1, y = 2 来初始化</span>\n    <span class="token keyword">let</span> msg2 <span class="token operator">=</span> Message<span class="token punctuation">::</span><span class="token function">Write</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 "hello, world!" 来初始化</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-92"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53779843383658200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg1 = Message::Move { x: 1, y: 2 };\n    let msg2 = Message::Write(String::from(&quot;hello, world!&quot;));\n}`, `53779843383658200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg1 <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> msg2 <span class="token operator">=</span> Message<span class="token punctuation">::</span><span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-10"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45448606420909620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 仅填空并修复错误\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg = Message::Move{x: 1, y: 2};\n\n    if let Message::Move{__} = msg {\n        assert_eq!(a, b);\n    } else {\n        panic!(&quot;不要让这行代码运行！&quot;);\n    }\n}`, `45448606420909620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 仅填空并修复错误</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>__<span class="token punctuation">}</span> <span class="token operator">=</span> msg <span class="token punctuation">{</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-93"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23429390725088715000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg = Message::Move { x: 1, y: 1 };\n\n    if let Message::Move { x: a, y: b } = msg {\n        assert_eq!(a, b);\n    } else {\n        panic!(&quot;不要让这行代码运行！&quot;);\n    }\n}`, `23429390725088715000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> a<span class="token punctuation">,</span> y<span class="token punctuation">:</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> msg <span class="token punctuation">{</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-9"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46072206629399945000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，并修复错误\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msgs: __ = [\n        Message::Quit,\n        Message::Move{x:1, y:3},\n        Message::ChangeColor(255,255,0)\n    ];\n\n    for msg in msgs {\n        show_message(msg)\n    }\n}\n\nfn show_message(msg: Message) {\n    println!(&quot;{}&quot;, msg);\n}`, `46072206629399945000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，并修复错误</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msgs<span class="token punctuation">:</span> __ <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Message<span class="token punctuation">::</span>Quit<span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> msg <span class="token keyword">in</span> msgs <span class="token punctuation">{</span>\n        <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-94"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16093458889685252000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msgs = [\n        Message::Quit,\n        Message::Move { x: 1, y: 3 },\n        Message::ChangeColor(255, 255, 0),\n    ];\n\n    for msg in msgs {\n        show_message(msg)\n    }\n}\n\nfn show_message(msg: Message) {\n    println!(&quot;{:#?}&quot;, msg);\n}`, `16093458889685252000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msgs <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Message<span class="token punctuation">::</span>Quit<span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> msg <span class="token keyword">in</span> msgs <span class="token punctuation">{</span>\n        <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:#?}"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-9"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68729829804305960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空让 \\`println\\` 输出，同时添加一些代码不要让最后一行的 \\`panic\\` 执行到\nfn main() {\n    let five = Some(5);\n    let six = plus_one(five);\n    let none = plus_one(None);\n\n    if let __ = six {\n        println!(&quot;{}&quot;, n)\n    }\n\n    panic!(&quot;不要让这行代码运行！&quot;);\n}\n\nfn plus_one(x: Option<i32>) -> Option<i32> {\n    match x {\n        __ => None,\n        __ => Some(i + 1),\n    }\n}`, `68729829804305960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空让 `println` 输出，同时添加一些代码不要让最后一行的 `panic` 执行到</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> five <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> six <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>five<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> none <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> __ <span class="token operator">=</span> six <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> x <span class="token punctuation">{</span>\n        __ <span class="token operator">=></span> None<span class="token punctuation">,</span>\n        __ <span class="token operator">=></span> <span class="token function">Some</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-95"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32690900908964270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let five = Some(5);\n    let six = plus_one(five);\n    let none = plus_one(None);\n\n    if let Some(n) = six {\n        println!(&quot;{}&quot;, n);\n        return\n    }\n\n    panic!(&quot;不要让这行代码运行！&quot;);\n}\n\nfn plus_one(x: Option<i32>) -> Option<i32> {\n    match x {\n        None => None,\n        Some(i) => Some(i + 1),\n    }\n}`, `32690900908964270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> five <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> six <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>five<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> none <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> six <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> x <span class="token punctuation">{</span>\n        None <span class="token operator">=></span> None<span class="token punctuation">,</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Some</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-8"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42542359701183140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码运行\nuse crate::List::*;\n\nenum List {\n    // Cons: 链表中包含有值的节点，节点是元组类型，第一个元素是节点的值，第二个元素是指向下一个节点的指针\n    Cons(u32, Box<List>),\n    // Nil: 链表中的最后一个节点，用于说明链表的结束\n    Nil,\n}\n\n// 为枚举实现一些方法\nimpl List {\n    // 创建空的链表\n    fn new() -> List {\n        // 因为没有节点，所以直接返回 Nil 节点\n        // 枚举成员 Nil 的类型是 List\n        Nil\n    }\n\n    // 在老的链表前面新增一个节点，并返回新的链表\n    fn prepend(self, elem: u32) -> __ {\n        Cons(elem, Box::new(self))\n    }\n\n    // 返回链表的长度\n    fn len(&self) -> u32 {\n        match *self {\n            // 这里我们不能拿走 tail 的所有权，因此需要获取它的引用\n            Cons(_, __ tail) => 1 + tail.len(),\n            // 空链表的长度为 0\n            Nil => 0\n        }\n    }\n\n    // 返回链表的字符串表现形式，用于打印输出\n    fn stringify(&self) -> String {\n        match *self {\n            Cons(head, ref tail) => {\n                // 递归生成字符串\n                format!(&quot;{}, {}&quot;, head, tail.__())\n            },\n            Nil => {\n                format!(&quot;Nil&quot;)\n            },\n        }\n    }\n}\n\nfn main() {\n    // 创建一个新的链表(也是空的)\n    let mut list = List::new();\n\n    // 添加一些元素\n    list = list.prepend(1);\n    list = list.prepend(2);\n    list = list.prepend(3);\n\n    // 打印列表的当前状态\n    println!(&quot;链表的长度是: {}&quot;, list.len());\n    println!(&quot;{}&quot;, list.stringify());\n}`, `42542359701183140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码运行</span>\n<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>List<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>\n\n<span class="token keyword">enum</span> List <span class="token punctuation">{</span>\n    <span class="token comment">// Cons: 链表中包含有值的节点，节点是元组类型，第一个元素是节点的值，第二个元素是指向下一个节点的指针</span>\n    <span class="token function">Cons</span><span class="token punctuation">(</span>u32<span class="token punctuation">,</span> Box<span class="token operator">&lt;</span>List<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment">// Nil: 链表中的最后一个节点，用于说明链表的结束</span>\n    Nil<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 为枚举实现一些方法</span>\n<span class="token keyword">impl</span> List <span class="token punctuation">{</span>\n    <span class="token comment">// 创建空的链表</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> List <span class="token punctuation">{</span>\n        <span class="token comment">// 因为没有节点，所以直接返回 Nil 节点</span>\n        <span class="token comment">// 枚举成员 Nil 的类型是 List</span>\n        Nil\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 在老的链表前面新增一个节点，并返回新的链表</span>\n    <span class="token keyword">fn</span> <span class="token function">prepend</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> elem<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> __ <span class="token punctuation">{</span>\n        <span class="token function">Cons</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 返回链表的长度</span>\n    <span class="token keyword">fn</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 这里我们不能拿走 tail 的所有权，因此需要获取它的引用</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> __ tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">1</span> <span class="token operator">+</span> tail<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token comment">// 空链表的长度为 0</span>\n            Nil <span class="token operator">=></span> <span class="token number">0</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 返回链表的字符串表现形式，用于打印输出</span>\n    <span class="token keyword">fn</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token keyword">ref</span> tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token comment">// 递归生成字符串</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> head<span class="token punctuation">,</span> tail<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            Nil <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Nil"</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 创建一个新的链表(也是空的)</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> list <span class="token operator">=</span> List<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 添加一些元素</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 打印列表的当前状态</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"链表的长度是: {}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-96"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72554759841894590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use crate::List::*;\n\nenum List {\n    Cons(u32, Box<List>),\n    Nil,\n}\n\nimpl List {\n    fn new() -> List {\n        Nil\n    }\n\n    fn prepend(self, elem: u32) -> List {\n        Cons(elem, Box::new(self))\n    }\n\n    fn len(&self) -> u32 {\n        match *self {\n            Cons(_, ref tail) => 1 + tail.len(),\n            Nil => 0\n        }\n    }\n\n    fn stringify(&self) -> String {\n        match *self {\n            Cons(head, ref tail) => {\n                format!(&quot;{}, {}&quot;, head, tail.stringify())\n            },\n            Nil => {\n                format!(&quot;Nil&quot;)\n            },\n        }\n    }\n}\n\nfn main() {\n    let mut list = List::new();\n\n    list = list.prepend(1);\n    list = list.prepend(2);\n    list = list.prepend(3);\n\n    println!(&quot;链表的长度是: {}&quot;, list.len());\n    println!(&quot;{}&quot;, list.stringify());\n}`, `72554759841894590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>List<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>\n\n<span class="token keyword">enum</span> List <span class="token punctuation">{</span>\n    <span class="token function">Cons</span><span class="token punctuation">(</span>u32<span class="token punctuation">,</span> Box<span class="token operator">&lt;</span>List<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Nil<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> List <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> List <span class="token punctuation">{</span>\n        Nil\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">prepend</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> elem<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> List <span class="token punctuation">{</span>\n        <span class="token function">Cons</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token keyword">ref</span> tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">1</span> <span class="token operator">+</span> tail<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            Nil <span class="token operator">=></span> <span class="token number">0</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token keyword">ref</span> tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> head<span class="token punctuation">,</span> tail<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            Nil <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Nil"</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> list <span class="token operator">=</span> List<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"链表的长度是: {}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO 练习到这里</p>\n<h1 id="流程控制"><a href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>流程控制</h1>\n<h2 id="问题一-17"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72211212757238830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let n = 5;\n\n    if n < 0 {\n        println!(&quot;{} is negative&quot;, n);\n    } __ n > 0 {\n        println!(&quot;{} is positive&quot;, n);\n    } __ {\n        println!(&quot;{} is zero&quot;, n);\n    }\n} `, `72211212757238830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is negative"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> __ n <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is positive"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> __ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is zero"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span> </code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-97"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1188187587664879600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `1188187587664879600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题二-17"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54519012569761950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let n = 5;\n\n    let big_n =\n        if n < 10 && n > -10 {\n            println!(&quot; 数字太小，先增加 10 倍再说&quot;);\n\n            10 * n\n        } else {\n            println!(&quot;数字太大，我们得让它减半&quot;);\n\n            n / 2.0 ;\n        }\n\n    println!(&quot;{} -> {}&quot;, n, big_n);\n} `, `54519012569761950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> big_n <span class="token operator">=</span>\n        <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> n <span class="token operator">></span> <span class="token operator">-</span><span class="token number">10</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">" 数字太小，先增加 10 倍再说"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token number">10</span> <span class="token operator">*</span> n\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"数字太大，我们得让它减半"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            n <span class="token operator">/</span> <span class="token number">2.0</span> <span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} -> {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> big_n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> </code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-98"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95865910461601090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `95865910461601090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题三-11"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91396540241913990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    for n in 1..=100 { // 修改此行，让代码工作\n        if n == 100 {\n            panic!(&quot;NEVER LET THIS RUN&quot;)\n        }\n    }\n} `, `91396540241913990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span> <span class="token comment">// 修改此行，让代码工作</span>\n        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">100</span> <span class="token punctuation">{</span>\n            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"NEVER LET THIS RUN"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span> </code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-99"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72958109168676730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `72958109168676730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题四-10"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93006791145686340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要新增或删除代码行\nfn main() {\n    let names = [String::from(&quot;liming&quot;),String::from(&quot;hanmeimei&quot;)];\n    for name in names {\n        // do something with name...\n    }\n\n    println!(&quot;{:?}&quot;, names);\n\n    let numbers = [1, 2, 3];\n    // numbers中的元素实现了 Copy，因此无需转移所有权\n    for n in numbers {\n        // do something with name...\n    }\n    \n    println!(&quot;{:?}&quot;, numbers);\n} `, `93006791145686340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要新增或删除代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"liming"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hanmeimei"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> name <span class="token keyword">in</span> names <span class="token punctuation">{</span>\n        <span class="token comment">// do something with name...</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// numbers中的元素实现了 Copy，因此无需转移所有权</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers <span class="token punctuation">{</span>\n        <span class="token comment">// do something with name...</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> </code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-100"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-100" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79385000985921980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `79385000985921980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题五-10"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62286553144230370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let a = [4,3,2,1];\n\n    // 通过索引和值的方式迭代数组 \\`a\\` \n    for (i,v) in a.__ {\n        println!(&quot;第{}个元素是{}&quot;,i+1,v);\n    }\n}`, `62286553144230370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 通过索引和值的方式迭代数组 `a` </span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span>__ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"第{}个元素是{}"</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-101"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-101" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18756727875370504000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `18756727875370504000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题六-9"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84235932837801740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让最后一行的  println! 工作 !\nfn main() {\n    // 一个计数值\n    let mut n = 1;\n\n    // 当条件为真时，不停的循环\n    while n __ 10 {\n        if n % 15 == 0 {\n            println!(&quot;fizzbuzz&quot;);\n        } else if n % 3 == 0 {\n            println!(&quot;fizz&quot;);\n        } else if n % 5 == 0 {\n            println!(&quot;buzz&quot;);\n        } else {\n            println!(&quot;{}&quot;, n);\n        }\n\n\n        __;\n    }\n\n    println!(&quot;n 的值是 {}, 循环结束&quot;,n);\n}`, `84235932837801740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让最后一行的  println! 工作 !</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 一个计数值</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 当条件为真时，不停的循环</span>\n    <span class="token keyword">while</span> n __ <span class="token number">10</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">15</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"fizzbuzz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"fizz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"buzz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n\n        __<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n 的值是 {}, 循环结束"</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-102"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-102" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18760782921721320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `18760782921721320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题七-4"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32985210472706994000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，不要修改其它代码\nfn main() {\n    let mut n = 0;\n    for i in 0..=100 {\n       if n == 66 {\n           __\n       }\n       n += 1;\n    }\n\n    assert_eq!(n, 66);\n}`, `32985210472706994000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span>\n       <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">66</span> <span class="token punctuation">{</span>\n           __\n       <span class="token punctuation">}</span>\n       n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-103"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-103" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55666397870808424000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `55666397870808424000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题八-4"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60594053541834800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，不要修改其它代码\nfn main() {\n    let mut n = 0;\n    for i in 0..=100 {\n       if n != 66 {\n           n+=1;\n           __;\n       }\n       \n       __\n    }\n\n    assert_eq!(n, 66);\n}`, `60594053541834800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span>\n       <span class="token keyword">if</span> n <span class="token operator">!=</span> <span class="token number">66</span> <span class="token punctuation">{</span>\n           n<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>\n           __<span class="token punctuation">;</span>\n       <span class="token punctuation">}</span>\n       \n       __\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-104"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-104" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32809051998193308000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `32809051998193308000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题九-4"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56961318956058075000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，不要修改其它代码\nfn main() {\n    let mut count = 0u32;\n\n    println!(&quot;Let\'s count until infinity!&quot;);\n\n    // 无限循环\n    loop {\n        count += 1;\n\n        if count == 3 {\n            println!(&quot;three&quot;);\n\n            // 跳过当此循环的剩余代码\n            __;\n        }\n\n        println!(&quot;{}&quot;, count);\n\n        if count == 5 {\n            println!(&quot;OK, that\'s enough&quot;);\n\n            __;\n        }\n    }\n\n    assert_eq!(count, 5);\n}`, `56961318956058075000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0u32</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Let\'s count until infinity!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 无限循环</span>\n    <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token comment">// 跳过当此循环的剩余代码</span>\n            __<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"OK, that\'s enough"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            __<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-105"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-105" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12362720029158414000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `12362720029158414000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题十-2"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82874706125803400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut counter = 0;\n\n    let result = loop {\n        counter += 1;\n\n        if counter == 10 {\n            __;\n        }\n    };\n\n    assert_eq!(result, 20);\n}`, `82874706125803400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> counter <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">{</span>\n            __<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-106"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-106" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81304502032195010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `81304502032195010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题十一-1"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%B8%80-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十一</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70717057673542770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut count = 0;\n    \'outer: loop {\n        \'inner1: loop {\n            if count >= 20 {\n                // 这只会跳出 inner1 循环\n                break \'inner1; // 这里使用 \\`break\\` 也是一样的\n            }\n            count += 2;\n        }\n\n        count += 5;\n\n        \'inner2: loop {\n            if count >= 30 {\n                break \'outer;\n            }\n\n            continue \'outer;\n        }\n    }\n\n    assert!(count == __)\n}`, `70717057673542770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token lifetime-annotation symbol">\'outer:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        <span class="token lifetime-annotation symbol">\'inner1:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">20</span> <span class="token punctuation">{</span>\n                <span class="token comment">// 这只会跳出 inner1 循环</span>\n                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">\'inner1;</span> <span class="token comment">// 这里使用 `break` 也是一样的</span>\n            <span class="token punctuation">}</span>\n            count <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        count <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n        <span class="token lifetime-annotation symbol">\'inner2:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">30</span> <span class="token punctuation">{</span>\n                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">\'outer;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">continue</span> <span class="token lifetime-annotation symbol">\'outer;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>count <span class="token operator">==</span> __<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-107"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-107" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30909149843459203000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `30909149843459203000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h1 id="模式匹配"><a href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式匹配</h1>\n<h2 id="match-和-if-let"><a href="#match-%E5%92%8C-if-let" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>match 和 if let</h2>\n<h3 id="问题一-18"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20006972772510490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Direction {\n    East,\n    West,\n    North,\n    South,\n}\n\nfn main() {\n    let dire = Direction::South;\n    match dire {\n        Direction::East => println!(&quot;East&quot;),\n        __  => { // 在这里匹配 South 或 North\n            println!(&quot;South or North&quot;);\n        },\n        _ => println!(__),\n    };\n}`, `20006972772510490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Direction <span class="token punctuation">{</span>\n    East<span class="token punctuation">,</span>\n    West<span class="token punctuation">,</span>\n    North<span class="token punctuation">,</span>\n    South<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> dire <span class="token operator">=</span> Direction<span class="token punctuation">::</span>South<span class="token punctuation">;</span>\n    <span class="token keyword">match</span> dire <span class="token punctuation">{</span>\n        Direction<span class="token punctuation">::</span>East <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        __  <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// 在这里匹配 South 或 North</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"South or North"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-108"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-108" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66285666949610840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `66285666949610840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题二-18"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92583004980648280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let boolean = true;\n\n    // 使用 match 表达式填空，并满足以下条件\n    //\n    // boolean = true => binary = 1\n    // boolean = false => binary = 0\n    let binary = __;\n\n    assert_eq!(binary, 1);\n}`, `92583004980648280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> boolean <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 match 表达式填空，并满足以下条件</span>\n    <span class="token comment">//</span>\n    <span class="token comment">// boolean = true => binary = 1</span>\n    <span class="token comment">// boolean = false => binary = 0</span>\n    <span class="token keyword">let</span> binary <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-109"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-109" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60174127987123446000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `60174127987123446000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题三-12"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14716511342229332000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msgs = [\n        Message::Quit,\n        Message::Move{x:1, y:3},\n        Message::ChangeColor(255,255,0)\n    ];\n\n    for msg in msgs {\n        show_message(msg)\n    }\n} \n\nfn show_message(msg: Message) {\n    match msg {\n        __ => { // 这里匹配 Message::Move\n            assert_eq!(a, 1);\n            assert_eq!(b, 3);\n        },\n        Message::ChangeColor(_, g, b) => {\n            assert_eq!(g, __);\n            assert_eq!(b, __);\n        }\n        __ => println!(&quot;no data in these variants&quot;)\n    }\n}`, `14716511342229332000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msgs <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Message<span class="token punctuation">::</span>Quit<span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> msg <span class="token keyword">in</span> msgs <span class="token punctuation">{</span>\n        <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span> \n\n<span class="token keyword">fn</span> <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>\n        __ <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// 这里匹配 Message::Move</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        __ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"no data in these variants"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-110"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-110" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93435398951170920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `93435398951170920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题四-11"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20909722814805987000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let alphabets = [\'a\', \'E\', \'Z\', \'0\', \'x\', \'9\' , \'Y\'];\n\n    // 使用 \\`matches\\` 填空\n    for ab in alphabets {\n        assert!(__)\n    }\n} `, `20909722814805987000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> alphabets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'E\'</span><span class="token punctuation">,</span> <span class="token char string">\'Z\'</span><span class="token punctuation">,</span> <span class="token char string">\'0\'</span><span class="token punctuation">,</span> <span class="token char string">\'x\'</span><span class="token punctuation">,</span> <span class="token char string">\'9\'</span> <span class="token punctuation">,</span> <span class="token char string">\'Y\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 `matches` 填空</span>\n    <span class="token keyword">for</span> ab <span class="token keyword">in</span> alphabets <span class="token punctuation">{</span>\n        <span class="token function">assert!</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span> </code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-111"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-111" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88811759723035530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `88811759723035530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题五-11"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38197525738327570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum MyEnum {\n    Foo,\n    Bar\n}\n\nfn main() {\n    let mut count = 0;\n\n    let v = vec![MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];\n    for e in v {\n        if e == MyEnum::Foo { // 修复错误，只能修改本行代码\n            count += 1;\n        }\n    }\n\n    assert_eq!(count, 2);\n}`, `38197525738327570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> MyEnum <span class="token punctuation">{</span>\n    Foo<span class="token punctuation">,</span>\n    Bar\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Bar<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> e <span class="token keyword">in</span> v <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> e <span class="token operator">==</span> MyEnum<span class="token punctuation">::</span>Foo <span class="token punctuation">{</span> <span class="token comment">// 修复错误，只能修改本行代码</span>\n            count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-112"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-112" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68435696113168840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `68435696113168840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题六-10"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45143544105649180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let o = Some(7);\n\n    // 移除整个 \\`match\\` 语句块，使用 \\`if let\\` 替代\n    match o {\n        Some(i) => {\n            println!(&quot;This is a really long string and \\`{:?}\\`&quot;, i);\n        }\n        _ => {}\n    };\n}`, `45143544105649180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 移除整个 `match` 语句块，使用 `if let` 替代</span>\n    <span class="token keyword">match</span> o <span class="token punctuation">{</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"This is a really long string and `{:?}`"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-113"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-113" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23336274347380457000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `23336274347380457000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题七-5"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75623547697940090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Foo {\n    Bar(u8)\n}\n\nfn main() {\n    let a = Foo::Bar(1);\n\n    __ {\n        println!(&quot;foobar 持有的值是: {}&quot;, i);\n    }\n}`, `75623547697940090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Foo <span class="token punctuation">{</span>\n    <span class="token function">Bar</span><span class="token punctuation">(</span>u8<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> Foo<span class="token punctuation">::</span><span class="token function">Bar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    __ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"foobar 持有的值是: {}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-114"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-114" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="109248774300962910"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `109248774300962910`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题八-5"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45939633680189600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Foo {\n    Bar,\n    Baz,\n    Qux(u32)\n}\n\nfn main() {\n    let a = Foo::Qux(10);\n\n    // 移除以下代码，使用 \\`match\\` 代替\n    if let Foo::Bar = a {\n        println!(&quot;match foo::bar&quot;)\n    } else if let Foo::Baz = a {\n        println!(&quot;match foo::baz&quot;)\n    } else {\n        println!(&quot;match others&quot;)\n    }\n}`, `45939633680189600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Foo <span class="token punctuation">{</span>\n    Bar<span class="token punctuation">,</span>\n    Baz<span class="token punctuation">,</span>\n    <span class="token function">Qux</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> Foo<span class="token punctuation">::</span><span class="token function">Qux</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 移除以下代码，使用 `match` 代替</span>\n    <span class="token keyword">if</span> <span class="token keyword">let</span> Foo<span class="token punctuation">::</span>Bar <span class="token operator">=</span> a <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match foo::bar"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> Foo<span class="token punctuation">::</span>Baz <span class="token operator">=</span> a <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match foo::baz"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match others"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-115"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-115" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51549375871748660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `51549375871748660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题九-5"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93818415674601900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 就地修复错误\nfn main() {\n    let age = Some(30);\n    if let Some(age) = age { // 创建一个新的变量，该变量与之前的 \\`age\\` 变量同名\n       assert_eq!(age, Some(30));\n    } // 新的 \\`age\\` 变量在这里超出作用域\n    \n    match age {\n        // \\`match\\` 也能实现变量遮蔽\n        Some(age) =>  println!(&quot;age 是一个新的变量，它的值是 {}&quot;,age),\n        _ => ()\n    }\n }`, `93818415674601900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 就地修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=</span> age <span class="token punctuation">{</span> <span class="token comment">// 创建一个新的变量，该变量与之前的 `age` 变量同名</span>\n       <span class="token function">assert_eq!</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token comment">// 新的 `age` 变量在这里超出作用域</span>\n    \n    <span class="token keyword">match</span> age <span class="token punctuation">{</span>\n        <span class="token comment">// `match` 也能实现变量遮蔽</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"age 是一个新的变量，它的值是 {}"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-116"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-116" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15166880519352267000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `15166880519352267000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="模式"><a href="#%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式</h2>\n<h3 id="问题一-19"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39975011928377310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {}\nfn match_number(n: i32) {\n    match n {\n        // 匹配一个单独的值\n        1 => println!(&quot;One!&quot;),\n        // 使用 \\`|\\` 填空，不要使用 \\`..\\` 或 \\`..=\\`\n        __ => println!(&quot;match 2 -> 5&quot;),\n        // 匹配一个闭区间的数值序列\n        6..=10 => {\n            println!(&quot;match 6 -> 10&quot;)\n        },\n        _ => {\n            println!(&quot;match 11 -> +infinite&quot;)\n        }\n    }\n}`, `39975011928377310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">match_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> n <span class="token punctuation">{</span>\n        <span class="token comment">// 匹配一个单独的值</span>\n        <span class="token number">1</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 使用 `|` 填空，不要使用 `..` 或 `..=`</span>\n        __ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 2 -> 5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 匹配一个闭区间的数值序列</span>\n        <span class="token number">6</span><span class="token punctuation">..=</span><span class="token number">10</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 6 -> 10"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 11 -> +infinite"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-117"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-117" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96337939337600430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `96337939337600430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题二-19"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32119420195096370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Point {\n    x: i32,\n    y: i32,\n}\n\nfn main() {\n    // 填空，让 p 匹配第二个分支\n    let p = Point { x: __, y: __ };\n\n    match p {\n        Point { x, y: 0 } => println!(&quot;On the x axis at {}&quot;, x),\n        // 第二个分支\n        Point { x: 0..=5, y: y@ (10 | 20 | 30) } => println!(&quot;On the y axis at {}&quot;, y),\n        Point { x, y } => println!(&quot;On neither axis: ({}, {})&quot;, x, y),\n    }\n}`, `32119420195096370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Point <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空，让 p 匹配第二个分支</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> __<span class="token punctuation">,</span> y<span class="token punctuation">:</span> __ <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> p <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On the x axis at {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 第二个分支</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> y<span class="token operator">@</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">|</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On the y axis at {}"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On neither axis: ({}, {})"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-118"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-118" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59225121167113340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `59225121167113340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题三-13"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8140578049134994000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nenum Message {\n    Hello { id: i32 },\n}\n\nfn main() {\n    let msg = Message::Hello { id: 5 };\n\n    match msg {\n        Message::Hello {\n            id:  3..=7,\n        } => println!(&quot;id 值的范围在 [3, 7] 之间: {}&quot;, id),\n        Message::Hello { id: newid@10 | 11 | 12 } => {\n            println!(&quot;id 值的范围在 [10, 12] 之间: {}&quot;, newid)\n        }\n        Message::Hello { id } => println!(&quot;Found some other id: {}&quot;, id),\n    }\n}`, `8140578049134994000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span>\n            id<span class="token punctuation">:</span>  <span class="token number">3</span><span class="token punctuation">..=</span><span class="token number">7</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"id 值的范围在 [3, 7] 之间: {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> newid<span class="token operator">@</span><span class="token number">10</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> <span class="token number">12</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"id 值的范围在 [10, 12] 之间: {}"</span><span class="token punctuation">,</span> newid<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Found some other id: {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-119"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-119" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95424991519543510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `95424991519543510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题四-12"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25488539332380865000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空让代码工作，必须使用 \\`split\\`\nfn main() {\n    let num = Some(4);\n    let split = 5;\n    match num {\n        Some(x) __ => assert!(x < split),\n        Some(x) => assert!(x >= split),\n        None => (),\n    }\n}`, `25488539332380865000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空让代码工作，必须使用 `split`</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> split <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">match</span> num <span class="token punctuation">{</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> __ <span class="token operator">=></span> <span class="token function">assert!</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> split<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">assert!</span><span class="token punctuation">(</span>x <span class="token operator">>=</span> split<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        None <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-120"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-120" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11515685213641257000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `11515685213641257000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题五-12"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50444199519088560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nfn main() {\n    let numbers = (2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048);\n\n    match numbers {\n        __ => {\n           assert_eq!(first, 2);\n           assert_eq!(last, 2048);\n        }\n    }\n}`, `50444199519088560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> numbers <span class="token punctuation">{</span>\n        __ <span class="token operator">=></span> <span class="token punctuation">{</span>\n           <span class="token function">assert_eq!</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n           <span class="token function">assert_eq!</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-121"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-121" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33178830937226465000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `33178830937226465000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h3 id="问题六-11"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68859275803941850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，尽量少地修改代码\n// 不要移除任何代码行\nfn main() {\n    let mut v = String::from(&quot;hello,&quot;);\n    let r = &mut v;\n\n    match r {\n       &mut value => value.push_str(&quot; world!&quot;) \n    }\n}`, `68859275803941850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，尽量少地修改代码</span>\n<span class="token comment">// 不要移除任何代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> r <span class="token punctuation">{</span>\n       <span class="token operator">&amp;</span><span class="token keyword">mut</span> value <span class="token operator">=></span> value<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" world!"</span><span class="token punctuation">)</span> \n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-122"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-122" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83458620682227530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `83458620682227530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h1 id="方法"><a href="#%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法</h1>\n<h2 id="问题一-20"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89983197949192220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nimpl Rectangle {\n    // 完成 area 方法，返回矩形 Rectangle 的面积\n    fn area\n}\n\nfn main() {\n    let rect1 = Rectangle { width: 30, height: 50 };\n\n    assert_eq!(rect1.area(), 1500);\n}`, `89983197949192220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>\n    <span class="token comment">// 完成 area 方法，返回矩形 Rectangle 的面积</span>\n    <span class="token keyword">fn</span> area\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>rect1<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-123"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-123" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22476268915133880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `22476268915133880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题二-20"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92224226462818840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只填空，不要删除任何代码行!\n#[derive(Debug)]\nstruct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    pub fn show_state(__)  {\n        println!(&quot;the current state is {}&quot;, __.color);\n    }\n}\nfn main() {\n    let light = TrafficLight{\n        color: &quot;red&quot;.to_owned(),\n    };\n    // 不要拿走 \\`light\\` 的所有权\n    light.show_state();\n    // 否则下面代码会报错\n    println!(&quot;{:?}&quot;, light);\n}`, `92224226462818840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 只填空，不要删除任何代码行!</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">show_state</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the current state is {}"</span><span class="token punctuation">,</span> __<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> light <span class="token operator">=</span> TrafficLight<span class="token punctuation">{</span>\n        color<span class="token punctuation">:</span> <span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token comment">// 不要拿走 `light` 的所有权</span>\n    light<span class="token punctuation">.</span><span class="token function">show_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 否则下面代码会报错</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> light<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-124"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-124" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4586619394961633000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `4586619394961633000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题三-14"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91001233159118770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    // 使用 \\`Self\\` 填空\n    pub fn show_state(__)  {\n        println!(&quot;the current state is {}&quot;, self.color);\n    }\n\n    // 填空，不要使用 \\`Self\\` 或其变体\n    pub fn change_state(__) {\n        self.color = &quot;green&quot;.to_string()\n    }\n}\nfn main() {}`, `91001233159118770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token comment">// 使用 `Self` 填空</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">show_state</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the current state is {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 填空，不要使用 `Self` 或其变体</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">change_state</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">"green"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-125"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-125" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27020329768678298000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `27020329768678298000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题四-13"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66854102380293740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    // 1. 实现下面的关联函数 \\`new\\`,\n    // 2. 该函数返回一个 TrafficLight 实例，包含 \\`color\\` &quot;red&quot;\n    // 3. 该函数必须使用 \\`Self\\` 作为类型，不能在签名或者函数体中使用 \\`TrafficLight\\`\n    pub fn new() \n\n    pub fn get_state(&self) -> &str {\n        &self.color\n    }\n}\n\nfn main() {\n    let light = TrafficLight::new();\n    assert_eq!(light.get_state(), &quot;red&quot;);\n}`, `66854102380293740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token comment">// 1. 实现下面的关联函数 `new`,</span>\n    <span class="token comment">// 2. 该函数返回一个 TrafficLight 实例，包含 `color` "red"</span>\n    <span class="token comment">// 3. 该函数必须使用 `Self` 作为类型，不能在签名或者函数体中使用 `TrafficLight`</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> \n\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">get_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>color\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> light <span class="token operator">=</span> TrafficLight<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span><span class="token function">get_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-126"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-126" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27200362436488420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `27200362436488420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题五-13"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99022032162842300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Rectangle {\n    width: u32,\n    height: u32,\n}\n\n// 使用多个 \\`impl\\` 语句块重写下面的代码\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n\n    fn can_hold(&self, other: &Rectangle) -> bool {\n        self.width > other.width && self.height > other.height\n    }\n}\n\n\nfn main() {}`, `99022032162842300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用多个 `impl` 语句块重写下面的代码</span>\n<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Rectangle<span class="token punctuation">)</span> <span class="token punctuation">-></span> bool <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">></span> other<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">></span> other<span class="token punctuation">.</span>height\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-127"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-127" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48932840823078715000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `48932840823078715000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题六-12"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84029276794761070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nenum TrafficLightColor {\n    Red,\n    Yellow,\n    Green,\n}\n\n// 为 TrafficLightColor 实现所需的方法\nimpl TrafficLightColor {\n    \n}\n\nfn main() {\n    let c = TrafficLightColor::Yellow;\n\n    assert_eq!(c.color(), &quot;yellow&quot;);\n\n    println!(&quot;{:?}&quot;,c);\n}`, `84029276794761070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> TrafficLightColor <span class="token punctuation">{</span>\n    Red<span class="token punctuation">,</span>\n    Yellow<span class="token punctuation">,</span>\n    Green<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 为 TrafficLightColor 实现所需的方法</span>\n<span class="token keyword">impl</span> TrafficLightColor <span class="token punctuation">{</span>\n    \n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c <span class="token operator">=</span> TrafficLightColor<span class="token punctuation">::</span>Yellow<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-128"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-128" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19106429461586362000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `19106429461586362000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<p>// TODO <a href="https://zh.practice.rs/generics-traits/intro.html" target="_blank" rel="nofollow noreferrer noopener">https://zh.practice.rs/generics-traits/intro.html</a></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Rust练手测试/index.md absPath of file >>> MarkdownRemark",timeToRead:72,frontmatter:{date:"2022-08-02 17:24:05",path:"/rust-practice-test/",tags:"后端, Rust, 练手测试",title:"Rust练手测试",draft:null}},{excerpt:"基本概念 镜像 Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。 分层存储 因为镜像包含操作系统完整的 root 文件系统，其体积往往是庞大的，因此在 Docker 设计时，就充分利用 Union FS 的技术，将其设计为分层存储的架构。所以严格来说，镜像并非是像一个 ISO…",html:'<h1 id="基本概念"><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本概念</h1>\n<h2 id="镜像"><a href="#%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>镜像</h2>\n<p>Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>\n<h3 id="分层存储"><a href="#%E5%88%86%E5%B1%82%E5%AD%98%E5%82%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分层存储</h3>\n<p>因为镜像包含操作系统完整的 root 文件系统，其体积往往是庞大的，因此在 Docker 设计时，就充分利用 Union FS 的技术，将其设计为分层存储的架构。所以严格来说，镜像并非是像一个 ISO 那样的打包文件，镜像只是一个虚拟的概念，其实际体现并非由一个文件组成，而是由一组文件系统组成，或者说，由多层文件系统联合组成。</p>\n<p>镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层。比如，删除前一层文件的操作，实际不是真的删除前一层的文件，而是仅在当前层标记为该文件已删除。在最终容器运行的时候，虽然不会看到这个文件，但是实际上该文件会一直跟随镜像。因此，在构建镜像的时候，需要额外小心，每一层尽量只包含该层需要添加的东西，任何额外的东西应该在该层构建结束前清理掉。</p>\n<p>分层存储的特征还使得镜像的复用、定制变的更为容易。甚至可以用之前构建好的镜像作为基础层，然后进一步添加新的层，以定制自己所需的内容，构建新的镜像。</p>\n<h2 id="容器"><a href="#%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器</h2>\n<p>镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p>\n<p>容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的命名空间（opens new window）。因此容器可以拥有自己的 root 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。这种特性使得容器封装的应用比直接在宿主运行更加安全。也因为这种隔离的特性，很多人初学 Docker 时常常会混淆容器和虚拟机。</p>\n<p>前面讲过镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，我们可以称这个为容器运行时读写而准备的存储层为容器存储层。</p>\n<p>容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。</p>\n<p>按照 Docker 最佳实践的要求，容器不应该向其存储层内写入任何数据，容器存储层要保持无状态化。所有的文件写入操作，都应该使用数据卷（Volume）、或者绑定宿主目录，在这些位置的读写会跳过容器存储层，直接对宿主（或网络存储）发生读写，其性能和稳定性更高。</p>\n<p>数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。</p>\n<h2 id="仓库"><a href="#%E4%BB%93%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>仓库</h2>\n<p>镜像构建完成后，可以很容易的在当前宿主机上运行，但是，如果需要在其它服务器上使用这个镜像，我们就需要一个集中的存储、分发镜像的服务，Docker Registry 就是这样的服务。</p>\n<p>一个 Docker Registry 中可以包含多个仓库（Repository）；每个仓库可以包含多个标签（Tag）；每个标签对应一个镜像。</p>\n<p>通常，一个仓库会包含同一个软件不同版本的镜像，而标签就常用于对应该软件的各个版本。我们可以通过 <code class="language-text">&lt;仓库名&gt;:&lt;标签&gt;</code> 的格式来指定具体是这个软件哪个版本的镜像。如果不给出标签，将以 latest 作为默认标签。</p>\n<p>以 Ubuntu 镜像为例，ubuntu 是仓库的名字，其内包含有不同的版本标签，如 16.04, 18.04。我们可以通过 ubuntu:16.04 或者 ubuntu:18.04 来具体指定所需哪个版本的镜像。如果忽略了标签，比如 ubuntu，那将视为 ubuntu:latest。</p>\n<p>仓库名经常以两段式路径形式出现，比如 jwilder/nginx-proxy，前者往往意味着 Docker Registry 多用户环境下的用户名，后者则往往是对应的软件名。但这并非绝对，取决于所使用的具体 Docker Registry 的软件或服务。</p>\n<h3 id="docker-registry-公开服务"><a href="#docker-registry-%E5%85%AC%E5%BC%80%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Registry 公开服务</h3>\n<p>Docker Registry 公开服务是开放给用户使用、允许用户管理镜像的 Registry 服务。一般这类公开服务允许用户免费上传、下载公开的镜像，并可能提供收费服务供用户管理私有镜像。</p>\n<p>最常使用的 Registry 公开服务是官方的 Docker Hub，这也是默认的 Registry，并拥有大量的高质量的官方镜像。除此以外，还有 Red Hat 的 Quay.io ；Google 的 Google Container Registry，Kubernetes 的镜像使用的就是这个服务；代码托管平台 GitHub 推出的 ghcr.io。</p>\n<p>由于某些原因，在国内访问这些服务可能会比较慢。国内的一些云服务商提供了针对 Docker Hub 的镜像服务（Registry Mirror），这些镜像服务被称为加速器。常见的有阿里云加速器、DaoCloud 加速器等。使用加速器会直接从国内的地址下载 Docker Hub 的镜像，比直接从 Docker Hub 下载速度会提高很多。</p>\n<p>国内也有一些云服务商提供类似于 Docker Hub 的公开服务。比如网易云镜像服务、DaoCloud 镜像市场、阿里云镜像库等。</p>\n<h3 id="私有-docker-registry"><a href="#%E7%A7%81%E6%9C%89-docker-registry" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>私有 Docker Registry</h3>\n<p>除了使用公开服务外，用户还可以在本地搭建私有 Docker Registry。Docker 官方提供了 Docker Registry 镜像，可以直接使用做为私有 Registry 服务。在私有仓库一节中，会有进一步的搭建私有 Registry 服务的讲解。</p>\n<p>开源的 Docker Registry 镜像只提供了 Docker Registry API 的服务端实现，足以支持 docker 命令，不影响使用。但不包含图形界面，以及镜像维护、用户管理、访问控制等高级功能。</p>\n<p>除了官方的 Docker Registry 外，还有第三方软件实现了 Docker Registry API，甚至提供了用户界面以及一些高级功能，比如 Harbor 和 Sonatype Nexus</p>\n<h1 id="使用镜像"><a href="#%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用镜像</h1>\n<p>Docker 运行容器前需要本地存在对应的镜像，如果本地不存在该镜像，Docker 会从镜像仓库下载该镜像。</p>\n<h2 id="获取镜像"><a href="#%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取镜像</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58526596173841840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]`, `58526596173841840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker pull <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>Docker Registry 地址<span class="token punctuation">[</span>:端口号<span class="token punctuation">]</span>/<span class="token punctuation">]</span>仓库名<span class="token punctuation">[</span>:标签<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<ul>\n<li>Docker 镜像仓库地址：地址的格式一般是 <code class="language-text">&lt;域名/IP&gt;[:端口号]</code>。默认地址是 Docker Hub(docker.io)。</li>\n<li>仓库名：如之前所说，这里的仓库名是两段式名称，即 <code class="language-text">&lt;用户名&gt;/&lt;软件名&gt;</code>。对于 Docker Hub，如果不给出用户名，则默认为 library，也就是官方镜像。</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="627295381499970400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker pull ubuntu:18.04\n18.04: Pulling from library/ubuntu\n92dc2a97ff99: Pull complete\nbe13a9d27eb8: Pull complete\nc8299583700a: Pull complete\nDigest: sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26\nStatus: Downloaded newer image for ubuntu:18.04\ndocker.io/library/ubuntu:18.04 # 完整名称`, `627295381499970400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker pull ubuntu:18.04\n<span class="token number">18.04</span>: Pulling from library/ubuntu\n92dc2a97ff99: Pull complete\nbe13a9d27eb8: Pull complete\nc8299583700a: Pull complete\nDigest: sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26\nStatus: Downloaded newer image <span class="token keyword">for</span> ubuntu:18.04\ndocker.io/library/ubuntu:18.04 <span class="token comment"># 完整名称</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行"><a href="#%E8%BF%90%E8%A1%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1543049580420996600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -it --rm ubuntu:18.04 bash\n\nroot@e7009c6ce357:/# cat /etc/os-release\nNAME=&quot;Ubuntu&quot;\nVERSION=&quot;18.04.1 LTS (Bionic Beaver)&quot;\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=&quot;Ubuntu 18.04.1 LTS&quot;\nVERSION_ID=&quot;18.04&quot;\nHOME_URL=&quot;https://www.ubuntu.com/&quot;\nSUPPORT_URL=&quot;https://help.ubuntu.com/&quot;\nBUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;\nPRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;\nVERSION_CODENAME=bionic\nUBUNTU_CODENAME=bionic`, `1543049580420996600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -it --rm ubuntu:18.04 <span class="token function">bash</span>\n\nroot@e7009c6ce357:/<span class="token comment"># cat /etc/os-release</span>\n<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu"</span>\n<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"18.04.1 LTS (Bionic Beaver)"</span>\n<span class="token assign-left variable">ID</span><span class="token operator">=</span>ubuntu\n<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span>debian\n<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu 18.04.1 LTS"</span>\n<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"18.04"</span>\n<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/"</span>\n<span class="token assign-left variable">SUPPORT_URL</span><span class="token operator">=</span><span class="token string">"https://help.ubuntu.com/"</span>\n<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.launchpad.net/ubuntu/"</span>\n<span class="token assign-left variable">PRIVACY_POLICY_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span>\n<span class="token assign-left variable">VERSION_CODENAME</span><span class="token operator">=</span>bionic\n<span class="token assign-left variable">UBUNTU_CODENAME</span><span class="token operator">=</span>bionic</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>docker run 就是运行容器的命令，具体格式我们会在容器一节进行详细讲解，我们这里简要的说明一下上面用到的参数。</p>\n<ul>\n<li><code class="language-text">-it</code>：这是两个参数，一个是 <code class="language-text">-i</code> 交互式操作，一个是 <code class="language-text">-t</code> 终端。我们这里打算进入 bash 执行一些命令并查看返回结果，因此我们需要交互式终端。</li>\n<li><code class="language-text">--rm</code>：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需求，退出的容器并不会立即删除，除非手动 docker rm。我们这里只是随便执行个命令，看看结果，不需要排障和保留结果，因此使用 —rm 可以避免浪费空间。</li>\n<li><code class="language-text">ubuntu:18.04</code>：这是指用 <code class="language-text">ubuntu:18.04</code> 镜像为基础来启动容器。</li>\n<li><code class="language-text">bash</code>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 bash。进入容器后，我们可以在 Shell 下操作，执行任何所需的命令。这里，我们执行了 cat /etc/os-release，这是 Linux 常用的查看当前系统版本的命令，从返回的结果可以看到容器内是 <code class="language-text">Ubuntu 18.04.1 LTS</code> 系统。</li>\n</ul>\n<p>最后我们通过 exit 退出了这个容器。</p>\n<h2 id="列出镜像"><a href="#%E5%88%97%E5%87%BA%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列出镜像</h2>\n<p>列出已经下载下来的镜像，可以使用 docker image ls 命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82283986349669200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls\nREPOSITORY           TAG                 IMAGE ID            CREATED             SIZE\nredis                latest              5f515359c7f8        5 days ago          183 MB\nnginx                latest              05a60462f8ba        5 days ago          181 MB\nmongo                3.2                 fe9198c04d62        5 days ago          342 MB\n<none>               <none>              00285df0df87        5 days ago          342 MB\nubuntu               18.04               329ed837d508        3 days ago          63.3MB\nubuntu               bionic              329ed837d508        3 days ago          63.3MB`, `82283986349669200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span>\nREPOSITORY           TAG                 IMAGE ID            CREATED             SIZE\nredis                latest              5f515359c7f8        <span class="token number">5</span> days ago          <span class="token number">183</span> MB\nnginx                latest              05a60462f8ba        <span class="token number">5</span> days ago          <span class="token number">181</span> MB\nmongo                <span class="token number">3.2</span>                 fe9198c04d62        <span class="token number">5</span> days ago          <span class="token number">342</span> MB\n<span class="token operator">&lt;</span>none<span class="token operator">></span>               <span class="token operator">&lt;</span>none<span class="token operator">></span>              00285df0df87        <span class="token number">5</span> days ago          <span class="token number">342</span> MB\nubuntu               <span class="token number">18.04</span>               329ed837d508        <span class="token number">3</span> days ago          <span class="token number">63</span>.3MB\nubuntu               bionic              329ed837d508        <span class="token number">3</span> days ago          <span class="token number">63</span>.3MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="镜像体积"><a href="#%E9%95%9C%E5%83%8F%E4%BD%93%E7%A7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>镜像体积</h3>\n<p>Docker Hub 中显示的体积是压缩后的体积，而 docker image ls 显示的是镜像下载到本地后展开的大小</p>\n<p>另外一个需要注意的问题是，docker image ls 列表中的镜像体积总和并非是所有镜像实际硬盘消耗。由于 Docker 镜像是多层存储结构，并且可以继承、复用，因此不同镜像可能会因为使用相同的基础镜像，从而拥有共同的层。由于 Docker 使用 Union FS，相同的层只需要保存一份即可，因此实际镜像硬盘占用空间很可能要比这个列表镜像大小的总和要小的多。</p>\n<p>你可以通过 docker system df 命令来便捷的查看镜像、容器、数据卷所占用的空间。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73832372792560470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker system df\n\nTYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE\nImages              24                  0                   1.992GB             1.992GB (100%)\nContainers          1                   0                   62.82MB             62.82MB (100%)\nLocal Volumes       9                   0                   652.2MB             652.2MB (100%)\nBuild Cache                                                 0B                  0B`, `73832372792560470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker system <span class="token function">df</span>\n\nTYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE\nImages              <span class="token number">24</span>                  <span class="token number">0</span>                   <span class="token number">1</span>.992GB             <span class="token number">1</span>.992GB <span class="token punctuation">(</span><span class="token number">100</span>%<span class="token punctuation">)</span>\nContainers          <span class="token number">1</span>                   <span class="token number">0</span>                   <span class="token number">62</span>.82MB             <span class="token number">62</span>.82MB <span class="token punctuation">(</span><span class="token number">100</span>%<span class="token punctuation">)</span>\nLocal Volumes       <span class="token number">9</span>                   <span class="token number">0</span>                   <span class="token number">652</span>.2MB             <span class="token number">652</span>.2MB <span class="token punctuation">(</span><span class="token number">100</span>%<span class="token punctuation">)</span>\nBuild Cache                                                 0B                  0B</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="虚悬镜像"><a href="#%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>虚悬镜像</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3541140234900908000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<none>               <none>              00285df0df87        5 days ago          342 MB`, `3541140234900908000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">&lt;</span>none<span class="token operator">></span>               <span class="token operator">&lt;</span>none<span class="token operator">></span>              00285df0df87        <span class="token number">5</span> days ago          <span class="token number">342</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这个镜像原本是有镜像名和标签的，原来为 <code class="language-text">mongo:3.2</code>，随着官方镜像维护，发布了新版本后，重新 <code class="language-text">docker pull mongo:3.2</code> 时，<code class="language-text">mongo:3.2</code> 这个镜像名被转移到了新下载的镜像身上，而旧的镜像上的这个名称则被取消，从而成为了 <code class="language-text">&lt;none&gt;</code>。除了 docker pull 可能导致这种情况，docker build 也同样可以导致这种现象。由于新旧镜像同名，旧镜像名称被取消，从而出现仓库名、标签均为 <code class="language-text">&lt;none&gt;</code> 的镜像。这类无标签镜像也被称为虚悬镜像 (dangling image) ，可以用下面的命令专门显示这类镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16601003555816196000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls -f dangling=true\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\n<none>              <none>              00285df0df87        5 days ago          342 MB`, `16601003555816196000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> -f <span class="token assign-left variable">dangling</span><span class="token operator">=</span>true\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\n<span class="token operator">&lt;</span>none<span class="token operator">></span>              <span class="token operator">&lt;</span>none<span class="token operator">></span>              00285df0df87        <span class="token number">5</span> days ago          <span class="token number">342</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>一般来说，虚悬镜像已经失去了存在的价值，是可以随意删除的，可以用下面的命令删除。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40250745660759860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image prune`, `40250745660759860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image prune</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="中间层镜像"><a href="#%E4%B8%AD%E9%97%B4%E5%B1%82%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>中间层镜像</h3>\n<p>为了加速镜像构建、重复利用资源，Docker 会利用中间层镜像。所以在使用一段时间后，可能会看到一些依赖的中间层镜像。默认的 docker image ls 列表中只会显示顶层镜像，如果希望显示包括中间层镜像在内的所有镜像的话，需要加 -a 参数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63232187699617540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls -a`, `63232187699617540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> -a</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这样会看到很多无标签的镜像，与之前的虚悬镜像不同，这些无标签的镜像很多都是中间层镜像，是其它镜像所依赖的镜像。这些无标签镜像不应该删除，否则会导致上层镜像因为依赖丢失而出错。实际上，这些镜像也没必要删除，因为之前说过，相同的层只会存一遍，而这些镜像是别的镜像的依赖，因此并不会因为它们被列出来而多存了一份，无论如何你也会需要它们。只要删除那些依赖它们的镜像后，这些依赖的中间层镜像也会被连带删除。</p>\n<h3 id="列出部分镜像"><a href="#%E5%88%97%E5%87%BA%E9%83%A8%E5%88%86%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列出部分镜像</h3>\n<p>不加任何参数的情况下，docker image ls 会列出所有顶层镜像，但是有时候我们只希望列出部分镜像。docker image ls 有好几个参数可以帮助做到这个事情。</p>\n<p>根据仓库名列出镜像</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29211603649366434000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls ubuntu\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              18.04               329ed837d508        3 days ago          63.3MB\nubuntu              bionic              329ed837d508        3 days ago          63.3MB`, `29211603649366434000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> ubuntu\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              <span class="token number">18.04</span>               329ed837d508        <span class="token number">3</span> days ago          <span class="token number">63</span>.3MB\nubuntu              bionic              329ed837d508        <span class="token number">3</span> days ago          <span class="token number">63</span>.3MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>列出特定的某个镜像，也就是说指定仓库名和标签</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22282693417338417000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls ubuntu:18.04\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              18.04               329ed837d508        3 days ago          63.3MB`, `22282693417338417000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> ubuntu:18.04\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              <span class="token number">18.04</span>               329ed837d508        <span class="token number">3</span> days ago          <span class="token number">63</span>.3MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>除此以外，docker image ls 还支持强大的过滤器参数 <code class="language-text">--filter</code>，或者简写 -f。之前我们已经看到了使用过滤器来列出虚悬镜像的用法，它还有更多的用法。比如，我们希望看到在 <code class="language-text">mongo:3.2</code> 之后建立的镜像，可以用下面的命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66508671161728650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls -f since=mongo:3.2\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nredis               latest              5f515359c7f8        5 days ago          183 MB\nnginx               latest              05a60462f8ba        5 days ago          181 MB`, `66508671161728650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> -f <span class="token assign-left variable">since</span><span class="token operator">=</span>mongo:3.2\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nredis               latest              5f515359c7f8        <span class="token number">5</span> days ago          <span class="token number">183</span> MB\nnginx               latest              05a60462f8ba        <span class="token number">5</span> days ago          <span class="token number">181</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>想查看某个位置之前的镜像也可以，只需要把 since 换成 before 即可。</p>\n<p>此外，如果镜像构建时，定义了 LABEL，还可以通过 LABEL 来过滤。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45386124169145310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls -f label=com.example.version=0.1`, `45386124169145310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> -f <span class="token assign-left variable">label</span><span class="token operator">=</span>com.example.version<span class="token operator">=</span><span class="token number">0.1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="以特定格式显示"><a href="#%E4%BB%A5%E7%89%B9%E5%AE%9A%E6%A0%BC%E5%BC%8F%E6%98%BE%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>以特定格式显示</h3>\n<p>默认情况下，docker image ls 会输出一个完整的表格，但是我们并非所有时候都会需要这些内容。比如，刚才删除虚悬镜像的时候，我们需要利用 docker image ls 把所有的虚悬镜像的 ID 列出来，然后才可以交给 docker image rm 命令作为参数来删除指定的这些镜像，这个时候就用到了 -q 参数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7073457895938517000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls -q\n5f515359c7f8\n05a60462f8ba\nfe9198c04d62\n00285df0df87\n329ed837d508\n329ed837d508`, `7073457895938517000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> -q\n5f515359c7f8\n05a60462f8ba\nfe9198c04d62\n00285df0df87\n329ed837d508\n329ed837d508</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>—filter 配合 -q 产生出指定范围的 ID 列表，然后送给另一个 docker 命令作为参数，从而针对这组实体成批的进行某种操作的做法在 Docker 命令行使用过程中非常常见，不仅仅是镜像，将来我们会在各个命令中看到这类搭配以完成很强大的功能。因此每次在文档看到过滤器后，可以多注意一下它们的用法。</p>\n<p>另外一些时候，我们可能只是对表格的结构不满意，希望自己组织列；或者不希望有标题，这样方便其它程序解析结果等，这就用到了 Go 的模板语法。</p>\n<p>比如，下面的命令会直接列出镜像结果，并且只包含镜像 ID 和仓库名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78268685990981340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls --format &quot;{{.ID}}: {{.Repository}}&quot;\n5f515359c7f8: redis\n05a60462f8ba: nginx\nfe9198c04d62: mongo\n00285df0df87: <none>\n329ed837d508: ubuntu\n329ed837d508: ubuntu`, `78268685990981340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> --format <span class="token string">"{{.ID}}: {{.Repository}}"</span>\n5f515359c7f8: redis\n05a60462f8ba: nginx\nfe9198c04d62: mongo\n00285df0df87: <span class="token operator">&lt;</span>none<span class="token operator">></span>\n329ed837d508: ubuntu\n329ed837d508: ubuntu</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或者打算以表格等距显示，并且有标题行，和默认一样，不过自己定义列：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69891440830338650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls --format &quot;table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}&quot;\nIMAGE ID            REPOSITORY          TAG\n5f515359c7f8        redis               latest\n05a60462f8ba        nginx               latest\nfe9198c04d62        mongo               3.2\n00285df0df87        <none>              <none>\n329ed837d508        ubuntu              18.04\n329ed837d508        ubuntu              bionic`, `69891440830338650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> --format <span class="token string">"table {{.ID}}<span class="token entity" title="\\t">\\t</span>{{.Repository}}<span class="token entity" title="\\t">\\t</span>{{.Tag}}"</span>\nIMAGE ID            REPOSITORY          TAG\n5f515359c7f8        redis               latest\n05a60462f8ba        nginx               latest\nfe9198c04d62        mongo               <span class="token number">3.2</span>\n00285df0df87        <span class="token operator">&lt;</span>none<span class="token operator">></span>              <span class="token operator">&lt;</span>none<span class="token operator">></span>\n329ed837d508        ubuntu              <span class="token number">18.04</span>\n329ed837d508        ubuntu              bionic</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="删除本地镜像"><a href="#%E5%88%A0%E9%99%A4%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除本地镜像</h2>\n<p>如果要删除本地的镜像，可以使用 docker image rm 命令，其格式为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42765293718002300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image rm [选项] <镜像1> [<镜像2> ...]`, `42765293718002300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">rm</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token operator">&lt;</span>镜像<span class="token operator"><span class="token file-descriptor important">1</span>></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>镜像<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="用-id、镜像名、摘要删除镜像"><a href="#%E7%94%A8-id%E3%80%81%E9%95%9C%E5%83%8F%E5%90%8D%E3%80%81%E6%91%98%E8%A6%81%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用 ID、镜像名、摘要删除镜像</h3>\n<p>其中，&#x3C;镜像> 可以是 镜像短 ID、镜像长 ID、镜像名或者镜像摘要。</p>\n<p>比如我们有这么一些镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46523836424731370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ncentos                      latest              0584b3d2cf6d        3 weeks ago         196.5 MB\nredis                       alpine              501ad78535f0        3 weeks ago         21.03 MB\ndocker                      latest              cf693ec9b5c7        3 weeks ago         105.1 MB\nnginx                       latest              e43d811ce2f4        5 weeks ago         181.5 MB`, `46523836424731370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span>\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ncentos                      latest              0584b3d2cf6d        <span class="token number">3</span> weeks ago         <span class="token number">196.5</span> MB\nredis                       alpine              501ad78535f0        <span class="token number">3</span> weeks ago         <span class="token number">21.03</span> MB\ndocker                      latest              cf693ec9b5c7        <span class="token number">3</span> weeks ago         <span class="token number">105.1</span> MB\nnginx                       latest              e43d811ce2f4        <span class="token number">5</span> weeks ago         <span class="token number">181.5</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38365110377397670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image rm 501\n\\$ docker image rm centos`, `38365110377397670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">rm</span> <span class="token number">501</span>\n$ docker image <span class="token function">rm</span> centos</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>当然，更精确的是使用镜像摘要删除镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19583290732333847000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls --digests\nREPOSITORY                  TAG                 DIGEST                                                                    IMAGE ID            CREATED             SIZE\nnode                        slim                sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228   6e0c4c8e3913        3 weeks ago         214 MB\n\n\\$ docker image rm node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228\nUntagged: node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228`, `19583290732333847000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> --digests\nREPOSITORY                  TAG                 DIGEST                                                                    IMAGE ID            CREATED             SIZE\nnode                        slim                sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228   6e0c4c8e3913        <span class="token number">3</span> weeks ago         <span class="token number">214</span> MB\n\n$ docker image <span class="token function">rm</span> node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228\nUntagged: node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="untagged-和-deleted"><a href="#untagged-%E5%92%8C-deleted" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Untagged 和 Deleted</h3>\n<p>删除行为分为两类，一类是 Untagged，另一类是 Deleted。我们之前介绍过，镜像的唯一标识是其 ID 和摘要，而一个镜像可以有多个标签。</p>\n<p>因此当我们使用上面命令删除镜像的时候，实际上是在要求删除某个标签的镜像。所以首先需要做的是将满足我们要求的所有镜像标签都取消，这就是我们看到的 Untagged 的信息。因为一个镜像可以对应多个标签，因此当我们删除了所指定的标签后，可能还有别的标签指向了这个镜像，如果是这种情况，那么 Delete 行为就不会发生。所以并非所有的 docker image rm 都会产生删除镜像的行为，有可能仅仅是取消了某个标签而已。</p>\n<p>当该镜像所有的标签都被取消了，该镜像很可能会失去了存在的意义，因此会触发删除行为。镜像是多层存储结构，因此在删除的时候也是从上层向基础层方向依次进行判断删除。镜像的多层结构让镜像复用变得非常容易，因此很有可能某个其它镜像正依赖于当前镜像的某一层。这种情况，依旧不会触发删除该层的行为。直到没有任何层依赖当前层时，才会真实的删除当前层。这就是为什么，有时候会奇怪，为什么明明没有别的标签指向这个镜像，但是它还是存在的原因，也是为什么有时候会发现所删除的层数和自己 docker pull 看到的层数不一样的原因。</p>\n<p>除了镜像依赖以外，还需要注意的是容器对镜像的依赖。如果有用这个镜像启动的容器存在（即使容器没有运行），那么同样不可以删除这个镜像。之前讲过，容器是以镜像为基础，再加一层容器存储层，组成这样的多层存储结构去运行的。因此该镜像如果被这个容器所依赖的，那么删除必然会导致故障。如果这些容器是不需要的，应该先将它们删除，然后再来删除镜像。</p>\n<h3 id="用-docker-image-ls-命令来配合"><a href="#%E7%94%A8-docker-image-ls-%E5%91%BD%E4%BB%A4%E6%9D%A5%E9%85%8D%E5%90%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用 docker image ls 命令来配合</h3>\n<p>像其它可以承接多个实体的命令一样，可以使用 docker image ls -q 来配合使用 docker image rm，这样可以成批的删除希望删除的镜像。我们在“镜像列表”章节介绍过很多过滤镜像列表的方式都可以拿过来使用。</p>\n<p>比如，我们需要删除所有仓库名为 redis 的镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63383040813670924000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image rm \\$(docker image ls -q redis)`, `63383040813670924000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span>docker image <span class="token function">ls</span> -q redis<span class="token variable">)</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或者删除所有在 <code class="language-text">mongo:3.2</code> 之前的镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91250712089964430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image rm \\$(docker image ls -q -f before=mongo:3.2)`, `91250712089964430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span>docker image <span class="token function">ls</span> -q -f <span class="token assign-left variable">before</span><span class="token operator">=</span>mongo:3.2<span class="token variable">)</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>充分利用你的想象力和 Linux 命令行的强大，你可以完成很多非常赞的功能。</p>\n<h2 id="利用-commit-理解镜像构成"><a href="#%E5%88%A9%E7%94%A8-commit-%E7%90%86%E8%A7%A3%E9%95%9C%E5%83%8F%E6%9E%84%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>利用 commit 理解镜像构成</h2>\n<p>让我们以定制一个 Web 服务器为例子，来讲解镜像是如何构建的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35798975176042623000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run --name webserver -d -p 80:80 nginx`, `35798975176042623000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run --name webserver -d -p <span class="token number">80</span>:80 nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这条命令会用 nginx 镜像启动一个容器，命名为 webserver，并且映射了 80 端口，这样我们可以用浏览器去访问这个 nginx 服务器。</p>\n<p>如果是在本机运行的 Docker，那么可以直接访问：<code class="language-text">http://localhost</code> ，如果是在虚拟机、云服务器上安装的 Docker，则需要将 localhost 换为虚拟机地址或者实际云服务器地址。</p>\n<p>直接用浏览器访问的话，我们会看到默认的 Nginx 欢迎页面。</p>\n<p>现在，假设我们非常不喜欢这个欢迎页面，我们希望改成欢迎 Docker 的文字，我们可以使用 docker exec 命令进入容器，修改其内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87116068127505510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker exec -it webserver bash\nroot@3729b97e8226:/# echo \'<h1>Hello, Docker!</h1>\' > /usr/share/nginx/html/index.html\nroot@3729b97e8226:/# exit\nexit`, `87116068127505510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token builtin class-name">exec</span> -it webserver <span class="token function">bash</span>\nroot@3729b97e8226:/<span class="token comment"># echo \'&lt;h1>Hello, Docker!&lt;/h1>\' > /usr/share/nginx/html/index.html</span>\nroot@3729b97e8226:/<span class="token comment"># exit</span>\n<span class="token builtin class-name">exit</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们以交互式终端方式进入 webserver 容器，并执行了 bash 命令，也就是获得一个可操作的 Shell。</p>\n<p>然后，我们用 <code class="language-text">&lt;h1&gt;Hello, Docker!&lt;/h1&gt;</code> 覆盖了 <code class="language-text">/usr/share/nginx/html/index.html</code> 的内容。</p>\n<p>现在我们再刷新浏览器的话，会发现内容被改变了。</p>\n<p>我们修改了容器的文件，也就是改动了容器的存储层。我们可以通过 docker diff 命令看到具体的改动。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44053090427663230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker diff webserver\nC /root\nA /root/.bash_history\nC /run\nC /usr\nC /usr/share\nC /usr/share/nginx\nC /usr/share/nginx/html\nC /usr/share/nginx/html/index.html\nC /var\nC /var/cache\nC /var/cache/nginx\nA /var/cache/nginx/client_temp\nA /var/cache/nginx/fastcgi_temp\nA /var/cache/nginx/proxy_temp\nA /var/cache/nginx/scgi_temp\nA /var/cache/nginx/uwsgi_temp`, `44053090427663230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">diff</span> webserver\nC /root\nA /root/.bash_history\nC /run\nC /usr\nC /usr/share\nC /usr/share/nginx\nC /usr/share/nginx/html\nC /usr/share/nginx/html/index.html\nC /var\nC /var/cache\nC /var/cache/nginx\nA /var/cache/nginx/client_temp\nA /var/cache/nginx/fastcgi_temp\nA /var/cache/nginx/proxy_temp\nA /var/cache/nginx/scgi_temp\nA /var/cache/nginx/uwsgi_temp</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们定制好了变化，我们希望能将其保存下来形成镜像。</p>\n<p>要知道，当我们运行一个容器的时候（如果不使用卷的话），我们做的任何文件修改都会被记录于容器存储层里。而 Docker 提供了一个 docker commit 命令，可以将容器的存储层保存下来成为镜像。换句话说，就是在原有镜像的基础上，再叠加上容器的存储层，并构成新的镜像。以后我们运行这个新镜像的时候，就会拥有原有容器最后的文件变化。</p>\n<p>docker commit 的语法格式为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14976351862325287000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker commit [选项] <容器ID或容器名> [<仓库名>[:<标签>]]`, `14976351862325287000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker commit <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token operator">&lt;</span>容器ID或容器名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>仓库名<span class="token operator">></span><span class="token punctuation">[</span>:<span class="token operator">&lt;</span>标签<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们可以用下面的命令将容器保存为镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55554009633428850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker commit \\\n    --author &quot;Tao Wang <twang2218@gmail.com>&quot; \\\n    --message &quot;修改了默认网页&quot; \\\n    webserver \\\n    nginx:v2\nsha256:07e33465974800ce65751acc279adc6ed2dc5ed4e0838f8b86f0c87aa1795214`, `55554009633428850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker commit <span class="token punctuation">\\</span>\n    --author <span class="token string">"Tao Wang &lt;twang2218@gmail.com>"</span> <span class="token punctuation">\\</span>\n    --message <span class="token string">"修改了默认网页"</span> <span class="token punctuation">\\</span>\n    webserver <span class="token punctuation">\\</span>\n    nginx:v2\nsha256:07e33465974800ce65751acc279adc6ed2dc5ed4e0838f8b86f0c87aa1795214</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 —author 是指定修改的作者，而 —message 则是记录本次修改的内容。这点和 git 版本控制相似，不过这里这些信息可以省略留空。</p>\n<p>我们可以在 docker image ls 中看到这个新定制的镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34779023646952380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls nginx\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nnginx               v2                  07e334659748        9 seconds ago       181.5 MB\nnginx               1.11                05a60462f8ba        12 days ago         181.5 MB\nnginx               latest              e43d811ce2f4        4 weeks ago         181.5 MB`, `34779023646952380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> nginx\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nnginx               v2                  07e334659748        <span class="token number">9</span> seconds ago       <span class="token number">181.5</span> MB\nnginx               <span class="token number">1.11</span>                05a60462f8ba        <span class="token number">12</span> days ago         <span class="token number">181.5</span> MB\nnginx               latest              e43d811ce2f4        <span class="token number">4</span> weeks ago         <span class="token number">181.5</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们还可以用 docker history 具体查看镜像内的历史记录，如果比较 <code class="language-text">nginx:latest</code> 的历史记录，我们会发现新增了我们刚刚提交的这一层。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52210691408225490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker history nginx:v2\nIMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\n07e334659748        54 seconds ago      nginx -g daemon off;                            95 B                修改了默认网页\ne43d811ce2f4        4 weeks ago         /bin/sh -c #(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon    0 B\n<missing>           4 weeks ago         /bin/sh -c #(nop)  EXPOSE 443/tcp 80/tcp        0 B\n<missing>           4 weeks ago         /bin/sh -c ln -sf /dev/stdout /var/log/nginx/   22 B\n<missing>           4 weeks ago         /bin/sh -c apt-key adv --keyserver hkp://pgp.   58.46 MB\n<missing>           4 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.11.5-1   0 B\n<missing>           4 weeks ago         /bin/sh -c #(nop)  MAINTAINER NGINX Docker Ma   0 B\n<missing>           4 weeks ago         /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0 B\n<missing>           4 weeks ago         /bin/sh -c #(nop) ADD file:23aa4f893e3288698c   123 MB`, `52210691408225490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">history</span> nginx:v2\nIMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\n07e334659748        <span class="token number">54</span> seconds ago      nginx -g daemon off<span class="token punctuation">;</span>                            <span class="token number">95</span> B                修改了默认网页\ne43d811ce2f4        <span class="token number">4</span> weeks ago         /bin/sh -c <span class="token comment">#(nop)  CMD ["nginx" "-g" "daemon    0 B</span>\n<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">4</span> weeks ago         /bin/sh -c <span class="token comment">#(nop)  EXPOSE 443/tcp 80/tcp        0 B</span>\n<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">4</span> weeks ago         /bin/sh -c <span class="token function">ln</span> -sf /dev/stdout /var/log/nginx/   <span class="token number">22</span> B\n<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">4</span> weeks ago         /bin/sh -c apt-key adv --keyserver hkp://pgp.   <span class="token number">58.46</span> MB\n<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">4</span> weeks ago         /bin/sh -c <span class="token comment">#(nop)  ENV NGINX_VERSION=1.11.5-1   0 B</span>\n<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">4</span> weeks ago         /bin/sh -c <span class="token comment">#(nop)  MAINTAINER NGINX Docker Ma   0 B</span>\n<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">4</span> weeks ago         /bin/sh -c <span class="token comment">#(nop)  CMD ["/bin/bash"]            0 B</span>\n<span class="token operator">&lt;</span>missing<span class="token operator">></span>           <span class="token number">4</span> weeks ago         /bin/sh -c <span class="token comment">#(nop) ADD file:23aa4f893e3288698c   123 MB</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>新的镜像定制好后，我们可以来运行这个镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90447702963374670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker run --name web2 -d -p 81:80 nginx:v2`, `90447702963374670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker run --name web2 -d -p <span class="token number">81</span>:80 nginx:v2</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这里我们命名为新的服务为 web2，并且映射到 81 端口。访问 <code class="language-text">http://localhost:81</code> 看到结果，其内容应该和之前修改后的 webserver 一样。</p>\n<p>至此，我们第一次完成了定制镜像，使用的是 docker commit 命令，手动操作给旧的镜像添加了新的一层，形成新的镜像，对镜像多层存储应该有了更直观的感觉。</p>\n<h3 id="慎用-docker-commit"><a href="#%E6%85%8E%E7%94%A8-docker-commit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>慎用 docker commit</h3>\n<p>使用 docker commit 命令虽然可以比较直观的帮助理解镜像分层存储的概念，但是实际环境中并不会这样使用。</p>\n<p>首先，如果仔细观察之前的 docker diff webserver 的结果，你会发现除了真正想要修改的 /usr/share/nginx/html/index.html 文件外，由于命令的执行，还有很多文件被改动或添加了。这还仅仅是最简单的操作，如果是安装软件包、编译构建，那会有大量的无关内容被添加进来，将会导致镜像极为臃肿。</p>\n<p>此外，使用 docker commit 意味着所有对镜像的操作都是黑箱操作，生成的镜像也被称为黑箱镜像，换句话说，就是除了制作镜像的人知道执行过什么命令、怎么生成的镜像，别人根本无从得知。而且，即使是这个制作镜像的人，过一段时间后也无法记清具体的操作。这种黑箱镜像的维护工作是非常痛苦的。</p>\n<p>而且，回顾之前提及的镜像所使用的分层存储的概念，除当前层外，之前的每一层都是不会发生改变的，换句话说，任何修改的结果仅仅是在当前层进行标记、添加、修改，而不会改动上一层。如果使用 docker commit 制作镜像，以及后期修改的话，每一次修改都会让镜像更加臃肿一次，所删除的上一层的东西并不会丢失，会一直如影随形的跟着这个镜像，即使根本无法访问到。这会让镜像更加臃肿。</p>\n<h2 id="使用-dockerfile-定制镜像"><a href="#%E4%BD%BF%E7%94%A8-dockerfile-%E5%AE%9A%E5%88%B6%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 Dockerfile 定制镜像</h2>\n<p>从刚才的 docker commit 的学习中，我们可以了解到，镜像的定制实际上就是定制每一层所添加的配置、文件。如果我们可以把每一层修改、安装、构建、操作的命令都写入一个脚本，用这个脚本来构建、定制镜像，那么之前提及的无法重复的问题、镜像构建透明性的问题、体积的问题就都会解决。这个脚本就是 Dockerfile。</p>\n<p>Dockerfile 是一个文本文件，其内包含了一条条的指令(Instruction)，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</p>\n<p>还以之前定制 nginx 镜像为例，这次我们使用 Dockerfile 来定制。</p>\n<p>在一个空白目录中，建立一个文本文件，并命名为 Dockerfile：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="571246671045266800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ mkdir mynginx\n\\$ cd mynginx\n\\$ touch Dockerfile`, `571246671045266800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">mkdir</span> mynginx\n$ <span class="token builtin class-name">cd</span> mynginx\n$ <span class="token function">touch</span> Dockerfile</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>其内容为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31831285885655093000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM nginx\nRUN echo \'<h1>Hello, Docker!</h1>\' > /usr/share/nginx/html/index.html`, `31831285885655093000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">FROM nginx\nRUN <span class="token builtin class-name">echo</span> <span class="token string">\'&lt;h1>Hello, Docker!&lt;/h1>\'</span> <span class="token operator">></span> /usr/share/nginx/html/index.html</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这个 Dockerfile 很简单，一共就两行。涉及到了两条指令，FROM 和 RUN。</p>\n<h3 id="from-指定基础镜像"><a href="#from-%E6%8C%87%E5%AE%9A%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FROM 指定基础镜像</h3>\n<p>所谓定制镜像，那一定是以一个镜像为基础，在其上进行定制。就像我们之前运行了一个 nginx 镜像的容器，再进行修改一样，基础镜像是必须指定的。而 FROM 就是指定基础镜像，因此一个 Dockerfile 中 FROM 是必备的指令，并且必须是第一条指令。</p>\n<p>在 Docker Hub 上有非常多的高质量的官方镜像，有可以直接拿来使用的服务类的镜像，如 nginx、redis、mongo、mysql、httpd、php、tomcat 等；也有一些方便开发、构建、运行各种语言应用的镜像，如 node、openjdk、python、ruby、golang 等。可以在其中寻找一个最符合我们最终目标的镜像为基础镜像进行定制。</p>\n<p>如果没有找到对应服务的镜像，官方镜像中还提供了一些更为基础的操作系统镜像，如 ubuntu、debian、centos、fedora、alpine 等，这些操作系统的软件库为我们提供了更广阔的扩展空间。</p>\n<p>除了选择现有镜像为基础镜像外，Docker 还存在一个特殊的镜像，名为 scratch。这个镜像是虚拟的概念，并不实际存在，它表示一个空白的镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81592589671263080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM scratch\n...`, `81592589671263080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">FROM scratch\n<span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果你以 scratch 为基础镜像的话，意味着你不以任何镜像为基础，接下来所写的指令将作为镜像第一层开始存在。</p>\n<p>不以任何系统为基础，直接将可执行文件复制进镜像的做法并不罕见，对于 Linux 下静态编译的程序来说，并不需要有操作系统提供运行时支持，所需的一切库都已经在可执行文件里了，因此直接 FROM scratch 会让镜像体积更加小巧。使用 Go 语言开发的应用很多会使用这种方式来制作镜像，这也是为什么有人认为 Go 是特别适合容器微服务架构的语言的原因之一。</p>\n<h3 id="run-执行命令"><a href="#run-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RUN 执行命令</h3>\n<p>RUN 指令是用来执行命令行命令的。由于命令行的强大能力，RUN 指令在定制镜像时是最常用的指令之一。其格式有两种：</p>\n<ul>\n<li>\n<p>shell 格式：<code class="language-text">RUN &lt;命令&gt;</code>，就像直接在命令行中输入的命令一样。刚才写的 Dockerfile 中的 RUN 指令就是这种格式。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41730020707506460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN echo \'<h1>Hello, Docker!</h1>\' > /usr/share/nginx/html/index.html`, `41730020707506460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">RUN <span class="token builtin class-name">echo</span> <span class="token string">\'&lt;h1>Hello, Docker!&lt;/h1>\'</span> <span class="token operator">></span> /usr/share/nginx/html/index.html</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>exec 格式：RUN [“可执行文件”, “参数 1”, “参数 2”]，这更像是函数调用中的格式。</p>\n</li>\n</ul>\n<p>既然 RUN 就像 Shell 脚本一样可以执行命令，那么我们是否就可以像 Shell 脚本一样把每个命令对应一个 RUN 呢？比如这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19554580688296894000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM debian:stretch\n\nRUN apt-get update\nRUN apt-get install -y gcc libc6-dev make wget\nRUN wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;\nRUN mkdir -p /usr/src/redis\nRUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1\nRUN make -C /usr/src/redis\nRUN make -C /usr/src/redis install`, `19554580688296894000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">FROM debian:stretch\n\nRUN <span class="token function">apt-get</span> update\nRUN <span class="token function">apt-get</span> <span class="token function">install</span> -y gcc libc6-dev <span class="token function">make</span> <span class="token function">wget</span>\nRUN <span class="token function">wget</span> -O redis.tar.gz <span class="token string">"http://download.redis.io/releases/redis-5.0.3.tar.gz"</span>\nRUN <span class="token function">mkdir</span> -p /usr/src/redis\nRUN <span class="token function">tar</span> -xzf redis.tar.gz -C /usr/src/redis --strip-components<span class="token operator">=</span><span class="token number">1</span>\nRUN <span class="token function">make</span> -C /usr/src/redis\nRUN <span class="token function">make</span> -C /usr/src/redis <span class="token function">install</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>之前说过，Dockerfile 中每一个指令都会建立一层，RUN 也不例外。每一个 RUN 的行为，就和刚才我们手工建立镜像的过程一样：新建立一层，在其上执行这些命令，执行结束后，commit 这一层的修改，构成新的镜像。</p>\n<p>而上面的这种写法，创建了 7 层镜像。这是完全没有意义的，而且很多运行时不需要的东西，都被装进了镜像里，比如编译环境、更新的软件包等等。结果就是产生非常臃肿、非常多层的镜像，不仅仅增加了构建部署的时间，也很容易出错。 这是很多初学 Docker 的人常犯的一个错误。</p>\n<p>Union FS 是有最大层数限制的，比如 AUFS，曾经是最大不得超过 42 层，现在是不得超过 127 层。</p>\n<p>上面的 Dockerfile 正确的写法应该是这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88655698661500030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM debian:stretch\n\nRUN set -x; buildDeps=\'gcc libc6-dev make wget\' \\\n    && apt-get update \\\n    && apt-get install -y \\$buildDeps \\\n    && wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot; \\\n    && mkdir -p /usr/src/redis \\\n    && tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\\n    && make -C /usr/src/redis \\\n    && make -C /usr/src/redis install \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && rm redis.tar.gz \\\n    && rm -r /usr/src/redis \\\n    && apt-get purge -y --auto-remove \\$buildDeps`, `88655698661500030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">FROM debian:stretch\n\nRUN <span class="token builtin class-name">set</span> -x<span class="token punctuation">;</span> <span class="token assign-left variable">buildDeps</span><span class="token operator">=</span><span class="token string">\'gcc libc6-dev make wget\'</span> <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> update <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y <span class="token variable">$buildDeps</span> <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O redis.tar.gz <span class="token string">"http://download.redis.io/releases/redis-5.0.3.tar.gz"</span> <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p /usr/src/redis <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> -xzf redis.tar.gz -C /usr/src/redis --strip-components<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> -C /usr/src/redis <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> -C /usr/src/redis <span class="token function">install</span> <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf /var/lib/apt/lists/* <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> redis.tar.gz <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -r /usr/src/redis <span class="token punctuation">\\</span>\n    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> purge -y --auto-remove <span class="token variable">$buildDeps</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>首先，之前所有的命令只有一个目的，就是编译、安装 redis 可执行文件。因此没有必要建立很多层，这只是一层的事情。因此，这里没有使用很多个 RUN 一一对应不同的命令，而是仅仅使用一个 RUN 指令，并使用 &#x26;&#x26; 将各个所需命令串联起来，将之前的 7 层 简化为了 1 层。在撰写 Dockerfile 的时候，要经常提醒自己，这并不是在写 Shell 脚本，而是在定义每一层该如何构建。</p>\n<p>并且，这里为了格式化还进行了换行。Dockerfile 支持 Shell 类的行尾添加 \\ 的命令换行方式，以及行首 # 进行注释的格式。良好的格式，比如换行、缩进、注释等，会让维护、排障更为容易，这是一个比较好的习惯。</p>\n<p>此外，还可以看到这一组命令的最后添加了清理工作的命令，删除了为了编译构建所需要的软件，清理了所有下载、展开的文件，并且还清理了 apt 缓存文件。这是很重要的一步，我们之前说过，镜像是多层存储，每一层的东西并不会在下一层被删除，会一直跟随着镜像。因此镜像构建时，一定要确保每一层只添加真正需要添加的东西，任何无关的东西都应该清理掉。</p>\n<p>很多人初学 Docker 制作出了很臃肿的镜像的原因之一，就是忘记了每一层构建的最后一定要清理掉无关文件。</p>\n<h3 id="构建镜像"><a href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建镜像</h3>\n<p>好了，让我们再回到之前定制的 nginx 镜像的 Dockerfile 来。现在我们明白了这个 Dockerfile 的内容，那么让我们来构建这个镜像吧。</p>\n<p>在 Dockerfile 文件所在目录执行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16101935840520976000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build -t nginx:v3 .\nSending build context to Docker daemon 2.048 kB\nStep 1 : FROM nginx\n ---> e43d811ce2f4\nStep 2 : RUN echo \'<h1>Hello, Docker!</h1>\' > /usr/share/nginx/html/index.html\n ---> Running in 9cdc27646c7b\n ---> 44aa4490ce2c\nRemoving intermediate container 9cdc27646c7b\nSuccessfully built 44aa4490ce2c`, `16101935840520976000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build -t nginx:v3 <span class="token builtin class-name">.</span>\nSending build context to Docker daemon <span class="token number">2.048</span> kB\nStep <span class="token number">1</span> <span class="token builtin class-name">:</span> FROM nginx\n ---<span class="token operator">></span> e43d811ce2f4\nStep <span class="token number">2</span> <span class="token builtin class-name">:</span> RUN <span class="token builtin class-name">echo</span> <span class="token string">\'&lt;h1>Hello, Docker!&lt;/h1>\'</span> <span class="token operator">></span> /usr/share/nginx/html/index.html\n ---<span class="token operator">></span> Running <span class="token keyword">in</span> 9cdc27646c7b\n ---<span class="token operator">></span> 44aa4490ce2c\nRemoving intermediate container 9cdc27646c7b\nSuccessfully built 44aa4490ce2c</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从命令的输出结果中，我们可以清晰的看到镜像的构建过程。在 Step 2 中，如同我们之前所说的那样，RUN 指令启动了一个容器 9cdc27646c7b，执行了所要求的命令，并最后提交了这一层 44aa4490ce2c，随后删除了所用到的这个容器 9cdc27646c7b。</p>\n<p>这里我们使用了 docker build 命令进行镜像构建。其格式为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35891236017377760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker build [选项] <上下文路径/URL/->`, `35891236017377760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker build <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token operator">&lt;</span>上下文路径/URL/-<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在这里我们指定了最终镜像的名称 <code class="language-text">-t nginx:v3</code>，构建成功后，我们可以像之前运行 nginx:v2 那样来运行这个镜像，其结果会和 nginx:v2 一样。</p>\n<h3 id="镜像构建上下文（context）"><a href="#%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%88context%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>镜像构建上下文（Context）</h3>\n<p>如果注意，会看到 docker build 命令最后有一个 <code class="language-text">.</code>。<code class="language-text">.</code> 表示当前目录，而 Dockerfile 就在当前目录，因此不少初学者以为这个路径是在指定 Dockerfile 所在路径，这么理解其实是不准确的。如果对应上面的命令格式，你可能会发现，这是在指定上下文路径。那么什么是上下文呢？</p>\n<p>首先我们要理解 docker build 的工作原理。Docker 在运行时分为 Docker 引擎（也就是服务端守护进程）和客户端工具。Docker 的引擎提供了一组 REST API，被称为 Docker Remote API，而如 docker 命令这样的客户端工具，则是通过这组 API 与 Docker 引擎交互，从而完成各种功能。因此，虽然表面上我们好像是在本机执行各种 docker 功能，但实际上，一切都是使用的远程调用形式在服务端（Docker 引擎）完成。也因为这种 C/S 设计，让我们操作远程服务器的 Docker 引擎变得轻而易举。</p>\n<p>当我们进行镜像构建的时候，并非所有定制都会通过 RUN 指令完成，经常会需要将一些本地文件复制进镜像，比如通过 COPY 指令、ADD 指令等。而 docker build 命令构建镜像，其实并非在本地构建，而是在服务端，也就是 Docker 引擎中构建的。那么在这种客户端/服务端的架构中，如何才能让服务端获得本地文件呢？</p>\n<p>这就引入了上下文的概念。当构建的时候，用户会指定构建镜像上下文的路径，docker build 命令得知这个路径后，会将路径下的所有内容打包，然后上传给 Docker 引擎。这样 Docker 引擎收到这个上下文包后，展开就会获得构建镜像所需的一切文件。</p>\n<p>如果在 Dockerfile 中这么写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43626187458929750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`COPY ./package.json /app/`, `43626187458929750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">COPY ./package.json /app/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这并不是要复制执行 docker build 命令所在的目录下的 package.json，也不是复制 Dockerfile 所在目录下的 package.json，而是复制上下文（context）目录下的 package.json。</p>\n<p>因此，COPY 这类指令中的源文件的路径都是相对路径。这也是初学者经常会问的为什么 <code class="language-text">COPY ../package.json /app</code> 或者 <code class="language-text">COPY /opt/xxxx /app</code> 无法工作的原因，因为这些路径已经超出了上下文的范围，Docker 引擎无法获得这些位置的文件。如果真的需要那些文件，应该将它们复制到上下文目录中去。</p>\n<p>现在就可以理解刚才的命令 <code class="language-text">docker build -t nginx:v3 .</code> 中的这个 <code class="language-text">.</code>，实际上是在指定上下文的目录，docker build 命令会将该目录下的内容打包交给 Docker 引擎以帮助构建镜像。</p>\n<p>如果观察 docker build 输出，我们其实已经看到了这个发送上下文的过程：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17867438305859906000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build -t nginx:v3 .\nSending build context to Docker daemon 2.048 kB\n...`, `17867438305859906000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build -t nginx:v3 <span class="token builtin class-name">.</span>\nSending build context to Docker daemon <span class="token number">2.048</span> kB\n<span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>理解构建上下文对于镜像构建是很重要的，避免犯一些不应该的错误。比如有些初学者在发现 <code class="language-text">COPY /opt/xxxx /app</code> 不工作后，于是干脆将 Dockerfile 放到了硬盘根目录去构建，结果发现 docker build 执行后，在发送一个几十 GB 的东西，极为缓慢而且很容易构建失败。那是因为这种做法是在让 docker build 打包整个硬盘，这显然是使用错误。</p>\n<p>一般来说，应该会将 Dockerfile 置于一个空目录下，或者项目根目录下。如果该目录下没有所需文件，那么应该把所需文件复制一份过来。如果目录下有些东西确实不希望构建时传给 Docker 引擎，那么可以用 .gitignore 一样的语法写一个 .dockerignore，该文件是用于剔除不需要作为上下文传递给 Docker 引擎的。</p>\n<p>那么为什么会有人误以为 <code class="language-text">.</code> 是指定 Dockerfile 所在目录呢？这是因为在默认情况下，如果不额外指定 Dockerfile 的话，会将上下文目录下的名为 Dockerfile 的文件作为 Dockerfile。</p>\n<p>这只是默认行为，实际上 Dockerfile 的文件名并不要求必须为 Dockerfile，而且并不要求必须位于上下文目录中，比如可以用 -f ../Dockerfile.php 参数指定某个文件作为 Dockerfile。</p>\n<p>当然，一般大家习惯性的会使用默认的文件名 Dockerfile，以及会将其置于镜像构建上下文目录中。</p>\n<h3 id="其它-docker-build-的用法"><a href="#%E5%85%B6%E5%AE%83-docker-build-%E7%9A%84%E7%94%A8%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其它 docker build 的用法</h3>\n<h4 id="直接用-git-repo-进行构建"><a href="#%E7%9B%B4%E6%8E%A5%E7%94%A8-git-repo-%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直接用 Git repo 进行构建</h4>\n<p>或许你已经注意到了，docker build 还支持从 URL 构建，比如可以直接从 Git repo 中构建：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84518684200495890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# \\$env:DOCKER_BUILDKIT=0\n# export DOCKER_BUILDKIT=0\n\n\\$ docker build -t hello-world https://github.com/docker-library/hello-world.git#master:amd64/hello-world\n\nStep 1/3 : FROM scratch\n --->\nStep 2/3 : COPY hello /\n ---> ac779757d46e\nStep 3/3 : CMD [&quot;/hello&quot;]\n ---> Running in d2a513a760ed\nRemoving intermediate container d2a513a760ed\n ---> 038ad4142d2b\nSuccessfully built 038ad4142d2b`, `84518684200495890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># $env:DOCKER_BUILDKIT=0</span>\n<span class="token comment"># export DOCKER_BUILDKIT=0</span>\n\n$ docker build -t hello-world https://github.com/docker-library/hello-world.git<span class="token comment">#master:amd64/hello-world</span>\n\nStep <span class="token number">1</span>/3 <span class="token builtin class-name">:</span> FROM scratch\n ---<span class="token operator">></span>\nStep <span class="token number">2</span>/3 <span class="token builtin class-name">:</span> COPY hello /\n ---<span class="token operator">></span> ac779757d46e\nStep <span class="token number">3</span>/3 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">"/hello"</span><span class="token punctuation">]</span>\n ---<span class="token operator">></span> Running <span class="token keyword">in</span> d2a513a760ed\nRemoving intermediate container d2a513a760ed\n ---<span class="token operator">></span> 038ad4142d2b\nSuccessfully built 038ad4142d2b</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这行命令指定了构建所需的 Git repo，并且指定分支为 master，构建目录为 /amd64/hello-world/，然后 Docker 就会自己去 git clone 这个项目、切换到指定分支、并进入到指定目录后开始构建。</p>\n<h4 id="用给定的-tar-压缩包构建"><a href="#%E7%94%A8%E7%BB%99%E5%AE%9A%E7%9A%84-tar-%E5%8E%8B%E7%BC%A9%E5%8C%85%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用给定的 tar 压缩包构建</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="592311049934357600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build http://server/context.tar.gz`, `592311049934357600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build http://server/context.tar.gz</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果所给出的 URL 不是个 Git repo，而是个 tar 压缩包，那么 Docker 引擎会下载这个包，并自动解压缩，以其作为上下文，开始构建。</p>\n<h4 id="从标准输入中读取-dockerfile-进行构建"><a href="#%E4%BB%8E%E6%A0%87%E5%87%86%E8%BE%93%E5%85%A5%E4%B8%AD%E8%AF%BB%E5%8F%96-dockerfile-%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从标准输入中读取 Dockerfile 进行构建</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12452971799241630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker build - < Dockerfile`, `12452971799241630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker build - <span class="token operator">&lt;</span> Dockerfile</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78820279991481470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cat Dockerfile | docker build -`, `78820279991481470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">cat</span> Dockerfile <span class="token operator">|</span> docker build -</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果标准输入传入的是文本文件，则将其视为 Dockerfile，并开始构建。这种形式由于直接从标准输入中读取 Dockerfile 的内容，它没有上下文，因此不可以像其他方法那样可以将本地文件 COPY 进镜像之类的事情。</p>\n<h4 id="从标准输入中读取上下文压缩包进行构建"><a href="#%E4%BB%8E%E6%A0%87%E5%87%86%E8%BE%93%E5%85%A5%E4%B8%AD%E8%AF%BB%E5%8F%96%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8E%8B%E7%BC%A9%E5%8C%85%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从标准输入中读取上下文压缩包进行构建</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18515843423631995000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build - < context.tar.gz`, `18515843423631995000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build - <span class="token operator">&lt;</span> context.tar.gz</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果发现标准输入的文件格式是 gzip、bzip2 以及 xz 的话，将会使其为上下文压缩包，直接将其展开，将里面视为上下文，并开始构建。</p>\n<h2 id="其它制作镜像的方式"><a href="#%E5%85%B6%E5%AE%83%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F%E7%9A%84%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其它制作镜像的方式</h2>\n<p>除了标准的使用 Dockerfile 生成镜像的方法外，由于各种特殊需求和历史原因，还提供了一些其它方法用以生成镜像。</p>\n<h3 id="从-rootfs-压缩包导入"><a href="#%E4%BB%8E-rootfs-%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AF%BC%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从 rootfs 压缩包导入</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27115066255828290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker import [选项] <文件>|<URL>|- [<仓库名>[:<标签>]]`, `27115066255828290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker <span class="token function">import</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token operator">&lt;</span>文件<span class="token operator">>|</span><span class="token operator">&lt;</span>URL<span class="token operator">>|</span>- <span class="token punctuation">[</span><span class="token operator">&lt;</span>仓库名<span class="token operator">></span><span class="token punctuation">[</span>:<span class="token operator">&lt;</span>标签<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>压缩包可以是本地文件、远程 Web 文件，甚至是从标准输入中得到。压缩包将会在镜像 / 目录展开，并直接作为镜像第一层提交。</p>\n<p>比如我们想要创建一个 OpenVZ 的 Ubuntu 16.04 模板的镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80169233266020970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker import \\\n    http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz \\\n    openvz/ubuntu:16.04\n\nDownloading from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz\nsha256:412b8fc3e3f786dca0197834a698932b9c51b69bd8cf49e100c35d38c9879213`, `80169233266020970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">import</span> <span class="token punctuation">\\</span>\n    http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz <span class="token punctuation">\\</span>\n    openvz/ubuntu:16.04\n\nDownloading from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz\nsha256:412b8fc3e3f786dca0197834a698932b9c51b69bd8cf49e100c35d38c9879213</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这条命令自动下载了 ubuntu-16.04-x86_64.tar.gz 文件，并且作为根文件系统展开导入，并保存为镜像 openvz/ubuntu:16.04。</p>\n<p>导入成功后，我们可以用 docker image ls 看到这个导入的镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33297086545669562000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls openvz/ubuntu\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nopenvz/ubuntu       16.04               412b8fc3e3f7        55 seconds ago      505MB`, `33297086545669562000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> openvz/ubuntu\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nopenvz/ubuntu       <span class="token number">16.04</span>               412b8fc3e3f7        <span class="token number">55</span> seconds ago      505MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果我们查看其历史的话，会看到描述中有导入的文件链接：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58395003649006690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker history openvz/ubuntu:16.04\nIMAGE               CREATED              CREATED BY          SIZE                COMMENT\nf477a6e18e98        About a minute ago                       214.9 MB            Imported from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz`, `58395003649006690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">history</span> openvz/ubuntu:16.04\nIMAGE               CREATED              CREATED BY          SIZE                COMMENT\nf477a6e18e98        About a minute ago                       <span class="token number">214.9</span> MB            Imported from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="docker-镜像的导入和导出-docker-save-和-docker-load"><a href="#docker-%E9%95%9C%E5%83%8F%E7%9A%84%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA-docker-save-%E5%92%8C-docker-load" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 镜像的导入和导出 docker save 和 docker load</h2>\n<p>Docker 还提供了 docker save 和 docker load 命令，用以将镜像保存为一个文件，然后传输到另一个位置上，再加载进来。这是在没有 Docker Registry 时的做法，现在已经不推荐，镜像迁移应该直接使用 Docker Registry，无论是直接使用 Docker Hub 还是使用内网私有 Registry 都可以。</p>\n<h3 id="保存镜像"><a href="#%E4%BF%9D%E5%AD%98%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>保存镜像</h3>\n<p>使用 docker save 命令可以将镜像保存为归档文件。</p>\n<p>比如我们希望保存这个 alpine 镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51706602157792215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls alpine\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nalpine              latest              baa5d63471ea        5 weeks ago         4.803 MB`, `51706602157792215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span> alpine\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nalpine              latest              baa5d63471ea        <span class="token number">5</span> weeks ago         <span class="token number">4.803</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>保存镜像的命令为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65647283065275160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker save alpine -o filename\n\\$ file filename\nfilename: POSIX tar archive`, `65647283065275160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker save alpine -o filename\n$ <span class="token function">file</span> filename\nfilename: POSIX <span class="token function">tar</span> archive</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这里的 filename 可以为任意名称甚至任意后缀名，但文件的本质都是归档文件</p>\n<p>注意：如果同名则会覆盖（没有警告）</p>\n<p>若使用 gzip 压缩：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33086129311809920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker save alpine | gzip > alpine-latest.tar.gz`, `33086129311809920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker save alpine <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">></span> alpine-latest.tar.gz</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后我们将 alpine-latest.tar.gz 文件复制到了到了另一个机器上，可以用下面这个命令加载镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55405946608996246000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker load -i alpine-latest.tar.gz\nLoaded image: alpine:latest`, `55405946608996246000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker load -i alpine-latest.tar.gz\nLoaded image: alpine:latest</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果我们结合这两个命令以及 ssh 甚至 pv 的话，利用 Linux 强大的管道，我们可以写一个命令完成从一个机器将镜像迁移到另一个机器，并且带进度条的功能：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98753192620207730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker save <镜像名> | bzip2 | pv | ssh <用户名>@<主机名> \'cat | docker load\'`, `98753192620207730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker save <span class="token operator">&lt;</span>镜像名<span class="token operator">></span> <span class="token operator">|</span> <span class="token function">bzip2</span> <span class="token operator">|</span> <span class="token function">pv</span> <span class="token operator">|</span> <span class="token function">ssh</span> <span class="token operator">&lt;</span>用户名<span class="token operator">></span>@<span class="token operator">&lt;</span>主机名<span class="token operator">></span> <span class="token string">\'cat | docker load\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="镜像的实现原理"><a href="#%E9%95%9C%E5%83%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>镜像的实现原理</h2>\n<p>Docker 镜像是怎么实现增量的修改和维护的？</p>\n<p>每个镜像都由很多层次构成，Docker 使用 Union FS 将这些不同的层结合到一个镜像中去。</p>\n<p>通常 Union FS 有两个用途, 一方面可以实现不借助 LVM、RAID 将多个 disk 挂到同一个目录下,另一个更常用的就是将一个只读的分支和一个可写的分支联合在一起，Live CD 正是基于此方法可以允许在镜像不变的基础上允许用户在其上进行一些写操作。</p>\n<p>Docker 在 OverlayFS 上构建的容器也是利用了类似的原理。</p>\n<h1 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile</h1>\n<h2 id="copy-复制文件"><a href="#copy-%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>COPY 复制文件</h2>\n<p>格式：</p>\n<ul>\n<li><code class="language-text">COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;源路径&gt;... &lt;目标路径&gt;</code></li>\n<li><code class="language-text">COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;源路径1&gt;&quot;,... &quot;&lt;目标路径&gt;&quot;]</code></li>\n</ul>\n<p>和 RUN 指令一样，也有两种格式，一种类似于命令行，一种类似于函数调用。</p>\n<p>COPY 指令将从构建上下文目录中 <code class="language-text">&lt;源路径&gt;</code> 的文件/目录复制到新的一层的镜像内的 <code class="language-text">&lt;目标路径&gt;</code> 位置。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59983025020514870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`COPY package.json /usr/src/app/`, `59983025020514870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> package.json /usr/src/app/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><code class="language-text">&lt;源路径&gt;</code> 可以是多个，甚至可以是通配符，其通配符规则要满足 Go 的 filepath.Match 规则，如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49705742764035875000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`COPY hom* /mydir/\nCOPY hom?.txt /mydir/`, `49705742764035875000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> hom* /mydir/\n<span class="token keyword">COPY</span> hom<span class="token punctuation">?</span>.txt /mydir/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><code class="language-text">&lt;目标路径&gt;</code> 可以是容器内的绝对路径，也可以是相对于工作目录的相对路径（工作目录可以用 WORKDIR 指令来指定）。目标路径不需要事先创建，如果目录不存在会在复制文件前先行创建缺失目录。</p>\n<p>此外，还需要注意一点，使用 COPY 指令，源文件的各种元数据都会保留。比如读、写、执行权限、文件变更时间等。这个特性对于镜像定制很有用。特别是构建相关文件都在使用 Git 进行管理的时候。</p>\n<p>在使用该指令的时候还可以加上 <code class="language-text">--chown=&lt;user&gt;:&lt;group&gt;</code> 选项来改变文件的所属用户及所属组。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38802916043621940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`COPY --chown=55:mygroup files* /mydir/\nCOPY --chown=bin files* /mydir/\nCOPY --chown=1 files* /mydir/\nCOPY --chown=10:11 files* /mydir/`, `38802916043621940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=55<span class="token punctuation">:</span>mygroup files* /mydir/\n<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=bin files* /mydir/\n<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=1 files* /mydir/\n<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=10<span class="token punctuation">:</span>11 files* /mydir/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果源路径为文件夹，复制的时候不是直接复制该文件夹，而是将文件夹中的内容复制到目标路径。</p>\n<h2 id="add-更高级的复制文件"><a href="#add-%E6%9B%B4%E9%AB%98%E7%BA%A7%E7%9A%84%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ADD 更高级的复制文件</h2>\n<p>ADD 指令和 COPY 的格式和性质基本一致。但是在 COPY 基础上增加了一些功能。</p>\n<p>比如 <code class="language-text">&lt;源路径&gt;</code> 可以是一个 URL，这种情况下，Docker 引擎会试图去下载这个链接的文件放到 <code class="language-text">&lt;目标路径&gt;</code> 去。下载后的文件权限自动设置为 600，如果这并不是想要的权限，那么还需要增加额外的一层 RUN 进行权限调整，另外，如果下载的是个压缩包，需要解压缩，也一样还需要额外的一层 RUN 指令进行解压缩。所以不如直接使用 RUN 指令，然后使用 wget 或者 curl 工具下载，处理权限、解压缩、然后清理无用文件更合理。因此，这个功能其实并不实用，而且不推荐使用。</p>\n<p>如果 <code class="language-text">&lt;源路径&gt;</code> 为一个 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，ADD 指令将会自动解压缩这个压缩文件到 <code class="language-text">&lt;目标路径&gt;</code> 去。</p>\n<p>在某些情况下，这个自动解压缩的功能非常有用，比如官方镜像 ubuntu 中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69958970805144950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM scratch\nADD ubuntu-xenial-core-cloudimg-amd64-root.tar.gz /\n...`, `69958970805144950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> scratch\n<span class="token keyword">ADD</span> ubuntu<span class="token punctuation">-</span>xenial<span class="token punctuation">-</span>core<span class="token punctuation">-</span>cloudimg<span class="token punctuation">-</span>amd64<span class="token punctuation">-</span>root.tar.gz /\n<span class="token punctuation">...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但在某些情况下，如果我们真的是希望复制个压缩文件进去，而不解压缩，这时就不可以使用 ADD 命令了。</p>\n<p>在 Docker 官方的 Dockerfile 最佳实践文档中要求，尽可能的使用 COPY，因为 COPY 的语义很明确，就是复制文件而已，而 ADD 则包含了更复杂的功能，其行为也不一定很清晰。最适合使用 ADD 的场合，就是所提及的需要自动解压缩的场合。</p>\n<p>另外需要注意的是，ADD 指令会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。</p>\n<p>因此在 COPY 和 ADD 指令中选择的时候，可以遵循这样的原则，所有的文件复制均使用 COPY 指令，仅在需要自动解压缩的场合使用 ADD。</p>\n<p>在使用该指令的时候还可以加上 <code class="language-text">--chown=&lt;user&gt;:&lt;group&gt;</code> 选项来改变文件的所属用户及所属组。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92978851504573900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ADD --chown=55:mygroup files* /mydir/\nADD --chown=bin files* /mydir/\nADD --chown=1 files* /mydir/k\nADD --chown=10:11 files* /mydir/`, `92978851504573900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ADD</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=55<span class="token punctuation">:</span>mygroup files* /mydir/\n<span class="token keyword">ADD</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=bin files* /mydir/\n<span class="token keyword">ADD</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=1 files* /mydir/k\n<span class="token keyword">ADD</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>chown=10<span class="token punctuation">:</span>11 files* /mydir/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="cmd-容器启动命令"><a href="#cmd-%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CMD 容器启动命令</h2>\n<p>CMD 指令的格式和 RUN 相似，也是两种格式：</p>\n<ul>\n<li>shell 格式：<code class="language-text">CMD &lt;命令&gt;</code></li>\n<li>exec 格式：<code class="language-text">CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;...]</code></li>\n<li>参数列表格式：<code class="language-text">CMD [&quot;参数1&quot;, &quot;参数2&quot;...]</code>。在指定了 ENTRYPOINT 指令后，用 CMD 指定具体的参数。</li>\n</ul>\n<p>之前介绍容器的时候曾经说过，Docker 不是虚拟机，容器就是进程。既然是进程，那么在启动容器的时候，需要指定所运行的程序及参数。CMD 指令就是用于指定默认的容器主进程的启动命令的。</p>\n<p>在运行时可以指定新的命令来替代镜像设置中的这个默认命令，比如，ubuntu 镜像默认的 CMD 是 <code class="language-text">/bin/bash</code>，如果我们直接 <code class="language-text">docker run -it ubuntu</code> 的话，会直接进入 bash。我们也可以在运行时指定运行别的命令，如 <code class="language-text">docker run -it ubuntu cat /etc/os-release</code>。这就是用 <code class="language-text">cat /etc/os-release</code> 命令替换了默认的 <code class="language-text">/bin/bash</code> 命令了，输出了系统版本信息。</p>\n<p>在指令格式上，一般推荐使用 exec 格式，这类格式在解析时会被解析为 JSON 数组，因此一定要使用双引号，而不要使用单引号。</p>\n<p>如果使用 shell 格式的话，实际的命令会被包装为 <code class="language-text">sh -c</code> 的参数的形式进行执行。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71244567658360316000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`CMD echo \\$HOME`, `71244567658360316000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">CMD</span> echo $HOME</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在实际执行中，会将其变更为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49767359697206520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo \\$HOME&quot; ]`, `49767359697206520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"echo $HOME"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这就是为什么我们可以使用环境变量的原因，因为这些环境变量会被 shell 进行解析处理。</p>\n<p>提到 CMD 就不得不提容器中应用在前台执行和后台执行的问题。这是初学者常出现的一个混淆。</p>\n<p>Docker 不是虚拟机，容器中的应用都应该以前台执行，而不是像虚拟机、物理机里面那样，用 systemd 去启动后台服务，容器内没有后台服务的概念。</p>\n<p>一些初学者将 CMD 写为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98218116735681330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`CMD service nginx start`, `98218116735681330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">CMD</span> service nginx start</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后发现容器执行后就立即退出了。甚至在容器内去使用 systemctl 命令结果却发现根本执行不了。这就是因为没有搞明白前台、后台的概念，没有区分容器和虚拟机的差异，依旧在以传统虚拟机的角度去理解容器。</p>\n<p>对于容器而言，其启动程序就是容器应用进程，容器就是为了主进程而存在的，主进程退出，容器就失去了存在的意义，从而退出，其它辅助进程不是它需要关心的东西。</p>\n<p>而使用 <code class="language-text">service nginx start</code> 命令，则是希望 upstart 来以后台守护进程形式启动 nginx 服务。而刚才说了 <code class="language-text">CMD service nginx start</code> 会被理解为 <code class="language-text">CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]</code>，因此主进程实际上是 sh。那么当 <code class="language-text">service nginx start</code> 命令结束后，sh 也就结束了，sh 作为主进程退出了，自然就会令容器退出。</p>\n<p>正确的做法是直接执行 nginx 可执行文件，并且要求以前台形式运行。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46068787301346650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]`, `46068787301346650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"nginx"</span><span class="token punctuation">,</span> <span class="token string">"-g"</span><span class="token punctuation">,</span> <span class="token string">"daemon off;"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="entrypoint-入口点"><a href="#entrypoint-%E5%85%A5%E5%8F%A3%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ENTRYPOINT 入口点</h2>\n<p>ENTRYPOINT 的格式和 RUN 指令格式一样，分为 exec 格式和 shell 格式。</p>\n<p>ENTRYPOINT 的目的和 CMD 一样，都是在指定容器启动程序及参数。ENTRYPOINT 在运行时也可以替代，不过比 CMD 要略显繁琐，需要通过 docker run 的参数 <code class="language-text">--entrypoint</code> 来指定。</p>\n<p>当指定了 ENTRYPOINT 后，CMD 的含义就发生了改变，不再是直接的运行其命令，而是将 CMD 的内容作为参数传给 ENTRYPOINT 指令，换句话说实际执行时，将变为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66431639400001140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<ENTRYPOINT> &quot;<CMD>&quot;`, `66431639400001140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">&lt;</span>ENTRYPOINT<span class="token operator">></span> <span class="token string">"&lt;CMD>"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>那么有了 CMD 后，为什么还要有 ENTRYPOINT 呢？这种 <code class="language-text">&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</code> 有什么好处么？让我们来看几个场景。</p>\n<h3 id="场景一：让镜像变成像命令一样使用"><a href="#%E5%9C%BA%E6%99%AF%E4%B8%80%EF%BC%9A%E8%AE%A9%E9%95%9C%E5%83%8F%E5%8F%98%E6%88%90%E5%83%8F%E5%91%BD%E4%BB%A4%E4%B8%80%E6%A0%B7%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>场景一：让镜像变成像命令一样使用</h3>\n<p>假设我们需要一个得知自己当前公网 IP 的镜像，那么可以先用 CMD 来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23143990020518834000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM ubuntu:18.04\nRUN apt-get update \\\n    && apt-get install -y curl \\\n    && rm -rf /var/lib/apt/lists/*\nCMD [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://myip.ipip.net&quot; ]`, `23143990020518834000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>18.04\n<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update \\\n    &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y curl \\\n    &amp;&amp; rm <span class="token punctuation">-</span>rf /var/lib/apt/lists/*\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"-s"</span><span class="token punctuation">,</span> <span class="token string">"http://myip.ipip.net"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>假如我们使用 <code class="language-text">docker build -t myip .</code> 来构建镜像的话，如果我们需要查询当前公网 IP，只需要执行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80728235582532290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run myip\n当前 IP：61.148.226.66 来自：北京市 联通`, `80728235582532290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run myip\n当前 IP：61.148.226.66 来自：北京市 联通</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>嗯，这么看起来好像可以直接把镜像当做命令使用了，不过命令总有参数，如果我们希望加参数呢？比如从上面的 CMD 中可以看到实质的命令是 curl，那么如果我们希望显示 HTTP 头信息，就需要加上 -i 参数。那么我们可以直接加 -i 参数给 <code class="language-text">docker run myip</code> 么？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3971789911115952600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run myip -i\ndocker: Error response from daemon: invalid header field value &quot;oci runtime error: container_linux.go:247: starting container process caused \\&quot;exec: \\\\\\&quot;-i\\\\\\&quot;: executable file not found in \\$PATH\\&quot;\\n&quot;.`, `3971789911115952600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run myip -i\ndocker: Error response from daemon: invalid header field value <span class="token string">"oci runtime error: container_linux.go:247: starting container process caused <span class="token entity" title="\\&quot;">\\"</span>exec: <span class="token entity" title="\\\\">\\\\</span><span class="token entity" title="\\&quot;">\\"</span>-i<span class="token entity" title="\\\\">\\\\</span><span class="token entity" title="\\&quot;">\\"</span>: executable file not found in <span class="token environment constant">$PATH</span><span class="token entity" title="\\&quot;">\\"</span><span class="token entity" title="\\n">\\n</span>"</span><span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>我们可以看到可执行文件找不到的报错，<code class="language-text">executable file not found</code>。之前我们说过，跟在镜像名后面的是 command，运行时会替换 CMD 的默认值。因此这里的 -i 替换了原来的 CMD，而不是添加在原来的 <code class="language-text">curl -s http://myip.ipip.net</code> 后面。而 -i 根本不是命令，所以自然找不到。</p>\n<p>那么如果我们希望加入 -i 这参数，我们就必须重新完整的输入这个命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55693907429172890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run myip curl -s http://myip.ipip.net -i`, `55693907429172890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run myip <span class="token function">curl</span> -s http://myip.ipip.net -i</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这显然不是很好的解决方案，而使用 ENTRYPOINT 就可以解决这个问题。现在我们重新用 ENTRYPOINT 来实现这个镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21530820976439525000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM ubuntu:18.04\nRUN apt-get update \\\n    && apt-get install -y curl \\\n    && rm -rf /var/lib/apt/lists/*\nENTRYPOINT [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://myip.ipip.net&quot; ]`, `21530820976439525000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>18.04\n<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update \\\n    &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y curl \\\n    &amp;&amp; rm <span class="token punctuation">-</span>rf /var/lib/apt/lists/*\n<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span> <span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"-s"</span><span class="token punctuation">,</span> <span class="token string">"http://myip.ipip.net"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这次我们再来尝试直接使用 <code class="language-text">docker run myip -i</code>：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41039559069085970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run myip\n当前 IP：61.148.226.66 来自：北京市 联通\n\n\\$ docker run myip -i\nHTTP/1.1 200 OK\nServer: nginx/1.8.0\nDate: Tue, 22 Nov 2016 05:12:40 GMT\nContent-Type: text/html; charset=UTF-8\nVary: Accept-Encoding\nX-Powered-By: PHP/5.6.24-1~dotdeb+7.1\nX-Cache: MISS from cache-2\nX-Cache-Lookup: MISS from cache-2:80\nX-Cache: MISS from proxy-2_6\nTransfer-Encoding: chunked\nVia: 1.1 cache-2:80, 1.1 proxy-2_6:8006\nConnection: keep-alive\n\n当前 IP：61.148.226.66 来自：北京市 联通`, `41039559069085970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run myip\n当前 IP：61.148.226.66 来自：北京市 联通\n\n$ docker run myip -i\nHTTP/1.1 <span class="token number">200</span> OK\nServer: nginx/1.8.0\nDate: Tue, <span class="token number">22</span> Nov <span class="token number">2016</span> 05:12:40 GMT\nContent-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>UTF-8\nVary: Accept-Encoding\nX-Powered-By: PHP/5.6.24-1~dotdeb+7.1\nX-Cache: MISS from cache-2\nX-Cache-Lookup: MISS from cache-2:80\nX-Cache: MISS from proxy-2_6\nTransfer-Encoding: chunked\nVia: <span class="token number">1.1</span> cache-2:80, <span class="token number">1.1</span> proxy-2_6:8006\nConnection: keep-alive\n\n当前 IP：61.148.226.66 来自：北京市 联通</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，这次成功了。这是因为当存在 ENTRYPOINT 后，CMD 的内容将会作为参数传给 ENTRYPOINT，而这里 -i 就是新的 CMD，因此会作为参数传给 curl，从而达到了我们预期的效果。</p>\n<h3 id="场景二：应用运行前的准备工作"><a href="#%E5%9C%BA%E6%99%AF%E4%BA%8C%EF%BC%9A%E5%BA%94%E7%94%A8%E8%BF%90%E8%A1%8C%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>场景二：应用运行前的准备工作</h3>\n<p>启动容器就是启动主进程，但有些时候，启动主进程前，需要一些准备工作。</p>\n<p>比如 mysql 类的数据库，可能需要一些数据库配置、初始化的工作，这些工作要在最终的 mysql 服务器运行之前解决。</p>\n<p>此外，可能希望避免使用 root 用户去启动服务，从而提高安全性，而在启动服务前还需要以 root 身份执行一些必要的准备工作，最后切换到服务用户身份启动服务。或者除了服务外，其它命令依旧可以使用 root 身份执行，方便调试等。</p>\n<p>这些准备工作是和容器 CMD 无关的，无论 CMD 为什么，都需要事先进行一个预处理的工作。这种情况下，可以写一个脚本，然后放入 ENTRYPOINT 中去执行，而这个脚本会将接到的参数（也就是 <code class="language-text">&lt;CMD&gt;</code>）作为命令，在脚本最后执行。比如官方镜像 redis 中就是这么做的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43025156630883820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM alpine:3.4\n...\nRUN addgroup -S redis && adduser -S -G redis redis\n...\nENTRYPOINT [&quot;docker-entrypoint.sh&quot;]\n\nEXPOSE 6379\nCMD [ &quot;redis-server&quot; ]`, `43025156630883820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> alpine<span class="token punctuation">:</span>3.4\n<span class="token punctuation">...</span>\n<span class="token keyword">RUN</span> addgroup <span class="token punctuation">-</span>S redis &amp;&amp; adduser <span class="token punctuation">-</span>S <span class="token punctuation">-</span>G redis redis\n<span class="token punctuation">...</span>\n<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"docker-entrypoint.sh"</span><span class="token punctuation">]</span>\n\n<span class="token keyword">EXPOSE</span> 6379\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"redis-server"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到其中为了 redis 服务创建了 redis 用户，并在最后指定了 ENTRYPOINT 为 docker-entrypoint.sh 脚本。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65170375732871545000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n...\n# allow the container to be started with \\`--user\\`\nif [ &quot;\\$1&quot; = \'redis-server\' -a &quot;\\$(id -u)&quot; = \'0\' ]; then\n   find . \\! -user redis -exec chown redis \'{}\' +\n   exec gosu redis &quot;\\$0&quot; &quot;\\$@&quot;\nfi\n\nexec &quot;\\$@&quot;`, `65170375732871545000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token punctuation">..</span>.\n<span class="token comment"># allow the container to be started with `--user`</span>\n<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">=</span> <span class="token string">\'redis-server\'</span> -a <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span>"</span> <span class="token operator">=</span> <span class="token string">\'0\'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n   <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token punctuation">\\</span><span class="token operator">!</span> -user redis -exec <span class="token function">chown</span> redis <span class="token string">\'{}\'</span> +\n   <span class="token builtin class-name">exec</span> gosu redis <span class="token string">"<span class="token variable">$0</span>"</span> <span class="token string">"<span class="token variable">$@</span>"</span>\n<span class="token keyword">fi</span>\n\n<span class="token builtin class-name">exec</span> <span class="token string">"<span class="token variable">$@</span>"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>该脚本的内容就是根据 CMD 的内容来判断，如果是 redis-server 的话，则切换到 redis 用户身份启动服务器，否则依旧使用 root 身份执行。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63173824665320310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -it redis id\nuid=0(root) gid=0(root) groups=0(root)`, `63173824665320310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -it redis <span class="token function">id</span>\n<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="env-设置环境变量"><a href="#env-%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ENV 设置环境变量</h2>\n<p>格式有两种：</p>\n<ul>\n<li><code class="language-text">ENV &lt;key&gt; &lt;value&gt;</code></li>\n<li><code class="language-text">ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code></li>\n</ul>\n<p>这个指令很简单，就是设置环境变量而已，无论是后面的其它指令如 RUN，还是运行时的应用，都可以直接使用这里定义的环境变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36874471130940090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ENV VERSION=1.0 DEBUG=on \\\n    NAME=&quot;Happy Feet&quot;`, `36874471130940090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ENV</span> VERSION=1.0 DEBUG=on \\\n    NAME=<span class="token string">"Happy Feet"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这个例子中演示了如何换行，以及对含有空格的值用双引号括起来的办法，这和 Shell 下的行为是一致的。</p>\n<p>定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。比如在官方 node 镜像 Dockerfile 中，就有类似这样的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="315287502202266100"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ENV NODE_VERSION 7.2.0\n\nRUN curl -SLO &quot;https://nodejs.org/dist/v\\$NODE_VERSION/node-v\\$NODE_VERSION-linux-x64.tar.xz&quot; \\\n  && curl -SLO &quot;https://nodejs.org/dist/v\\$NODE_VERSION/SHASUMS256.txt.asc&quot; \\\n  && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n  && grep &quot; node-v\\$NODE_VERSION-linux-x64.tar.xz\\\\$&quot; SHASUMS256.txt | sha256sum -c - \\\n  && tar -xJf &quot;node-v\\$NODE_VERSION-linux-x64.tar.xz&quot; -C /usr/local --strip-components=1 \\\n  && rm &quot;node-v\\$NODE_VERSION-linux-x64.tar.xz&quot; SHASUMS256.txt.asc SHASUMS256.txt \\\n  && ln -s /usr/local/bin/node /usr/local/bin/nodejs`, `315287502202266100`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ENV</span> NODE_VERSION 7.2.0\n\n<span class="token keyword">RUN</span> curl <span class="token punctuation">-</span>SLO <span class="token string">"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz"</span> \\\n  &amp;&amp; curl <span class="token punctuation">-</span>SLO <span class="token string">"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc"</span> \\\n  &amp;&amp; gpg <span class="token punctuation">-</span><span class="token punctuation">-</span>batch <span class="token punctuation">-</span><span class="token punctuation">-</span>decrypt <span class="token punctuation">-</span><span class="token punctuation">-</span>output SHASUMS256.txt SHASUMS256.txt.asc \\\n  &amp;&amp; grep <span class="token string">" node-v$NODE_VERSION-linux-x64.tar.xz\\$"</span> SHASUMS256.txt <span class="token punctuation">|</span> sha256sum <span class="token punctuation">-</span>c <span class="token punctuation">-</span> \\\n  &amp;&amp; tar <span class="token punctuation">-</span>xJf <span class="token string">"node-v$NODE_VERSION-linux-x64.tar.xz"</span> <span class="token punctuation">-</span>C /usr/local <span class="token punctuation">-</span><span class="token punctuation">-</span>strip<span class="token punctuation">-</span>components=1 \\\n  &amp;&amp; rm <span class="token string">"node-v$NODE_VERSION-linux-x64.tar.xz"</span> SHASUMS256.txt.asc SHASUMS256.txt \\\n  &amp;&amp; ln <span class="token punctuation">-</span>s /usr/local/bin/node /usr/local/bin/nodejs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这里先定义了环境变量 <code class="language-text">NODE_VERSION</code>，其后的 RUN 这层里，多次使用 <code class="language-text">$NODE_VERSION</code> 来进行操作定制。可以看到，将来升级镜像构建版本的时候，只需要更新 7.2.0 即可，Dockerfile 构建维护变得更轻松了。</p>\n<p>下列指令可以支持环境变量展开：ADD、COPY、ENV、EXPOSE、FROM、LABEL、USER、WORKDIR、VOLUME、STOPSIGNAL、ONBUILD、RUN。</p>\n<p>可以从这个指令列表里感觉到，环境变量可以使用的地方很多，很强大。通过环境变量，我们可以让一份 Dockerfile 制作更多的镜像，只需使用不同的环境变量即可。</p>\n<h2 id="arg-构建参数"><a href="#arg-%E6%9E%84%E5%BB%BA%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ARG 构建参数</h2>\n<p>格式：<code class="language-text">ARG &lt;参数名&gt;[=&lt;默认值&gt;]</code></p>\n<p>构建参数和 ENV 的效果一样，都是设置环境变量。所不同的是，ARG 所设置的构建环境的环境变量，在将来容器运行时是不会存在这些环境变量的。但是不要因此就使用 ARG 保存密码之类的信息，因为 docker history 还是可以看到所有值的。</p>\n<p>Dockerfile 中的 ARG 指令是定义参数名称，以及定义其默认值。该默认值可以在构建命令 docker build 中用 <code class="language-text">--build-arg &lt;参数名&gt;=&lt;值&gt;</code> 来覆盖。</p>\n<p>灵活的使用 ARG 指令，能够在不修改 Dockerfile 的情况下，构建出不同的镜像。</p>\n<p>ARG 指令有生效范围，如果在 FROM 指令之前指定，那么只能用于 FROM 指令中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52876199997652630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ARG DOCKER_USERNAME=library\n\nFROM \\${DOCKER_USERNAME}/alpine\n\nRUN set -x ; echo \\${DOCKER_USERNAME}`, `52876199997652630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ARG</span> DOCKER_USERNAME=library\n\n<span class="token keyword">FROM</span> $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span>/alpine\n\n<span class="token keyword">RUN</span> set <span class="token punctuation">-</span>x ; echo $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用上述 Dockerfile 会发现无法输出 <code class="language-text">${DOCKER_USERNAME}</code> 变量的值，要想正常输出，你必须在 FROM 之后再次指定 ARG</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28835490677276975000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 只在 FROM 中生效\nARG DOCKER_USERNAME=library\n\nFROM \\${DOCKER_USERNAME}/alpine\n\n# 要想在 FROM 之后使用，必须再次指定\nARG DOCKER_USERNAME=library\n\nRUN set -x ; echo \\${DOCKER_USERNAME}`, `28835490677276975000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># 只在 FROM 中生效</span>\n<span class="token keyword">ARG</span> DOCKER_USERNAME=library\n\n<span class="token keyword">FROM</span> $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span>/alpine\n\n<span class="token comment"># 要想在 FROM 之后使用，必须再次指定</span>\n<span class="token keyword">ARG</span> DOCKER_USERNAME=library\n\n<span class="token keyword">RUN</span> set <span class="token punctuation">-</span>x ; echo $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于多阶段构建，尤其要注意这个问题</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29685949419609360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 这个变量在每个 FROM 中都生效\nARG DOCKER_USERNAME=library\n\nFROM \\${DOCKER_USERNAME}/alpine\n\nRUN set -x ; echo 1\n\nFROM \\${DOCKER_USERNAME}/alpine\n\nRUN set -x ; echo 2`, `29685949419609360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># 这个变量在每个 FROM 中都生效</span>\n<span class="token keyword">ARG</span> DOCKER_USERNAME=library\n\n<span class="token keyword">FROM</span> $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span>/alpine\n\n<span class="token keyword">RUN</span> set <span class="token punctuation">-</span>x ; echo 1\n\n<span class="token keyword">FROM</span> $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span>/alpine\n\n<span class="token keyword">RUN</span> set <span class="token punctuation">-</span>x ; echo 2</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于上述 Dockerfile 两个 FROM 指令都可以使用 <code class="language-text">${DOCKER_USERNAME}</code>，对于在各个阶段中使用的变量都必须在每个阶段分别指定：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39104507957975820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ARG DOCKER_USERNAME=library\n\nFROM \\${DOCKER_USERNAME}/alpine\n\n# 在 FROM 之后使用变量，必须在每个阶段分别指定\nARG DOCKER_USERNAME=library\n\nRUN set -x ; echo \\${DOCKER_USERNAME}\n\nFROM \\${DOCKER_USERNAME}/alpine\n\n# 在 FROM 之后使用变量，必须在每个阶段分别指定\nARG DOCKER_USERNAME=library\n\nRUN set -x ; echo \\${DOCKER_USERNAME}`, `39104507957975820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ARG</span> DOCKER_USERNAME=library\n\n<span class="token keyword">FROM</span> $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span>/alpine\n\n<span class="token comment"># 在 FROM 之后使用变量，必须在每个阶段分别指定</span>\n<span class="token keyword">ARG</span> DOCKER_USERNAME=library\n\n<span class="token keyword">RUN</span> set <span class="token punctuation">-</span>x ; echo $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span>\n\n<span class="token keyword">FROM</span> $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span>/alpine\n\n<span class="token comment"># 在 FROM 之后使用变量，必须在每个阶段分别指定</span>\n<span class="token keyword">ARG</span> DOCKER_USERNAME=library\n\n<span class="token keyword">RUN</span> set <span class="token punctuation">-</span>x ; echo $<span class="token punctuation">{</span>DOCKER_USERNAME<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="volume-定义匿名卷"><a href="#volume-%E5%AE%9A%E4%B9%89%E5%8C%BF%E5%90%8D%E5%8D%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>VOLUME 定义匿名卷</h2>\n<p>格式为：</p>\n<ul>\n<li><code class="language-text">VOLUME [&quot;&lt;路径 1&gt;&quot;, &quot;&lt;路径 2&gt;&quot;...]</code></li>\n<li><code class="language-text">VOLUME &lt;路径&gt;</code></li>\n</ul>\n<p>之前我们说过，容器运行时应该尽量保持容器存储层不发生写操作，对于数据库类需要保存动态数据的应用，其数据库文件应该保存于卷(volume)中，后面的章节我们会进一步介绍 Docker 卷的概念。为了防止运行时用户忘记将动态文件所保存目录挂载为卷，在 Dockerfile 中，我们可以事先指定某些目录挂载为匿名卷，这样在运行时如果用户不指定挂载，其应用也可以正常运行，不会向容器存储层写入大量数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43839509374118850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`VOLUME /data`, `43839509374118850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">VOLUME</span> /data</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这里的 /data 目录就会在容器运行时自动挂载为匿名卷，任何向 /data 中写入的信息都不会记录进容器存储层，从而保证了容器存储层的无状态化。当然，运行容器时可以覆盖这个挂载设置。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21202011808579346000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -v mydata:/data xxxx`, `21202011808579346000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile">$ docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>v mydata<span class="token punctuation">:</span>/data xxxx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在这行命令中，就使用了 mydata 这个命名卷挂载到了 /data 这个位置，替代了 Dockerfile 中定义的匿名卷的挂载配置。</p>\n<h2 id="expose-声明端口"><a href="#expose-%E5%A3%B0%E6%98%8E%E7%AB%AF%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EXPOSE 声明端口</h2>\n<p>格式为 <code class="language-text">EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]</code>。</p>\n<p>EXPOSE 指令是声明容器运行时提供服务的端口，这只是一个声明，在容器运行时并不会因为这个声明应用就会开启这个端口的服务。在 Dockerfile 中写入这样的声明有两个好处，一个是帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射；另一个用处则是在运行时使用随机端口映射时，也就是 <code class="language-text">docker run -P</code> 时，会自动随机映射 EXPOSE 的端口。</p>\n<p>要将 EXPOSE 和在运行时使用 <code class="language-text">-p &lt;宿主端口&gt;:&lt;容器端口&gt;</code> 区分开来。-p，是映射宿主端口和容器端口，换句话说，就是将容器的对应端口服务公开给外界访问，而 EXPOSE 仅仅是声明容器打算使用什么端口而已，并不会自动在宿主进行端口映射。</p>\n<h2 id="workdir-指定工作目录"><a href="#workdir-%E6%8C%87%E5%AE%9A%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WORKDIR 指定工作目录</h2>\n<p>格式为 <code class="language-text">WORKDIR &lt;工作目录路径&gt;</code>。</p>\n<p>使用 WORKDIR 指令可以来指定工作目录（或者称为当前目录），以后各层的当前目录就被改为指定的目录，如该目录不存在，WORKDIR 会帮你建立目录。</p>\n<p>之前提到一些初学者常犯的错误是把 Dockerfile 等同于 Shell 脚本来书写，这种错误的理解还可能会导致出现下面这样的错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11755824875262544000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN cd /app\nRUN echo &quot;hello&quot; > world.txt`, `11755824875262544000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> cd /app\n<span class="token keyword">RUN</span> echo <span class="token string">"hello"</span> <span class="token punctuation">></span> world.txt</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果将这个 Dockerfile 进行构建镜像运行后，会发现找不到 <code class="language-text">/app/world.txt</code> 文件，或者其内容不是 hello。原因其实很简单，在 Shell 中，连续两行是同一个进程执行环境，因此前一个命令修改的内存状态，会直接影响后一个命令；而在 Dockerfile 中，这两行 RUN 命令的执行环境根本不同，是两个完全不同的容器。这就是对 Dockerfile 构建分层存储的概念不了解所导致的错误。</p>\n<p>之前说过每一个 RUN 都是启动一个容器、执行命令、然后提交存储层文件变更。第一层 <code class="language-text">RUN cd /app</code> 的执行仅仅是当前进程的工作目录变更，一个内存上的变化而已，其结果不会造成任何文件变更。而到第二层的时候，启动的是一个全新的容器，跟第一层的容器更完全没关系，自然不可能继承前一层构建过程中的内存变化。</p>\n<p>因此如果需要改变以后各层的工作目录的位置，那么应该使用 WORKDIR 指令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23452060416120180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`WORKDIR /app\n\nRUN echo &quot;hello&quot; > world.txt`, `23452060416120180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">WORKDIR</span> /app\n\n<span class="token keyword">RUN</span> echo <span class="token string">"hello"</span> <span class="token punctuation">></span> world.txt</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果你的 WORKDIR 指令使用的相对路径，那么所切换的路径与之前的 WORKDIR 有关：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6292808999390353000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`WORKDIR /a\nWORKDIR b\nWORKDIR c\n\nRUN pwd`, `6292808999390353000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">WORKDIR</span> /a\n<span class="token keyword">WORKDIR</span> b\n<span class="token keyword">WORKDIR</span> c\n\n<span class="token keyword">RUN</span> pwd</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>RUN pwd 的工作目录为 /a/b/c。</p>\n<h2 id="user-指定当前用户"><a href="#user-%E6%8C%87%E5%AE%9A%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>USER 指定当前用户</h2>\n<p>格式：<code class="language-text">USER &lt;用户名&gt;[:&lt;用户组&gt;]</code></p>\n<p>USER 指令和 WORKDIR 相似，都是改变环境状态并影响以后的层。WORKDIR 是改变工作目录，USER 则是改变之后层的执行 RUN, CMD 以及 ENTRYPOINT 这类命令的身份。</p>\n<p>注意，USER 只是帮助你切换到指定用户而已，这个用户必须是事先建立好的，否则无法切换。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17973511359420800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN groupadd -r redis && useradd -r -g redis redis\nUSER redis\nRUN [ &quot;redis-server&quot; ]`, `17973511359420800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> groupadd <span class="token punctuation">-</span>r redis &amp;&amp; useradd <span class="token punctuation">-</span>r <span class="token punctuation">-</span>g redis redis\n<span class="token keyword">USER</span> redis\n<span class="token keyword">RUN</span> <span class="token punctuation">[</span> <span class="token string">"redis-server"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果以 root 执行的脚本，在执行期间希望改变身份，比如希望以某个已经建立好的用户来运行某个服务进程，不要使用 su 或者 sudo，这些都需要比较麻烦的配置，而且在 TTY 缺失的环境下经常出错。建议使用 gosu。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10997081175879030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 建立 redis 用户，并使用 gosu 换另一个用户执行命令\nRUN groupadd -r redis && useradd -r -g redis redis\n# 下载 gosu\nRUN wget -O /usr/local/bin/gosu &quot;https://github.com/tianon/gosu/releases/download/1.12/gosu-amd64&quot; \\\n    && chmod +x /usr/local/bin/gosu \\\n    && gosu nobody true\n# 设置 CMD，并以另外的用户执行\nCMD [ &quot;exec&quot;, &quot;gosu&quot;, &quot;redis&quot;, &quot;redis-server&quot; ]`, `10997081175879030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># 建立 redis 用户，并使用 gosu 换另一个用户执行命令</span>\n<span class="token keyword">RUN</span> groupadd <span class="token punctuation">-</span>r redis &amp;&amp; useradd <span class="token punctuation">-</span>r <span class="token punctuation">-</span>g redis redis\n<span class="token comment"># 下载 gosu</span>\n<span class="token keyword">RUN</span> wget <span class="token punctuation">-</span>O /usr/local/bin/gosu <span class="token string">"https://github.com/tianon/gosu/releases/download/1.12/gosu-amd64"</span> \\\n    &amp;&amp; chmod +x /usr/local/bin/gosu \\\n    &amp;&amp; gosu nobody true\n<span class="token comment"># 设置 CMD，并以另外的用户执行</span>\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token string">"gosu"</span><span class="token punctuation">,</span> <span class="token string">"redis"</span><span class="token punctuation">,</span> <span class="token string">"redis-server"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="healthcheck-健康检查"><a href="#healthcheck-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HEALTHCHECK 健康检查</h2>\n<p>格式：</p>\n<ul>\n<li><code class="language-text">HEALTHCHECK [选项] CMD &lt;命令&gt;</code>：设置检查容器健康状况的命令</li>\n<li><code class="language-text">HEALTHCHECK NONE</code>：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</li>\n</ul>\n<p>HEALTHCHECK 指令是告诉 Docker 应该如何进行判断容器的状态是否正常，这是 Docker 1.12 引入的新指令。</p>\n<p>在没有 HEALTHCHECK 指令前，Docker 引擎只可以通过容器内主进程是否退出来判断容器是否状态异常。很多情况下这没问题，但是如果程序进入死锁状态，或者死循环状态，应用进程并不退出，但是该容器已经无法提供服务了。在 1.12 以前，Docker 不会检测到容器的这种状态，从而不会重新调度，导致可能会有部分容器已经无法提供服务了却还在接受用户请求。</p>\n<p>而自 1.12 之后，Docker 提供了 HEALTHCHECK 指令，通过该指令指定一行命令，用这行命令来判断容器主进程的服务状态是否还正常，从而比较真实的反应容器实际状态。</p>\n<p>当在一个镜像指定了 HEALTHCHECK 指令后，用其启动容器，初始状态会为 starting，在 HEALTHCHECK 指令检查成功后变为 healthy，如果连续一定次数失败，则会变为 unhealthy。</p>\n<p>HEALTHCHECK 支持下列选项：</p>\n<ul>\n<li><code class="language-text">--interval=&lt;间隔&gt;</code>：两次健康检查的间隔，默认为 30 秒；</li>\n<li><code class="language-text">--timeout=&lt;时长&gt;</code>：健康检查命令运行超时时间，如果超过这个时间，本次健康检查就被视为失败，默认 30 秒；</li>\n<li><code class="language-text">--retries=&lt;次数&gt;</code>：当连续失败指定次数后，则将容器状态视为 unhealthy，默认 3 次。</li>\n</ul>\n<p>和 CMD, ENTRYPOINT 一样，HEALTHCHECK 只可以出现一次，如果写了多个，只有最后一个生效。</p>\n<p>在 <code class="language-text">HEALTHCHECK [选项] CMD</code> 后面的命令，格式和 ENTRYPOINT 一样，分为 shell 格式，和 exec 格式。命令的返回值决定了该次健康检查的成功与否：0：成功；1：失败；2：保留，不要使用这个值。</p>\n<p>假设我们有个镜像是个最简单的 Web 服务，我们希望增加健康检查来判断其 Web 服务是否在正常工作，我们可以用 curl 来帮助判断，其 Dockerfile 的 HEALTHCHECK 可以这么写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98202117235462800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM nginx\nRUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*\nHEALTHCHECK --interval=5s --timeout=3s \\\n  CMD curl -fs http://localhost/ || exit 1`, `98202117235462800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> nginx\n<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y curl &amp;&amp; rm <span class="token punctuation">-</span>rf /var/lib/apt/lists/*\n<span class="token keyword">HEALTHCHECK</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>interval=5s <span class="token punctuation">-</span><span class="token punctuation">-</span>timeout=3s \\\n  <span class="token keyword">CMD</span> curl <span class="token punctuation">-</span>fs http<span class="token punctuation">:</span>//localhost/ <span class="token punctuation">|</span><span class="token punctuation">|</span> exit 1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里我们设置了每 5 秒检查一次（这里为了试验所以间隔非常短，实际应该相对较长），如果健康检查命令超过 3 秒没响应就视为失败，并且使用 curl -fs <a href="http://localhost/" target="_blank" rel="nofollow noreferrer noopener">http://localhost/</a> || exit 1 作为健康检查命令。</p>\n<p>使用 docker build 来构建这个镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3354057973019753000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build -t myweb:v1 .`, `3354057973019753000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build -t myweb:v1 <span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>构建好了后，我们启动一个容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59189159022944530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d --name web -p 80:80 myweb:v1`, `59189159022944530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d --name web -p <span class="token number">80</span>:80 myweb:v1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当运行该镜像后，可以通过 <code class="language-text">docker container ls</code> 看到最初的状态为 (health: starting)：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48190248557424000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container ls\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                            PORTS               NAMES\n03e28eb00bd0        myweb:v1            &quot;nginx -g \'daemon off&quot;   3 seconds ago       Up 2 seconds (health: starting)   80/tcp, 443/tcp     web`, `48190248557424000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container <span class="token function">ls</span>\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                            PORTS               NAMES\n03e28eb00bd0        myweb:v1            <span class="token string">"nginx -g \'daemon off"</span>   <span class="token number">3</span> seconds ago       Up <span class="token number">2</span> seconds <span class="token punctuation">(</span>health: starting<span class="token punctuation">)</span>   <span class="token number">80</span>/tcp, <span class="token number">443</span>/tcp     web</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在等待几秒钟后，再次 docker container ls，就会看到健康状态变化为了 (healthy)：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12166330475373498000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container ls\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS               NAMES\n03e28eb00bd0        myweb:v1            &quot;nginx -g \'daemon off&quot;   18 seconds ago      Up 16 seconds (healthy)   80/tcp, 443/tcp     web`, `12166330475373498000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container <span class="token function">ls</span>\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS               NAMES\n03e28eb00bd0        myweb:v1            <span class="token string">"nginx -g \'daemon off"</span>   <span class="token number">18</span> seconds ago      Up <span class="token number">16</span> seconds <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   <span class="token number">80</span>/tcp, <span class="token number">443</span>/tcp     web</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果健康检查连续失败超过了重试次数，状态就会变为 (unhealthy)。</p>\n<p>为了帮助排障，健康检查命令的输出（包括 stdout 以及 stderr）都会被存储于健康状态里，可以用 docker inspect 来查看。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38977244326399260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker inspect --format \'{{json .State.Health}}\' web | python -m json.tool\n{\n    &quot;FailingStreak&quot;: 0,\n    &quot;Log&quot;: [\n        {\n            &quot;End&quot;: &quot;2016-11-25T14:35:37.940957051Z&quot;,\n            &quot;ExitCode&quot;: 0,\n            &quot;Output&quot;: &quot;<!DOCTYPE html>\\n<html>\\n<head>\\n<title>Welcome to nginx!</title>\\n<style>\\n    body {\\n        width: 35em;\\n        margin: 0 auto;\\n        font-family: Tahoma, Verdana, Arial, sans-serif;\\n    }\\n</style>\\n</head>\\n<body>\\n<h1>Welcome to nginx!</h1>\\n<p>If you see this page, the nginx web server is successfully installed and\\nworking. Further configuration is required.</p>\\n\\n<p>For online documentation and support please refer to\\n<a href=\\&quot;http://nginx.org/\\&quot;>nginx.org</a>.<br/>\\nCommercial support is available at\\n<a href=\\&quot;http://nginx.com/\\&quot;>nginx.com</a>.</p>\\n\\n<p><em>Thank you for using nginx.</em></p>\\n</body>\\n</html>\\n&quot;,\n            &quot;Start&quot;: &quot;2016-11-25T14:35:37.780192565Z&quot;\n        }\n    ],\n    &quot;Status&quot;: &quot;healthy&quot;\n}`, `38977244326399260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker inspect --format <span class="token string">\'{{json .State.Health}}\'</span> web <span class="token operator">|</span> python -m json.tool\n<span class="token punctuation">{</span>\n    <span class="token string">"FailingStreak"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,\n    <span class="token string">"Log"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">{</span>\n            <span class="token string">"End"</span><span class="token builtin class-name">:</span> <span class="token string">"2016-11-25T14:35:37.940957051Z"</span>,\n            <span class="token string">"ExitCode"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,\n            <span class="token string">"Output"</span><span class="token builtin class-name">:</span> <span class="token string">"&lt;!DOCTYPE html><span class="token entity" title="\\n">\\n</span>&lt;html><span class="token entity" title="\\n">\\n</span>&lt;head><span class="token entity" title="\\n">\\n</span>&lt;title>Welcome to nginx!&lt;/title><span class="token entity" title="\\n">\\n</span>&lt;style><span class="token entity" title="\\n">\\n</span>    body {<span class="token entity" title="\\n">\\n</span>        width: 35em;<span class="token entity" title="\\n">\\n</span>        margin: 0 auto;<span class="token entity" title="\\n">\\n</span>        font-family: Tahoma, Verdana, Arial, sans-serif;<span class="token entity" title="\\n">\\n</span>    }<span class="token entity" title="\\n">\\n</span>&lt;/style><span class="token entity" title="\\n">\\n</span>&lt;/head><span class="token entity" title="\\n">\\n</span>&lt;body><span class="token entity" title="\\n">\\n</span>&lt;h1>Welcome to nginx!&lt;/h1><span class="token entity" title="\\n">\\n</span>&lt;p>If you see this page, the nginx web server is successfully installed and<span class="token entity" title="\\n">\\n</span>working. Further configuration is required.&lt;/p><span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>&lt;p>For online documentation and support please refer to<span class="token entity" title="\\n">\\n</span>&lt;a href=<span class="token entity" title="\\&quot;">\\"</span>http://nginx.org/<span class="token entity" title="\\&quot;">\\"</span>>nginx.org&lt;/a>.&lt;br/><span class="token entity" title="\\n">\\n</span>Commercial support is available at<span class="token entity" title="\\n">\\n</span>&lt;a href=<span class="token entity" title="\\&quot;">\\"</span>http://nginx.com/<span class="token entity" title="\\&quot;">\\"</span>>nginx.com&lt;/a>.&lt;/p><span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>&lt;p>&lt;em>Thank you for using nginx.&lt;/em>&lt;/p><span class="token entity" title="\\n">\\n</span>&lt;/body><span class="token entity" title="\\n">\\n</span>&lt;/html><span class="token entity" title="\\n">\\n</span>"</span>,\n            <span class="token string">"Start"</span><span class="token builtin class-name">:</span> <span class="token string">"2016-11-25T14:35:37.780192565Z"</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>,\n    <span class="token string">"Status"</span><span class="token builtin class-name">:</span> <span class="token string">"healthy"</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="label-指令"><a href="#label-%E6%8C%87%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LABEL 指令</h2>\n<p>LABEL 指令用来给镜像以键值对的形式添加一些元数据（metadata）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80946823188423300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`LABEL <key>=<value> <key>=<value> <key>=<value> ...`, `80946823188423300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">LABEL</span> &lt;key<span class="token punctuation">></span>=&lt;value<span class="token punctuation">></span> &lt;key<span class="token punctuation">></span>=&lt;value<span class="token punctuation">></span> &lt;key<span class="token punctuation">></span>=&lt;value<span class="token punctuation">></span> <span class="token punctuation">...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们还可以用一些标签来申明镜像的作者、文档地址等：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19645641635444530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`LABEL org.opencontainers.image.authors=&quot;yeasy&quot;\n\nLABEL org.opencontainers.image.documentation=&quot;https://yeasy.gitbooks.io&quot;`, `19645641635444530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">LABEL</span> org.opencontainers.image.authors=<span class="token string">"yeasy"</span>\n\n<span class="token keyword">LABEL</span> org.opencontainers.image.documentation=<span class="token string">"https://yeasy.gitbooks.io"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>具体可以参考 <a href="https://github.com/opencontainers/image-spec/blob/master/annotations.md" target="_blank" rel="nofollow noreferrer noopener">https://github.com/opencontainers/image-spec/blob/master/annotations.md</a></p>\n<h2 id="shell-指令"><a href="#shell-%E6%8C%87%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SHELL 指令</h2>\n<p>格式：<code class="language-text">SHELL [&quot;executable&quot;, &quot;parameters&quot;]</code></p>\n<p>SHELL 指令可以指定 <code class="language-text">RUN ENTRYPOINT CMD</code> 指令的 shell，Linux 中默认为 <code class="language-text">[&quot;/bin/sh&quot;, &quot;-c&quot;]</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53258930175577770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`SHELL [&quot;/bin/sh&quot;, &quot;-c&quot;]\n\nRUN lll ; ls\n\nSHELL [&quot;/bin/sh&quot;, &quot;-cex&quot;]\n\nRUN lll ; ls`, `53258930175577770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">SHELL</span> <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">]</span>\n\n<span class="token keyword">RUN</span> lll ; ls\n\n<span class="token keyword">SHELL</span> <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> <span class="token string">"-cex"</span><span class="token punctuation">]</span>\n\n<span class="token keyword">RUN</span> lll ; ls</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>两个 RUN 运行同一命令，第二个 RUN 运行的命令会打印出每条命令并当遇到错误时退出。</p>\n<p>当 <code class="language-text">ENTRYPOINT CMD</code> 以 shell 格式指定时，SHELL 指令所指定的 shell 也会成为这两个指令的 shell</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51881178270202690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`SHELL [&quot;/bin/sh&quot;, &quot;-cex&quot;]\n\n# /bin/sh -cex &quot;nginx&quot;\nENTRYPOINT nginx\n\n\\`\\`\\`dockerfile\nSHELL [&quot;/bin/sh&quot;, &quot;-cex&quot;]\n\n# /bin/sh -cex &quot;nginx&quot;\nCMD nginx`, `51881178270202690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">SHELL</span> <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> <span class="token string">"-cex"</span><span class="token punctuation">]</span>\n\n<span class="token comment"># /bin/sh -cex </span><span class="token string">"nginx"</span>\n<span class="token keyword">ENTRYPOINT</span> nginx\n\n```dockerfile\n<span class="token keyword">SHELL</span> <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> <span class="token string">"-cex"</span><span class="token punctuation">]</span>\n\n<span class="token comment"># /bin/sh -cex </span><span class="token string">"nginx"</span>\n<span class="token keyword">CMD</span> nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="onbuild-为他人做嫁衣裳"><a href="#onbuild-%E4%B8%BA%E4%BB%96%E4%BA%BA%E5%81%9A%E5%AB%81%E8%A1%A3%E8%A3%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ONBUILD 为他人做嫁衣裳</h2>\n<p>格式：<code class="language-text">ONBUILD &lt;其它指令&gt;</code>。</p>\n<p>ONBUILD 是一个特殊的指令，它后面跟的是其它指令，比如 RUN, COPY 等，而这些指令，在当前镜像构建时并不会被执行。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行。</p>\n<p>Dockerfile 中的其它指令都是为了定制当前镜像而准备的，唯有 ONBUILD 是为了帮助别人定制自己而准备的。</p>\n<p>假设我们要制作 Node.js 所写的应用的镜像。我们都知道 Node.js 使用 npm 进行包管理，所有依赖、配置、启动信息等会放到 package.json 文件里。在拿到程序代码后，需要先进行 npm install 才可以获得所有需要的依赖。然后就可以通过 npm start 来启动应用。因此，一般来说会这样写 Dockerfile：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70479098117954830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM node:slim\nRUN mkdir /app\nWORKDIR /app\nCOPY ./package.json /app\nRUN [ &quot;npm&quot;, &quot;install&quot; ]\nCOPY . /app/\nCMD [ &quot;npm&quot;, &quot;start&quot; ]`, `70479098117954830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>slim\n<span class="token keyword">RUN</span> mkdir /app\n<span class="token keyword">WORKDIR</span> /app\n<span class="token keyword">COPY</span> ./package.json /app\n<span class="token keyword">RUN</span> <span class="token punctuation">[</span> <span class="token string">"npm"</span><span class="token punctuation">,</span> <span class="token string">"install"</span> <span class="token punctuation">]</span>\n<span class="token keyword">COPY</span> . /app/\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"npm"</span><span class="token punctuation">,</span> <span class="token string">"start"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>把这个 Dockerfile 放到 Node.js 项目的根目录，构建好镜像后，就可以直接拿来启动容器运行。但是如果我们还有第二个 Node.js 项目也差不多呢？好吧，那就再把这个 Dockerfile 复制到第二个项目里。那如果有第三个项目呢？再复制么？文件的副本越多，版本控制就越困难，让我们继续看这样的场景维护的问题。</p>\n<p>如果第一个 Node.js 项目在开发过程中，发现这个 Dockerfile 里存在问题，比如敲错字了、或者需要安装额外的包，然后开发人员修复了这个 Dockerfile，再次构建，问题解决。第一个项目没问题了，但是第二个项目呢？虽然最初 Dockerfile 是复制、粘贴自第一个项目的，但是并不会因为第一个项目修复了他们的 Dockerfile，而第二个项目的 Dockerfile 就会被自动修复。</p>\n<p>那么我们可不可以做一个基础镜像，然后各个项目使用这个基础镜像呢？这样基础镜像更新，各个项目不用同步 Dockerfile 的变化，重新构建后就继承了基础镜像的更新？好吧，可以，让我们看看这样的结果。那么上面的这个 Dockerfile 就会变为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9115965558860828000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM node:slim\nRUN mkdir /app\nWORKDIR /app\nCMD [ &quot;npm&quot;, &quot;start&quot; ]`, `9115965558860828000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>slim\n<span class="token keyword">RUN</span> mkdir /app\n<span class="token keyword">WORKDIR</span> /app\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"npm"</span><span class="token punctuation">,</span> <span class="token string">"start"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里我们把项目相关的构建指令拿出来，放到子项目里去。假设这个基础镜像的名字为 my-node 的话，各个项目内的自己的 Dockerfile 就变为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6625976567507963000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM my-node\nCOPY ./package.json /app\nRUN [ &quot;npm&quot;, &quot;install&quot; ]\nCOPY . /app/`, `6625976567507963000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> my<span class="token punctuation">-</span>node\n<span class="token keyword">COPY</span> ./package.json /app\n<span class="token keyword">RUN</span> <span class="token punctuation">[</span> <span class="token string">"npm"</span><span class="token punctuation">,</span> <span class="token string">"install"</span> <span class="token punctuation">]</span>\n<span class="token keyword">COPY</span> . /app/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>基础镜像变化后，各个项目都用这个 Dockerfile 重新构建镜像，会继承基础镜像的更新。</p>\n<p>那么，问题解决了么？没有。准确说，只解决了一半。如果这个 Dockerfile 里面有些东西需要调整呢？比如 npm install 都需要加一些参数，那怎么办？这一行 RUN 是不可能放入基础镜像的，因为涉及到了当前项目的 <code class="language-text">./package.json</code>，难道又要一个个修改么？所以说，这样制作基础镜像，只解决了原来的 Dockerfile 的前 4 条指令的变化问题，而后面三条指令的变化则完全没办法处理。</p>\n<p>ONBUILD 可以解决这个问题。让我们用 ONBUILD 重新写一下基础镜像的 Dockerfile:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52764327700002950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM node:slim\nRUN mkdir /app\nWORKDIR /app\nONBUILD COPY ./package.json /app\nONBUILD RUN [ &quot;npm&quot;, &quot;install&quot; ]\nONBUILD COPY . /app/\nCMD [ &quot;npm&quot;, &quot;start&quot; ]`, `52764327700002950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>slim\n<span class="token keyword">RUN</span> mkdir /app\n<span class="token keyword">WORKDIR</span> /app\n<span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> ./package.json /app\n<span class="token keyword">ONBUILD</span> <span class="token keyword">RUN</span> <span class="token punctuation">[</span> <span class="token string">"npm"</span><span class="token punctuation">,</span> <span class="token string">"install"</span> <span class="token punctuation">]</span>\n<span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> . /app/\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">"npm"</span><span class="token punctuation">,</span> <span class="token string">"start"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这次我们回到原始的 Dockerfile，但是这次将项目相关的指令加上 ONBUILD，这样在构建基础镜像的时候，这三行并不会被执行。然后各个项目的 Dockerfile 就变成了简单地：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22843217114850734000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM my-node`, `22843217114850734000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> my<span class="token punctuation">-</span>node</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是的，只有这么一行。当在各个项目目录中，用这个只有一行的 Dockerfile 构建镜像时，之前基础镜像的那三行 ONBUILD 就会开始执行，成功的将当前项目的代码复制进镜像、并且针对本项目执行 npm install，生成应用镜像。</p>\n<h2 id="多阶段构建"><a href="#%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多阶段构建</h2>\n<h3 id="之前的做法"><a href="#%E4%B9%8B%E5%89%8D%E7%9A%84%E5%81%9A%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>之前的做法</h3>\n<p>在 Docker 17.05 版本之前，我们构建 Docker 镜像时，通常会采用两种方式：</p>\n<h4 id="全部放入一个-dockerfile"><a href="#%E5%85%A8%E9%83%A8%E6%94%BE%E5%85%A5%E4%B8%80%E4%B8%AA-dockerfile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全部放入一个 Dockerfile</h4>\n<p>一种方式是将所有的构建过程包含在一个 Dockerfile 中，包括项目及其依赖库的编译、测试、打包等流程，这里可能会带来的一些问题：</p>\n<ul>\n<li>镜像层次多，镜像体积较大，部署时间变长</li>\n<li>源代码存在泄露的风险</li>\n</ul>\n<p>例如，编写 app.go 文件，该程序输出 Hello World!</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42695784507090680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`package main\n\nimport &quot;fmt&quot;\n\nfunc main(){\n    fmt.Printf(&quot;Hello World!&quot;);\n}`, `42695784507090680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="go"\n              >\n                <span class="gatsby-code-button-language">go</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> main\n\n<span class="token keyword">import</span> <span class="token string">"fmt"</span>\n\n<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>编写 Dockerfile.one 文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40025206914179950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM golang:alpine\n\nRUN apk --no-cache add git ca-certificates\n\nWORKDIR /go/src/github.com/go/helloworld/\n\nCOPY app.go .\n\nRUN go get -d -v github.com/go-sql-driver/mysql \\\n  && CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app . \\\n  && cp /go/src/github.com/go/helloworld/app /root\n\nWORKDIR /root/\n\nCMD [&quot;./app&quot;]`, `40025206914179950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> golang<span class="token punctuation">:</span>alpine\n\n<span class="token keyword">RUN</span> apk <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache add git ca<span class="token punctuation">-</span>certificates\n\n<span class="token keyword">WORKDIR</span> /go/src/github.com/go/helloworld/\n\n<span class="token keyword">COPY</span> app.go .\n\n<span class="token keyword">RUN</span> go get <span class="token punctuation">-</span>d <span class="token punctuation">-</span>v github.com/go<span class="token punctuation">-</span>sql<span class="token punctuation">-</span>driver/mysql \\\n  &amp;&amp; CGO_ENABLED=0 GOOS=linux go build <span class="token punctuation">-</span>a <span class="token punctuation">-</span>installsuffix cgo <span class="token punctuation">-</span>o app . \\\n  &amp;&amp; cp /go/src/github.com/go/helloworld/app /root\n\n<span class="token keyword">WORKDIR</span> /root/\n\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"./app"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>构建镜像</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8291681493303815000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build -t go/helloworld:1 -f Dockerfile.one .`, `8291681493303815000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build -t go/helloworld:1 -f Dockerfile.one <span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="分散到多个-dockerfile"><a href="#%E5%88%86%E6%95%A3%E5%88%B0%E5%A4%9A%E4%B8%AA-dockerfile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分散到多个 Dockerfile</h4>\n<p>另一种方式，就是我们事先在一个 Dockerfile 将项目及其依赖库编译测试打包好后，再将其拷贝到运行环境中，这种方式需要我们编写两个 Dockerfile 和一些编译脚本才能将其两个阶段自动整合起来，这种方式虽然可以很好地规避第一种方式存在的风险，但明显部署过程较复杂。</p>\n<p>例如，编写 Dockerfile.build 文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92241016338413000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM golang:alpine\n\nRUN apk --no-cache add git\n\nWORKDIR /go/src/github.com/go/helloworld\n\nCOPY app.go .\n\nRUN go get -d -v github.com/go-sql-driver/mysql \\\n  && CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .`, `92241016338413000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> golang<span class="token punctuation">:</span>alpine\n\n<span class="token keyword">RUN</span> apk <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache add git\n\n<span class="token keyword">WORKDIR</span> /go/src/github.com/go/helloworld\n\n<span class="token keyword">COPY</span> app.go .\n\n<span class="token keyword">RUN</span> go get <span class="token punctuation">-</span>d <span class="token punctuation">-</span>v github.com/go<span class="token punctuation">-</span>sql<span class="token punctuation">-</span>driver/mysql \\\n  &amp;&amp; CGO_ENABLED=0 GOOS=linux go build <span class="token punctuation">-</span>a <span class="token punctuation">-</span>installsuffix cgo <span class="token punctuation">-</span>o app .</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>编写 Dockerfile.copy 文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56834772101825480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM alpine:latest\n\nRUN apk --no-cache add ca-certificates\n\nWORKDIR /root/\n\nCOPY app .\n\nCMD [&quot;./app&quot;]`, `56834772101825480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> alpine<span class="token punctuation">:</span>latest\n\n<span class="token keyword">RUN</span> apk <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache add ca<span class="token punctuation">-</span>certificates\n\n<span class="token keyword">WORKDIR</span> /root/\n\n<span class="token keyword">COPY</span> app .\n\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"./app"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>新建 build.sh</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56991505387625456000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\necho Building go/helloworld:build\n\ndocker build -t go/helloworld:build . -f Dockerfile.build\n\ndocker create --name extract go/helloworld:build\ndocker cp extract:/go/src/github.com/go/helloworld/app ./app\ndocker rm -f extract\n\necho Building go/helloworld:2\n\ndocker build --no-cache -t go/helloworld:2 . -f Dockerfile.copy\nrm ./app`, `56991505387625456000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token builtin class-name">echo</span> Building go/helloworld:build\n\ndocker build -t go/helloworld:build <span class="token builtin class-name">.</span> -f Dockerfile.build\n\ndocker create --name extract go/helloworld:build\ndocker <span class="token function">cp</span> extract:/go/src/github.com/go/helloworld/app ./app\ndocker <span class="token function">rm</span> -f extract\n\n<span class="token builtin class-name">echo</span> Building go/helloworld:2\n\ndocker build --no-cache -t go/helloworld:2 <span class="token builtin class-name">.</span> -f Dockerfile.copy\n<span class="token function">rm</span> ./app</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在运行脚本即可构建镜像</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52669460828334460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ chmod +x build.sh\n\n\\$ ./build.sh`, `52669460828334460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">chmod</span> +x build.sh\n\n$ ./build.sh</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>对比两种方式生成的镜像大小</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32023905571477828000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls\n\nREPOSITORY      TAG    IMAGE ID        CREATED         SIZE\ngo/helloworld   2      f7cf3465432c    22 seconds ago  6.47MB\ngo/helloworld   1      f55d3e16affc    2 minutes ago   295MB`, `32023905571477828000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span>\n\nREPOSITORY      TAG    IMAGE ID        CREATED         SIZE\ngo/helloworld   <span class="token number">2</span>      f7cf3465432c    <span class="token number">22</span> seconds ago  <span class="token number">6</span>.47MB\ngo/helloworld   <span class="token number">1</span>      f55d3e16affc    <span class="token number">2</span> minutes ago   295MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用多阶段构建"><a href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用多阶段构建</h3>\n<p>为解决以上问题，Docker v17.05 开始支持多阶段构建 (multistage builds)。使用多阶段构建我们就可以很容易解决前面提到的问题，并且只需要编写一个 Dockerfile：</p>\n<p>例如，编写 Dockerfile 文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72692276007583790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM golang:alpine as builder\n\nRUN apk --no-cache add git\n\nWORKDIR /go/src/github.com/go/helloworld/\n\nRUN go get -d -v github.com/go-sql-driver/mysql\n\nCOPY app.go .\n\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .\n\nFROM alpine:latest as prod\n\nRUN apk --no-cache add ca-certificates\n\nWORKDIR /root/\n\nCOPY --from=0 /go/src/github.com/go/helloworld/app .\n\nCMD [&quot;./app&quot;]`, `72692276007583790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> golang<span class="token punctuation">:</span>alpine as builder\n\n<span class="token keyword">RUN</span> apk <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache add git\n\n<span class="token keyword">WORKDIR</span> /go/src/github.com/go/helloworld/\n\n<span class="token keyword">RUN</span> go get <span class="token punctuation">-</span>d <span class="token punctuation">-</span>v github.com/go<span class="token punctuation">-</span>sql<span class="token punctuation">-</span>driver/mysql\n\n<span class="token keyword">COPY</span> app.go .\n\n<span class="token keyword">RUN</span> CGO_ENABLED=0 GOOS=linux go build <span class="token punctuation">-</span>a <span class="token punctuation">-</span>installsuffix cgo <span class="token punctuation">-</span>o app .\n\n<span class="token keyword">FROM</span> alpine<span class="token punctuation">:</span>latest as prod\n\n<span class="token keyword">RUN</span> apk <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache add ca<span class="token punctuation">-</span>certificates\n\n<span class="token keyword">WORKDIR</span> /root/\n\n<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=0 /go/src/github.com/go/helloworld/app .\n\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"./app"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>构建镜像</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23208351863407084000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build -t go/helloworld:3 .`, `23208351863407084000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker build -t go/helloworld:3 <span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>对比三个镜像大小</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69339678368888455000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker image ls\n\nREPOSITORY        TAG   IMAGE ID         CREATED            SIZE\ngo/helloworld     3     d6911ed9c846     7 seconds ago      6.47MB\ngo/helloworld     2     f7cf3465432c     22 seconds ago     6.47MB\ngo/helloworld     1     f55d3e16affc     2 minutes ago      295MB`, `69339678368888455000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker image <span class="token function">ls</span>\n\nREPOSITORY        TAG   IMAGE ID         CREATED            SIZE\ngo/helloworld     <span class="token number">3</span>     d6911ed9c846     <span class="token number">7</span> seconds ago      <span class="token number">6</span>.47MB\ngo/helloworld     <span class="token number">2</span>     f7cf3465432c     <span class="token number">22</span> seconds ago     <span class="token number">6</span>.47MB\ngo/helloworld     <span class="token number">1</span>     f55d3e16affc     <span class="token number">2</span> minutes ago      295MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>很明显使用多阶段构建的镜像体积小，同时也完美解决了上边提到的问题。</p>\n<h4 id="只构建某一阶段的镜像"><a href="#%E5%8F%AA%E6%9E%84%E5%BB%BA%E6%9F%90%E4%B8%80%E9%98%B6%E6%AE%B5%E7%9A%84%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>只构建某一阶段的镜像</h4>\n<p>我们可以使用 as 来为某一阶段命名，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59702331803473990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM golang:alpine as builder`, `59702331803473990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> golang<span class="token punctuation">:</span>alpine as builder</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>例如当我们只想构建 builder 阶段的镜像时，增加 —target=builder 参数即可</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="368342891882456060"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker build --target builder -t username/imagename:tag .`, `368342891882456060`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile">$ docker build <span class="token punctuation">-</span><span class="token punctuation">-</span>target builder <span class="token punctuation">-</span>t username/imagename<span class="token punctuation">:</span>tag .</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="构建时从其他镜像复制文件"><a href="#%E6%9E%84%E5%BB%BA%E6%97%B6%E4%BB%8E%E5%85%B6%E4%BB%96%E9%95%9C%E5%83%8F%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建时从其他镜像复制文件</h4>\n<p>上面例子中我们使用 <code class="language-text">COPY --from=0 /go/src/github.com/go/helloworld/app .</code> 从上一阶段的镜像中复制文件，我们也可以复制任意镜像中的文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86253625910806900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ COPY --from=nginx:latest /etc/nginx/nginx.conf /nginx.conf`, `86253625910806900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile">$ COPY <span class="token punctuation">-</span><span class="token punctuation">-</span>from=nginx<span class="token punctuation">:</span>latest /etc/nginx/nginx.conf /nginx.conf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="构建多种系统架构支持的-docker-镜像----docker-manifest-命令详解"><a href="#%E6%9E%84%E5%BB%BA%E5%A4%9A%E7%A7%8D%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81%E7%9A%84-docker-%E9%95%9C%E5%83%8F----docker-manifest-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建多种系统架构支持的 Docker 镜像 — docker manifest 命令详解</h2>\n<p>我们知道使用镜像创建一个容器，该镜像必须与 Docker 宿主机系统架构一致，例如 <code class="language-text">Linux x86_64</code> 架构的系统中只能使用 <code class="language-text">Linux x86_64</code> 的镜像创建容器。</p>\n<p>Windows、macOS 除外，其使用了 <code class="language-text">binfmt_misc</code> 提供了多种架构支持，在 Windows、macOS 系统上 (x86_64) 可以运行 arm 等其他架构的镜像。</p>\n<p>例如我们在 <code class="language-text">Linux x86_64</code> 中构建一个 <code class="language-text">username/test</code> 镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7107390243248091000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM alpine\n\nCMD echo 1`, `7107390243248091000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> alpine\n\n<span class="token keyword">CMD</span> echo 1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>构建镜像后推送到 Docker Hub，之后我们尝试在树莓派 Linux arm64v8 中使用这个镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27382967693173543000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -it --rm username/test`, `27382967693173543000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -it --rm username/test</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>可以发现这个镜像根本获取不到。</p>\n<p>要解决这个问题，通常采用的做法是通过镜像名区分不同系统架构的镜像，例如在 <code class="language-text">Linux x86_64</code> 和 <code class="language-text">Linux arm64v8</code> 分别构建 <code class="language-text">username/test</code> 和 <code class="language-text">username/arm64v8-test</code> 镜像。运行时使用对应架构的镜像即可。</p>\n<p>这样做显得很繁琐，那么有没有一种方法让 Docker 引擎根据系统架构自动拉取对应的镜像呢？</p>\n<p>我们发现在 <code class="language-text">Linux x86_64</code> 和 <code class="language-text">Linux arm64v8</code> 架构的计算机中分别使用 <code class="language-text">golang:alpine</code> 镜像运行容器 <code class="language-text">$ docker run golang:alpine go version</code> 时，容器能够正常的运行。</p>\n<p>这是什么原因呢？</p>\n<p>原因就是 <code class="language-text">golang:alpine</code> 官方镜像有一个 manifest 列表 (manifest list) 。</p>\n<p>当用户获取一个镜像时，Docker 引擎会首先查找该镜像是否有 manifest 列表，如果有的话 Docker 引擎会按照 Docker 运行环境（系统及架构）查找出对应镜像（例如 golang:alpine）。如果没有的话会直接获取镜像（例如上例中我们构建的 username/test）。</p>\n<p>我们可以使用 <code class="language-text">$ docker manifest inspect golang:alpine</code> 查看这个 manifest 列表的结构。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36666831803947540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker manifest inspect golang:alpine`, `36666831803947540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker manifest inspect golang:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54873458151296710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;schemaVersion&quot;: 2,\n  &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.list.v2+json&quot;,\n  &quot;manifests&quot;: [\n    {\n      &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.v2+json&quot;,\n      &quot;size&quot;: 1365,\n      &quot;digest&quot;: &quot;sha256:5e28ac423243b187f464d635bcfe1e909f4a31c6c8bce51d0db0a1062bec9e16&quot;,\n      &quot;platform&quot;: {\n        &quot;architecture&quot;: &quot;amd64&quot;,\n        &quot;os&quot;: &quot;linux&quot;\n      }\n    },\n    {\n      &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.v2+json&quot;,\n      &quot;size&quot;: 1365,\n      &quot;digest&quot;: &quot;sha256:2945c46e26c9787da884b4065d1de64cf93a3b81ead1b949843dda1fcd458bae&quot;,\n      &quot;platform&quot;: {\n        &quot;architecture&quot;: &quot;arm&quot;,\n        &quot;os&quot;: &quot;linux&quot;,\n        &quot;variant&quot;: &quot;v7&quot;\n      }\n    },\n    {\n      &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.v2+json&quot;,\n      &quot;size&quot;: 1365,\n      &quot;digest&quot;: &quot;sha256:87fff60114fd3402d0c1a7ddf1eea1ded658f171749b57dc782fd33ee2d47b2d&quot;,\n      &quot;platform&quot;: {\n        &quot;architecture&quot;: &quot;arm64&quot;,\n        &quot;os&quot;: &quot;linux&quot;,\n        &quot;variant&quot;: &quot;v8&quot;\n      }\n    },\n    {\n      &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.v2+json&quot;,\n      &quot;size&quot;: 1365,\n      &quot;digest&quot;: &quot;sha256:607b43f1d91144f82a9433764e85eb3ccf83f73569552a49bc9788c31b4338de&quot;,\n      &quot;platform&quot;: {\n        &quot;architecture&quot;: &quot;386&quot;,\n        &quot;os&quot;: &quot;linux&quot;\n      }\n    },\n    {\n      &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.v2+json&quot;,\n      &quot;size&quot;: 1365,\n      &quot;digest&quot;: &quot;sha256:25ead0e21ed5e246ce31e274b98c09aaf548606788ef28eaf375dc8525064314&quot;,\n      &quot;platform&quot;: {\n        &quot;architecture&quot;: &quot;ppc64le&quot;,\n        &quot;os&quot;: &quot;linux&quot;\n      }\n    },\n    {\n      &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.v2+json&quot;,\n      &quot;size&quot;: 1365,\n      &quot;digest&quot;: &quot;sha256:69f5907fa93ea591175b2c688673775378ed861eeb687776669a48692bb9754d&quot;,\n      &quot;platform&quot;: {\n        &quot;architecture&quot;: &quot;s390x&quot;,\n        &quot;os&quot;: &quot;linux&quot;\n      }\n    }\n  ]\n}`, `54873458151296710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"schemaVersion"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n  <span class="token property">"mediaType"</span><span class="token operator">:</span> <span class="token string">"application/vnd.docker.distribution.manifest.list.v2+json"</span><span class="token punctuation">,</span>\n  <span class="token property">"manifests"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">"mediaType"</span><span class="token operator">:</span> <span class="token string">"application/vnd.docker.distribution.manifest.v2+json"</span><span class="token punctuation">,</span>\n      <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">1365</span><span class="token punctuation">,</span>\n      <span class="token property">"digest"</span><span class="token operator">:</span> <span class="token string">"sha256:5e28ac423243b187f464d635bcfe1e909f4a31c6c8bce51d0db0a1062bec9e16"</span><span class="token punctuation">,</span>\n      <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"architecture"</span><span class="token operator">:</span> <span class="token string">"amd64"</span><span class="token punctuation">,</span>\n        <span class="token property">"os"</span><span class="token operator">:</span> <span class="token string">"linux"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">"mediaType"</span><span class="token operator">:</span> <span class="token string">"application/vnd.docker.distribution.manifest.v2+json"</span><span class="token punctuation">,</span>\n      <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">1365</span><span class="token punctuation">,</span>\n      <span class="token property">"digest"</span><span class="token operator">:</span> <span class="token string">"sha256:2945c46e26c9787da884b4065d1de64cf93a3b81ead1b949843dda1fcd458bae"</span><span class="token punctuation">,</span>\n      <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"architecture"</span><span class="token operator">:</span> <span class="token string">"arm"</span><span class="token punctuation">,</span>\n        <span class="token property">"os"</span><span class="token operator">:</span> <span class="token string">"linux"</span><span class="token punctuation">,</span>\n        <span class="token property">"variant"</span><span class="token operator">:</span> <span class="token string">"v7"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">"mediaType"</span><span class="token operator">:</span> <span class="token string">"application/vnd.docker.distribution.manifest.v2+json"</span><span class="token punctuation">,</span>\n      <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">1365</span><span class="token punctuation">,</span>\n      <span class="token property">"digest"</span><span class="token operator">:</span> <span class="token string">"sha256:87fff60114fd3402d0c1a7ddf1eea1ded658f171749b57dc782fd33ee2d47b2d"</span><span class="token punctuation">,</span>\n      <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"architecture"</span><span class="token operator">:</span> <span class="token string">"arm64"</span><span class="token punctuation">,</span>\n        <span class="token property">"os"</span><span class="token operator">:</span> <span class="token string">"linux"</span><span class="token punctuation">,</span>\n        <span class="token property">"variant"</span><span class="token operator">:</span> <span class="token string">"v8"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">"mediaType"</span><span class="token operator">:</span> <span class="token string">"application/vnd.docker.distribution.manifest.v2+json"</span><span class="token punctuation">,</span>\n      <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">1365</span><span class="token punctuation">,</span>\n      <span class="token property">"digest"</span><span class="token operator">:</span> <span class="token string">"sha256:607b43f1d91144f82a9433764e85eb3ccf83f73569552a49bc9788c31b4338de"</span><span class="token punctuation">,</span>\n      <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"architecture"</span><span class="token operator">:</span> <span class="token string">"386"</span><span class="token punctuation">,</span>\n        <span class="token property">"os"</span><span class="token operator">:</span> <span class="token string">"linux"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">"mediaType"</span><span class="token operator">:</span> <span class="token string">"application/vnd.docker.distribution.manifest.v2+json"</span><span class="token punctuation">,</span>\n      <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">1365</span><span class="token punctuation">,</span>\n      <span class="token property">"digest"</span><span class="token operator">:</span> <span class="token string">"sha256:25ead0e21ed5e246ce31e274b98c09aaf548606788ef28eaf375dc8525064314"</span><span class="token punctuation">,</span>\n      <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"architecture"</span><span class="token operator">:</span> <span class="token string">"ppc64le"</span><span class="token punctuation">,</span>\n        <span class="token property">"os"</span><span class="token operator">:</span> <span class="token string">"linux"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">"mediaType"</span><span class="token operator">:</span> <span class="token string">"application/vnd.docker.distribution.manifest.v2+json"</span><span class="token punctuation">,</span>\n      <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">1365</span><span class="token punctuation">,</span>\n      <span class="token property">"digest"</span><span class="token operator">:</span> <span class="token string">"sha256:69f5907fa93ea591175b2c688673775378ed861eeb687776669a48692bb9754d"</span><span class="token punctuation">,</span>\n      <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"architecture"</span><span class="token operator">:</span> <span class="token string">"s390x"</span><span class="token punctuation">,</span>\n        <span class="token property">"os"</span><span class="token operator">:</span> <span class="token string">"linux"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看出 manifest 列表中包含了不同系统架构所对应的镜像 digest 值，这样 Docker 就可以在不同的架构中使用相同的 manifest (例如 golang:alpine) 获取对应的镜像。</p>\n<p>下面介绍如何使用 <code class="language-text">$ docker manifest</code> 命令创建并推送 manifest 列表到 Docker Hub。</p>\n<h3 id="构建镜像-1"><a href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建镜像</h3>\n<p>首先在 <code class="language-text">Linux x86_64</code> 构建 <code class="language-text">username/x8664-test</code> 镜像。并在 <code class="language-text">Linux arm64v8</code> 中构建 <code class="language-text">username/arm64v8-test</code> 镜像，构建好之后推送到 Docker Hub。</p>\n<h3 id="创建-manifest-列表"><a href="#%E5%88%9B%E5%BB%BA-manifest-%E5%88%97%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 manifest 列表</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11903618975010599000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# \\$ docker manifest create MANIFEST_LIST MANIFEST [MANIFEST...]\n\\$ docker manifest create username/test \\\n      username/x8664-test \\\n      username/arm64v8-test`, `11903618975010599000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># $ docker manifest create MANIFEST_LIST MANIFEST [MANIFEST...]</span>\n$ docker manifest create username/test <span class="token punctuation">\\</span>\n      username/x8664-test <span class="token punctuation">\\</span>\n      username/arm64v8-test</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当要修改一个 manifest 列表时，可以加入 -a 或 —amend 参数。</p>\n<h3 id="设置-manifest-列表"><a href="#%E8%AE%BE%E7%BD%AE-manifest-%E5%88%97%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置 manifest 列表</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47122595618521145000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# \\$ docker manifest annotate [OPTIONS] MANIFEST_LIST MANIFEST\n\\$ docker manifest annotate username/test \\\n      username/x8664-test \\\n      --os linux --arch x86_64\n\n\\$ docker manifest annotate username/test \\\n      username/arm64v8-test \\\n      --os linux --arch arm64 --variant v8`, `47122595618521145000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># $ docker manifest annotate [OPTIONS] MANIFEST_LIST MANIFEST</span>\n$ docker manifest annotate username/test <span class="token punctuation">\\</span>\n      username/x8664-test <span class="token punctuation">\\</span>\n      --os linux --arch x86_64\n\n$ docker manifest annotate username/test <span class="token punctuation">\\</span>\n      username/arm64v8-test <span class="token punctuation">\\</span>\n      --os linux --arch arm64 --variant v8</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样就配置好了 manifest 列表。</p>\n<h3 id="查看-manifest-列表"><a href="#%E6%9F%A5%E7%9C%8B-manifest-%E5%88%97%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看 manifest 列表</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52875468699658420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker manifest inspect username/test`, `52875468699658420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker manifest inspect username/test</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="推送-manifest-列表"><a href="#%E6%8E%A8%E9%80%81-manifest-%E5%88%97%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>推送 manifest 列表</h3>\n<p>最后我们可以将其推送到 Docker Hub。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11389765851053734000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker manifest push username/test`, `11389765851053734000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker manifest push username/test</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="测试"><a href="#%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试</h3>\n<p>我们在 <code class="language-text">Linux x86_64</code> <code class="language-text">Linux arm64v8</code> 中分别执行 <code class="language-text">$ docker run -it --rm username/test</code> 命令，发现可以正确的执行。</p>\n<h1 id="操作容器"><a href="#%E6%93%8D%E4%BD%9C%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>操作容器</h1>\n<p>容器是 Docker 又一核心概念。</p>\n<p>简单的说，容器是独立运行的一个或一组应用，以及它们的运行态环境。对应的，虚拟机可以理解为模拟运行的一整套操作系统（提供了运行态环境和其他系统环境）和跑在上面的应用。</p>\n<p>本章将具体介绍如何来管理一个容器，包括创建、启动和停止等。</p>\n<h2 id="启动容器"><a href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>启动容器</h2>\n<p>启动容器有两种方式，一种是基于镜像新建一个容器并启动，另外一个是将在终止状态（exited）的容器重新启动。</p>\n<p>因为 Docker 的容器实在太轻量级了，很多时候用户都是随时删除和新创建容器。</p>\n<h3 id="新建并启动"><a href="#%E6%96%B0%E5%BB%BA%E5%B9%B6%E5%90%AF%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新建并启动</h3>\n<p>所需要的命令主要为 docker run。</p>\n<p>例如，下面的命令输出一个 “Hello World”，之后终止容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51064739469552010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run ubuntu:18.04 /bin/echo \'Hello world\'\nHello world`, `51064739469552010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run ubuntu:18.04 /bin/echo <span class="token string">\'Hello world\'</span>\nHello world</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这跟在本地直接执行 <code class="language-text">/bin/echo &#39;hello world&#39;</code> 几乎感觉不出任何区别。</p>\n<p>下面的命令则启动一个 bash 终端，允许用户进行交互。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73920316809208450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -t -i ubuntu:18.04 /bin/bash\nroot@af8bae53bdd3:/#`, `73920316809208450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -t -i ubuntu:18.04 /bin/bash\nroot@af8bae53bdd3:/<span class="token comment">#</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>其中，<code class="language-text">-t</code> 选项让 Docker 分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上，<code class="language-text">-i</code> 则让容器的标准输入保持打开。</p>\n<p>在交互模式下，用户可以通过所创建的终端来输入命令，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15695775590960360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`root@af8bae53bdd3:/# pwd\n/\nroot@af8bae53bdd3:/# ls\nbin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var`, `15695775590960360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">root@af8bae53bdd3:/<span class="token comment"># pwd</span>\n/\nroot@af8bae53bdd3:/<span class="token comment"># ls</span>\nbin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当利用 docker run 来创建容器时，Docker 在后台运行的标准操作包括：</p>\n<ul>\n<li>检查本地是否存在指定的镜像，不存在就从 registry 下载</li>\n<li>利用镜像创建并启动一个容器</li>\n<li>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层</li>\n<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去</li>\n<li>从地址池配置一个 ip 地址给容器</li>\n<li>执行用户指定的应用程序</li>\n<li>执行完毕后容器被终止</li>\n</ul>\n<h3 id="启动已终止容器"><a href="#%E5%90%AF%E5%8A%A8%E5%B7%B2%E7%BB%88%E6%AD%A2%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>启动已终止容器</h3>\n<p>可以利用 <code class="language-text">docker container start</code> 命令，直接将一个已经终止（exited）的容器启动运行。</p>\n<p>容器的核心为所执行的应用程序，所需要的资源都是应用程序运行所必需的。除此之外，并没有其它的资源。可以在伪终端中利用 ps 或 top 来查看进程信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78178514617559650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`root@ba267838cc1b:/# ps\n  PID TTY          TIME CMD\n    1 ?        00:00:00 bash\n   11 ?        00:00:00 ps`, `78178514617559650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">root@ba267838cc1b:/<span class="token comment"># ps</span>\n  PID TTY          TIME CMD\n    <span class="token number">1</span> ?        00:00:00 <span class="token function">bash</span>\n   <span class="token number">11</span> ?        00:00:00 <span class="token function">ps</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可见，容器中仅运行了指定的 bash 应用。这种特点使得 Docker 对资源的利用率极高，是货真价实的轻量级虚拟化。</p>\n<h2 id="后台运行"><a href="#%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后台运行</h2>\n<p>更多的时候，需要让 Docker 在后台运行而不是直接把执行命令的结果输出在当前宿主机下。此时，可以通过添加 <code class="language-text">-d</code> 参数来实现。</p>\n<p>下面举两个例子来说明一下。</p>\n<p>如果不使用 <code class="language-text">-d</code> 参数运行容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60855615114008740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run ubuntu:18.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;\nhello world\nhello world\nhello world\nhello world`, `60855615114008740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run ubuntu:18.04 /bin/sh -c <span class="token string">"while true; do echo hello world; sleep 1; done"</span>\nhello world\nhello world\nhello world\nhello world</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>容器会把输出的结果 (STDOUT) 打印到宿主机上面</p>\n<p>如果使用了 <code class="language-text">-d</code> 参数运行容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60381859145971980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d ubuntu:18.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;\n77b2dc01fe0f3f1265df143181e7b9af5e05279a884f4776ee75350ea9d8017a`, `60381859145971980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d ubuntu:18.04 /bin/sh -c <span class="token string">"while true; do echo hello world; sleep 1; done"</span>\n77b2dc01fe0f3f1265df143181e7b9af5e05279a884f4776ee75350ea9d8017a</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>此时容器会在后台运行并不会把输出的结果 (STDOUT) 打印到宿主机上面(输出结果可以用 <code class="language-text">docker logs</code> 查看)。</p>\n<blockquote>\n<p>注：容器是否会长久运行，是和 docker run 指定的命令有关，和 <code class="language-text">-d</code> 参数无关。</p>\n</blockquote>\n<p>使用 <code class="language-text">-d</code> 参数启动后会返回一个唯一的 id，也可以通过 docker container ls 命令来查看容器信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7279815053777838000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container ls\nCONTAINER ID  IMAGE         COMMAND               CREATED        STATUS       PORTS NAMES\n77b2dc01fe0f  ubuntu:18.04  /bin/sh -c \'while tr  2 minutes ago  Up 1 minute        agitated_wright`, `7279815053777838000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container <span class="token function">ls</span>\nCONTAINER ID  IMAGE         COMMAND               CREATED        STATUS       PORTS NAMES\n77b2dc01fe0f  ubuntu:18.04  /bin/sh -c \'while <span class="token function">tr</span>  <span class="token number">2</span> minutes ago  Up <span class="token number">1</span> minute        agitated_wright</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>要获取容器的输出信息，可以通过 <code class="language-text">docker container logs</code> 命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93798909503309870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container logs [container ID or NAMES]\nhello world\nhello world\nhello world\n. . .`, `93798909503309870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container logs <span class="token punctuation">[</span>container ID or NAMES<span class="token punctuation">]</span>\nhello world\nhello world\nhello world\n<span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="终止容器"><a href="#%E7%BB%88%E6%AD%A2%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>终止容器</h2>\n<p>可以使用 <code class="language-text">docker container stop</code> 来终止一个运行中的容器。</p>\n<p>此外，当 Docker 容器中指定的应用终结时，容器也自动终止。</p>\n<p>例如对于上一章节中只启动了一个终端的容器，用户通过 <code class="language-text">exit</code> 命令或 <code class="language-text">Ctrl+d</code> 来退出终端时，所创建的容器立刻终止。</p>\n<p>终止状态的容器可以用 <code class="language-text">docker container ls -a</code> 命令看到。例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17946139536836526000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container ls -a\nCONTAINER ID        IMAGE                    COMMAND                CREATED             STATUS                          PORTS               NAMES\nba267838cc1b        ubuntu:18.04             &quot;/bin/bash&quot;            30 minutes ago      Exited (0) About a minute ago                       trusting_newton`, `17946139536836526000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container <span class="token function">ls</span> -a\nCONTAINER ID        IMAGE                    COMMAND                CREATED             STATUS                          PORTS               NAMES\nba267838cc1b        ubuntu:18.04             <span class="token string">"/bin/bash"</span>            <span class="token number">30</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> About a minute ago                       trusting_newton</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>处于终止状态的容器，可以通过 <code class="language-text">docker container start</code> 命令来重新启动。</p>\n<p>此外，<code class="language-text">docker container restart</code> 命令会将一个运行态的容器终止，然后再重新启动它。</p>\n<h2 id="进入容器"><a href="#%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进入容器</h2>\n<p>在使用 <code class="language-text">-d</code> 参数时，容器启动后会进入后台。</p>\n<p>某些时候需要进入容器进行操作，包括使用 docker attach 命令或 docker exec 命令，推荐大家使用 docker exec 命令，原因会在下面说明。</p>\n<h3 id="attach-命令"><a href="#attach-%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>attach 命令</h3>\n<p>下面示例如何使用 docker attach 命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6517486014816520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -dit ubuntu\n243c32535da7d142fb0e6df616a3c3ada0b8ab417937c853a9e1c251f499f550\n\n\\$ docker container ls\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n243c32535da7        ubuntu:latest       &quot;/bin/bash&quot;         18 seconds ago      Up 17 seconds                           nostalgic_hypatia\n\n\\$ docker attach 243c\nroot@243c32535da7:/#`, `6517486014816520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -dit ubuntu\n243c32535da7d142fb0e6df616a3c3ada0b8ab417937c853a9e1c251f499f550\n\n$ docker container <span class="token function">ls</span>\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n243c32535da7        ubuntu:latest       <span class="token string">"/bin/bash"</span>         <span class="token number">18</span> seconds ago      Up <span class="token number">17</span> seconds                           nostalgic_hypatia\n\n$ docker attach 243c\nroot@243c32535da7:/<span class="token comment">#</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意：如果从这个 stdin 中 exit，会导致容器的停止。</p>\n<h3 id="exec-命令--i--t-参数"><a href="#exec-%E5%91%BD%E4%BB%A4--i--t-%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>exec 命令 -i -t 参数</h3>\n<p>docker exec 后边可以跟多个参数，这里主要说明 <code class="language-text">-i -t</code> 参数。</p>\n<p>只用 <code class="language-text">-i</code> 参数时，由于没有分配伪终端，界面没有我们熟悉的 Linux 命令提示符，但命令执行结果仍然可以返回。</p>\n<p>当 <code class="language-text">-i -t</code> 参数一起使用时，则可以看到我们熟悉的 Linux 命令提示符。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64577368005972360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -dit ubuntu\n69d137adef7a8a689cbcb059e94da5489d3cddd240ff675c640c8d96e84fe1f6\n\n\\$ docker container ls\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n69d137adef7a        ubuntu:latest       &quot;/bin/bash&quot;         18 seconds ago      Up 17 seconds                           zealous_swirles\n\n\\$ docker exec -i 69d1 bash\nls\nbin\nboot\ndev\n...\n\n\\$ docker exec -it 69d1 bash\nroot@69d137adef7a:/#`, `64577368005972360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -dit ubuntu\n69d137adef7a8a689cbcb059e94da5489d3cddd240ff675c640c8d96e84fe1f6\n\n$ docker container <span class="token function">ls</span>\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n69d137adef7a        ubuntu:latest       <span class="token string">"/bin/bash"</span>         <span class="token number">18</span> seconds ago      Up <span class="token number">17</span> seconds                           zealous_swirles\n\n$ docker <span class="token builtin class-name">exec</span> -i 69d1 <span class="token function">bash</span>\n<span class="token function">ls</span>\nbin\nboot\ndev\n<span class="token punctuation">..</span>.\n\n$ docker <span class="token builtin class-name">exec</span> -it 69d1 <span class="token function">bash</span>\nroot@69d137adef7a:/<span class="token comment">#</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果从这个 stdin 中 exit，不会导致容器的停止。这就是为什么推荐大家使用 docker exec 的原因。</p>\n<p>更多参数说明请使用 <code class="language-text">docker exec --help</code> 查看。</p>\n<h2 id="导出和导入容器"><a href="#%E5%AF%BC%E5%87%BA%E5%92%8C%E5%AF%BC%E5%85%A5%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>导出和导入容器</h2>\n<h3 id="导出容器"><a href="#%E5%AF%BC%E5%87%BA%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>导出容器</h3>\n<p>如果要导出本地某个容器，可以使用 docker export 命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91164243997834870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container ls -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                    PORTS               NAMES\n7691a814370e        ubuntu:18.04        &quot;/bin/bash&quot;         36 hours ago        Exited (0) 21 hours ago                       test\n\\$ docker export 7691a814370e > ubuntu.tar`, `91164243997834870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container <span class="token function">ls</span> -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                    PORTS               NAMES\n7691a814370e        ubuntu:18.04        <span class="token string">"/bin/bash"</span>         <span class="token number">36</span> hours ago        Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">21</span> hours ago                       <span class="token builtin class-name">test</span>\n$ docker <span class="token builtin class-name">export</span> 7691a814370e <span class="token operator">></span> ubuntu.tar</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样将导出容器快照到本地文件。</p>\n<h3 id="导入容器快照"><a href="#%E5%AF%BC%E5%85%A5%E5%AE%B9%E5%99%A8%E5%BF%AB%E7%85%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>导入容器快照</h3>\n<p>可以使用 docker import 从容器快照文件中再导入为镜像，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89613680558121730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ cat ubuntu.tar | docker import - test/ubuntu:v1.0\n\\$ docker image ls\nREPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE\ntest/ubuntu         v1.0                9d37a6082e97        About a minute ago   171.3 MB`, `89613680558121730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">cat</span> ubuntu.tar <span class="token operator">|</span> docker <span class="token function">import</span> - test/ubuntu:v1.0\n$ docker image <span class="token function">ls</span>\nREPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE\ntest/ubuntu         v1.0                9d37a6082e97        About a minute ago   <span class="token number">171.3</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此外，也可以通过指定 URL 或者某个目录来导入，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23777404533500770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker import http://example.com/exampleimage.tgz example/imagerepo`, `23777404533500770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">import</span> http://example.com/exampleimage.tgz example/imagerepo</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<blockquote>\n<p>注：用户既可以使用 docker load 来导入镜像存储文件到本地镜像库，也可以使用 docker import 来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。</p>\n</blockquote>\n<h2 id="删除容器"><a href="#%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除容器</h2>\n<p>可以使用 <code class="language-text">docker container rm</code> 来删除一个处于终止状态的容器。例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36738289029757200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container rm trusting_newton\ntrusting_newton`, `36738289029757200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container <span class="token function">rm</span> trusting_newton\ntrusting_newton</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果要删除一个运行中的容器，可以添加 -f 参数。Docker 会发送 SIGKILL 信号给容器。</p>\n<h3 id="清理所有处于终止状态的容器"><a href="#%E6%B8%85%E7%90%86%E6%89%80%E6%9C%89%E5%A4%84%E4%BA%8E%E7%BB%88%E6%AD%A2%E7%8A%B6%E6%80%81%E7%9A%84%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>清理所有处于终止状态的容器</h3>\n<p>用 <code class="language-text">docker container ls -a</code> 命令可以查看所有已经创建的包括终止状态的容器，如果数量太多要一个个删除可能会很麻烦，用下面的命令可以清理掉所有处于终止状态的容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5925081454650006000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container prune`, `5925081454650006000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container prune</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h1 id="docker-仓库"><a href="#docker-%E4%BB%93%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 仓库</h1>\n<p>仓库（Repository）是集中存放镜像的地方。</p>\n<p>一个容易混淆的概念是注册服务器（Registry）。实际上注册服务器是管理仓库的具体服务器，每个服务器上可以有多个仓库，而每个仓库下面有多个镜像。从这方面来说，仓库可以被认为是一个具体的项目或目录。例如对于仓库地址 <code class="language-text">docker.io/ubuntu</code> 来说，docker.io 是注册服务器地址，ubuntu 是仓库名。</p>\n<p>大部分时候，并不需要严格区分这两者的概念。</p>\n<h2 id="docker-hub"><a href="#docker-hub" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Hub</h2>\n<p>目前 Docker 官方维护了一个公共仓库 Docker Hub，大部分需求都可以通过在 Docker Hub 中直接下载镜像来实现。</p>\n<h3 id="注册"><a href="#%E6%B3%A8%E5%86%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>注册</h3>\n<p>你可以在 <a href="https://hub.docker.com" target="_blank" rel="nofollow noreferrer noopener">https://hub.docker.com</a> 免费注册一个 Docker 账号。</p>\n<h3 id="登录"><a href="#%E7%99%BB%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>登录</h3>\n<p>可以通过执行 docker login 命令交互式的输入用户名及密码来完成在命令行界面登录 Docker Hub。</p>\n<p>你可以通过 docker logout 退出登录。</p>\n<h3 id="拉取镜像"><a href="#%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>拉取镜像</h3>\n<p>你可以通过 docker search 命令来查找官方仓库中的镜像，并利用 docker pull 命令来将它下载到本地。</p>\n<p>例如以 centos 为关键词进行搜索：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48324909423522430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker search centos\nNAME                               DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\ncentos                             The official build of CentOS.                   6449      [OK]\nansible/centos7-ansible            Ansible on Centos7                              132                  [OK]\nconsol/centos-xfce-vnc             Centos container with &quot;headless&quot; VNC session…   126                  [OK]\njdeathe/centos-ssh                 OpenSSH / Supervisor / EPEL/IUS/SCL Repos - …   117                  [OK]\ncentos/systemd                     systemd enabled base container.                 96                   [OK]`, `48324909423522430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker search centos\nNAME                               DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\ncentos                             The official build of CentOS.                   <span class="token number">6449</span>      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>\nansible/centos7-ansible            Ansible on Centos7                              <span class="token number">132</span>                  <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>\nconsol/centos-xfce-vnc             Centos container with <span class="token string">"headless"</span> VNC session…   <span class="token number">126</span>                  <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>\njdeathe/centos-ssh                 OpenSSH / Supervisor / EPEL/IUS/SCL Repos - …   <span class="token number">117</span>                  <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>\ncentos/systemd                     systemd enabled base container.                 <span class="token number">96</span>                   <span class="token punctuation">[</span>OK<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到返回了很多包含关键字的镜像，其中包括镜像名字、描述、收藏数（表示该镜像的受关注程度）、是否官方创建（OFFICIAL）、是否自动构建 （AUTOMATED）。</p>\n<p>根据是否是官方提供，可将镜像分为两类。</p>\n<ol>\n<li>\n<p>类似 centos 这样的镜像，被称为基础镜像或根镜像。这些基础镜像由 Docker 公司创建、验证、支持、提供。这样的镜像往往使用单个单词作为名字。</p>\n</li>\n<li>\n<p>比如 <code class="language-text">ansible/centos7-ansible</code> 镜像，它是由 Docker Hub 的注册用户创建并维护的，往往带有用户名称前缀。可以通过前缀 <code class="language-text">username/</code> 来指定使用某个用户提供的镜像，比如 ansible 用户。</p>\n</li>\n</ol>\n<p>另外，在查找的时候通过 <code class="language-text">--filter=stars=N</code> 参数可以指定仅显示收藏数量为 N 以上的镜像。</p>\n<p>下载官方 centos 镜像到本地。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37544011806184250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker pull centos\nUsing default tag: latest\nlatest: Pulling from library/centos\n7a0437f04f83: Pull complete\nDigest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1\nStatus: Downloaded newer image for centos:latest\ndocker.io/library/centos:latest`, `37544011806184250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker pull centos\nUsing default tag: latest\nlatest: Pulling from library/centos\n7a0437f04f83: Pull complete\nDigest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1\nStatus: Downloaded newer image <span class="token keyword">for</span> centos:latest\ndocker.io/library/centos:latest</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="推送镜像"><a href="#%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>推送镜像</h3>\n<p>用户也可以在登录后通过 docker push 命令来将自己的镜像推送到 Docker Hub。</p>\n<p>以下命令中的 username 请替换为你的 Docker 账号用户名。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45658608685945940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker tag ubuntu:18.04 username/ubuntu:18.04\n\n\\$ docker image ls\n\nREPOSITORY                                               TAG                    IMAGE ID            CREATED             SIZE\nubuntu                                                   18.04                  275d79972a86        6 days ago          94.6MB\nusername/ubuntu                                          18.04                  275d79972a86        6 days ago          94.6MB\n\n\\$ docker push username/ubuntu:18.04\n\n\\$ docker search username\n\nNAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nusername/ubuntu`, `45658608685945940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker tag ubuntu:18.04 username/ubuntu:18.04\n\n$ docker image <span class="token function">ls</span>\n\nREPOSITORY                                               TAG                    IMAGE ID            CREATED             SIZE\nubuntu                                                   <span class="token number">18.04</span>                  275d79972a86        <span class="token number">6</span> days ago          <span class="token number">94</span>.6MB\nusername/ubuntu                                          <span class="token number">18.04</span>                  275d79972a86        <span class="token number">6</span> days ago          <span class="token number">94</span>.6MB\n\n$ docker push username/ubuntu:18.04\n\n$ docker search username\n\nNAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nusername/ubuntu</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="自动构建"><a href="#%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自动构建</h3>\n<p>2021 年 7 月 26 日之后，该项功能仅限付费用户使用。</p>\n<p>自动构建（Automated Builds）可以自动触发构建镜像，方便升级镜像。</p>\n<p>有时候，用户构建了镜像，安装了某个软件，当软件发布新版本则需要手动更新镜像。</p>\n<p>而自动构建允许用户通过 Docker Hub 指定跟踪一个目标网站（支持 GitHub 或 BitBucket）上的项目，一旦项目发生新的提交（commit）或者创建了新的标签（tag），Docker Hub 会自动构建镜像并推送到 Docker Hub 中。</p>\n<p>要配置自动构建，包括如下的步骤：</p>\n<ul>\n<li>登录 Docker Hub；</li>\n<li>在 Docker Hub 点击右上角头像，在账号设置（Account Settings）中关联（Linked Accounts）目标网站；</li>\n<li>在 Docker Hub 中新建或选择已有的仓库，在 Builds 选项卡中选择 Configure Automated Builds；</li>\n<li>选取一个目标网站中的项目（需要含 Dockerfile）和分支；</li>\n<li>指定 Dockerfile 的位置，并保存。</li>\n</ul>\n<p>之后，可以在 Docker Hub 的仓库页面的 Timeline 选项卡中查看每次构建的状态。</p>\n<h1 id="数据管理"><a href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据管理</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-17-02-27-55-a787655c53be0430f111e9269abb1da8-1041c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 501px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.898203592814376%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB20lEQVQoz1VQyY4TMRDNx3DjM/gCJMSFExe+gfMIjcSFE0cQ4gc4c0AzIIZMkgnJZJkOnXQmvS9O2+1e3HbbvVBJJNBIpXLpVT35vdd78vr941fnj16ePT//RAseJVmcFiFOA5KGJAuTLMAwUACjJEc0hw61p7mHae/Zm48v3n5+evbh3ZfLruvariMZu7dc0/G2pmPsbMsNLC9MWXnaHnp7eFPGezgrjkhXt62fci8TurcfL1aD8fRqML782Z9rumaYdw6yKZd1HeViGaRMNnkpehHNgZmUcmQTHWWqaSspfRRjQjcesiLsI+xGsVKKydokbBmmFxtkJiXjogfGuGqchN3jYmQnVlL+EwafmAk3MN/EpawPSMwqUAf7pj3KhiRk09pJWYoKpYwwIaTKWSml8jNR8KrkgosKtkIIUoh9UZ1sHsgQL0wLnw7/mCt9M/x9O54t19udASkVKiZ0oRuT+d1cW2/urQvNJlz9J6OjZ1XXW9ubLlfDyexmOp+tjK9TA64CFI/nq/5oAvitttZd9CDtE7lumvXO+XF9870/vLoefRtMf2kW4BBeAclUEmSDF/jjAdnHFGZVN8Eebx1/5wamF5puQBJaNy0UHEJrjww4g5KqAQRn7C+cXiHdG08wcwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 17 02 27 55" title="" data-src="/static/2022-07-17-02-27-55-a787655c53be0430f111e9269abb1da8-1041c.png" data-srcset="/static/2022-07-17-02-27-55-a787655c53be0430f111e9269abb1da8-d18f3.png 200w,\n/static/2022-07-17-02-27-55-a787655c53be0430f111e9269abb1da8-764b5.png 400w,\n/static/2022-07-17-02-27-55-a787655c53be0430f111e9269abb1da8-1041c.png 501w" data-sizes="(max-width: 501px) 100vw, 501px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这一章介绍如何在 Docker 内部以及容器之间管理数据，在容器中管理数据主要有两种方式：</p>\n<ul>\n<li>数据卷（Volumes）</li>\n<li>挂载主机目录 (Bind mounts)</li>\n</ul>\n<h2 id="数据卷"><a href="#%E6%95%B0%E6%8D%AE%E5%8D%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据卷</h2>\n<p>数据卷是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：</p>\n<ul>\n<li>数据卷可以在容器之间共享和重用</li>\n<li>对数据卷的修改会立马生效</li>\n<li>对数据卷的更新，不会影响镜像</li>\n<li>数据卷默认会一直存在，即使容器被删除</li>\n</ul>\n<blockquote>\n<p>注意：数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会复制到数据卷中（仅数据卷为空时会复制）。</p>\n</blockquote>\n<h3 id="创建一个数据卷"><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8D%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建一个数据卷</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97029067396994660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker volume create my-vol`, `97029067396994660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker volume create my-vol</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>查看所有的数据卷</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68215439387821840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker volume ls\n\nDRIVER              VOLUME NAME\nlocal               my-vol`, `68215439387821840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker volume <span class="token function">ls</span>\n\nDRIVER              VOLUME NAME\n<span class="token builtin class-name">local</span>               my-vol</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在主机里使用以下命令可以查看指定数据卷的信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85520067501946630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker volume inspect my-vol\n[\n    {\n        &quot;Driver&quot;: &quot;local&quot;,\n        &quot;Labels&quot;: {},\n        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/my-vol/_data&quot;,\n        &quot;Name&quot;: &quot;my-vol&quot;,\n        &quot;Options&quot;: {},\n        &quot;Scope&quot;: &quot;local&quot;\n    }\n]`, `85520067501946630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker volume inspect my-vol\n<span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,\n        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,\n        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/my-vol/_data"</span>,\n        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"my-vol"</span>,\n        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,\n        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="启动一个挂载数据卷的容器"><a href="#%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%9A%84%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>启动一个挂载数据卷的容器</h3>\n<p>在用 docker run 命令的时候，使用 <code class="language-text">--mount</code> 标记来将数据卷挂载到容器里。在一次 docker run 中可以挂载多个数据卷。</p>\n<p>下面创建一个名为 web 的容器，并加载一个数据卷到容器的 <code class="language-text">/usr/share/nginx/html</code> 目录。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33804864743090745000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -P \\\n    --name web \\\n    # -v my-vol:/usr/share/nginx/html \\\n    --mount source=my-vol,target=/usr/share/nginx/html \\\n    nginx:alpine`, `33804864743090745000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -P <span class="token punctuation">\\</span>\n    --name web <span class="token punctuation">\\</span>\n    <span class="token comment"># -v my-vol:/usr/share/nginx/html \\</span>\n    --mount <span class="token assign-left variable">source</span><span class="token operator">=</span>my-vol,target<span class="token operator">=</span>/usr/share/nginx/html <span class="token punctuation">\\</span>\n    nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="查看数据卷的具体信息"><a href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%9A%84%E5%85%B7%E4%BD%93%E4%BF%A1%E6%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看数据卷的具体信息</h3>\n<p>在主机里使用以下命令可以查看 web 容器的信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39374134503869415000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker inspect web`, `39374134503869415000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker inspect web</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>数据卷信息在 <code class="language-text">&quot;Mounts&quot; Key</code> 下面</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75681366930572300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;Mounts&quot;: [\n    {\n        &quot;Type&quot;: &quot;volume&quot;,\n        &quot;Name&quot;: &quot;my-vol&quot;,\n        &quot;Source&quot;: &quot;/var/lib/docker/volumes/my-vol/_data&quot;,\n        &quot;Destination&quot;: &quot;/usr/share/nginx/html&quot;,\n        &quot;Driver&quot;: &quot;local&quot;,\n        &quot;Mode&quot;: &quot;&quot;,\n        &quot;RW&quot;: true,\n        &quot;Propagation&quot;: &quot;&quot;\n    }\n],`, `75681366930572300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"Mounts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n        <span class="token property">"Type"</span><span class="token operator">:</span> <span class="token string">"volume"</span><span class="token punctuation">,</span>\n        <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"my-vol"</span><span class="token punctuation">,</span>\n        <span class="token property">"Source"</span><span class="token operator">:</span> <span class="token string">"/var/lib/docker/volumes/my-vol/_data"</span><span class="token punctuation">,</span>\n        <span class="token property">"Destination"</span><span class="token operator">:</span> <span class="token string">"/usr/share/nginx/html"</span><span class="token punctuation">,</span>\n        <span class="token property">"Driver"</span><span class="token operator">:</span> <span class="token string">"local"</span><span class="token punctuation">,</span>\n        <span class="token property">"Mode"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n        <span class="token property">"RW"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        <span class="token property">"Propagation"</span><span class="token operator">:</span> <span class="token string">""</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="删除数据卷"><a href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%8D%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除数据卷</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74403281536522900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker volume rm my-vol`, `74403281536522900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker volume <span class="token function">rm</span> my-vol</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>数据卷是被设计用来持久化数据的，它的生命周期独立于容器，Docker 不会在容器被删除后自动删除数据卷，并且也不存在垃圾回收这样的机制来处理没有任何容器引用的数据卷。如果需要在删除容器的同时移除数据卷。可以在删除容器的时候使用 <code class="language-text">docker rm -v</code> 这个命令。</p>\n<p>无主的数据卷可能会占据很多空间，要清理请使用以下命令</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44557804489285010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker volume prune`, `44557804489285010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker volume prune</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="挂载主机目录"><a href="#%E6%8C%82%E8%BD%BD%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挂载主机目录</h2>\n<h3 id="挂载一个主机目录作为数据卷"><a href="#%E6%8C%82%E8%BD%BD%E4%B8%80%E4%B8%AA%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%8D%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挂载一个主机目录作为数据卷</h3>\n<p>使用 <code class="language-text">--mount</code> 标记可以指定挂载一个本地主机的目录到容器中去。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72570468168302215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -P \\\n    --name web \\\n    # -v /src/webapp:/usr/share/nginx/html \\\n    --mount type=bind,source=/src/webapp,target=/usr/share/nginx/html \\\n    nginx:alpine`, `72570468168302215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -P <span class="token punctuation">\\</span>\n    --name web <span class="token punctuation">\\</span>\n    <span class="token comment"># -v /src/webapp:/usr/share/nginx/html \\</span>\n    --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/src/webapp,target<span class="token operator">=</span>/usr/share/nginx/html <span class="token punctuation">\\</span>\n    nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的命令加载主机的 <code class="language-text">/src/webapp</code> 目录到容器的 <code class="language-text">/usr/share/nginx/html</code> 目录。这个功能在进行测试的时候十分方便，比如用户可以放置一些程序到本地目录中，来查看容器是否正常工作。本地目录的路径必须是绝对路径，以前使用 <code class="language-text">-v</code> 参数时如果本地目录不存在 Docker 会自动为你创建一个文件夹，现在使用 <code class="language-text">--mount</code> 参数时如果本地目录不存在，Docker 会报错。</p>\n<p>Docker 挂载主机目录的默认权限是读写，用户也可以通过增加 readonly 指定为只读。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2210399336955726300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -P \\\n    --name web \\\n    # -v /src/webapp:/usr/share/nginx/html:ro \\\n    --mount type=bind,source=/src/webapp,target=/usr/share/nginx/html,readonly \\\n    nginx:alpine`, `2210399336955726300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -P <span class="token punctuation">\\</span>\n    --name web <span class="token punctuation">\\</span>\n    <span class="token comment"># -v /src/webapp:/usr/share/nginx/html:ro \\</span>\n    --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/src/webapp,target<span class="token operator">=</span>/usr/share/nginx/html,readonly <span class="token punctuation">\\</span>\n    nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>加了 readonly 之后，就挂载为只读了。如果你在容器内 <code class="language-text">/usr/share/nginx/html</code> 目录新建文件，会显示如下错误</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11679781186775063000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/usr/share/nginx/html # touch new.txt\ntouch: new.txt: Read-only file system`, `11679781186775063000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">/usr/share/nginx/html <span class="token comment"># touch new.txt</span>\ntouch: new.txt: Read-only <span class="token function">file</span> system</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="查看数据卷的具体信息-1"><a href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%9A%84%E5%85%B7%E4%BD%93%E4%BF%A1%E6%81%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看数据卷的具体信息</h3>\n<p>在主机里使用以下命令可以查看 web 容器的信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72043480024001495000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker inspect web`, `72043480024001495000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker inspect web</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>挂载主机目录的配置信息在 <code class="language-text">&quot;Mounts&quot; Key</code> 下面</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23918752629566886000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;Mounts&quot;: [\n    {\n        &quot;Type&quot;: &quot;bind&quot;,\n        &quot;Source&quot;: &quot;/src/webapp&quot;,\n        &quot;Destination&quot;: &quot;/usr/share/nginx/html&quot;,\n        &quot;Mode&quot;: &quot;&quot;,\n        &quot;RW&quot;: true,\n        &quot;Propagation&quot;: &quot;rprivate&quot;\n    }\n],`, `23918752629566886000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"Mounts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n        <span class="token property">"Type"</span><span class="token operator">:</span> <span class="token string">"bind"</span><span class="token punctuation">,</span>\n        <span class="token property">"Source"</span><span class="token operator">:</span> <span class="token string">"/src/webapp"</span><span class="token punctuation">,</span>\n        <span class="token property">"Destination"</span><span class="token operator">:</span> <span class="token string">"/usr/share/nginx/html"</span><span class="token punctuation">,</span>\n        <span class="token property">"Mode"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n        <span class="token property">"RW"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        <span class="token property">"Propagation"</span><span class="token operator">:</span> <span class="token string">"rprivate"</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="挂载一个本地主机文件作为数据卷"><a href="#%E6%8C%82%E8%BD%BD%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E4%B8%BB%E6%9C%BA%E6%96%87%E4%BB%B6%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%8D%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挂载一个本地主机文件作为数据卷</h3>\n<p><code class="language-text">--mount</code> 标记也可以从主机挂载单个文件到容器中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81510641790169020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run --rm -it \\\n   # -v \\$HOME/.bash_history:/root/.bash_history \\\n   --mount type=bind,source=\\$HOME/.bash_history,target=/root/.bash_history \\\n   ubuntu:18.04 \\\n   bash\n\nroot@2affd44b4667:/# history\n1  ls\n2  diskutil list`, `81510641790169020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run --rm -it <span class="token punctuation">\\</span>\n   <span class="token comment"># -v $HOME/.bash_history:/root/.bash_history \\</span>\n   --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span><span class="token environment constant">$HOME</span>/.bash_history,target<span class="token operator">=</span>/root/.bash_history <span class="token punctuation">\\</span>\n   ubuntu:18.04 <span class="token punctuation">\\</span>\n   <span class="token function">bash</span>\n\nroot@2affd44b4667:/<span class="token comment"># history</span>\n<span class="token number">1</span>  <span class="token function">ls</span>\n<span class="token number">2</span>  diskutil list</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样就可以记录在容器输入过的命令了。</p>\n<h1 id="网络"><a href="#%E7%BD%91%E7%BB%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>网络</h1>\n<p>Docker 允许通过外部访问容器或容器互联的方式来提供网络服务。</p>\n<h2 id="外部访问容器"><a href="#%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>外部访问容器</h2>\n<p>容器中可以运行一些网络应用，要让外部也可以访问这些应用，可以通过 <code class="language-text">-P</code> 或 <code class="language-text">-p</code> 参数来指定端口映射。</p>\n<p>当使用 <code class="language-text">-P</code> 标记时，Docker 会随机映射一个端口到内部容器开放的网络端口。</p>\n<p>使用 <code class="language-text">docker container ls</code> 可以看到，本地主机的 32768 被映射到了容器的 80 端口。此时访问本机的 32768 端口即可访问容器内 NGINX 默认页面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29235871519077515000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -P nginx:alpine\n\n\\$ docker container ls -l\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES\nfae320d08268        nginx:alpine        &quot;/docker-entrypoint.…&quot;   24 seconds ago      Up 20 seconds       0.0.0.0:32768->80/tcp   bold_mcnulty`, `29235871519077515000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -P nginx:alpine\n\n$ docker container <span class="token function">ls</span> -l\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES\nfae320d08268        nginx:alpine        <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">24</span> seconds ago      Up <span class="token number">20</span> seconds       <span class="token number">0.0</span>.0.0:32768-<span class="token operator">></span><span class="token number">80</span>/tcp   bold_mcnulty</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样的，可以通过 docker logs 命令来查看访问记录。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73760058241564975000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker logs fa\n172.17.0.1 - - [25/Aug/2020:08:34:04 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0&quot; &quot;-&quot;`, `73760058241564975000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker logs fa\n<span class="token number">172.17</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">25</span>/Aug/2020:08:34:04 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">612</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0"</span> <span class="token string">"-"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><code class="language-text">-p</code> 则可以指定要映射的端口，并且，在一个指定端口上只可以绑定一个容器。支持的格式有 <code class="language-text">ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort</code>。</p>\n<h3 id="映射所有接口地址"><a href="#%E6%98%A0%E5%B0%84%E6%89%80%E6%9C%89%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>映射所有接口地址</h3>\n<p>使用 <code class="language-text">hostPort:containerPort</code> 格式本地的 80 端口映射到容器的 80 端口，可以执行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81948752786874040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -p 80:80 nginx:alpine`, `81948752786874040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -p <span class="token number">80</span>:80 nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时默认会绑定本地所有接口上的所有地址。</p>\n<h3 id="映射到指定地址的指定端口"><a href="#%E6%98%A0%E5%B0%84%E5%88%B0%E6%8C%87%E5%AE%9A%E5%9C%B0%E5%9D%80%E7%9A%84%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>映射到指定地址的指定端口</h3>\n<p>可以使用 <code class="language-text">ip:hostPort:containerPort</code> 格式指定映射使用一个特定地址，比如 localhost 地址 127.0.0.1</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55927224023536690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -p 127.0.0.1:80:80 nginx:alpine`, `55927224023536690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -p <span class="token number">127.0</span>.0.1:80:80 nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="映射到指定地址的任意端口"><a href="#%E6%98%A0%E5%B0%84%E5%88%B0%E6%8C%87%E5%AE%9A%E5%9C%B0%E5%9D%80%E7%9A%84%E4%BB%BB%E6%84%8F%E7%AB%AF%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>映射到指定地址的任意端口</h3>\n<p>使用 <code class="language-text">ip::containerPort</code> 绑定 localhost 的任意端口到容器的 80 端口，本地主机会自动分配一个端口。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9142582041202063000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -p 127.0.0.1::80 nginx:alpine`, `9142582041202063000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -p <span class="token number">127.0</span>.0.1::80 nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>还可以使用 udp 标记来指定 udp 端口</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60752035549827220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d -p 127.0.0.1:80:80/udp nginx:alpine`, `60752035549827220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d -p <span class="token number">127.0</span>.0.1:80:80/udp nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="查看映射端口配置"><a href="#%E6%9F%A5%E7%9C%8B%E6%98%A0%E5%B0%84%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看映射端口配置</h3>\n<p>使用 docker port 来查看当前映射的端口配置，也可以查看到绑定的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91869072722766410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker port fa 80\n0.0.0.0:32768`, `91869072722766410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker port fa <span class="token number">80</span>\n<span class="token number">0.0</span>.0.0:32768</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>注意：</p>\n<ul>\n<li>容器有自己的内部网络和 ip 地址（使用 docker inspect 查看，Docker 还可以有一个可变的网络配置。）</li>\n<li><code class="language-text">-p</code> 标记可以多次使用来绑定多个端口</li>\n</ul>\n<p>例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61765376678205320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -d \\\n    -p 80:80 \\\n    -p 443:443 \\\n    nginx:alpine`, `61765376678205320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -d <span class="token punctuation">\\</span>\n    -p <span class="token number">80</span>:80 <span class="token punctuation">\\</span>\n    -p <span class="token number">443</span>:443 <span class="token punctuation">\\</span>\n    nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="容器互联"><a href="#%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器互联</h2>\n<p>如果你之前有 Docker 使用经验，你可能已经习惯了使用 <code class="language-text">--link</code> 参数来使容器互联。</p>\n<p>随着 Docker 网络的完善，强烈建议大家将容器加入自定义的 Docker 网络来连接多个容器，而不是使用 <code class="language-text">--link</code> 参数。</p>\n<h3 id="新建网络"><a href="#%E6%96%B0%E5%BB%BA%E7%BD%91%E7%BB%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新建网络</h3>\n<p>下面先创建一个新的 Docker 网络。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36105327084746830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker network create -d bridge my-net`, `36105327084746830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker network create -d bridge my-net</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><code class="language-text">-d</code> 参数指定 Docker 网络类型，有 bridge、overlay。其中 overlay 网络类型用于 Swarm mode，在本小节中你可以忽略它。</p>\n<h3 id="连接容器"><a href="#%E8%BF%9E%E6%8E%A5%E5%AE%B9%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>连接容器</h3>\n<p>运行一个容器并连接到新建的 my-net 网络</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40922425563146130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -it --rm --name busybox1 --network my-net busybox sh`, `40922425563146130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -it --rm --name busybox1 --network my-net busybox <span class="token function">sh</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>打开新的终端，再运行一个容器并加入到 my-net 网络</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75102752064751200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -it --rm --name busybox2 --network my-net busybox sh`, `75102752064751200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -it --rm --name busybox2 --network my-net busybox <span class="token function">sh</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>再打开一个新的终端查看容器信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91620211765022930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker container ls\n\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nb47060aca56b        busybox             &quot;sh&quot;                11 minutes ago      Up 11 minutes                           busybox2\n8720575823ec        busybox             &quot;sh&quot;                16 minutes ago      Up 16 minutes                           busybox1`, `91620211765022930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker container <span class="token function">ls</span>\n\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nb47060aca56b        busybox             <span class="token string">"sh"</span>                <span class="token number">11</span> minutes ago      Up <span class="token number">11</span> minutes                           busybox2\n8720575823ec        busybox             <span class="token string">"sh"</span>                <span class="token number">16</span> minutes ago      Up <span class="token number">16</span> minutes                           busybox1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面通过 ping 来证明 busybox1 容器和 busybox2 容器建立了互联关系。</p>\n<p>在 busybox1 容器输入以下命令</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27566673313897484000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/ # ping busybox2\nPING busybox2 (172.19.0.3): 56 data bytes\n64 bytes from 172.19.0.3: seq=0 ttl=64 time=0.072 ms\n64 bytes from 172.19.0.3: seq=1 ttl=64 time=0.118 ms`, `27566673313897484000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">/ <span class="token comment"># ping busybox2</span>\nPING busybox2 <span class="token punctuation">(</span><span class="token number">172.19</span>.0.3<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes\n<span class="token number">64</span> bytes from <span class="token number">172.19</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.072</span> ms\n<span class="token number">64</span> bytes from <span class="token number">172.19</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.118</span> ms</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>用 ping 来测试连接 busybox2 容器，它会解析成 172.19.0.3。</p>\n<p>同理在 busybox2 容器执行 ping busybox1，也会成功连接到。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45458520544062850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/ # ping busybox1\nPING busybox1 (172.19.0.2): 56 data bytes\n64 bytes from 172.19.0.2: seq=0 ttl=64 time=0.064 ms\n64 bytes from 172.19.0.2: seq=1 ttl=64 time=0.143 ms`, `45458520544062850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">/ <span class="token comment"># ping busybox1</span>\nPING busybox1 <span class="token punctuation">(</span><span class="token number">172.19</span>.0.2<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes\n<span class="token number">64</span> bytes from <span class="token number">172.19</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.064</span> ms\n<span class="token number">64</span> bytes from <span class="token number">172.19</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.143</span> ms</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样，busybox1 容器和 busybox2 容器建立了互联关系。</p>\n<h3 id="docker-compose"><a href="#docker-compose" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Compose</h3>\n<p>如果你有多个容器之间需要互相连接，推荐使用 Docker Compose。</p>\n<h2 id="配置-dns"><a href="#%E9%85%8D%E7%BD%AE-dns" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置 DNS</h2>\n<p>如何自定义配置容器的主机名和 DNS 呢？秘诀就是 Docker 利用虚拟文件来挂载容器的 3 个相关配置文件。</p>\n<p>在容器中使用 mount 命令可以看到挂载信息：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62491697572617740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ mount\n/dev/disk/by-uuid/1fec...ebdf on /etc/hostname type ext4 ...\n/dev/disk/by-uuid/1fec...ebdf on /etc/hosts type ext4 ...\ntmpfs on /etc/resolv.conf type tmpfs ...`, `62491697572617740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">mount</span>\n/dev/disk/by-uuid/1fec<span class="token punctuation">..</span>.ebdf on /etc/hostname <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">..</span>.\n/dev/disk/by-uuid/1fec<span class="token punctuation">..</span>.ebdf on /etc/hosts <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">..</span>.\ntmpfs on /etc/resolv.conf <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种机制可以让宿主主机 DNS 信息发生更新后，所有 Docker 容器的 DNS 配置通过 <code class="language-text">/etc/resolv.conf</code> 文件立刻得到更新。</p>\n<p>配置全部容器的 DNS，也可以在 <code class="language-text">/etc/docker/daemon.json</code> 文件中增加以下内容来设置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81411881855124230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;dns&quot;: [&quot;114.114.114.114&quot;, &quot;8.8.8.8&quot;]\n}`, `81411881855124230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"dns"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"114.114.114.114"</span><span class="token punctuation">,</span> <span class="token string">"8.8.8.8"</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这样每次启动的容器 DNS 自动配置为 <code class="language-text">114.114.114.114</code> 和 <code class="language-text">8.8.8.8</code>。使用以下命令来证明其已经生效。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10057662019112446000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -it --rm ubuntu:18.04 cat etc/resolv.conf\n\nnameserver 114.114.114.114\nnameserver 8.8.8.8`, `10057662019112446000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -it --rm ubuntu:18.04 <span class="token function">cat</span> etc/resolv.conf\n\nnameserver <span class="token number">114.114</span>.114.114\nnameserver <span class="token number">8.8</span>.8.8</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果用户想要手动指定容器的配置，可以在使用 docker run 命令启动容器时加入如下参数：</p>\n<p><code class="language-text">-h HOSTNAME</code> 或者 <code class="language-text">--hostname=HOSTNAME</code> 设定容器的主机名，它会被写到容器内的 <code class="language-text">/etc/hostname</code> 和 <code class="language-text">/etc/hosts</code>。但它在容器外部看不到，既不会在 <code class="language-text">docker container ls</code> 中显示，也不会在其他的容器的 <code class="language-text">/etc/hosts</code> 看到。</p>\n<p><code class="language-text">--dns=IP_ADDRESS</code> 添加 DNS 服务器到容器的 <code class="language-text">/etc/resolv.conf</code> 中，让容器用这个服务器来解析所有不在 <code class="language-text">/etc/hosts</code> 中的主机名。</p>\n<p><code class="language-text">--dns-search=DOMAIN</code> 设定容器的搜索域，当设定搜索域为 <code class="language-text">.example.com</code> 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 <code class="language-text">host.example.com</code>。</p>\n<p>注意：如果在容器启动时没有指定最后两个参数，Docker 会默认用主机上的 <code class="language-text">/etc/resolv.conf</code> 来配置容器。</p>\n<h1 id="高级网络配置"><a href="#%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>高级网络配置</h1>\n<p>本章将介绍 Docker 的一些高级网络配置和选项。</p>\n<p>当 Docker 启动时，会自动在主机上创建一个 docker0 虚拟网桥，实际上是 Linux 的一个 bridge，可以理解为一个软件交换机。它会在挂载到它的网口之间进行转发。</p>\n<p>同时，Docker 随机分配一个本地未占用的私有网段（在 RFC1918 中定义）中的一个地址给 docker0 接口。比如典型的 <code class="language-text">172.17.42.1</code>，掩码为 <code class="language-text">255.255.0.0</code>。此后启动的容器内的网口也会自动分配一个同一网段（172.17.0.0/16）的地址。</p>\n<p>当创建一个 Docker 容器的时候，同时会创建了一对 <code class="language-text">veth pair</code> 接口（当数据包发送到一个接口时，另外一个接口也可以收到相同的数据包）。这对接口一端在容器内，即 eth0；另一端在本地并被挂载到 docker0 网桥，名称以 veth 开头（例如 vethAQI2QT）。通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。Docker 就创建了在主机和所有容器之间一个虚拟共享网络。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-b7caf.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 63.76172090457805%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACy0lEQVQ4y11S23LTSBDNxy9P1L5AQZEAtS8LVCULVSSYwFLEsnwhbIiDHfkSsr7EsS4jjXX1SJbj9KGVBCrwcKp7WqfPnOnWWqrCvkpmMh4eOPPhvpgP9kU8/E/MI0+kKhKWeyImTktMhSHO7JbwA0vkWSwmliPap6YwBqZocZzaQmQqtNe4KbhYREgbT7HUH2BZfYj80xPwNyzzFN+mOg4HL3E02ub4CmI2ACjH4YmJZx+H2KyM8XxvhNaphUJnTanIy5UPd2/jsv/yDnW2/qBZeZ0S36QsTag70qikr9MbbZ3Kh3+TIwd0uVT0pTehR//UaWPzA62/2id2SXkarAqHMlMzKG2DpHEXovsn0sojhPIcaRrDGGmMJxhP7mG/vwlTfANdKHw6NrFV/oLR2X1saS066EyxzK4EQ5mlIeJhk2ZmA+K8hmTURBK6UPMQtvs/pvYBbLuOc6cD37fAM8SZ6eBkNIZt6egNz2hqu8gUC6p5IPNFgny1oDgOIT0Xy1WORRYhY6yWKZIogOcKzjMsFjEKAxd5jMtlAuE4nEd0wTlrXTtU8wi+NyUp/4LnPcbMHcNloutYkCwUBNsIo4eIwi4EO/GEyVEiDHWY1l1I2aCZ5yNV/mptsYikawvopa/UO3qPfmsX1d0jaDttVN60r2L13x3UtWfQSjVUdgyuf0V520CzXsNpZwefyzU60Pv8opAFs0h6jkCl1KLydhcF9FIb+tsbcF7be46adg/V91XUdnuovTvmS4vLDOb3sff6mJqN7rVg8WQGP88mT1gowPkNLPjSQxx9RJK8gDU9QtfoodNuYTIe8TicG75FvuQl3l4KO6ViEb8ihj9zEPgewoD/VZ5dHEkefjGv8Db3qvfnUopGPhADt1E0Gcc8z/IHNA8/o1Gv8DLOWSDBb1wquFeCbPNaUF0Xb6MgZ2n0U7zIf9R/1H4X/A5Lt609X+QIKgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 18 14 38 31" title="" data-src="/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-fee1c.png" data-srcset="/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-a67b7.png 200w,\n/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-0b187.png 400w,\n/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-fee1c.png 800w,\n/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-b1a91.png 1200w,\n/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-95179.png 1600w,\n/static/2022-07-18-14-38-31-406d237313be1836c53fa30dee8bd076-b7caf.png 1813w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>接下来的部分将介绍在一些场景中，Docker 所有的网络定制配置。以及通过 Linux 命令来调整、补充、甚至替换 Docker 默认的网络配置。</p>\n<h2 id="快速配置指南"><a href="#%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>快速配置指南</h2>\n<p>下面是一个跟 Docker 网络相关的命令列表。</p>\n<p>其中有些命令选项只有在 Docker 服务启动的时候才能配置，而且不能马上生效。</p>\n<ul>\n<li><code class="language-text">-b BRIDGE</code> 或 <code class="language-text">--bridge=BRIDGE</code> 指定容器挂载的网桥</li>\n<li><code class="language-text">--bip=CIDR</code> 定制 docker0 的掩码</li>\n<li><code class="language-text">-H SOCKET...</code> 或 <code class="language-text">--host=SOCKET... Docker</code> 服务端接收命令的通道</li>\n<li><code class="language-text">--icc=true|false</code> 是否支持容器之间进行通信</li>\n<li><code class="language-text">--ip-forward=true|false</code> 请看下文容器之间的通信</li>\n<li><code class="language-text">--iptables=true|false</code> 是否允许 Docker 添加 iptables 规则</li>\n<li><code class="language-text">--mtu=BYTES</code> 容器网络中的 MTU</li>\n</ul>\n<p>下面 2 个命令选项既可以在启动服务时指定，也可以在启动容器时指定。在 Docker 服务启动的时候指定则会成为默认值，后面执行 docker run 时可以覆盖设置的默认值。</p>\n<ul>\n<li><code class="language-text">--dns=IP_ADDRESS...</code> 使用指定的 DNS 服务器</li>\n<li><code class="language-text">--dns-search=DOMAIN...</code> 指定 DNS 搜索域</li>\n</ul>\n<p>最后这些选项只有在 docker run 执行时使用，因为它是针对容器的特性内容。</p>\n<ul>\n<li><code class="language-text">-h HOSTNAME</code> 或 <code class="language-text">--hostname=HOSTNAME</code> 配置容器主机名</li>\n<li><code class="language-text">--link=CONTAINER_NAME:ALIAS</code> 添加到另一个容器的连接</li>\n<li><code class="language-text">--net=bridge|none|container:NAME_or_ID|host</code> 配置容器的桥接模式</li>\n<li><code class="language-text">-p SPEC</code> 或 <code class="language-text">--publish=SPEC</code> 映射容器端口到宿主主机</li>\n<li><code class="language-text">-P</code> 或 <code class="language-text">--publish-all=true|false</code> 映射容器所有端口到宿主主机</li>\n</ul>\n<h2 id="容器访问控制"><a href="#%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器访问控制</h2>\n<p>容器的访问控制，主要通过 Linux 上的 iptables 防火墙来进行管理和实现。iptables 是 Linux 上默认的防火墙软件，在大部分发行版中都自带。</p>\n<h3 id="容器访问外部网络"><a href="#%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器访问外部网络</h3>\n<p>容器要想访问外部网络，需要本地系统的转发支持。在 Linux 系统中，检查转发是否打开。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47504212561822000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$sysctl net.ipv4.ip_forward\nnet.ipv4.ip_forward = 1`, `47504212561822000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token variable">$sysctl</span> net.ipv4.ip_forward\nnet.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果为 0，说明没有开启转发，则需要手动打开。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57039912677702970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$sysctl -w net.ipv4.ip_forward=1`, `57039912677702970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token variable">$sysctl</span> -w net.ipv4.ip_forward<span class="token operator">=</span><span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果在启动 Docker 服务的时候设定 <code class="language-text">--ip-forward=true</code>, Docker 就会自动设定系统的 <code class="language-text">ip_forward</code> 参数为 1。</p>\n<h3 id="容器之间访问"><a href="#%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E8%AE%BF%E9%97%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器之间访问</h3>\n<p>容器之间相互访问，需要两方面的支持。</p>\n<ol>\n<li>容器的网络拓扑是否已经互联。默认情况下，所有容器都会被连接到 docker0 网桥上。</li>\n<li>本地系统的防火墙软件 <code class="language-text">iptables</code> 是否允许通过。</li>\n</ol>\n<h4 id="访问所有端口"><a href="#%E8%AE%BF%E9%97%AE%E6%89%80%E6%9C%89%E7%AB%AF%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>访问所有端口</h4>\n<p>当启动 Docker 服务（即 dockerd）的时候，默认会添加一条转发策略到本地主机 iptables 的 FORWARD 链上。策略为通过（ACCEPT）还是禁止（DROP）取决于配置<code class="language-text">--icc=true</code>（缺省值）还是 <code class="language-text">--icc=false</code>。当然，如果手动指定 <code class="language-text">--iptables=false</code> 则不会添加 iptables 规则。</p>\n<p>可见，默认情况下，不同容器之间是允许网络互通的。如果为了安全考虑，可以在 <code class="language-text">/etc/docker/daemon.json</code> 文件中配置 <code class="language-text">{&quot;icc&quot;: false}</code> 来禁止它。</p>\n<h4 id="访问指定端口"><a href="#%E8%AE%BF%E9%97%AE%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>访问指定端口</h4>\n<p>在通过 <code class="language-text">--icc=false</code> 关闭网络访问后，还可以通过 <code class="language-text">--link=CONTAINER_NAME:ALIAS</code> 选项来访问容器的开放端口。</p>\n<p>例如，在启动 Docker 服务时，可以同时使用 <code class="language-text">--icc=false --iptables=true</code> 参数来关闭允许相互的网络访问，并让 Docker 可以修改系统中的 iptables 规则。</p>\n<p>此时，系统中的 iptables 规则可能是类似</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64498007998140270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo iptables -nL\n...\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n...`, `64498007998140270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> iptables -nL\n<span class="token punctuation">..</span>.\nChain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>\ntarget     prot opt <span class="token builtin class-name">source</span>               destination\nDROP       all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0\n<span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>之后，启动容器（docker run）时使用 <code class="language-text">--link=CONTAINER_NAME:ALIAS</code> 选项。Docker 会在 iptable 中为两个容器分别添加一条 ACCEPT 规则，允许相互访问开放的端口（取决于 Dockerfile 中的 EXPOSE 指令）。</p>\n<p>当添加了 <code class="language-text">--link=CONTAINER_NAME:ALIAS</code> 选项后，添加了 iptables 规则。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92453224520448800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo iptables -nL\n...\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\nACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:80\nACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:80\nDROP       all  --  0.0.0.0/0            0.0.0.0/0`, `92453224520448800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> iptables -nL\n<span class="token punctuation">..</span>.\nChain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>\ntarget     prot opt <span class="token builtin class-name">source</span>               destination\nACCEPT     tcp  --  <span class="token number">172.17</span>.0.2           <span class="token number">172.17</span>.0.3           tcp spt:80\nACCEPT     tcp  --  <span class="token number">172.17</span>.0.3           <span class="token number">172.17</span>.0.2           tcp dpt:80\nDROP       all  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意：<code class="language-text">--link=CONTAINER_NAME:ALIAS</code> 中的 CONTAINER_NAME 目前必须是 Docker 分配的名字，或使用 <code class="language-text">--name</code> 参数指定的名字。主机名则不会被识别。</p>\n<h2 id="映射容器端口到宿主主机的实现"><a href="#%E6%98%A0%E5%B0%84%E5%AE%B9%E5%99%A8%E7%AB%AF%E5%8F%A3%E5%88%B0%E5%AE%BF%E4%B8%BB%E4%B8%BB%E6%9C%BA%E7%9A%84%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>映射容器端口到宿主主机的实现</h2>\n<p>默认情况下，容器可以主动访问到外部网络的连接，但是外部网络无法访问到容器。</p>\n<h3 id="容器访问外部实现"><a href="#%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器访问外部实现</h3>\n<p>容器所有到外部网络的连接，源地址都会被 NAT 成本地系统的 IP 地址。这是使用 iptables 的源地址伪装操作实现的。</p>\n<p>查看主机的 NAT 规则。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5177784993542333000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo iptables -t nat -nL\n...\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination\nMASQUERADE  all  --  172.17.0.0/16       !172.17.0.0/16\n...`, `5177784993542333000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> iptables -t nat -nL\n<span class="token punctuation">..</span>.\nChain POSTROUTING <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>\ntarget     prot opt <span class="token builtin class-name">source</span>               destination\nMASQUERADE  all  --  <span class="token number">172.17</span>.0.0/16       <span class="token operator">!</span><span class="token number">172.17</span>.0.0/16\n<span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，上述规则将所有源地址在 <code class="language-text">172.17.0.0/16</code> 网段，目标地址为其他网段（外部网络）的流量动态伪装为从系统网卡发出。MASQUERADE 跟传统 SNAT 的好处是它能动态从网卡获取地址。</p>\n<h3 id="外部访问容器实现"><a href="#%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>外部访问容器实现</h3>\n<p>容器允许外部访问，可以在 docker run 时候通过 -p 或 -P 参数来启用。</p>\n<p>不管用那种办法，其实也是在本地的 iptable 的 nat 表中添加相应的规则。</p>\n<p>使用 -P 时：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63402344018595725000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ iptables -t nat -nL\n...\nChain DOCKER (2 references)\ntarget     prot opt source               destination\nDNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:49153 to:172.17.0.2:80`, `63402344018595725000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ iptables -t nat -nL\n<span class="token punctuation">..</span>.\nChain DOCKER <span class="token punctuation">(</span><span class="token number">2</span> references<span class="token punctuation">)</span>\ntarget     prot opt <span class="token builtin class-name">source</span>               destination\nDNAT       tcp  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            tcp dpt:49153 to:172.17.0.2:80</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 -p 80:80 时：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4107636134801517600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ iptables -t nat -nL\nChain DOCKER (2 references)\ntarget     prot opt source               destination\nDNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:172.17.0.2:80`, `4107636134801517600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ iptables -t nat -nL\nChain DOCKER <span class="token punctuation">(</span><span class="token number">2</span> references<span class="token punctuation">)</span>\ntarget     prot opt <span class="token builtin class-name">source</span>               destination\nDNAT       tcp  --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            tcp dpt:80 to:172.17.0.2:80</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意：</p>\n<ul>\n<li>\n<p>这里的规则映射了 <code class="language-text">0.0.0.0</code>，意味着将接受主机来自所有接口的流量。用户可以通过 <code class="language-text">-p IP:host_port:container_port</code> 或 <code class="language-text">-p IP::port</code> 来指定允许访问容器的主机上的 IP、接口等，以制定更严格的规则。</p>\n</li>\n<li>\n<p>如果希望永久绑定到某个固定的 IP 地址，可以在 Docker 配置文件 <code class="language-text">/etc/docker/daemon.json</code> 中添加如下内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58384385305505560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n&quot;ip&quot;: &quot;0.0.0.0&quot;\n}`, `58384385305505560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n<span class="token property">"ip"</span><span class="token operator">:</span> <span class="token string">"0.0.0.0"</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h2 id="自定义网桥"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E6%A1%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义网桥</h2>\n<p>除了默认的 docker0 网桥，用户也可以指定网桥来连接各个容器。</p>\n<p>在启动 Docker 服务的时候，使用 <code class="language-text">-b BRIDGE</code> 或 <code class="language-text">--bridge=BRIDGE</code> 来指定使用的网桥。</p>\n<p>如果服务已经运行，那需要先停止服务，并删除旧的网桥。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47171568446387370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo systemctl stop docker\n\\$ sudo ip link set dev docker0 down\n\\$ sudo brctl delbr docker0`, `47171568446387370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> systemctl stop docker\n$ <span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev docker0 down\n$ <span class="token function">sudo</span> brctl delbr docker0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后创建一个网桥 bridge0。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38733214157222110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo brctl addbr bridge0\n\\$ sudo ip addr add 192.168.5.1/24 dev bridge0\n\\$ sudo ip link set dev bridge0 up`, `38733214157222110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> brctl addbr bridge0\n$ <span class="token function">sudo</span> <span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">192.168</span>.5.1/24 dev bridge0\n$ <span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev bridge0 up</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>查看确认网桥创建并启动。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63742658820587140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ ip addr show bridge0\n4: bridge0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state UP group default\n    link/ether 66:38:d0:0d:76:18 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.5.1/24 scope global bridge0\n       valid_lft forever preferred_lft forever`, `63742658820587140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">ip</span> addr show bridge0\n<span class="token number">4</span>: bridge0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noop state UP group default\n    link/ether <span class="token number">66</span>:38:d0:0d:76:18 brd ff:ff:ff:ff:ff:ff\n    inet <span class="token number">192.168</span>.5.1/24 scope global bridge0\n       valid_lft forever preferred_lft forever</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Docker 配置文件 <code class="language-text">/etc/docker/daemon.json</code> 中添加如下内容，即可将 Docker 默认桥接到创建的网桥上。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41798604765248130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;bridge&quot;: &quot;bridge0&quot;\n}`, `41798604765248130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"bridge"</span><span class="token operator">:</span> <span class="token string">"bridge0"</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>启动 Docker 服务。</p>\n<p>新建一个容器，可以看到它已经桥接到了 bridge0 上。</p>\n<p>可以继续用 brctl show 命令查看桥接的信息。另外，在容器中可以使用 ip addr 和 ip route 命令来查看 IP 地址配置和路由信息。</p>\n<h2 id="工具和示例"><a href="#%E5%B7%A5%E5%85%B7%E5%92%8C%E7%A4%BA%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工具和示例</h2>\n<p>在介绍自定义网络拓扑之前，你可能会对一些外部工具和例子感兴趣：</p>\n<h3 id="pipework"><a href="#pipework" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pipework</h3>\n<p>Jérôme Petazzoni 编写了一个叫 <a href="https://github.com/jpetazzo/pipework" target="_blank" rel="nofollow noreferrer noopener">pipework</a> 的 shell 脚本，可以帮助用户在比较复杂的场景中完成容器的连接。</p>\n<h3 id="playground"><a href="#playground" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>playground</h3>\n<p>Brandon Rhodes 创建了一个提供完整的 Docker 容器网络拓扑管理的 <a href="https://github.com/brandon-rhodes/fopnp/tree/m/playground" target="_blank" rel="nofollow noreferrer noopener">Python 库</a>，包括路由、NAT 防火墙；以及一些提供 HTTP SMTP POP IMAP Telnet SSH FTP 的服务器。</p>\n<h2 id="编辑网络配置文件"><a href="#%E7%BC%96%E8%BE%91%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑网络配置文件</h2>\n<p>Docker 1.2.0 开始支持在运行中的容器里编辑 <code class="language-text">/etc/hosts</code>, <code class="language-text">/etc/hostname</code> 和 <code class="language-text">/etc/resolv.conf</code> 文件。</p>\n<p>但是这些修改是临时的，只在运行的容器中保留，容器终止或重启后并不会被保存下来，也不会被 <code class="language-text">docker commit</code> 提交。</p>\n<h2 id="示例：创建一个点到点连接"><a href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%82%B9%E5%88%B0%E7%82%B9%E8%BF%9E%E6%8E%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例：创建一个点到点连接</h2>\n<p>默认情况下，Docker 会将所有容器连接到由 docker0 提供的虚拟子网中。</p>\n<p>用户有时候需要两个容器之间可以直连通信，而不用通过主机网桥进行桥接。</p>\n<p>解决办法很简单：创建一对 peer 接口，分别放到两个容器中，配置成点到点链路类型即可。</p>\n<p>首先启动 2 个容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32233684083521540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run -i -t --rm --net=none base /bin/bash\nroot@1f1f4c1f931a:/#\n\\$ docker run -i -t --rm --net=none base /bin/bash\nroot@12e343489d2f:/#`, `32233684083521540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run -i -t --rm --net<span class="token operator">=</span>none base /bin/bash\nroot@1f1f4c1f931a:/<span class="token comment">#</span>\n$ docker run -i -t --rm --net<span class="token operator">=</span>none base /bin/bash\nroot@12e343489d2f:/<span class="token comment">#</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>找到进程号，然后创建网络命名空间的跟踪文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95643233686255730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker inspect -f \'{{.State.Pid}}\' 1f1f4c1f931a\n2989\n\\$ docker inspect -f \'{{.State.Pid}}\' 12e343489d2f\n3004\n\\$ sudo mkdir -p /var/run/netns\n\\$ sudo ln -s /proc/2989/ns/net /var/run/netns/2989\n\\$ sudo ln -s /proc/3004/ns/net /var/run/netns/3004`, `95643233686255730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker inspect -f <span class="token string">\'{{.State.Pid}}\'</span> 1f1f4c1f931a\n<span class="token number">2989</span>\n$ docker inspect -f <span class="token string">\'{{.State.Pid}}\'</span> 12e343489d2f\n<span class="token number">3004</span>\n$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p /var/run/netns\n$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /proc/2989/ns/net /var/run/netns/2989\n$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /proc/3004/ns/net /var/run/netns/3004</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>创建一对 peer 接口，然后配置路由</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4562638229961901600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo ip link add A type veth peer name B\n\n\\$ sudo ip link set A netns 2989\n\\$ sudo ip netns exec 2989 ip addr add 10.1.1.1/32 dev A\n\\$ sudo ip netns exec 2989 ip link set A up\n\\$ sudo ip netns exec 2989 ip route add 10.1.1.2/32 dev A\n\n\\$ sudo ip link set B netns 3004\n\\$ sudo ip netns exec 3004 ip addr add 10.1.1.2/32 dev B\n\\$ sudo ip netns exec 3004 ip link set B up\n\\$ sudo ip netns exec 3004 ip route add 10.1.1.1/32 dev B`, `4562638229961901600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> A <span class="token builtin class-name">type</span> veth peer name B\n\n$ <span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> A netns <span class="token number">2989</span>\n$ <span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> <span class="token number">2989</span> <span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">10.1</span>.1.1/32 dev A\n$ <span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> <span class="token number">2989</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> A up\n$ <span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> <span class="token number">2989</span> <span class="token function">ip</span> route <span class="token function">add</span> <span class="token number">10.1</span>.1.2/32 dev A\n\n$ <span class="token function">sudo</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> B netns <span class="token number">3004</span>\n$ <span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> <span class="token number">3004</span> <span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">10.1</span>.1.2/32 dev B\n$ <span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> <span class="token number">3004</span> <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> B up\n$ <span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> <span class="token number">3004</span> <span class="token function">ip</span> route <span class="token function">add</span> <span class="token number">10.1</span>.1.1/32 dev B</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在这 2 个容器就可以相互 ping 通，并成功建立连接。点到点链路不需要子网和子网掩码。</p>\n<p>此外，也可以不指定 <code class="language-text">--net=none</code> 来创建点到点链路。这样容器还可以通过原先的网络来通信。</p>\n<p>利用类似的办法，可以创建一个只跟主机通信的容器。但是一般情况下，更推荐使用 <code class="language-text">--icc=false</code> 来关闭容器之间的通信。</p>\n<h1 id="swarm-mode"><a href="#swarm-mode" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Swarm mode</h1>\n<p>Docker 1.12 <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="nofollow noreferrer noopener">Swarm mode</a> 已经内嵌入 Docker 引擎，成为了 docker 子命令 docker swarm。请注意与旧的 Docker Swarm 区分开来。</p>\n<p>Swarm mode 内置 kv 存储功能，提供了众多的新特性，比如：具有容错能力的去中心化设计、内置服务发现、负载均衡、路由网格、动态伸缩、滚动更新、安全传输等。使得 Docker 原生的 Swarm 集群具备与 Mesos、Kubernetes 竞争的实力。</p>\n<h2 id="基本概念-1"><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本概念</h2>\n<p>Swarm 是使用 <a href="https://github.com/docker/swarmkit/" target="_blank" rel="nofollow noreferrer noopener">SwarmKit</a> 构建的 Docker 引擎内置（原生）的集群管理和编排工具。</p>\n<p>使用 Swarm 集群之前需要了解以下几个概念。</p>\n<h3 id="节点"><a href="#%E8%8A%82%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节点</h3>\n<p>运行 Docker 的主机可以主动初始化一个 Swarm 集群或者加入一个已存在的 Swarm 集群，这样这个运行 Docker 的主机就成为一个 Swarm 集群的节点 (node) 。</p>\n<p>节点分为管理 (manager) 节点和工作 (worker) 节点。</p>\n<p>管理节点用于 Swarm 集群的管理，docker swarm 命令基本只能在管理节点执行（节点退出集群命令 <code class="language-text">docker swarm leave</code> 可以在工作节点执行）。一个 Swarm 集群可以有多个管理节点，但只有一个管理节点可以成为 leader，leader 通过 <a href="https://thesecretlivesofdata.com/raft/" target="_blank" rel="nofollow noreferrer noopener">raft 协议</a>实现。</p>\n<p>工作节点是任务执行节点，管理节点将服务 (service) 下发至工作节点执行。管理节点默认也作为工作节点。你也可以通过配置让服务只运行在管理节点。</p>\n<p>来自 Docker 官网的这张图片形象的展示了集群中管理节点与工作节点的关系。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-19-11-16-29-db0a7eee4e4ce292445a5148537ae9ac-d1d8a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.893123446561724%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABmUlEQVQoz22PWU/bQBSF8///QougahRE+1CQKgQq0DYtSI2VhpSgxCFexmPH+9iexZ7FS90AD7Q9Ojq69+HTuXfQ7dR2HVEt4s2jc9n1Lh5TdRHldpyDpIAJTih/Qtp20D0rKOtpJLRYTkJxZaSXm/ji4Y8/m2io2ad6fO2xW594RDbtP3BcNdOQj91SC/jUZ9cQX1r5jUt+BmwM8FfItEjYtEl4W+/oF3BUNd8hOV+4exPn7QJ9Afhi5b+eOG/u0m+QflpuX/0AV4BkslV/we2ueRFXmh0Nb/0TPbWwmm+Lw1/BxzWysJy52WgenBo5kv9rZqImlapk3XRdnwlmlWq4ajDjOeP9o3XbUV7z5hno4URKm1CAscvYA8piJWDJbFyEguspAkVhZLlXMq+k/RCKysxzWJaoVkjKwbwojgxjf+UcO95obQwN/wSA/aX9wfFH682hGbwzreEaHNn+e8M40N1jAA+WmzOYBoIPQiE8KeaIWiUHFZ+lxJfiPmc6Lj0hZil1hVgV7D6jgZL9ahI6dYOxue2P+g2C3u29d5l6SwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 19 11 16 29" title="" data-src="/static/2022-07-19-11-16-29-db0a7eee4e4ce292445a5148537ae9ac-fee1c.png" data-srcset="/static/2022-07-19-11-16-29-db0a7eee4e4ce292445a5148537ae9ac-a67b7.png 200w,\n/static/2022-07-19-11-16-29-db0a7eee4e4ce292445a5148537ae9ac-0b187.png 400w,\n/static/2022-07-19-11-16-29-db0a7eee4e4ce292445a5148537ae9ac-fee1c.png 800w,\n/static/2022-07-19-11-16-29-db0a7eee4e4ce292445a5148537ae9ac-b1a91.png 1200w,\n/static/2022-07-19-11-16-29-db0a7eee4e4ce292445a5148537ae9ac-d1d8a.png 1207w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="服务和任务"><a href="#%E6%9C%8D%E5%8A%A1%E5%92%8C%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>服务和任务</h3>\n<p>任务（Task）是 Swarm 中的最小的调度单位，目前来说就是一个单一的容器。</p>\n<p>服务（Services）是指一组任务的集合，服务定义了任务的属性。服务有两种模式：</p>\n<ol>\n<li><code class="language-text">replicated services</code> 按照一定规则在各个工作节点上运行指定个数的任务。</li>\n<li><code class="language-text">global services</code> 每个工作节点上运行一个任务</li>\n</ol>\n<p>两种模式通过 <code class="language-text">docker service create</code> 的 <code class="language-text">--mode</code> 参数指定。</p>\n<p>来自 Docker 官网的这张图片形象的展示了容器、任务、服务的关系。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-19-11-16-53-f4c415047158c2dd2c692b7057088a9b-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACF0lEQVQoz4VS227bMAzN/3/JHnfBuqJb16xp2mQN2mRYk665+iZbN9uKJcuWZGWyvZcBQ0cQgiTygDw8HJxeN2uXqw2mqbsCAFfP2+WvLeeijZxOg1eAjbXPnE8gekyzOWNTQsYRmGI8JiSW8tSDbZcnSlmIUmltux9nldLnfvBuvfscgRFjS4R9kLj6wzh+4bwF2y7RGLP3o5edl7FjX9OdR1FeRuArwjdpepPntwgvKF0Qeh7H2x5cmwYKRaRJeA1YRav2KVQja1UppWxTNQ1mxXLnraPYeaFUaYxumhbMVTMM5G2irsPS+QTpy0BGx0pr7cKZUlRrUtdJWfqce0IEUkZSii464LW5R2qO6/cPmzfjn3d+PiMGFLUj4tp2bM/C6CJOrtJ0CuETRKsEnQOwLrq2XdoEqhmUH+b7tw+7sccmuAU3xjAhLkF84YfXEM3KckXTgKY+It8gXPOiBTt6s6R6xMr5nGjXwndYJUWtu7HvhViX4inLbg7+2A/vQrA6skWW0arqBqabUttDQlYHsAnhj42fclk3VsiWtpu687KqEE1xzmDGKmOcFr2Wgz7811K1Up16qUYQDQkZUTpm+Qjje0qmCH0CYN9L9e+l7E5Z12cH7+N2/yUEE843hCKICcRjiF5eAfdmrF0wNsvzmeOM0DWIJxA+pOkQoaAs/wNu+3dmbX7kay/wYniIoeNs7J8N/g1ZjhJSNTR2XQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 19 11 16 53" title="" data-src="/static/2022-07-19-11-16-53-f4c415047158c2dd2c692b7057088a9b-fee1c.png" data-srcset="/static/2022-07-19-11-16-53-f4c415047158c2dd2c692b7057088a9b-a67b7.png 200w,\n/static/2022-07-19-11-16-53-f4c415047158c2dd2c692b7057088a9b-0b187.png 400w,\n/static/2022-07-19-11-16-53-f4c415047158c2dd2c692b7057088a9b-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="创建-swarm-集群"><a href="#%E5%88%9B%E5%BB%BA-swarm-%E9%9B%86%E7%BE%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 Swarm 集群</h2>\n<p>Swarm 集群由管理节点和工作节点组成，本节我们来创建一个包含一个管理节点和两个工作节点的最小 Swarm 集群。</p>\n<h3 id="初始化集群"><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>初始化集群</h3>\n<p>在已经安装好 Docker 的主机上执行如下命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38422079650685360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker swarm init --advertise-addr 192.168.99.100\nSwarm initialized: current node (dxn1zf6l61qsb1josjja83ngz) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \\\n    192.168.99.100:2377\n\nTo add a manager to this swarm, run \'docker swarm join-token manager\' and follow the instructions.`, `38422079650685360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker swarm init --advertise-addr <span class="token number">192.168</span>.99.100\nSwarm initialized: current node <span class="token punctuation">(</span>dxn1zf6l61qsb1josjja83ngz<span class="token punctuation">)</span> is now a manager.\n\nTo <span class="token function">add</span> a worker to this swarm, run the following command:\n\n    docker swarm <span class="token function">join</span> <span class="token punctuation">\\</span>\n    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c <span class="token punctuation">\\</span>\n    <span class="token number">192.168</span>.99.100:2377\n\nTo <span class="token function">add</span> a manager to this swarm, run <span class="token string">\'docker swarm join-token manager\'</span> and follow the instructions.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你的 Docker 主机有多个网卡，拥有多个 IP，必须使用 <code class="language-text">--advertise-addr</code> 指定 IP。</p>\n<blockquote>\n<p>执行 <code class="language-text">docker swarm init</code> 命令的节点自动成为管理节点。</p>\n</blockquote>\n<h3 id="增加工作节点"><a href="#%E5%A2%9E%E5%8A%A0%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增加工作节点</h3>\n<p>上一步我们初始化了一个 Swarm 集群，拥有了一个管理节点，下面我们继续在两个 Docker 主机中分别执行如下命令，创建工作节点并加入到集群中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17538996509273730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker swarm join \\\n    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \\\n    192.168.99.100:2377\n\nThis node joined a swarm as a worker.`, `17538996509273730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker swarm <span class="token function">join</span> <span class="token punctuation">\\</span>\n    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c <span class="token punctuation">\\</span>\n    <span class="token number">192.168</span>.99.100:2377\n\nThis node joined a swarm as a worker.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="查看集群"><a href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看集群</h3>\n<p>经过上边的两步，我们已经拥有了一个最小的 Swarm 集群，包含一个管理节点和两个工作节点。</p>\n<p>在管理节点使用 <code class="language-text">docker node ls</code> 查看集群。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42004282660044950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker node ls\nID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS\n03g1y59jwfg7cf99w4lt0f662    worker2   Ready   Active\n9j68exjopxe7wfl6yuxml7a7j    worker1   Ready   Active\ndxn1zf6l61qsb1josjja83ngz *  manager   Ready   Active        Leader`, `42004282660044950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker node <span class="token function">ls</span>\nID                           <span class="token environment constant">HOSTNAME</span>  STATUS  AVAILABILITY  MANAGER STATUS\n03g1y59jwfg7cf99w4lt0f662    worker2   Ready   Active\n9j68exjopxe7wfl6yuxml7a7j    worker1   Ready   Active\ndxn1zf6l61qsb1josjja83ngz *  manager   Ready   Active        Leader</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="部署服务"><a href="#%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署服务</h2>\n<p>我们使用 docker service 命令来管理 Swarm 集群中的服务，该命令只能在管理节点运行。</p>\n<h3 id="新建服务"><a href="#%E6%96%B0%E5%BB%BA%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新建服务</h3>\n<p>现在我们在上一节创建的 Swarm 集群中运行一个名为 nginx 服务。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59745578128551460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service create --replicas 3 -p 80:80 --name nginx nginx:1.13.7-alpine`, `59745578128551460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> create --replicas <span class="token number">3</span> -p <span class="token number">80</span>:80 --name nginx nginx:1.13.7-alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们使用浏览器，输入任意节点 IP（即 <code class="language-text">192.168.99.100:80</code>），即可看到 nginx 默认页面。</p>\n<h3 id="查看服务"><a href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看服务</h3>\n<p>使用 <code class="language-text">docker service ls</code> 来查看当前 Swarm 集群运行的服务。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21400927403129377000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE                 PORTS\nkc57xffvhul5        nginx               replicated          3/3                 nginx:1.13.7-alpine   *:80->80/tcp`, `21400927403129377000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> <span class="token function">ls</span>\nID                  NAME                MODE                REPLICAS            IMAGE                 PORTS\nkc57xffvhul5        nginx               replicated          <span class="token number">3</span>/3                 nginx:1.13.7-alpine   *:80-<span class="token operator">></span><span class="token number">80</span>/tcp</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>使用 <code class="language-text">docker service ps</code> 来查看某个服务的详情。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43882342385482146000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service ps nginx\nID                  NAME                IMAGE                 NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\npjfzd39buzlt        nginx.1             nginx:1.13.7-alpine   swarm2              Running             Running about a minute ago\nhy9eeivdxlaa        nginx.2             nginx:1.13.7-alpine   swarm1              Running             Running about a minute ago\n36wmpiv7gmfo        nginx.3             nginx:1.13.7-alpine   swarm3              Running             Running about a minute ago`, `43882342385482146000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> <span class="token function">ps</span> nginx\nID                  NAME                IMAGE                 NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\npjfzd39buzlt        nginx.1             nginx:1.13.7-alpine   swarm2              Running             Running about a minute ago\nhy9eeivdxlaa        nginx.2             nginx:1.13.7-alpine   swarm1              Running             Running about a minute ago\n36wmpiv7gmfo        nginx.3             nginx:1.13.7-alpine   swarm3              Running             Running about a minute ago</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 <code class="language-text">docker service logs</code> 来查看某个服务的日志。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47486659888895440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service logs nginx\nnginx.3.36wmpiv7gmfo@swarm3    | 10.255.0.4 - - [25/Nov/2017:02:10:30 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0&quot; &quot;-&quot;\nnginx.3.36wmpiv7gmfo@swarm3    | 10.255.0.4 - - [25/Nov/2017:02:10:30 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 169 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0&quot; &quot;-&quot;\nnginx.3.36wmpiv7gmfo@swarm3    | 2017/11/25 02:10:30 [error] 5#5: *1 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 10.255.0.4, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;192.168.99.102&quot;\nnginx.1.pjfzd39buzlt@swarm2    | 10.255.0.2 - - [25/Nov/2017:02:10:26 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0&quot; &quot;-&quot;\nnginx.1.pjfzd39buzlt@swarm2    | 10.255.0.2 - - [25/Nov/2017:02:10:27 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 169 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0&quot; &quot;-&quot;\nnginx.1.pjfzd39buzlt@swarm2    | 2017/11/25 02:10:27 [error] 5#5: *1 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 10.255.0.2, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;192.168.99.101&quot;`, `47486659888895440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> logs nginx\nnginx.3.36wmpiv7gmfo@swarm3    <span class="token operator">|</span> <span class="token number">10.255</span>.0.4 - - <span class="token punctuation">[</span><span class="token number">25</span>/Nov/2017:02:10:30 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">612</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0"</span> <span class="token string">"-"</span>\nnginx.3.36wmpiv7gmfo@swarm3    <span class="token operator">|</span> <span class="token number">10.255</span>.0.4 - - <span class="token punctuation">[</span><span class="token number">25</span>/Nov/2017:02:10:30 +0000<span class="token punctuation">]</span> <span class="token string">"GET /favicon.ico HTTP/1.1"</span> <span class="token number">404</span> <span class="token number">169</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0"</span> <span class="token string">"-"</span>\nnginx.3.36wmpiv7gmfo@swarm3    <span class="token operator">|</span> <span class="token number">2017</span>/11/25 02:10:30 <span class="token punctuation">[</span>error<span class="token punctuation">]</span> <span class="token number">5</span><span class="token comment">#5: *1 open() "/usr/share/nginx/html/favicon.ico" failed (2: No such file or directory), client: 10.255.0.4, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "192.168.99.102"</span>\nnginx.1.pjfzd39buzlt@swarm2    <span class="token operator">|</span> <span class="token number">10.255</span>.0.2 - - <span class="token punctuation">[</span><span class="token number">25</span>/Nov/2017:02:10:26 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">612</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0"</span> <span class="token string">"-"</span>\nnginx.1.pjfzd39buzlt@swarm2    <span class="token operator">|</span> <span class="token number">10.255</span>.0.2 - - <span class="token punctuation">[</span><span class="token number">25</span>/Nov/2017:02:10:27 +0000<span class="token punctuation">]</span> <span class="token string">"GET /favicon.ico HTTP/1.1"</span> <span class="token number">404</span> <span class="token number">169</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0"</span> <span class="token string">"-"</span>\nnginx.1.pjfzd39buzlt@swarm2    <span class="token operator">|</span> <span class="token number">2017</span>/11/25 02:10:27 <span class="token punctuation">[</span>error<span class="token punctuation">]</span> <span class="token number">5</span><span class="token comment">#5: *1 open() "/usr/share/nginx/html/favicon.ico" failed (2: No such file or directory), client: 10.255.0.2, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "192.168.99.101"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="服务伸缩"><a href="#%E6%9C%8D%E5%8A%A1%E4%BC%B8%E7%BC%A9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>服务伸缩</h3>\n<p>我们可以使用 <code class="language-text">docker service scale</code> 对一个服务运行的容器数量进行伸缩。</p>\n<p>当业务处于高峰期时，我们需要扩展服务运行的容器数量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46923308765729940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service scale nginx=5`, `46923308765729940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> scale <span class="token assign-left variable">nginx</span><span class="token operator">=</span><span class="token number">5</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当业务平稳时，我们需要减少服务运行的容器数量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24786874519212110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service scale nginx=2`, `24786874519212110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> scale <span class="token assign-left variable">nginx</span><span class="token operator">=</span><span class="token number">2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="删除服务"><a href="#%E5%88%A0%E9%99%A4%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除服务</h3>\n<p>使用 <code class="language-text">docker service rm</code> 来从 Swarm 集群移除某个服务。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34895341884287580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service rm nginx`, `34895341884287580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> <span class="token function">rm</span> nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="在-swarm-集群中使用-compose-文件"><a href="#%E5%9C%A8-swarm-%E9%9B%86%E7%BE%A4%E4%B8%AD%E4%BD%BF%E7%94%A8-compose-%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 Swarm 集群中使用 compose 文件</h2>\n<p>正如之前使用 <code class="language-text">docker-compose.yml</code> 来一次配置、启动多个容器，在 Swarm 集群中也可以使用 compose 文件（docker-compose.yml）来配置、启动多个服务。</p>\n<p>上一节中，我们使用 <code class="language-text">docker service create</code> 一次只能部署一个服务，使用 <code class="language-text">docker-compose.yml</code> 我们可以一次启动多个关联的服务。</p>\n<p>我们以在 Swarm 集群中部署 WordPress 为例进行说明。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36218908316336894000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\n\nservices:\n  wordpress:\n    image: wordpress\n    ports:\n      - 80:80\n    networks:\n      - overlay\n    environment:\n      WORDPRESS_DB_HOST: db:3306\n      WORDPRESS_DB_USER: wordpress\n      WORDPRESS_DB_PASSWORD: wordpress\n    deploy:\n      mode: replicated\n      replicas: 3\n\n  db:\n    image: mysql\n    networks:\n      - overlay\n    volumes:\n      - db-data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: somewordpress\n      MYSQL_DATABASE: wordpress\n      MYSQL_USER: wordpress\n      MYSQL_PASSWORD: wordpress\n    deploy:\n      placement:\n        constraints: [node.role == manager]\n\n  visualizer:\n    image: dockersamples/visualizer:stable\n    ports:\n      - \'8080:8080\'\n    stop_grace_period: 1m30s\n    volumes:\n      - \'/var/run/docker.sock:/var/run/docker.sock\'\n    deploy:\n      placement:\n        constraints: [node.role == manager]\n\nvolumes:\n  db-data:\nnetworks:\n  overlay:`, `36218908316336894000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">wordpress</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> overlay\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token key atrule">WORDPRESS_DB_HOST</span><span class="token punctuation">:</span> db<span class="token punctuation">:</span><span class="token number">3306</span>\n      <span class="token key atrule">WORDPRESS_DB_USER</span><span class="token punctuation">:</span> wordpress\n      <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span> wordpress\n    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>\n      <span class="token key atrule">mode</span><span class="token punctuation">:</span> replicated\n      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>\n\n  <span class="token key atrule">db</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> overlay\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> db<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/mysql\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> somewordpress\n      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> wordpress\n      <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> wordpress\n      <span class="token key atrule">MYSQL_PASSWORD</span><span class="token punctuation">:</span> wordpress\n    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>\n      <span class="token key atrule">placement</span><span class="token punctuation">:</span>\n        <span class="token key atrule">constraints</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>node.role == manager<span class="token punctuation">]</span>\n\n  <span class="token key atrule">visualizer</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> dockersamples/visualizer<span class="token punctuation">:</span>stable\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'8080:8080\'</span>\n    <span class="token key atrule">stop_grace_period</span><span class="token punctuation">:</span> 1m30s\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'/var/run/docker.sock:/var/run/docker.sock\'</span>\n    <span class="token key atrule">deploy</span><span class="token punctuation">:</span>\n      <span class="token key atrule">placement</span><span class="token punctuation">:</span>\n        <span class="token key atrule">constraints</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>node.role == manager<span class="token punctuation">]</span>\n\n<span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n  <span class="token key atrule">db-data</span><span class="token punctuation">:</span>\n<span class="token key atrule">networks</span><span class="token punctuation">:</span>\n  overlay<span class="token punctuation">:</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Swarm 集群管理节点新建该文件，其中的 visualizer 服务提供一个可视化页面，我们可以从浏览器中很直观的查看集群中各个服务的运行节点。</p>\n<p>在 Swarm 集群中使用 <code class="language-text">docker-compose.yml</code> 需要用 <code class="language-text">docker stack</code> 命令，下面我们对该命令进行详细讲解。</p>\n<h3 id="部署服务-1"><a href="#%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署服务</h3>\n<p>部署服务使用 <code class="language-text">docker stack deploy</code>，其中 <code class="language-text">-c</code> 参数指定 compose 文件名。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12396944863107406000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker stack deploy -c docker-compose.yml wordpress`, `12396944863107406000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker stack deploy -c docker-compose.yml wordpress</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们打开浏览器输入 <code class="language-text">任一节点IP:8080</code> 即可看到各节点运行状态。</p>\n<p>在浏览器新的标签页输入 <code class="language-text">任一节点IP</code> 即可看到 WordPress 安装界面，安装完成之后，输入 <code class="language-text">任一节点IP</code> 即可看到 WordPress 页面。</p>\n<h3 id="查看服务-1"><a href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看服务</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20732674616971837000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker stack ls\nNAME                SERVICES\nwordpress           3`, `20732674616971837000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker stack <span class="token function">ls</span>\nNAME                SERVICES\nwordpress           <span class="token number">3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="移除服务"><a href="#%E7%A7%BB%E9%99%A4%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移除服务</h3>\n<p>要移除服务，使用 <code class="language-text">docker stack down</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62544936295182430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker stack down wordpress\nRemoving service wordpress_db\nRemoving service wordpress_visualizer\nRemoving service wordpress_wordpress\nRemoving network wordpress_overlay\nRemoving network wordpress_default`, `62544936295182430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker stack down wordpress\nRemoving <span class="token function">service</span> wordpress_db\nRemoving <span class="token function">service</span> wordpress_visualizer\nRemoving <span class="token function">service</span> wordpress_wordpress\nRemoving network wordpress_overlay\nRemoving network wordpress_default</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>该命令不会移除服务所使用的数据卷，如果你想移除数据卷请使用 <code class="language-text">docker volume rm</code></p>\n<h2 id="在-swarm-集群中管理敏感数据"><a href="#%E5%9C%A8-swarm-%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%AE%A1%E7%90%86%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 Swarm 集群中管理敏感数据</h2>\n<p>在动态的、大规模的分布式集群上，管理和分发密码、证书等敏感信息是极其重要的工作。传统的密钥分发方式（如密钥放入镜像中，设置环境变量，volume 动态挂载等）都存在着潜在的巨大的安全风险。</p>\n<p>Docker 目前已经提供了 secrets 管理功能，用户可以在 Swarm 集群中安全地管理密码、密钥证书等敏感数据，并允许在多个 Docker 容器实例之间共享访问指定的敏感数据。</p>\n<blockquote>\n<p>注意：secret 也可以在 Docker Compose 中使用。</p>\n</blockquote>\n<p>我们可以用 docker secret 命令来管理敏感信息。接下来我们在上面章节中创建好的 Swarm 集群中介绍该命令的使用。</p>\n<p>这里我们以在 Swarm 集群中部署 mysql 和 wordpress 服务为例。</p>\n<h3 id="创建-secret"><a href="#%E5%88%9B%E5%BB%BA-secret" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 secret</h3>\n<p>我们使用 <code class="language-text">docker secret create</code> 命令以管道符的形式创建 secret</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13591462949565880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ openssl rand -base64 20 | docker secret create mysql_password -\n\n\\$ openssl rand -base64 20 | docker secret create mysql_root_password -`, `13591462949565880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ openssl rand -base64 <span class="token number">20</span> <span class="token operator">|</span> docker secret create mysql_password -\n\n$ openssl rand -base64 <span class="token number">20</span> <span class="token operator">|</span> docker secret create mysql_root_password -</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="查看-secret"><a href="#%E6%9F%A5%E7%9C%8B-secret" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看 secret</h3>\n<p>使用 <code class="language-text">docker secret ls</code> 命令来查看 secret</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74630913111709860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker secret ls\n\nID                          NAME                  CREATED             UPDATED\nl1vinzevzhj4goakjap5ya409   mysql_password        41 seconds ago      41 seconds ago\nyvsczlx9votfw3l0nz5rlidig   mysql_root_password   12 seconds ago      12 seconds ago`, `74630913111709860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker secret <span class="token function">ls</span>\n\nID                          NAME                  CREATED             UPDATED\nl1vinzevzhj4goakjap5ya409   mysql_password        <span class="token number">41</span> seconds ago      <span class="token number">41</span> seconds ago\nyvsczlx9votfw3l0nz5rlidig   mysql_root_password   <span class="token number">12</span> seconds ago      <span class="token number">12</span> seconds ago</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="创建-mysql-服务"><a href="#%E5%88%9B%E5%BB%BA-mysql-%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 MySQL 服务</h3>\n<p>创建服务相关命令已经在前边章节进行了介绍，这里直接列出命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29432747433688600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker network create -d overlay mysql_private\n\n\\$ docker service create \\\n     --name mysql \\\n     --replicas 1 \\\n     --network mysql_private \\\n     --mount type=volume,source=mydata,destination=/var/lib/mysql \\\n     --secret source=mysql_root_password,target=mysql_root_password \\\n     --secret source=mysql_password,target=mysql_password \\\n     -e MYSQL_ROOT_PASSWORD_FILE=&quot;/run/secrets/mysql_root_password&quot; \\\n     -e MYSQL_PASSWORD_FILE=&quot;/run/secrets/mysql_password&quot; \\\n     -e MYSQL_USER=&quot;wordpress&quot; \\\n     -e MYSQL_DATABASE=&quot;wordpress&quot; \\\n     mysql:latest`, `29432747433688600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker network create -d overlay mysql_private\n\n$ docker <span class="token function">service</span> create <span class="token punctuation">\\</span>\n     --name mysql <span class="token punctuation">\\</span>\n     --replicas <span class="token number">1</span> <span class="token punctuation">\\</span>\n     --network mysql_private <span class="token punctuation">\\</span>\n     --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>volume,source<span class="token operator">=</span>mydata,destination<span class="token operator">=</span>/var/lib/mysql <span class="token punctuation">\\</span>\n     --secret <span class="token assign-left variable">source</span><span class="token operator">=</span>mysql_root_password,target<span class="token operator">=</span>mysql_root_password <span class="token punctuation">\\</span>\n     --secret <span class="token assign-left variable">source</span><span class="token operator">=</span>mysql_password,target<span class="token operator">=</span>mysql_password <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD_FILE</span><span class="token operator">=</span><span class="token string">"/run/secrets/mysql_root_password"</span> <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">MYSQL_PASSWORD_FILE</span><span class="token operator">=</span><span class="token string">"/run/secrets/mysql_password"</span> <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">MYSQL_USER</span><span class="token operator">=</span><span class="token string">"wordpress"</span> <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">MYSQL_DATABASE</span><span class="token operator">=</span><span class="token string">"wordpress"</span> <span class="token punctuation">\\</span>\n     mysql:latest</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你没有在 target 中显式的指定路径时，secret 默认通过 tmpfs 文件系统挂载到容器的 /run/secrets 目录中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60825873424723345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service create \\\n     --name wordpress \\\n     --replicas 1 \\\n     --network mysql_private \\\n     --publish target=30000,port=80 \\\n     --mount type=volume,source=wpdata,destination=/var/www/html \\\n     --secret source=mysql_password,target=wp_db_password,mode=0444 \\\n     -e WORDPRESS_DB_USER=&quot;wordpress&quot; \\\n     -e WORDPRESS_DB_PASSWORD_FILE=&quot;/run/secrets/wp_db_password&quot; \\\n     -e WORDPRESS_DB_HOST=&quot;mysql:3306&quot; \\\n     -e WORDPRESS_DB_NAME=&quot;wordpress&quot; \\\n     wordpress:latest`, `60825873424723345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> create <span class="token punctuation">\\</span>\n     --name wordpress <span class="token punctuation">\\</span>\n     --replicas <span class="token number">1</span> <span class="token punctuation">\\</span>\n     --network mysql_private <span class="token punctuation">\\</span>\n     --publish <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token number">30000</span>,port<span class="token operator">=</span><span class="token number">80</span> <span class="token punctuation">\\</span>\n     --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>volume,source<span class="token operator">=</span>wpdata,destination<span class="token operator">=</span>/var/www/html <span class="token punctuation">\\</span>\n     --secret <span class="token assign-left variable">source</span><span class="token operator">=</span>mysql_password,target<span class="token operator">=</span>wp_db_password,mode<span class="token operator">=</span>0444 <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">WORDPRESS_DB_USER</span><span class="token operator">=</span><span class="token string">"wordpress"</span> <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">WORDPRESS_DB_PASSWORD_FILE</span><span class="token operator">=</span><span class="token string">"/run/secrets/wp_db_password"</span> <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">WORDPRESS_DB_HOST</span><span class="token operator">=</span><span class="token string">"mysql:3306"</span> <span class="token punctuation">\\</span>\n     -e <span class="token assign-left variable">WORDPRESS_DB_NAME</span><span class="token operator">=</span><span class="token string">"wordpress"</span> <span class="token punctuation">\\</span>\n     wordpress:latest</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>查看服务</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72759289560211510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service ls\n\nID            NAME   MODE        REPLICAS  IMAGE\nwvnh0siktqr3  mysql      replicated  1/1       mysql:latest\nnzt5xzae4n62  wordpress  replicated  1/1       wordpress:latest`, `72759289560211510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> <span class="token function">ls</span>\n\nID            NAME   MODE        REPLICAS  IMAGE\nwvnh0siktqr3  mysql      replicated  <span class="token number">1</span>/1       mysql:latest\nnzt5xzae4n62  wordpress  replicated  <span class="token number">1</span>/1       wordpress:latest</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在浏览器访问 <code class="language-text">IP:30000</code>，即可开始 WordPress 的安装与使用。</p>\n<p>通过以上方法，我们没有像以前通过设置环境变量来设置 MySQL 密码，而是采用 <code class="language-text">docker secret</code> 来设置密码，防范了密码泄露的风险。</p>\n<h2 id="在-swarm-集群中管理配置数据"><a href="#%E5%9C%A8-swarm-%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 Swarm 集群中管理配置数据</h2>\n<p>在动态的、大规模的分布式集群上，管理和分发配置文件也是很重要的工作。传统的配置文件分发方式（如配置文件放入镜像中，设置环境变量，volume 动态挂载等）都降低了镜像的通用性。</p>\n<p>在 Docker 17.06 以上版本中，Docker 新增了 docker config 子命令来管理集群中的配置信息，以后你无需将配置文件放入镜像或挂载到容器中就可实现对服务的配置。</p>\n<blockquote>\n<p>注意：config 仅能在 Swarm 集群中使用。</p>\n</blockquote>\n<p>这里我们以在 Swarm 集群中部署 redis 服务为例。</p>\n<h3 id="创建-config"><a href="#%E5%88%9B%E5%BB%BA-config" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 config</h3>\n<p>新建 redis.conf 文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80612132627020370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`port 6380`, `80612132627020370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">port <span class="token number">6380</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此项配置 Redis 监听 6380 端口</p>\n<p>我们使用 docker config create 命令创建 config</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9262085885495530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker config create redis.conf redis.conf`, `9262085885495530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker config create redis.conf redis.conf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="查看-config"><a href="#%E6%9F%A5%E7%9C%8B-config" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看 config</h3>\n<p>使用 docker config ls 命令来查看 config</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43926193326713150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker config ls\n\nID                          NAME                CREATED             UPDATED\nyod8fx8iiqtoo84jgwadp86yk   redis.conf          4 seconds ago       4 seconds ago`, `43926193326713150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker config <span class="token function">ls</span>\n\nID                          NAME                CREATED             UPDATED\nyod8fx8iiqtoo84jgwadp86yk   redis.conf          <span class="token number">4</span> seconds ago       <span class="token number">4</span> seconds ago</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="创建-redis-服务"><a href="#%E5%88%9B%E5%BB%BA-redis-%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 redis 服务</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63484756331604350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service create \\\n     --name redis \\\n     # --config source=redis.conf,target=/etc/redis.conf \\\n     --config redis.conf \\\n     -p 6379:6380 \\\n     redis:latest \\\n     redis-server /redis.conf`, `63484756331604350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> create <span class="token punctuation">\\</span>\n     --name redis <span class="token punctuation">\\</span>\n     <span class="token comment"># --config source=redis.conf,target=/etc/redis.conf \\</span>\n     --config redis.conf <span class="token punctuation">\\</span>\n     -p <span class="token number">6379</span>:6380 <span class="token punctuation">\\</span>\n     redis:latest <span class="token punctuation">\\</span>\n     redis-server /redis.conf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你没有在 target 中显式的指定路径时，默认的 redis.conf 以 tmpfs 文件系统挂载到容器的 /config.conf。</p>\n<p>经过测试，redis 可以正常使用。</p>\n<p>以前我们通过监听主机目录来配置 Redis，就需要在集群的每个节点放置该文件，如果采用 <code class="language-text">docker config</code> 来管理服务的配置信息，我们只需在集群中的管理节点创建 config，当部署服务时，集群会自动的将配置文件分发到运行服务的各个节点中，大大降低了配置信息的管理和分发难度。</p>\n<h2 id="swarm-mode-与滚动升级"><a href="#swarm-mode-%E4%B8%8E%E6%BB%9A%E5%8A%A8%E5%8D%87%E7%BA%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Swarm mode 与滚动升级</h2>\n<p>在部署服务一节中我们使用 <code class="language-text">nginx:1.13.7-alpine</code> 镜像部署了一个名为 nginx 的服务。</p>\n<p>现在我们想要将 NGINX 版本升级到 <code class="language-text">1.13.12</code>，那么在 <code class="language-text">Swarm mode</code> 中如何升级服务呢？</p>\n<p>你可能会想到，先停止原来的服务，再使用新镜像部署一个服务，不就完成服务的 “升级” 了吗。</p>\n<p>这样做的弊端很明显，如果新部署的服务出现问题，原来的服务删除之后，很难恢复，那么在 Swarm mode 中到底该如何对服务进行滚动升级呢？</p>\n<p>答案就是使用 <code class="language-text">docker service update</code> 命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39195478730415420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service update \\\n    --image nginx:1.13.12-alpine \\\n    nginx`, `39195478730415420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> update <span class="token punctuation">\\</span>\n    --image nginx:1.13.12-alpine <span class="token punctuation">\\</span>\n    nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>以上命令使用 <code class="language-text">--image</code> 选项更新了服务的镜像。当然我们也可以使用 <code class="language-text">docker service update</code> 更新任意的配置。</p>\n<p><code class="language-text">--secret-add</code> 选项可以增加一个密钥</p>\n<p><code class="language-text">--secret-rm</code> 选项可以删除一个密钥</p>\n<p>更多选项可以通过 <code class="language-text">docker service update -h</code> 命令查看。</p>\n<h3 id="服务回退"><a href="#%E6%9C%8D%E5%8A%A1%E5%9B%9E%E9%80%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>服务回退</h3>\n<p>现在假设我们发现 nginx 服务的镜像升级到 <code class="language-text">nginx:1.13.12-alpine</code> 出现了一些问题，我们可以使用命令一键回退。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52391204357954750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service rollback nginx`, `52391204357954750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> rollback nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在使用 docker service ps 命令查看 nginx 服务详情。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44702776492202600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker service ps nginx\n\nID                  NAME                IMAGE                  NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nrt677gop9d4x        nginx.1             nginx:1.13.7-alpine   VM-20-83-debian     Running             Running about a minute ago\nd9pw13v59d00         \\_ nginx.1         nginx:1.13.12-alpine  VM-20-83-debian     Shutdown            Shutdown 2 minutes ago\ni7ynkbg6ybq5         \\_ nginx.1         nginx:1.13.7-alpine   VM-20-83-debian     Shutdown            Shutdown 2 minutes ago`, `44702776492202600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker <span class="token function">service</span> <span class="token function">ps</span> nginx\n\nID                  NAME                IMAGE                  NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nrt677gop9d4x        nginx.1             nginx:1.13.7-alpine   VM-20-83-debian     Running             Running about a minute ago\nd9pw13v59d00         <span class="token punctuation">\\</span>_ nginx.1         nginx:1.13.12-alpine  VM-20-83-debian     Shutdown            Shutdown <span class="token number">2</span> minutes ago\ni7ynkbg6ybq5         <span class="token punctuation">\\</span>_ nginx.1         nginx:1.13.7-alpine   VM-20-83-debian     Shutdown            Shutdown <span class="token number">2</span> minutes ago</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果的输出详细记录了服务的部署、滚动升级、回退的过程。</p>\n<h1 id="docker-buildx"><a href="#docker-buildx" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Buildx</h1>\n<p>Docker Buildx 是一个 docker CLI 插件，其扩展了 docker 命令，支持 Moby BuildKit 提供的功能。提供了与 docker build 相同的用户体验，并增加了许多新功能。</p>\n<blockquote>\n<p>该功能仅适用于 Docker v19.03+ 版本</p>\n</blockquote>\n<h2 id="使用-buildkit-构建镜像"><a href="#%E4%BD%BF%E7%94%A8-buildkit-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 BuildKit 构建镜像</h2>\n<p>BuildKit 是下一代的镜像构建组件，在 <a href="https://github.com/moby/buildkit" target="_blank" rel="nofollow noreferrer noopener">https://github.com/moby/buildkit</a> 开源。</p>\n<blockquote>\n<p>注意：如果您的镜像构建使用的是云服务商提供的镜像构建服务（腾讯云容器服务、阿里云容器服务等），由于上述服务提供商的 Docker 版本低于 18.09，BuildKit 无法使用，将造成镜像构建失败。建议使用 BuildKit 构建镜像时使用一个新的 Dockerfile 文件（例如 Dockerfile.buildkit）</p>\n</blockquote>\n<p>目前，Docker Hub 自动构建已经支持 buildkit，具体请参考 <a href="https://github.com/docker-practice/docker-hub-buildx" target="_blank" rel="nofollow noreferrer noopener">https://github.com/docker-practice/docker-hub-buildx</a></p>\n<h3 id="dockerfile-新增指令详解"><a href="#dockerfile-%E6%96%B0%E5%A2%9E%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile 新增指令详解</h3>\n<p>启用 BuildKit 之后，我们可以使用下面几个新的 Dockerfile 指令来加快镜像构建。</p>\n<h4 id="run---mounttypecache"><a href="#run---mounttypecache" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RUN —mount=type=cache</h4>\n<p>目前，几乎所有的程序都会使用依赖管理工具，例如 Go 中的 go mod、Node.js 中的 npm 等等，当我们构建一个镜像时，往往会重复的从互联网中获取依赖包，难以缓存，大大降低了镜像的构建效率。</p>\n<p>例如一个前端工程需要用到 npm：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19398543374529843000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM node:alpine as builder\n\nWORKDIR /app\n\nCOPY package.json /app/\n\nRUN npm i --registry=https://registry.npm.taobao.org \\\n        && rm -rf ~/.npm\n\nCOPY src /app/src\n\nRUN npm run build\n\nFROM nginx:alpine\n\nCOPY --from=builder /app/dist /app/dist`, `19398543374529843000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>alpine as builder\n\n<span class="token keyword">WORKDIR</span> /app\n\n<span class="token keyword">COPY</span> package.json /app/\n\n<span class="token keyword">RUN</span> npm i <span class="token punctuation">-</span><span class="token punctuation">-</span>registry=https<span class="token punctuation">:</span>//registry.npm.taobao.org \\\n        &amp;&amp; rm <span class="token punctuation">-</span>rf ~/.npm\n\n<span class="token keyword">COPY</span> src /app/src\n\n<span class="token keyword">RUN</span> npm run build\n\n<span class="token keyword">FROM</span> nginx<span class="token punctuation">:</span>alpine\n\n<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=builder /app/dist /app/dist</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用多阶段构建，构建的镜像中只包含了目标文件夹 dist，但仍然存在一些问题，当 package.json 文件变动时，<code class="language-text">RUN npm i &amp;&amp; rm -rf ~/.npm</code> 这一层会重新执行，变更多次后，生成了大量的中间层镜像。</p>\n<p>为解决这个问题，进一步的我们可以设想一个类似数据卷的功能，在镜像构建时把 <code class="language-text">node_modules</code> 文件夹挂载上去，在构建完成后，这个 <code class="language-text">node_modules</code> 文件夹会自动卸载，实际的镜像中并不包含 <code class="language-text">node_modules</code> 这个文件夹，这样我们就省去了每次获取依赖的时间，大大增加了镜像构建效率，同时也避免了生成了大量的中间层镜像。</p>\n<p>BuildKit 提供了 <code class="language-text">RUN --mount=type=cache</code> 指令，可以实现上边的设想。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43137296335895626000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\nFROM node:alpine as builder\n\nWORKDIR /app\n\nCOPY package.json /app/\n\nRUN --mount=type=cache,target=/app/node_modules,id=my_app_npm_module,sharing=locked \\\n    --mount=type=cache,target=/root/.npm,id=npm_cache \\\n        npm i --registry=https://registry.npm.taobao.org\n\nCOPY src /app/src\n\nRUN --mount=type=cache,target=/app/node_modules,id=my_app_npm_module,sharing=locked \\\n# --mount=type=cache,target=/app/dist,id=my_app_dist,sharing=locked \\\n        npm run build\n\nFROM nginx:alpine\n\n# COPY --from=builder /app/dist /app/dist\n\n# 为了更直观的说明 from 和 source 指令，这里使用 RUN 指令\nRUN --mount=type=cache,target=/tmp/dist,from=builder,source=/app/dist \\\n    # --mount=type=cache,target/tmp/dist,from=my_app_dist,sharing=locked \\\n    mkdir -p /app/dist && cp -r /tmp/dist/* /app/dist`, `43137296335895626000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n<span class="token keyword">FROM</span> node<span class="token punctuation">:</span>alpine as builder\n\n<span class="token keyword">WORKDIR</span> /app\n\n<span class="token keyword">COPY</span> package.json /app/\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/app/node_modules<span class="token punctuation">,</span>id=my_app_npm_module<span class="token punctuation">,</span>sharing=locked \\\n    <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/root/.npm<span class="token punctuation">,</span>id=npm_cache \\\n        npm i <span class="token punctuation">-</span><span class="token punctuation">-</span>registry=https<span class="token punctuation">:</span>//registry.npm.taobao.org\n\n<span class="token keyword">COPY</span> src /app/src\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/app/node_modules<span class="token punctuation">,</span>id=my_app_npm_module<span class="token punctuation">,</span>sharing=locked \\\n<span class="token comment"># --mount=type=cache,target=/app/dist,id=my_app_dist,sharing=locked \\</span>\n        npm run build\n\n<span class="token keyword">FROM</span> nginx<span class="token punctuation">:</span>alpine\n\n<span class="token comment"># COPY --from=builder /app/dist /app/dist</span>\n\n<span class="token comment"># 为了更直观的说明 from 和 source 指令，这里使用 RUN 指令</span>\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/tmp/dist<span class="token punctuation">,</span>from=builder<span class="token punctuation">,</span>source=/app/dist \\\n    <span class="token comment"># --mount=type=cache,target/tmp/dist,from=my_app_dist,sharing=locked \\</span>\n    mkdir <span class="token punctuation">-</span>p /app/dist &amp;&amp; cp <span class="token punctuation">-</span>r /tmp/dist/* /app/dist</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于 BuildKit 为实验特性，每个 Dockerfile 文件开头都必须加上如下指令</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21462498736967016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental`, `21462498736967016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>第一个 RUN 指令执行后，id 为 <code class="language-text">my_app_npm_module</code> 的缓存文件夹挂载到了 <code class="language-text">/app/node_modules</code> 文件夹中。多次执行也不会产生多个中间层镜像。</p>\n<p>第二个 RUN 指令执行时需要用到 <code class="language-text">node_modules</code> 文件夹，<code class="language-text">node_modules</code> 已经挂载，命令也可以正确执行。</p>\n<p>第三个 RUN 指令将上一阶段产生的文件复制到指定位置，from 指明缓存的来源，这里 builder 表示缓存来源于构建的第一阶段，source 指明缓存来源的文件夹。</p>\n<p>上面的 Dockerfile 中 <code class="language-text">--mount=type=cache,...</code> 中指令作用如下：</p>\n<table>\n<thead>\n<tr>\n<th align="left">Option</th>\n<th align="left">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">id</td>\n<td align="left">id 设置一个标志，以便区分缓存。</td>\n</tr>\n<tr>\n<td align="left">target(必填项)</td>\n<td align="left">缓存的挂载目标文件夹。</td>\n</tr>\n<tr>\n<td align="left">ro,readonly</td>\n<td align="left">只读，缓存文件夹不能被写入。</td>\n</tr>\n<tr>\n<td align="left">sharing</td>\n<td align="left">有 shared private locked 值可供选择。sharing 设置当一个缓存被多次使用时的表现，由于 BuildKit 支持并行构建，当多个步骤使用同一缓存时（同一 id）会发生冲突。shared 表示多个步骤可以同时读写，private 表示当多个步骤使用同一缓存时，每个步骤使用不同的缓存，locked 表示当一个步骤完成释放缓存后，后一个步骤才能继续使用该缓存。</td>\n</tr>\n<tr>\n<td align="left">from</td>\n<td align="left">缓存来源（构建阶段），不填写时为空文件夹。</td>\n</tr>\n<tr>\n<td align="left">source</td>\n<td align="left">来源的文件夹路径。</td>\n</tr>\n</tbody>\n</table>\n<h4 id="run---mounttypebind"><a href="#run---mounttypebind" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RUN —mount=type=bind</h4>\n<p>该指令可以将一个镜像（或上一构建阶段）的文件挂载到指定位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2783587255904218600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\n\nRUN --mount=type=bind,from=php:alpine,source=/usr/local/bin/docker-php-entrypoint,target=/docker-php-entrypoint \\\n        cat /docker-php-entrypoint`, `2783587255904218600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=bind<span class="token punctuation">,</span>from=php<span class="token punctuation">:</span>alpine<span class="token punctuation">,</span>source=/usr/local/bin/docker<span class="token punctuation">-</span>php<span class="token punctuation">-</span>entrypoint<span class="token punctuation">,</span>target=/docker<span class="token punctuation">-</span>php<span class="token punctuation">-</span>entrypoint \\\n        cat /docker<span class="token punctuation">-</span>php<span class="token punctuation">-</span>entrypoint</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="run---mounttypetmpfs"><a href="#run---mounttypetmpfs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RUN —mount=type=tmpfs</h4>\n<p>该指令可以将一个 tmpfs 文件系统挂载到指定位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15997679479417903000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\n\nRUN --mount=type=tmpfs,target=/temp \\\n        mount | grep /temp`, `15997679479417903000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=tmpfs<span class="token punctuation">,</span>target=/temp \\\n        mount <span class="token punctuation">|</span> grep /temp</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="run---mounttypesecret"><a href="#run---mounttypesecret" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RUN —mount=type=secret</h4>\n<p>该指令可以将一个文件（例如密钥）挂载到指定位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44108633088072606000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\n\nRUN --mount=type=secret,id=aws,target=/root/.aws/credentials \\\n        cat /root/.aws/credentials\n\n\\$ docker build -t test --secret id=aws,src=\\$HOME/.aws/credentials .`, `44108633088072606000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=secret<span class="token punctuation">,</span>id=aws<span class="token punctuation">,</span>target=/root/.aws/credentials \\\n        cat /root/.aws/credentials\n\n$ docker build <span class="token punctuation">-</span>t test <span class="token punctuation">-</span><span class="token punctuation">-</span>secret id=aws<span class="token punctuation">,</span>src=$HOME/.aws/credentials .</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="run---mounttypessh"><a href="#run---mounttypessh" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RUN —mount=type=ssh</h4>\n<p>该指令可以挂载 ssh 密钥。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52185174916770530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\n\nFROM alpine\nRUN apk add --no-cache openssh-client\nRUN mkdir -p -m 0700 ~/.ssh && ssh-keyscan gitlab.com >> ~/.ssh/known_hosts\nRUN --mount=type=ssh ssh git@gitlab.com | tee /hello`, `52185174916770530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n\n<span class="token keyword">FROM</span> alpine\n<span class="token keyword">RUN</span> apk add <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache openssh<span class="token punctuation">-</span>client\n<span class="token keyword">RUN</span> mkdir <span class="token punctuation">-</span>p <span class="token punctuation">-</span>m 0700 ~/.ssh &amp;&amp; ssh<span class="token punctuation">-</span>keyscan gitlab.com <span class="token punctuation">></span><span class="token punctuation">></span> ~/.ssh/known_hosts\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=ssh ssh git@gitlab.com <span class="token punctuation">|</span> tee /hello</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35260811955546820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ eval \\$(ssh-agent)\n\\$ ssh-add ~/.ssh/id_rsa\n(Input your passphrase here)\n\\$ docker build -t test --ssh default=\\$SSH_AUTH_SOCK .`, `35260811955546820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span>ssh-agent<span class="token variable">)</span></span>\n$ ssh-add ~/.ssh/id_rsa\n<span class="token punctuation">(</span>Input your passphrase here<span class="token punctuation">)</span>\n$ docker build -t <span class="token builtin class-name">test</span> --ssh <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token environment constant">$SSH_AUTH_SOCK</span> <span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="使用-buildx-构建镜像"><a href="#%E4%BD%BF%E7%94%A8-buildx-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 Buildx 构建镜像</h2>\n<h3 id="使用"><a href="#%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用</h3>\n<p>你可以直接使用 docker buildx build 命令构建镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49035207066047250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker buildx build .\n[+] Building 8.4s (23/32)\n => ...`, `49035207066047250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker buildx build <span class="token builtin class-name">.</span>\n<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">8</span>.4s <span class="token punctuation">(</span><span class="token number">23</span>/32<span class="token punctuation">)</span>\n <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>Buildx 使用 BuildKit 引擎 进行构建，支持许多新的功能，具体参考 Buildkit 一节。</p>\n<h3 id="官方文档"><a href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>官方文档</h3>\n<p><a href="https://docs.docker.com/engine/reference/commandline/buildx/" target="_blank" rel="nofollow noreferrer noopener">https://docs.docker.com/engine/reference/commandline/buildx/</a></p>\n<h2 id="使用-buildx-构建多种系统架构支持的-docker-镜像"><a href="#%E4%BD%BF%E7%94%A8-buildx-%E6%9E%84%E5%BB%BA%E5%A4%9A%E7%A7%8D%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81%E7%9A%84-docker-%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 buildx 构建多种系统架构支持的 Docker 镜像</h2>\n<p>在之前的版本中构建多种系统架构支持的 Docker 镜像，要想使用统一的名字必须使用 <code class="language-text">$ docker manifest</code> 命令。</p>\n<p>在 Docker 19.03+ 版本中可以使用 <code class="language-text">$ docker buildx build</code> 命令使用 BuildKit 构建镜像。该命令支持 <code class="language-text">--platform</code> 参数可以同时构建支持多种系统架构的 Docker 镜像，大大简化了构建步骤。</p>\n<h3 id="新建-builder-实例"><a href="#%E6%96%B0%E5%BB%BA-builder-%E5%AE%9E%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新建 builder 实例</h3>\n<p>Docker for Linux 不支持构建 arm 架构镜像，我们可以运行一个新的容器让其支持该特性，Docker 桌面版无需进行此项设置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80316845362131300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run --rm --privileged tonistiigi/binfmt:latest --install all`, `80316845362131300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run --rm --privileged tonistiigi/binfmt:latest --install all</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>由于 Docker 默认的 builder 实例不支持同时指定多个 <code class="language-text">--platform</code>，我们必须首先创建一个新的 builder 实例。同时由于国内拉取镜像较缓慢，我们可以使用配置了<a href="https://github.com/moby/buildkit/blob/master/docs/buildkitd.toml.md" target="_blank" rel="nofollow noreferrer noopener">镜像加速地址</a>的 <a href="https://github.com/docker-practice/buildx" target="_blank" rel="nofollow noreferrer noopener">dockerpracticesig/buildkit:master</a> 镜像替换官方镜像。</p>\n<blockquote>\n<p>如果你有私有的镜像加速器，可以基于 <a href="https://github.com/docker-practice/buildx" target="_blank" rel="nofollow noreferrer noopener">https://github.com/docker-practice/buildx</a> 构建自己的 buildkit 镜像并使用它。</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22826459435884438000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 适用于国内环境\n\\$ docker buildx create --use --name=mybuilder-cn --driver docker-container --driver-opt image=dockerpracticesig/buildkit:master\n\n# 适用于腾讯云环境(腾讯云主机、coding.net 持续集成)\n\\$ docker buildx create --use --name=mybuilder-cn --driver docker-container --driver-opt image=dockerpracticesig/buildkit:master-tencent\n\n# \\$ docker buildx create --name mybuilder --driver docker-container\n\n\\$ docker buildx use mybuilder`, `22826459435884438000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 适用于国内环境</span>\n$ docker buildx create --use --name<span class="token operator">=</span>mybuilder-cn --driver docker-container --driver-opt <span class="token assign-left variable">image</span><span class="token operator">=</span>dockerpracticesig/buildkit:master\n\n<span class="token comment"># 适用于腾讯云环境(腾讯云主机、coding.net 持续集成)</span>\n$ docker buildx create --use --name<span class="token operator">=</span>mybuilder-cn --driver docker-container --driver-opt <span class="token assign-left variable">image</span><span class="token operator">=</span>dockerpracticesig/buildkit:master-tencent\n\n<span class="token comment"># $ docker buildx create --name mybuilder --driver docker-container</span>\n\n$ docker buildx use mybuilder</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="构建镜像-2"><a href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建镜像</h3>\n<p>新建 Dockerfile 文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43572828542786530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM --platform=\\$TARGETPLATFORM alpine\n\nRUN uname -a > /os.txt\n\nCMD cat /os.txt`, `43572828542786530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>platform=$TARGETPLATFORM alpine\n\n<span class="token keyword">RUN</span> uname <span class="token punctuation">-</span>a <span class="token punctuation">></span> /os.txt\n\n<span class="token keyword">CMD</span> cat /os.txt</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 <code class="language-text">$ docker buildx build</code> 命令构建镜像，注意将 <code class="language-text">myusername</code> 替换为自己的 <code class="language-text">Docker Hub</code> 用户名。</p>\n<p><code class="language-text">--push</code> 参数表示将构建好的镜像推送到 Docker 仓库。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14146115788010238000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker buildx build --platform linux/arm,linux/arm64,linux/amd64 -t myusername/hello . --push\n\n# 查看镜像信息\n\\$ docker buildx imagetools inspect myusername/hello`, `14146115788010238000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker buildx build --platform linux/arm,linux/arm64,linux/amd64 -t myusername/hello <span class="token builtin class-name">.</span> --push\n\n<span class="token comment"># 查看镜像信息</span>\n$ docker buildx imagetools inspect myusername/hello</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在不同架构运行该镜像，可以得到该架构的信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62782383729645900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# arm\n\\$ docker run -it --rm myusername/hello\nLinux buildkitsandbox 4.9.125-linuxkit #1 SMP Fri Sep 7 08:20:28 UTC 2018 armv7l Linux\n\n# arm64\n\\$ docker run -it --rm myusername/hello\nLinux buildkitsandbox 4.9.125-linuxkit #1 SMP Fri Sep 7 08:20:28 UTC 2018 aarch64 Linux\n\n# amd64\n\\$ docker run -it --rm myusername/hello\nLinux buildkitsandbox 4.9.125-linuxkit #1 SMP Fri Sep 7 08:20:28 UTC 2018 x86_64 Linux`, `62782383729645900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># arm</span>\n$ docker run -it --rm myusername/hello\nLinux buildkitsandbox <span class="token number">4.9</span>.125-linuxkit <span class="token comment">#1 SMP Fri Sep 7 08:20:28 UTC 2018 armv7l Linux</span>\n\n<span class="token comment"># arm64</span>\n$ docker run -it --rm myusername/hello\nLinux buildkitsandbox <span class="token number">4.9</span>.125-linuxkit <span class="token comment">#1 SMP Fri Sep 7 08:20:28 UTC 2018 aarch64 Linux</span>\n\n<span class="token comment"># amd64</span>\n$ docker run -it --rm myusername/hello\nLinux buildkitsandbox <span class="token number">4.9</span>.125-linuxkit <span class="token comment">#1 SMP Fri Sep 7 08:20:28 UTC 2018 x86_64 Linux</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="架构相关变量"><a href="#%E6%9E%B6%E6%9E%84%E7%9B%B8%E5%85%B3%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>架构相关变量</h3>\n<p>Dockerfile 支持如下架构相关的变量</p>\n<ul>\n<li>TARGETPLATFORM：构建镜像的目标平台，例如 <code class="language-text">linux/amd64</code>, <code class="language-text">linux/arm/v7</code>, <code class="language-text">windows/amd64</code>。</li>\n<li>TARGETOS：TARGETPLATFORM 的 OS 类型，例如 linux, windows</li>\n<li>TARGETARCH：TARGETPLATFORM 的架构类型，例如 amd64, arm</li>\n<li>TARGETVARIANT：TARGETPLATFORM 的变种，该变量可能为空，例如 v7</li>\n<li>BUILDPLATFORM：构建镜像主机平台，例如 <code class="language-text">linux/amd64</code></li>\n<li>BUILDOS：BUILDPLATFORM 的 OS 类型，例如 linux</li>\n<li>BUILDARCH：BUILDPLATFORM 的架构类型，例如 amd64</li>\n<li>BUILDVARIANT：BUILDPLATFORM 的变种，该变量可能为空，例如 v7</li>\n</ul>\n<h4 id="使用举例"><a href="#%E4%BD%BF%E7%94%A8%E4%B8%BE%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用举例</h4>\n<p>例如我们要构建支持 <code class="language-text">linux/arm/v7</code> 和 <code class="language-text">linux/amd64</code> 两种架构的镜像。假设已经生成了两个平台对应的二进制文件：</p>\n<ul>\n<li>bin/dist-linux-arm</li>\n<li>bin/dist-linux-amd64</li>\n</ul>\n<p>那么 Dockerfile 可以这样书写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88458780825415880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM scratch\n\n# 使用变量必须申明\nARG TARGETOS\n\nARG TARGETARCH\n\nCOPY bin/dist-\\${TARGETOS}-\\${TARGETARCH} /dist\n\nENTRYPOINT [&quot;dist&quot;]`, `88458780825415880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">FROM scratch\n\n<span class="token comment"># 使用变量必须申明</span>\nARG TARGETOS\n\nARG TARGETARCH\n\nCOPY bin/dist-<span class="token variable">${TARGETOS}</span>-<span class="token variable">${TARGETARCH}</span> /dist\n\nENTRYPOINT <span class="token punctuation">[</span><span class="token string">"dist"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="podman"><a href="#podman" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>podman</h1>\n<p><a href="https://github.com/containers/podman" target="_blank" rel="nofollow noreferrer noopener">podman</a> 是一个无守护程序与 docker 命令兼容的下一代 Linux 容器工具。</p>\n<h2 id="安装"><a href="#%E5%AE%89%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90421427668265650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo yum -y install podman`, `90421427668265650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> yum -y <span class="token function">install</span> podman</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="使用-1"><a href="#%E4%BD%BF%E7%94%A8-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用</h2>\n<p>podman 与 docker 命令完全兼容，只需将 docker 替换为 podman 即可，例如运行一个容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53282263393437180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# \\$ docker run -d -p 80:80 nginx:alpine\n\n\\$ podman run -d -p 80:80 nginx:alpine`, `53282263393437180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># $ docker run -d -p 80:80 nginx:alpine</span>\n\n$ podman run -d -p <span class="token number">80</span>:80 nginx:alpine</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h1 id="常见问题总结"><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常见问题总结</h1>\n<h2 id="镜像相关"><a href="#%E9%95%9C%E5%83%8F%E7%9B%B8%E5%85%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>镜像相关</h2>\n<h3 id="如何批量清理临时镜像文件？"><a href="#%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%B8%85%E7%90%86%E4%B8%B4%E6%97%B6%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何批量清理临时镜像文件？</h3>\n<p>答：可以使用 <code class="language-text">docker image prune</code> 命令。</p>\n<h3 id="如何查看镜像支持的环境变量？"><a href="#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E6%94%AF%E6%8C%81%E7%9A%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何查看镜像支持的环境变量？</h3>\n<p>答：可以使用 <code class="language-text">docker run IMAGE env</code> 命令。</p>\n<h3 id="本地的镜像文件都存放在哪里？"><a href="#%E6%9C%AC%E5%9C%B0%E7%9A%84%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E9%83%BD%E5%AD%98%E6%94%BE%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>本地的镜像文件都存放在哪里？</h3>\n<p>答：与 Docker 相关的本地资源默认存放在 <code class="language-text">/var/lib/docker/</code> 目录下，以 overlay2 文件系统为例，其中 containers 目录存放容器信息，image 目录存放镜像信息，overlay2 目录下存放具体的镜像层文件。</p>\n<h3 id="构建-docker-镜像应该遵循哪些原则？"><a href="#%E6%9E%84%E5%BB%BA-docker-%E9%95%9C%E5%83%8F%E5%BA%94%E8%AF%A5%E9%81%B5%E5%BE%AA%E5%93%AA%E4%BA%9B%E5%8E%9F%E5%88%99%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建 Docker 镜像应该遵循哪些原则？</h3>\n<p>答：整体原则上，尽量保持镜像功能的明确和内容的精简，要点包括</p>\n<ul>\n<li>尽量选取满足需求但较小的基础系统镜像，例如大部分时候可以选择 alpine 镜像，仅有不足六兆大小；</li>\n<li>清理编译生成文件、安装包的缓存等临时文件；</li>\n<li>安装各个软件时候要指定准确的版本号，并避免引入不需要的依赖；</li>\n<li>从安全角度考虑，应用要尽量使用系统的库和依赖；</li>\n<li>如果安装应用时候需要配置一些特殊的环境变量，在安装后要还原不需要保持的变量值；</li>\n<li>使用 Dockerfile 创建镜像时候要添加 <code class="language-text">.dockerignore</code> 文件或使用干净的工作目录。</li>\n</ul>\n<h3 id="碰到网络问题，无法-pull-镜像，命令行指定-http_proxy-无效？"><a href="#%E7%A2%B0%E5%88%B0%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98%EF%BC%8C%E6%97%A0%E6%B3%95-pull-%E9%95%9C%E5%83%8F%EF%BC%8C%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8C%87%E5%AE%9A-http_proxy-%E6%97%A0%E6%95%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>碰到网络问题，无法 pull 镜像，命令行指定 <code class="language-text">http_proxy</code> 无效？</h3>\n<p>答：在 Docker 配置文件中添加 <code class="language-text">export http_proxy=&quot;http://&lt;PROXY_HOST&gt;:&lt;PROXY_PORT&gt;&quot;</code>，之后重启 Docker 服务即可。</p>\n<h2 id="容器相关"><a href="#%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器相关</h2>\n<h3 id="容器退出后，通过-docker-container-ls-命令查看不到，数据会丢失么？"><a href="#%E5%AE%B9%E5%99%A8%E9%80%80%E5%87%BA%E5%90%8E%EF%BC%8C%E9%80%9A%E8%BF%87-docker-container-ls-%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B%E4%B8%8D%E5%88%B0%EF%BC%8C%E6%95%B0%E6%8D%AE%E4%BC%9A%E4%B8%A2%E5%A4%B1%E4%B9%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器退出后，通过 <code class="language-text">docker container ls</code> 命令查看不到，数据会丢失么？</h3>\n<p>答：容器退出后会处于终止（exited）状态，此时可以通过 <code class="language-text">docker container ls -a</code> 查看。其中的数据也不会丢失，还可以通过 docker start 命令来启动它。只有删除掉容器才会清除所有数据。</p>\n<h3 id="如何停止所有正在运行的容器？"><a href="#%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%89%80%E6%9C%89%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何停止所有正在运行的容器？</h3>\n<p>答：可以使用 <code class="language-text">docker stop $(docker container ls -q)</code> 命令。</p>\n<h3 id="如何批量清理已经停止的容器？"><a href="#%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%B8%85%E7%90%86%E5%B7%B2%E7%BB%8F%E5%81%9C%E6%AD%A2%E7%9A%84%E5%AE%B9%E5%99%A8%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何批量清理已经停止的容器？</h3>\n<p>答：可以使用 <code class="language-text">docker container prune</code> 命令。</p>\n<h3 id="如何获取某个容器的-pid-信息？"><a href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84-pid-%E4%BF%A1%E6%81%AF%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何获取某个容器的 PID 信息？</h3>\n<p>答：可以使用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56228874912918970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker inspect --format \'{{ .State.Pid }}\' <CONTAINER ID or NAME>`, `56228874912918970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker inspect --format <span class="token string">\'{{ .State.Pid }}\'</span> <span class="token operator">&lt;</span>CONTAINER ID or NAME<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="如何获取某个容器的-ip-地址？"><a href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84-ip-%E5%9C%B0%E5%9D%80%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何获取某个容器的 IP 地址？</h3>\n<p>答：可以使用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29356720975351337000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker inspect --format \'{{ .NetworkSettings.IPAddress }}\' <CONTAINER ID or NAME>`, `29356720975351337000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker inspect --format <span class="token string">\'{{ .NetworkSettings.IPAddress }}\'</span> <span class="token operator">&lt;</span>CONTAINER ID or NAME<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="如何给容器指定一个固定-ip-地址，而不是每次重启容器-ip-地址都会变？"><a href="#%E5%A6%82%E4%BD%95%E7%BB%99%E5%AE%B9%E5%99%A8%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%9B%BA%E5%AE%9A-ip-%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E6%AF%8F%E6%AC%A1%E9%87%8D%E5%90%AF%E5%AE%B9%E5%99%A8-ip-%E5%9C%B0%E5%9D%80%E9%83%BD%E4%BC%9A%E5%8F%98%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何给容器指定一个固定 IP 地址，而不是每次重启容器 IP 地址都会变？</h3>\n<p>答：使用以下命令启动容器可以使容器 IP 固定不变</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39333079089570090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker network create -d bridge --subnet 172.25.0.0/16 my-net\n\n\\$ docker run --network=my-net --ip=172.25.3.3 -itd --name=my-container busybox`, `39333079089570090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker network create -d bridge --subnet <span class="token number">172.25</span>.0.0/16 my-net\n\n$ docker run --network<span class="token operator">=</span>my-net --ip<span class="token operator">=</span><span class="token number">172.25</span>.3.3 -itd --name<span class="token operator">=</span>my-container busybox</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="如何临时退出一个正在交互的容器的终端，而不终止它？"><a href="#%E5%A6%82%E4%BD%95%E4%B8%B4%E6%97%B6%E9%80%80%E5%87%BA%E4%B8%80%E4%B8%AA%E6%AD%A3%E5%9C%A8%E4%BA%A4%E4%BA%92%E7%9A%84%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BB%88%E7%AB%AF%EF%BC%8C%E8%80%8C%E4%B8%8D%E7%BB%88%E6%AD%A2%E5%AE%83%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何临时退出一个正在交互的容器的终端，而不终止它？</h3>\n<p>答：按 <code class="language-text">Ctrl-p</code> <code class="language-text">Ctrl-q</code>。如果按 <code class="language-text">Ctrl-c</code> 往往会让容器内应用进程终止，进而会终止容器。</p>\n<h3 id="使用-docker-port-命令映射容器的端口时，系统报错-error-no-public-port-80-published-for-xxx？"><a href="#%E4%BD%BF%E7%94%A8-docker-port-%E5%91%BD%E4%BB%A4%E6%98%A0%E5%B0%84%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%97%B6%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%8A%A5%E9%94%99-error-no-public-port-80-published-for-xxx%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 docker port 命令映射容器的端口时，系统报错 “Error: No public port ‘80’ published for xxx”？</h3>\n<ul>\n<li>\n<p>创建镜像时 Dockerfile 要通过 EXPOSE 指定正确的开放端口；</p>\n</li>\n<li>\n<p>容器启动时指定 <code class="language-text">PublishAllPort = true</code>。</p>\n</li>\n</ul>\n<h3 id="可以在一个容器中同时运行多个应用进程么？"><a href="#%E5%8F%AF%E4%BB%A5%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%90%8C%E6%97%B6%E8%BF%90%E8%A1%8C%E5%A4%9A%E4%B8%AA%E5%BA%94%E7%94%A8%E8%BF%9B%E7%A8%8B%E4%B9%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可以在一个容器中同时运行多个应用进程么？</h3>\n<p>答：一般并不推荐在同一个容器内运行多个应用进程。如果有类似需求，可以通过一些额外的进程管理机制，比如 supervisord 来管理所运行的进程。可以参考 <a href="https://docs.docker.com/config/containers/multi-service_container/" target="_blank" rel="nofollow noreferrer noopener">https://docs.docker.com/config/containers/multi-service_container/</a> 。</p>\n<h3 id="如何控制容器占用系统资源（cpu、内存）的份额？"><a href="#%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6%E5%AE%B9%E5%99%A8%E5%8D%A0%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%EF%BC%88cpu%E3%80%81%E5%86%85%E5%AD%98%EF%BC%89%E7%9A%84%E4%BB%BD%E9%A2%9D%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何控制容器占用系统资源（CPU、内存）的份额？</h3>\n<p>答：在使用 <code class="language-text">docker create</code> 命令创建容器或使用 <code class="language-text">docker run</code> 创建并启动容器的时候，可以使用 <code class="language-text">-c|--cpu-shares[=0]</code> 参数来调整容器使用 CPU 的权重；使用 <code class="language-text">-m|--memory[=MEMORY]</code> 参数来调整容器使用内存的大小。</p>\n<h2 id="仓库相关"><a href="#%E4%BB%93%E5%BA%93%E7%9B%B8%E5%85%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>仓库相关</h2>\n<h3 id="仓库（repository）、注册服务器（registry）、注册索引（index）有何关系？"><a href="#%E4%BB%93%E5%BA%93%EF%BC%88repository%EF%BC%89%E3%80%81%E6%B3%A8%E5%86%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88registry%EF%BC%89%E3%80%81%E6%B3%A8%E5%86%8C%E7%B4%A2%E5%BC%95%EF%BC%88index%EF%BC%89%E6%9C%89%E4%BD%95%E5%85%B3%E7%B3%BB%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>仓库（Repository）、注册服务器（Registry）、注册索引（Index）有何关系？</h3>\n<p>首先，仓库是存放一组关联镜像的集合，比如同一个应用的不同版本的镜像。</p>\n<p>注册服务器是存放实际的镜像文件的地方。注册索引则负责维护用户的账号、权限、搜索、标签等的管理。因此，注册服务器利用注册索引来实现认证等管理。</p>\n<h2 id="配置相关"><a href="#%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置相关</h2>\n<h3 id="docker-的配置文件放在哪里，如何修改配置？"><a href="#docker-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%94%BE%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%8C%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 的配置文件放在哪里，如何修改配置？</h3>\n<p>答：使用 systemd 的系统（如 <code class="language-text">Ubuntu 16.04</code>、Centos 等）的配置文件在 <code class="language-text">/etc/docker/daemon.json</code>。</p>\n<h3 id="如何更改-docker-的默认存储位置？"><a href="#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9-docker-%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何更改 Docker 的默认存储位置？</h3>\n<p>答：Docker 的默认存储位置是 <code class="language-text">/var/lib/docker</code>，如果希望将 Docker 的本地文件存储到其他分区，可以使用 Linux 软连接的方式来完成，或者在启动 daemon 时通过 <code class="language-text">-g</code> 参数指定，或者修改配置文件 <code class="language-text">/etc/docker/daemon.json</code> 的 “data-root” 项 。可以使用 <code class="language-text">docker system info | grep &quot;Root Dir&quot;</code> 查看当前使用的存储位置。</p>\n<p>例如，如下操作将默认存储位置迁移到 <code class="language-text">/storage/docker</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66956885916232160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[root@s26 ~]# df -h\nFilesystem                    Size  Used Avail Use% Mounted on\n/dev/mapper/VolGroup-lv_root   50G  5.3G   42G  12% /\ntmpfs                          48G  228K   48G   1% /dev/shm\n/dev/sda1                     485M   40M  420M   9% /boot\n/dev/mapper/VolGroup-lv_home  222G  188M  210G   1% /home\n/dev/sdb2                     2.7T  323G  2.3T  13% /storage\n[root@s26 ~]# service docker stop\n[root@s26 ~]# cd /var/lib/\n[root@s26 lib]# mv docker /storage/\n[root@s26 lib]# ln -s /storage/docker/ docker\n[root@s26 lib]# ls -la docker\nlrwxrwxrwx. 1 root root 15 11月 17 13:43 docker -> /storage/docker\n[root@s26 lib]# service docker start`, `66956885916232160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">[</span>root@s26 ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>\nFilesystem                    Size  Used Avail Use% Mounted on\n/dev/mapper/VolGroup-lv_root   50G  <span class="token number">5</span>.3G   42G  <span class="token number">12</span>% /\ntmpfs                          48G  228K   48G   <span class="token number">1</span>% /dev/shm\n/dev/sda1                     485M   40M  420M   <span class="token number">9</span>% /boot\n/dev/mapper/VolGroup-lv_home  222G  188M  210G   <span class="token number">1</span>% /home\n/dev/sdb2                     <span class="token number">2</span>.7T  323G  <span class="token number">2</span>.3T  <span class="token number">13</span>% /storage\n<span class="token punctuation">[</span>root@s26 ~<span class="token punctuation">]</span><span class="token comment"># service docker stop</span>\n<span class="token punctuation">[</span>root@s26 ~<span class="token punctuation">]</span><span class="token comment"># cd /var/lib/</span>\n<span class="token punctuation">[</span>root@s26 lib<span class="token punctuation">]</span><span class="token comment"># mv docker /storage/</span>\n<span class="token punctuation">[</span>root@s26 lib<span class="token punctuation">]</span><span class="token comment"># ln -s /storage/docker/ docker</span>\n<span class="token punctuation">[</span>root@s26 lib<span class="token punctuation">]</span><span class="token comment"># ls -la docker</span>\nlrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">15</span> <span class="token number">11</span>月 <span class="token number">17</span> <span class="token number">13</span>:43 docker -<span class="token operator">></span> /storage/docker\n<span class="token punctuation">[</span>root@s26 lib<span class="token punctuation">]</span><span class="token comment"># service docker start</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用内存和-swap-限制启动容器时候报警告：warning-your-kernel-does-not-support-cgroup-swap-limit-warning-your-kernel-does-not-support-swap-limit-capabilities-limitation-discarded？"><a href="#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E5%92%8C-swap-%E9%99%90%E5%88%B6%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%E6%97%B6%E5%80%99%E6%8A%A5%E8%AD%A6%E5%91%8A%EF%BC%9Awarning-your-kernel-does-not-support-cgroup-swap-limit-warning-your-kernel-does-not-support-swap-limit-capabilities-limitation-discarded%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用内存和 swap 限制启动容器时候报警告：“WARNING: Your kernel does not support cgroup swap limit. WARNING: Your kernel does not support swap limit capabilities. Limitation discarded.“？</h3>\n<p>答：这是因为系统默认没有开启对内存和 swap 使用的统计功能，引入该功能会带来性能的下降。要开启该功能，可以采取如下操作：</p>\n<ul>\n<li>编辑 <code class="language-text">/etc/default/grub</code> 文件（Ubuntu 系统为例），配置 <code class="language-text">GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1&quot;</code></li>\n<li>更新 grub：<code class="language-text">$ sudo update-grub</code></li>\n<li>重启系统，即可。</li>\n</ul>\n<h2 id="docker-与虚拟化"><a href="#docker-%E4%B8%8E%E8%99%9A%E6%8B%9F%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 与虚拟化</h2>\n<h3 id="docker-与-lxc（linux-container）有何不同？"><a href="#docker-%E4%B8%8E-lxc%EF%BC%88linux-container%EF%BC%89%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 与 LXC（Linux Container）有何不同？</h3>\n<p>答：LXC 利用 Linux 上相关技术实现了容器。Docker 则在如下的几个方面进行了改进：</p>\n<ul>\n<li>移植性：通过抽象容器配置，容器可以实现从一个平台移植到另一个平台；</li>\n<li>镜像系统：基于 OverlayFS 的镜像系统为容器的分发带来了很多的便利，同时共同的镜像层只需要存储一份，实现高效率的存储；</li>\n<li>版本管理：类似于 Git 的版本管理理念，用户可以更方便的创建、管理镜像文件；</li>\n<li>仓库系统：仓库系统大大降低了镜像的分发和管理的成本；</li>\n<li>周边工具：各种现有工具（配置管理、云平台）对 Docker 的支持，以及基于 Docker 的 PaaS、CI 等系统，让 Docker 的应用更加方便和多样化。</li>\n</ul>\n<h3 id="docker-与-vagrant-有何不同？"><a href="#docker-%E4%B8%8E-vagrant-%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 与 Vagrant 有何不同？</h3>\n<p>答：两者的定位完全不同。</p>\n<ul>\n<li>Vagrant 类似 Boot2Docker（一款运行 Docker 的最小内核），是一套虚拟机的管理环境。Vagrant 可以在多种系统上和虚拟机软件中运行，可以在 Windows，Mac 等非 Linux 平台上为 Docker 提供支持，自身具有较好的包装性和移植性。</li>\n<li>原生的 Docker 自身只能运行在 Linux 平台上，但启动和运行的性能都比虚拟机要快，往往更适合快速开发和部署应用的场景。</li>\n</ul>\n<p>简单说：Vagrant 适合用来管理虚拟机，而 Docker 适合用来管理应用环境。</p>\n<h3 id="开发环境中-docker-和-vagrant-该如何选择？"><a href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%B8%AD-docker-%E5%92%8C-vagrant-%E8%AF%A5%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>开发环境中 Docker 和 Vagrant 该如何选择？</h3>\n<p>答：Docker 不是虚拟机，而是进程隔离，对于资源的消耗很少，但是目前需要 Linux 环境支持。Vagrant 是虚拟机上做的封装，虚拟机本身会消耗资源。</p>\n<p>如果本地使用的 Linux 环境，推荐都使用 Docker。</p>\n<p>如果本地使用的是 macOS 或者 Windows 环境，那就需要开虚拟机，单一开发环境下 Vagrant 更简单；多环境开发下推荐在 Vagrant 里面再使用 Docker 进行环境隔离。</p>\n<h2 id="其它"><a href="#%E5%85%B6%E5%AE%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其它</h2>\n<h3 id="docker-能在非-linux-平台（比如-windows-或-macos-）上运行么？"><a href="#docker-%E8%83%BD%E5%9C%A8%E9%9D%9E-linux-%E5%B9%B3%E5%8F%B0%EF%BC%88%E6%AF%94%E5%A6%82-windows-%E6%88%96-macos-%EF%BC%89%E4%B8%8A%E8%BF%90%E8%A1%8C%E4%B9%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 能在非 Linux 平台（比如 Windows 或 macOS ）上运行么？</h3>\n<p>答：完全可以。</p>\n<h3 id="如何将一台宿主主机的-docker-环境迁移到另外一台宿主主机？"><a href="#%E5%A6%82%E4%BD%95%E5%B0%86%E4%B8%80%E5%8F%B0%E5%AE%BF%E4%B8%BB%E4%B8%BB%E6%9C%BA%E7%9A%84-docker-%E7%8E%AF%E5%A2%83%E8%BF%81%E7%A7%BB%E5%88%B0%E5%8F%A6%E5%A4%96%E4%B8%80%E5%8F%B0%E5%AE%BF%E4%B8%BB%E4%B8%BB%E6%9C%BA%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何将一台宿主主机的 Docker 环境迁移到另外一台宿主主机？</h3>\n<p>答：停止 Docker 服务。将整个 Docker 存储文件夹复制到另外一台宿主主机，然后调整另外一台宿主主机的配置即可。</p>\n<h3 id="如何进入-docker-容器的网络命名空间？"><a href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E5%85%A5-docker-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何进入 Docker 容器的网络命名空间？</h3>\n<p>答：Docker 在创建容器后，删除了宿主主机上 <code class="language-text">/var/run/netns</code> 目录中的相关的网络命名空间文件。因此，在宿主主机上是无法看到或访问容器的网络命名空间的。</p>\n<p>用户可以通过如下方法来手动恢复它。</p>\n<p>首先，使用下面的命令查看容器进程信息，比如这里的 1234。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34169638915579957000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker inspect --format=\'{{. State.Pid}}\' \\$container_id\n1234`, `34169638915579957000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker inspect --format<span class="token operator">=</span><span class="token string">\'{{. State.Pid}}\'</span> <span class="token variable">$container_id</span>\n<span class="token number">1234</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>接下来，在 <code class="language-text">/proc</code> 目录下，把对应的网络命名空间文件链接到 <code class="language-text">/var/run/netns</code> 目录。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12786562508770417000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo ln -s /proc/1234/ns/net /var/run/netns/`, `12786562508770417000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /proc/1234/ns/net /var/run/netns/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后，在宿主主机上就可以看到容器的网络命名空间信息。例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33687981253350375000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo ip netns show\n1234`, `33687981253350375000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">ip</span> netns show\n<span class="token number">1234</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>此时，用户可以通过正常的系统命令来查看或操作容器的命名空间了。例如修改容器的 IP 地址信息为 <code class="language-text">172.17.0.100/16</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28249061931635500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo ip netns exec 1234 ifconfig eth0 172.17.0.100/16`, `28249061931635500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> <span class="token number">1234</span> <span class="token function">ifconfig</span> eth0 <span class="token number">172.17</span>.0.100/16</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="如何获取容器绑定到本地那个-veth-接口上？"><a href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%AE%B9%E5%99%A8%E7%BB%91%E5%AE%9A%E5%88%B0%E6%9C%AC%E5%9C%B0%E9%82%A3%E4%B8%AA-veth-%E6%8E%A5%E5%8F%A3%E4%B8%8A%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何获取容器绑定到本地那个 veth 接口上？</h3>\n<p>答：Docker 容器启动后，会通过 veth 接口对连接到本地网桥，veth 接口命名跟容器命名毫无关系，十分难以找到对应关系。</p>\n<p>最简单的一种方式是通过查看接口的索引号，在容器中执行 <code class="language-text">ip a</code> 命令，查看到本地接口最前面的接口索引号，如 205，将此值加上 1，即 206，然后在本地主机执行 <code class="language-text">ip a</code> 命令，查找接口索引号为 206 的接口，两者即为连接的 veth 接口对。</p>\n<h1 id="docker-命令"><a href="#docker-%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 命令</h1>\n<p>Docker 命令有两大类，客户端命令和服务端命令。前者是主要的操作接口，后者用来启动 Docker Daemon。</p>\n<ul>\n<li>客户端命令：基本命令格式为 <code class="language-text">docker [OPTIONS] COMMAND [arg...]</code>；</li>\n<li>服务端命令：基本命令格式为 <code class="language-text">dockerd [OPTIONS]</code>。</li>\n</ul>\n<p>可以通过 <code class="language-text">man docker</code> 或 <code class="language-text">docker help</code> 来查看这些命令。</p>\n<h2 id="客户端命令docker"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4docker" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端命令(docker)</h2>\n<h3 id="客户端命令选项"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端命令选项</h3>\n<ul>\n<li><code class="language-text">--config=&quot;&quot;</code>：指定客户端配置文件，默认为 <code class="language-text">~/.docker</code>；</li>\n<li><code class="language-text">-D=true|false</code>：是否使用 debug 模式。默认不开启；</li>\n<li><code class="language-text">-H, --host=[]</code>：指定命令对应 Docker 守护进程的监听接口，可以为 unix 套接字 <code class="language-text">unix:///path/to/socket</code>，文件句柄 <code class="language-text">fd://socketfd</code> 或 tcp 套接字 <code class="language-text">tcp://[host[:port]]</code>，默认为 <code class="language-text">unix:///var/run/docker.sock</code>；</li>\n<li><code class="language-text">-l, --log-level=&quot;debug|info|warn|error|fatal&quot;</code>：指定日志输出级别；</li>\n<li><code class="language-text">--tls=true|false</code>：是否对 Docker 守护进程启用 TLS 安全机制，默认为否；</li>\n<li><code class="language-text">--tlscacert=/.docker/ca.pem</code>：TLS CA 签名的可信证书文件路径；</li>\n<li><code class="language-text">--tlscert=/.docker/cert.pem</code>：TLS 可信证书文件路径；</li>\n<li><code class="language-text">--tlscert=/.docker/key.pem</code>：TLS 密钥文件路径；</li>\n<li><code class="language-text">--tlsverify=true|false</code>：启用 TLS 校验，默认为否。</li>\n</ul>\n<h3 id="客户端命令"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端命令</h3>\n<p>可以通过 <code class="language-text">docker COMMAND --help</code> 来查看这些命令的具体用法。</p>\n<ul>\n<li>attach：依附到一个正在运行的容器中；</li>\n<li>build：从一个 Dockerfile 创建一个镜像；</li>\n<li>commit：从一个容器的修改中创建一个新的镜像；</li>\n<li>cp：在容器和本地宿主系统之间复制文件中；</li>\n<li>create：创建一个新容器，但并不运行它；</li>\n<li>diff：检查一个容器内文件系统的修改，包括修改和增加；</li>\n<li>events：从服务端获取实时的事件；</li>\n<li>exec：在运行的容器内执行命令；</li>\n<li>export：导出容器内容为一个 tar 包；</li>\n<li>history：显示一个镜像的历史信息；</li>\n<li>images：列出存在的镜像；</li>\n<li>import：导入一个文件（典型为 tar 包）路径或目录来创建一个本地镜像；</li>\n<li>info：显示一些相关的系统信息；</li>\n<li>inspect：显示一个容器的具体配置信息；</li>\n<li>kill：关闭一个运行中的容器 (包括进程和所有相关资源)；</li>\n<li>load：从一个 tar 包中加载一个镜像；</li>\n<li>login：注册或登录到一个 Docker 的仓库服务器；</li>\n<li>logout：从 Docker 的仓库服务器登出；</li>\n<li>logs：获取容器的 log 信息；</li>\n<li>network：管理 Docker 的网络，包括查看、创建、删除、挂载、卸载等；</li>\n<li>node：管理 swarm 集群中的节点，包括查看、更新、删除、提升/取消管理节点等；</li>\n<li>pause：暂停一个容器中的所有进程；</li>\n<li>port：查找一个 nat 到一个私有网口的公共口；</li>\n<li>ps：列出主机上的容器；</li>\n<li>pull：从一个 Docker 的仓库服务器下拉一个镜像或仓库；</li>\n<li>push：将一个镜像或者仓库推送到一个 Docker 的注册服务器；</li>\n<li>rename：重命名一个容器；</li>\n<li>restart：重启一个运行中的容器；</li>\n<li>rm：删除给定的若干个容器；</li>\n<li>rmi：删除给定的若干个镜像；</li>\n<li>run：创建一个新容器，并在其中运行给定命令；</li>\n<li>save：保存一个镜像为 tar 包文件；</li>\n<li>search：在 Docker index 中搜索一个镜像；</li>\n<li>service：管理 Docker 所启动的应用服务，包括创建、更新、删除等；</li>\n<li>start：启动一个容器；</li>\n<li>stats：输出（一个或多个）容器的资源使用统计信息；</li>\n<li>stop：终止一个运行中的容器；</li>\n<li>swarm：管理 Docker swarm 集群，包括创建、加入、退出、更新等；</li>\n<li>tag：为一个镜像打标签；</li>\n<li>top：查看一个容器中的正在运行的进程信息；</li>\n<li>unpause：将一个容器内所有的进程从暂停状态中恢复；</li>\n<li>update：更新指定的若干容器的配置信息；</li>\n<li>version：输出 Docker 的版本信息；</li>\n<li>volume：管理 Docker volume，包括查看、创建、删除等；</li>\n<li>wait：阻塞直到一个容器终止，然后输出它的退出符。</li>\n</ul>\n<h3 id="一张图总结-docker-的命令"><a href="#%E4%B8%80%E5%BC%A0%E5%9B%BE%E6%80%BB%E7%BB%93-docker-%E7%9A%84%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一张图总结 Docker 的命令</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-20-14-15-18-6a07fce065941fb650ecfc12354bb03b-95179.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAACh0lEQVQ4y5VUvW7UQBD2S/EKFLwALW9ARRdRICEh0VBRQQQtNUJEoUAhCaCg5EiU5Mzpcpf7sX3ntfd/7f2zGdvK5YBrGFmrsXe+mdlvvnWQITSdTPr90DlX/6cFK6+qqnXfe1/dmG/t37CgWrPVtjHGWiulVEoVRcEoI4RsAK88iIZQCBKcE4wZawCAT9EySRJKKQTACjGbwTjPM4zj8ej69EQoJaXIsrw3OBqMfkFxsAylQogNYGg1DEPWGqSnrUHNOI4IwdAFF5Kmc8Wyrv2/KwO+4xzACCGtNXyBFV67jEJwCLqtDNQUrakbA7/LAgzDAg6kLUu9illxFiTxbHw1TJLFxkmuT2HdIJvRRWBN0R2g61wbDXVuAa1DwzeTzw/Toy1Xom7DeysFac6c5/ll/4Jymuf49KwXxfN220Pz0Kl1lQpfLT49YN8eVWW+YgsKgEh8WRQAW1K5pCrLMcwWkEA1Qin4XReYSWMbLr2xivKSSWddADTAMNKcMO3hwbyhBWjuRsUZM7Yyl09n7++yvfuKXpNrdL5zcLXX01R28vTa+lxaJDRXxlnDOQdpNweuGkmbaDc7fsEvthVH/paNKjDWdEoEMaUpoiAlzgil8Txappmta+etrusUWjJOSMFTTKYLFiFXmgDmN52NkngOzUfRbLGYDwahEBKKLrN8ME9kWVa1B2HqssSUoOFs8vVsfnRpuAqgveEUHf4cf79IfvSj/eNhOF5UNxcQGMGYAKFKpE7TopB+7fI1ozrojZ9v7z57e/jk9f7jlx8/HAzWbl8Tyk+2Ru/upDv3vIqa795BdqPLAJTrnW0iCpdSo90ff4LWqR0+N7NdE39xpugKg7yUJL8BbOM6W57Sp9wAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 20 14 15 18" title="" data-src="/static/2022-07-20-14-15-18-6a07fce065941fb650ecfc12354bb03b-fee1c.png" data-srcset="/static/2022-07-20-14-15-18-6a07fce065941fb650ecfc12354bb03b-a67b7.png 200w,\n/static/2022-07-20-14-15-18-6a07fce065941fb650ecfc12354bb03b-0b187.png 400w,\n/static/2022-07-20-14-15-18-6a07fce065941fb650ecfc12354bb03b-fee1c.png 800w,\n/static/2022-07-20-14-15-18-6a07fce065941fb650ecfc12354bb03b-b1a91.png 1200w,\n/static/2022-07-20-14-15-18-6a07fce065941fb650ecfc12354bb03b-95179.png 1600w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="服务端命令dockerd"><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%91%BD%E4%BB%A4dockerd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>服务端命令(dockerd)</h2>\n<h3 id="dockerd-命令选项"><a href="#dockerd-%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dockerd 命令选项</h3>\n<ul>\n<li><code class="language-text">--api-cors-header=&quot;&quot;</code>：CORS 头部域，默认不允许 CORS，要允许任意的跨域访问，可以指定为 ”*“；</li>\n<li><code class="language-text">--authorization-plugin=&quot;&quot;</code>：载入认证的插件；</li>\n<li><code class="language-text">-b=&quot;&quot;</code>：将容器挂载到一个已存在的网桥上。指定为 none 时则禁用容器的网络，与 <code class="language-text">--bip</code> 选项互斥；</li>\n<li><code class="language-text">--bip=&quot;&quot;</code>：让动态创建的 docker0 网桥采用给定的 CIDR 地址; 与 <code class="language-text">-b</code> 选项互斥；</li>\n<li><code class="language-text">--cgroup-parent=&quot;&quot;</code>：指定 cgroup 的父组，默认 fs cgroup 驱动为 <code class="language-text">/docker</code>，systemd cgroup 驱动为 <code class="language-text">system.slice</code>；</li>\n<li><code class="language-text">--cluster-store=&quot;&quot;</code>：构成集群（如 Swarm）时，集群键值数据库服务地址；</li>\n<li><code class="language-text">--cluster-advertise=&quot;&quot;</code>：构成集群时，自身的被访问地址，可以为 <code class="language-text">host:port</code> 或 <code class="language-text">interface:port</code>；</li>\n<li><code class="language-text">--cluster-store-opt=&quot;&quot;</code>：构成集群时，键值数据库的配置选项；</li>\n<li><code class="language-text">--config-file=&quot;/etc/docker/daemon.json&quot;</code>：daemon 配置文件路径；</li>\n<li><code class="language-text">--containerd=&quot;&quot;</code>：containerd 文件的路径；</li>\n<li><code class="language-text">-D, --debug=true|false</code>：是否使用 Debug 模式。缺省为 false；</li>\n<li><code class="language-text">--default-gateway=&quot;&quot;</code>：容器的 IPv4 网关地址，必须在网桥的子网段内；</li>\n<li><code class="language-text">--default-gateway-v6=&quot;&quot;</code>：容器的 IPv6 网关地址；</li>\n<li><code class="language-text">--default-ulimit=[]</code>：默认的 ulimit 值；</li>\n<li><code class="language-text">--disable-legacy-registry=true|false</code>：是否允许访问旧版本的镜像仓库服务器；</li>\n<li><code class="language-text">--dns=&quot;&quot;</code>：指定容器使用的 DNS 服务器地址；</li>\n<li><code class="language-text">--dns-opt=&quot;&quot;</code>：DNS 选项；</li>\n<li><code class="language-text">--dns-search=[]</code>：DNS 搜索域；</li>\n<li><code class="language-text">--exec-opt=[]</code>：运行时的执行选项；</li>\n<li><code class="language-text">--exec-root=&quot;&quot;</code>：容器执行状态文件的根路径，默认为 <code class="language-text">/var/run/docker</code>；</li>\n<li><code class="language-text">--fixed-cidr=&quot;&quot;</code>：限定分配 IPv4 地址范围；</li>\n<li><code class="language-text">--fixed-cidr-v6=&quot;&quot;</code>：限定分配 IPv6 地址范围；</li>\n<li><code class="language-text">-G, --group=&quot;&quot;</code>：分配给 unix 套接字的组，默认为 docker；</li>\n<li><code class="language-text">-g, --graph=&quot;&quot;</code>：Docker 运行时的根路径，默认为 <code class="language-text">/var/lib/docker</code>；</li>\n<li><code class="language-text">-H, --host=[]</code>：指定命令对应 Docker daemon 的监听接口，可以为 unix 套接字 <code class="language-text">unix:///path/to/socket</code>，文件句柄 <code class="language-text">fd://socketfd</code> 或 tcp 套接字 <code class="language-text">tcp://[host[:port]]</code>，默认为 <code class="language-text">unix:///var/run/docker.sock</code>；</li>\n<li><code class="language-text">--icc=true|false</code>：是否启用容器间以及跟 daemon 所在主机的通信。默认为 true。</li>\n<li><code class="language-text">--insecure-registry=[]</code>：允许访问给定的非安全仓库服务；</li>\n<li><code class="language-text">--ip=&quot;&quot;</code>：绑定容器端口时候的默认 IP 地址。缺省为 0.0.0.0；</li>\n<li><code class="language-text">--ip-forward=true|false</code>：是否检查启动在 Docker 主机上的启用 IP 转发服务，默认开启。注意关闭该选项将不对系统转发能力进行任何检查修改；</li>\n<li><code class="language-text">--ip-masq=true|false</code>：是否进行地址伪装，用于容器访问外部网络，默认开启；</li>\n<li><code class="language-text">--iptables=true|false</code>：是否允许 Docker 添加 iptables 规则。缺省为 true；</li>\n<li><code class="language-text">--ipv6=true|false</code>：是否启用 IPv6 支持，默认关闭；</li>\n<li><code class="language-text">-l, --log-level=&quot;debug|info|warn|error|fatal&quot;</code>：指定日志输出级别；</li>\n<li><code class="language-text">--label=&quot;[]&quot;</code>：添加指定的键值对标注；</li>\n<li><code class="language-text">--log-driver=&quot;json-file|syslog|journald|gelf|fluentd|awslogs|splunk|etwlogs|gcplogs|none&quot;</code>：指定日志后端驱动，默认为 <code class="language-text">json-file</code>；</li>\n<li><code class="language-text">--log-opt=[]</code>：日志后端的选项；</li>\n<li><code class="language-text">--mtu=VALUE</code>：指定容器网络的 mtu；</li>\n<li><code class="language-text">-p=&quot;&quot;</code>：指定 daemon 的 PID 文件路径。缺省为 <code class="language-text">/var/run/docker.pid</code>；</li>\n<li><code class="language-text">--raw-logs</code>：输出原始，未加色彩的日志信息；</li>\n<li><code class="language-text">--registry-mirror=&lt;scheme&gt;://&lt;host&gt;</code>：指定 docker pull 时使用的注册服务器镜像地址；</li>\n<li><code class="language-text">-s, --storage-driver=&quot;&quot;</code>：指定使用给定的存储后端；</li>\n<li><code class="language-text">--selinux-enabled=true|false</code>：是否启用 SELinux 支持。缺省值为 false。SELinux 目前尚不支持 overlay 存储驱动；</li>\n<li><code class="language-text">--storage-opt=[]</code>：驱动后端选项；</li>\n<li><code class="language-text">--tls=true|false</code>：是否对 Docker daemon 启用 TLS 安全机制，默认为否；</li>\n<li><code class="language-text">--tlscacert=/.docker/ca.pem</code>：TLS CA 签名的可信证书文件路径；</li>\n<li><code class="language-text">--tlscert=/.docker/cert.pem</code>：TLS 可信证书文件路径；</li>\n<li><code class="language-text">--tlscert=/.docker/key.pem</code>：TLS 密钥文件路径；</li>\n<li><code class="language-text">--tlsverify=true|false</code>：启用 TLS 校验，默认为否；</li>\n<li><code class="language-text">--userland-proxy=true|false</code>：是否使用用户态代理来实现容器间和出容器的回环通信，默认为 true；</li>\n<li><code class="language-text">--userns-remap=default|uid:gid|user:group|user|uid</code>：指定容器的用户命名空间，默认是创建新的 UID 和 GID 映射到容器内进程。</li>\n</ul>\n<h1 id="dockerfile-最佳实践"><a href="#dockerfile-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile 最佳实践</h1>\n<h2 id="一般性的指南和建议"><a href="#%E4%B8%80%E8%88%AC%E6%80%A7%E7%9A%84%E6%8C%87%E5%8D%97%E5%92%8C%E5%BB%BA%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一般性的指南和建议</h2>\n<h3 id="容器应该是短暂的"><a href="#%E5%AE%B9%E5%99%A8%E5%BA%94%E8%AF%A5%E6%98%AF%E7%9F%AD%E6%9A%82%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器应该是短暂的</h3>\n<p>通过 Dockerfile 构建的镜像所启动的容器应该尽可能短暂（生命周期短）。「短暂」意味着可以停止和销毁容器，并且创建一个新容器并部署好所需的设置和配置工作量应该是极小的。</p>\n<h3 id="使用-dockerignore-文件"><a href="#%E4%BD%BF%E7%94%A8-dockerignore-%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 .dockerignore 文件</h3>\n<p>使用 Dockerfile 构建镜像时最好是将 Dockerfile 放置在一个新建的空目录下。然后将构建镜像所需要的文件添加到该目录中。为了提高构建镜像的效率，你可以在目录下新建一个 .dockerignore 文件来指定要忽略的文件和目录。.dockerignore 文件的排除模式语法和 Git 的 .gitignore 文件相似。</p>\n<h3 id="使用多阶段构建-1"><a href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用多阶段构建</h3>\n<p>在 Docker 17.05 以上版本中，你可以使用多阶段构建来减少所构建镜像的大小。</p>\n<h3 id="避免安装不必要的包"><a href="#%E9%81%BF%E5%85%8D%E5%AE%89%E8%A3%85%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>避免安装不必要的包</h3>\n<p>为了降低复杂性、减少依赖、减小文件大小、节约构建时间，你应该避免安装任何不必要的包。例如，不要在数据库镜像中包含一个文本编辑器。</p>\n<h3 id="一个容器只运行一个进程"><a href="#%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E5%8F%AA%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一个容器只运行一个进程</h3>\n<p>应该保证在一个容器中只运行一个进程。将多个应用解耦到不同容器中，保证了容器的横向扩展和复用。例如 web 应用应该包含三个容器：web 应用、数据库、缓存。</p>\n<p>如果容器互相依赖，你可以使用 Docker 自定义网络来把这些容器连接起来。</p>\n<h3 id="镜像层数尽可能少"><a href="#%E9%95%9C%E5%83%8F%E5%B1%82%E6%95%B0%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%B0%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>镜像层数尽可能少</h3>\n<p>你需要在 Dockerfile 可读性（也包括长期的可维护性）和减少层数之间做一个平衡。</p>\n<h3 id="将多行参数排序"><a href="#%E5%B0%86%E5%A4%9A%E8%A1%8C%E5%8F%82%E6%95%B0%E6%8E%92%E5%BA%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>将多行参数排序</h3>\n<p>将多行参数按字母顺序排序（比如要安装多个包时）。这可以帮助你避免重复包含同一个包，更新包列表时也更容易。也便于 PRs 阅读和审查。建议在反斜杠符号 <code class="language-text">\\</code> 之前添加一个空格，以增加可读性。</p>\n<p>下面是来自 <code class="language-text">buildpack-deps</code> 镜像的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51122330707826880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN apt-get update && apt-get install -y \\\n  bzr \\\n  cvs \\\n  git \\\n  mercurial \\\n  subversion`, `51122330707826880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y \\\n  bzr \\\n  cvs \\\n  git \\\n  mercurial \\\n  subversion</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="构建缓存"><a href="#%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建缓存</h3>\n<p>在镜像的构建过程中，Docker 会遍历 Dockerfile 文件中的指令，然后按顺序执行。在执行每条指令之前，Docker 都会在缓存中查找是否已经存在可重用的镜像，如果有就使用现存的镜像，不再重复创建。如果你不想在构建过程中使用缓存，你可以在 docker build 命令中使用 <code class="language-text">--no-cache=true</code> 选项。</p>\n<p>但是，如果你想在构建的过程中使用缓存，你得明白什么时候会，什么时候不会找到匹配的镜像，遵循的基本规则如下：</p>\n<ul>\n<li>从一个基础镜像开始（FROM 指令指定），下一条指令将和该基础镜像的所有子镜像进行匹配，检查这些子镜像被创建时使用的指令是否和被检查的指令完全一样。如果不是，则缓存失效。</li>\n<li>在大多数情况下，只需要简单地对比 Dockerfile 中的指令和子镜像。然而，有些指令需要更多的检查和解释。</li>\n<li>对于 ADD 和 COPY 指令，镜像中对应文件的内容也会被检查，每个文件都会计算出一个校验和。文件的最后修改时间和最后访问时间不会纳入校验。在缓存的查找过程中，会将这些校验和和已存在镜像中的文件校验和进行对比。如果文件有任何改变，比如内容和元数据，则缓存失效。</li>\n<li>除了 ADD 和 COPY 指令，缓存匹配过程不会查看临时容器中的文件来决定缓存是否匹配。例如，当执行完 <code class="language-text">RUN apt-get -y update</code> 指令后，容器中一些文件被更新，但 Docker 不会检查这些文件。这种情况下，只有指令字符串本身被用来匹配缓存。</li>\n</ul>\n<p>一旦缓存失效，所有后续的 Dockerfile 指令都将产生新的镜像，缓存不会被使用。</p>\n<h2 id="dockerfile-指令"><a href="#dockerfile-%E6%8C%87%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile 指令</h2>\n<p>下面针对 Dockerfile 中各种指令的最佳编写方式给出建议。</p>\n<h3 id="from"><a href="#from" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FROM</h3>\n<p>尽可能使用当前官方仓库作为你构建镜像的基础。推荐使用 Alpine 镜像，因为它被严格控制并保持最小尺寸（目前小于 5 MB），但它仍然是一个完整的发行版。</p>\n<h3 id="label"><a href="#label" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LABEL</h3>\n<p>你可以给镜像添加标签来帮助组织镜像、记录许可信息、辅助自动化构建等。每个标签一行，由 LABEL 开头加上一个或多个标签对。下面的示例展示了各种不同的可能格式。<code class="language-text">#</code> 开头的行是注释内容。</p>\n<p>注意：如果你的字符串中包含空格，必须将字符串放入引号中或者对空格使用转义。如果字符串内容本身就包含引号，必须对引号使用转义。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64623541263423160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# Set one or more individual labels\nLABEL com.example.version=&quot;0.0.1-beta&quot;\n\nLABEL vendor=&quot;ACME Incorporated&quot;\n\nLABEL com.example.release-date=&quot;2015-02-12&quot;\n\nLABEL com.example.version.is-production=&quot;&quot;`, `64623541263423160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># Set one or more individual labels</span>\n<span class="token keyword">LABEL</span> com.example.version=<span class="token string">"0.0.1-beta"</span>\n\n<span class="token keyword">LABEL</span> vendor=<span class="token string">"ACME Incorporated"</span>\n\n<span class="token keyword">LABEL</span> com.example.release<span class="token punctuation">-</span>date=<span class="token string">"2015-02-12"</span>\n\n<span class="token keyword">LABEL</span> com.example.version.is<span class="token punctuation">-</span>production=<span class="token string">""</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个镜像可以包含多个标签，但建议将多个标签放入到一个 LABEL 指令中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37651494075037030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# Set multiple labels at once, using line-continuation characters to break long lines\nLABEL vendor=ACME\\ Incorporated \\\n      com.example.is-beta= \\\n      com.example.is-production=&quot;&quot; \\\n      com.example.version=&quot;0.0.1-beta&quot; \\\n      com.example.release-date=&quot;2015-02-12&quot;`, `37651494075037030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># Set multiple labels at once, using line-continuation characters to break long lines</span>\n<span class="token keyword">LABEL</span> vendor=ACME\\ Incorporated \\\n      com.example.is<span class="token punctuation">-</span>beta= \\\n      com.example.is<span class="token punctuation">-</span>production=<span class="token string">""</span> \\\n      com.example.version=<span class="token string">"0.0.1-beta"</span> \\\n      com.example.release<span class="token punctuation">-</span>date=<span class="token string">"2015-02-12"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>关于标签可以接受的键值对，参考 <a href="https://docs.docker.com/config/labels-custom-metadata/" target="_blank" rel="nofollow noreferrer noopener">Understanding object labels</a>。关于查询标签信息，参考 <a href="https://docs.docker.com/config/labels-custom-metadata/" target="_blank" rel="nofollow noreferrer noopener">Managing labels on objects</a>。</p>\n<h3 id="run"><a href="#run" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RUN</h3>\n<p>为了保持 Dockerfile 文件的可读性，可理解性，以及可维护性，建议将长的或复杂的 RUN 指令用反斜杠 <code class="language-text">\\</code> 分割成多行。</p>\n<h4 id="apt-get"><a href="#apt-get" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>apt-get</h4>\n<p>RUN 指令最常见的用法是安装包用的 apt-get。因为 <code class="language-text">RUN apt-get</code> 指令会安装包，所以有几个问题需要注意。</p>\n<p>不要使用 <code class="language-text">RUN apt-get upgrade</code> 或 <code class="language-text">dist-upgrade</code>，因为许多基础镜像中的「必须」包不会在一个非特权容器中升级。如果基础镜像中的某个包过时了，你应该联系它的维护者。如果你确定某个特定的包，比如 foo，需要升级，使用 <code class="language-text">apt-get install -y foo</code> 就行，该指令会自动升级 foo 包。</p>\n<p>永远将 <code class="language-text">RUN apt-get update</code> 和 <code class="language-text">apt-get install</code> 组合成一条 RUN 声明，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23389977129136062000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN apt-get update && apt-get install -y \\\n        package-bar \\\n        package-baz \\\n        package-foo`, `23389977129136062000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y \\\n        package<span class="token punctuation">-</span>bar \\\n        package<span class="token punctuation">-</span>baz \\\n        package<span class="token punctuation">-</span>foo</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>将 <code class="language-text">apt-get update</code> 放在一条单独的 RUN 声明中会导致缓存问题以及后续的 <code class="language-text">apt-get install</code> 失败。比如，假设你有一个 Dockerfile 文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85408520634396330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM ubuntu:18.04\n\nRUN apt-get update\n\nRUN apt-get install -y curl`, `85408520634396330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>18.04\n\n<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update\n\n<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y curl</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>构建镜像后，所有的层都在 Docker 的缓存中。假设你后来又修改了其中的 <code class="language-text">apt-get install</code> 添加了一个包：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38495373878058860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM ubuntu:18.04\n\nRUN apt-get update\n\nRUN apt-get install -y curl nginx`, `38495373878058860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>18.04\n\n<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update\n\n<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y curl nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Docker 发现修改后的 <code class="language-text">RUN apt-get update</code> 指令和之前的完全一样。所以，<code class="language-text">apt-get update</code> 不会执行，而是使用之前的缓存镜像。因为 <code class="language-text">apt-get update</code> 没有运行，后面的 <code class="language-text">apt-get install</code> 可能安装的是过时的 curl 和 nginx 版本。</p>\n<p>使用 <code class="language-text">RUN apt-get update &amp;&amp; apt-get install -y</code> 可以确保你的 Dockerfiles 每次安装的都是包的最新的版本，而且这个过程不需要进一步的编码或额外干预。这项技术叫作 <code class="language-text">cache busting</code>。你也可以显示指定一个包的版本号来达到 <code class="language-text">cache-busting</code>，这就是所谓的固定版本，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73592949201567540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN apt-get update && apt-get install -y \\\n    package-bar \\\n    package-baz \\\n    package-foo=1.3.*`, `73592949201567540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y \\\n    package<span class="token punctuation">-</span>bar \\\n    package<span class="token punctuation">-</span>baz \\\n    package<span class="token punctuation">-</span>foo=1.3.*</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>固定版本会迫使构建过程检索特定的版本，而不管缓存中有什么。这项技术也可以减少因所需包中未预料到的变化而导致的失败。</p>\n<p>下面是一个 RUN 指令的示例模板，展示了所有关于 apt-get 的建议。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48449461285237790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN apt-get update && apt-get install -y \\\n    aufs-tools \\\n    automake \\\n    build-essential \\\n    curl \\\n    dpkg-sig \\\n    libcap-dev \\\n    libsqlite3-dev \\\n    mercurial \\\n    reprepro \\\n    ruby1.9.1 \\\n    ruby1.9.1-dev \\\n    s3cmd=1.1.* \\\n && rm -rf /var/lib/apt/lists/*`, `48449461285237790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update &amp;&amp; apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y \\\n    aufs<span class="token punctuation">-</span>tools \\\n    automake \\\n    build<span class="token punctuation">-</span>essential \\\n    curl \\\n    dpkg<span class="token punctuation">-</span>sig \\\n    libcap<span class="token punctuation">-</span>dev \\\n    libsqlite3<span class="token punctuation">-</span>dev \\\n    mercurial \\\n    reprepro \\\n    ruby1.9.1 \\\n    ruby1.9.1<span class="token punctuation">-</span>dev \\\n    s3cmd=1.1.* \\\n &amp;&amp; rm <span class="token punctuation">-</span>rf /var/lib/apt/lists/*</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 s3cmd 指令指定了一个版本号 <code class="language-text">1.1.*</code>。如果之前的镜像使用的是更旧的版本，指定新的版本会导致 <code class="language-text">apt-get udpate</code> 缓存失效并确保安装的是新版本。</p>\n<p>另外，清理掉 apt 缓存 <code class="language-text">var/lib/apt/lists</code> 可以减小镜像大小。因为 RUN 指令的开头为 <code class="language-text">apt-get udpate</code>，包缓存总是会在 <code class="language-text">apt-get install</code> 之前刷新。</p>\n<blockquote>\n<p>注意：官方的 Debian 和 Ubuntu 镜像会自动运行 <code class="language-text">apt-get clean</code>，所以不需要显式的调用 <code class="language-text">apt-get clean</code>。</p>\n</blockquote>\n<h3 id="cmd"><a href="#cmd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CMD</h3>\n<p>CMD 指令用于执行目标镜像中包含的软件，可以包含参数。CMD 大多数情况下都应该以 <code class="language-text">CMD [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;...]</code> 的形式使用。因此，如果创建镜像的目的是为了部署某个服务(比如 Apache)，你可能会执行类似于 <code class="language-text">CMD [&quot;apache2&quot;, &quot;-DFOREGROUND&quot;]</code> 形式的命令。我们建议任何服务镜像都使用这种形式的命令。</p>\n<p>多数情况下，CMD 都需要一个交互式的 shell (bash, Python, perl 等)，例如 <code class="language-text">CMD [&quot;perl&quot;, &quot;-de0&quot;]</code>，或者 <code class="language-text">CMD [&quot;PHP&quot;, &quot;-a&quot;]</code>。使用这种形式意味着，当你执行类似 <code class="language-text">docker run -it python</code> 时，你会进入一个准备好的 shell 中。CMD 应该在极少的情况下才能以 <code class="language-text">CMD [&quot;param&quot;, &quot;param&quot;]</code> 的形式与 ENTRYPOINT 协同使用，除非你和你的镜像使用者都对 ENTRYPOINT 的工作方式十分熟悉。</p>\n<h3 id="expose"><a href="#expose" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EXPOSE</h3>\n<p>EXPOSE 指令用于指定容器将要监听的端口。因此，你应该为你的应用程序使用常见的端口。例如，提供 <code class="language-text">Apache web</code> 服务的镜像应该使用 <code class="language-text">EXPOSE 80</code>，而提供 MongoDB 服务的镜像使用 <code class="language-text">EXPOSE 27017</code>。</p>\n<p>对于外部访问，用户可以在执行 <code class="language-text">docker run</code> 时使用一个标志来指示如何将指定的端口映射到所选择的端口。</p>\n<h3 id="env"><a href="#env" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ENV</h3>\n<p>为了方便新程序运行，你可以使用 ENV 来为容器中安装的程序更新 PATH 环境变量。例如使用 <code class="language-text">ENV PATH /usr/local/nginx/bin:$PATH</code> 来确保 <code class="language-text">CMD [&quot;nginx&quot;]</code> 能正确运行。</p>\n<p>ENV 指令也可用于为你想要容器化的服务提供必要的环境变量，比如 Postgres 需要的 PGDATA。</p>\n<p>最后，ENV 也能用于设置常见的版本号，比如下面的示例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86015092015299580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ENV PG_MAJOR 9.3\n\nENV PG_VERSION 9.3.4\n\nRUN curl -SL http://example.com/postgres-\\$PG_VERSION.tar.xz | tar -xJC /usr/src/postgress && …\n\nENV PATH /usr/local/postgres-\\$PG_MAJOR/bin:\\$PATH`, `86015092015299580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ENV</span> PG_MAJOR 9.3\n\n<span class="token keyword">ENV</span> PG_VERSION 9.3.4\n\n<span class="token keyword">RUN</span> curl <span class="token punctuation">-</span>SL http<span class="token punctuation">:</span>//example.com/postgres<span class="token punctuation">-</span>$PG_VERSION.tar.xz <span class="token punctuation">|</span> tar <span class="token punctuation">-</span>xJC /usr/src/postgress &amp;&amp; …\n\n<span class="token keyword">ENV</span> PATH /usr/local/postgres<span class="token punctuation">-</span>$PG_MAJOR/bin<span class="token punctuation">:</span>$PATH</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>类似于程序中的常量，这种方法可以让你只需改变 ENV 指令来自动的改变容器中的软件版本。</p>\n<h3 id="add-和-copy"><a href="#add-%E5%92%8C-copy" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ADD 和 COPY</h3>\n<p>虽然 ADD 和 COPY 功能类似，但一般优先使用 COPY。因为它比 ADD 更透明。COPY 只支持简单将本地文件拷贝到容器中，而 ADD 有一些并不明显的功能（比如本地 tar 提取和远程 URL 支持）。因此，ADD 的最佳用例是将本地 tar 文件自动提取到镜像中，例如 <code class="language-text">ADD rootfs.tar.xz</code>。</p>\n<p>如果你的 Dockerfile 有多个步骤需要使用上下文中不同的文件。单独 COPY 每个文件，而不是一次性的 COPY 所有文件，这将保证每个步骤的构建缓存只在特定的文件变化时失效。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66009327011863175000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`COPY requirements.txt /tmp/\n\nRUN pip install --requirement /tmp/requirements.txt\n\nCOPY . /tmp/`, `66009327011863175000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> requirements.txt /tmp/\n\n<span class="token keyword">RUN</span> pip install <span class="token punctuation">-</span><span class="token punctuation">-</span>requirement /tmp/requirements.txt\n\n<span class="token keyword">COPY</span> . /tmp/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果将 <code class="language-text">COPY . /tmp/</code> 放置在 RUN 指令之前，只要 <code class="language-text">.</code> 目录中任何一个文件变化，都会导致后续指令的缓存失效。</p>\n<p>为了让镜像尽量小，最好不要使用 ADD 指令从远程 URL 获取包，而是使用 curl 和 wget。这样你可以在文件提取完之后删掉不再需要的文件来避免在镜像中额外添加一层。比如尽量避免下面的用法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15197925456614382000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ADD http://example.com/big.tar.xz /usr/src/things/\n\nRUN tar -xJf /usr/src/things/big.tar.xz -C /usr/src/things\n\nRUN make -C /usr/src/things all`, `15197925456614382000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ADD</span> http<span class="token punctuation">:</span>//example.com/big.tar.xz /usr/src/things/\n\n<span class="token keyword">RUN</span> tar <span class="token punctuation">-</span>xJf /usr/src/things/big.tar.xz <span class="token punctuation">-</span>C /usr/src/things\n\n<span class="token keyword">RUN</span> make <span class="token punctuation">-</span>C /usr/src/things all</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而是应该使用下面这种方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19724723351378272000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`RUN mkdir -p /usr/src/things \\\n    && curl -SL http://example.com/big.tar.xz \\\n    | tar -xJC /usr/src/things \\\n    && make -C /usr/src/things all`, `19724723351378272000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> mkdir <span class="token punctuation">-</span>p /usr/src/things \\\n    &amp;&amp; curl <span class="token punctuation">-</span>SL http<span class="token punctuation">:</span>//example.com/big.tar.xz \\\n    <span class="token punctuation">|</span> tar <span class="token punctuation">-</span>xJC /usr/src/things \\\n    &amp;&amp; make <span class="token punctuation">-</span>C /usr/src/things all</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面使用的管道操作，所以没有中间文件需要删除。</p>\n<p>对于其他不需要 ADD 的自动提取功能的文件或目录，你应该使用 COPY。</p>\n<h3 id="entrypoint"><a href="#entrypoint" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ENTRYPOINT</h3>\n<p>ENTRYPOINT 的最佳用处是设置镜像的主命令，允许将镜像当成命令本身来运行（用 CMD 提供默认选项）。</p>\n<p>例如，下面的示例镜像提供了命令行工具 s3cmd:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89392946798285200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ENTRYPOINT [&quot;s3cmd&quot;]\n\nCMD [&quot;--help&quot;]`, `89392946798285200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"s3cmd"</span><span class="token punctuation">]</span>\n\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"--help"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>现在直接运行该镜像创建的容器会显示命令帮助：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1524397180276282400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run s3cmd`, `1524397180276282400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run s3cmd</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或者提供正确的参数来执行某个命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92518701753202560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run s3cmd ls s3://mybucket`, `92518701753202560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run s3cmd <span class="token function">ls</span> s3://mybucket</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这样镜像名可以当成命令行的参考。</p>\n<p>ENTRYPOINT 指令也可以结合一个辅助脚本使用，和前面命令行风格类似，即使启动工具需要不止一个步骤。</p>\n<p>例如，Postgres 官方镜像使用下面的脚本作为 ENTRYPOINT：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77001653938966680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/bash\nset -e\n\nif [ &quot;\\$1&quot; = \'postgres\' ]; then\n    chown -R postgres &quot;\\$PGDATA&quot;\n\n    if [ -z &quot;\\$(ls -A &quot;\\$PGDATA&quot;)&quot; ]; then\n        gosu postgres initdb\n    fi\n\n    exec gosu postgres &quot;\\$@&quot;\nfi\n\nexec &quot;\\$@&quot;`, `77001653938966680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>\n<span class="token builtin class-name">set</span> -e\n\n<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">=</span> <span class="token string">\'postgres\'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n    <span class="token function">chown</span> -R postgres <span class="token string">"<span class="token variable">$PGDATA</span>"</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> -A <span class="token string">"<span class="token variable">$PGDATA</span>"</span><span class="token variable">)</span></span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        gosu postgres initdb\n    <span class="token keyword">fi</span>\n\n    <span class="token builtin class-name">exec</span> gosu postgres <span class="token string">"<span class="token variable">$@</span>"</span>\n<span class="token keyword">fi</span>\n\n<span class="token builtin class-name">exec</span> <span class="token string">"<span class="token variable">$@</span>"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>注意：该脚本使用了 Bash 的内置命令 exec，所以最后运行的进程就是容器的 PID 为 1 的进程。这样，进程就可以接收到任何发送给容器的 Unix 信号了。</p>\n</blockquote>\n<p>该辅助脚本被拷贝到容器，并在容器启动时通过 ENTRYPOINT 执行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79961916659263950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`COPY ./docker-entrypoint.sh /\n\nENTRYPOINT [&quot;/docker-entrypoint.sh&quot;]`, `79961916659263950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> ./docker<span class="token punctuation">-</span>entrypoint.sh /\n\n<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"/docker-entrypoint.sh"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>该脚本可以让用户用几种不同的方式和 Postgres 交互。</p>\n<p>你可以很简单地启动 Postgres：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42810943242484490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run postgres`, `42810943242484490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run postgres</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也可以执行 Postgres 并传递参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92330435635670880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run postgres postgres --help`, `92330435635670880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run postgres postgres --help</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最后，你还可以启动另外一个完全不同的工具，比如 Bash：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30825565047537996000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker run --rm -it postgres bash`, `30825565047537996000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker run --rm -it postgres <span class="token function">bash</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="volume"><a href="#volume" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>VOLUME</h3>\n<p>VOLUME 指令用于暴露任何数据库存储文件，配置文件，或容器创建的文件和目录。强烈建议使用 VOLUME 来管理镜像中的可变部分和用户可以改变的部分。</p>\n<h3 id="user"><a href="#user" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>USER</h3>\n<p>如果某个服务不需要特权执行，建议使用 USER 指令切换到非 root 用户。先在 Dockerfile 中使用类似 <code class="language-text">RUN groupadd -r postgres &amp;&amp; useradd -r -g postgres postgres</code> 的指令创建用户和用户组。</p>\n<blockquote>\n<p>注意：在镜像中，用户和用户组每次被分配的 <code class="language-text">UID/GID</code> 都是不确定的，下次重新构建镜像时被分配到的 <code class="language-text">UID/GID</code> 可能会不一样。如果要依赖确定的 <code class="language-text">UID/GID</code>，你应该显式的指定一个 <code class="language-text">UID/GID</code>。</p>\n</blockquote>\n<p>你应该避免使用 sudo，因为它不可预期的 TTY 和信号转发行为可能造成的问题比它能解决的问题还多。如果你真的需要和 sudo 类似的功能（例如，以 root 权限初始化某个守护进程，以非 root 权限执行它），你可以使用 <a href="https://github.com/tianon/gosu" target="_blank" rel="nofollow noreferrer noopener">gosu</a>。</p>\n<p>最后，为了减少层数和复杂度，避免频繁地使用 USER 来回切换用户。</p>\n<h3 id="workdir"><a href="#workdir" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WORKDIR</h3>\n<p>为了清晰性和可靠性，你应该总是在 WORKDIR 中使用绝对路径。另外，你应该使用 WORKDIR 来替代类似于 <code class="language-text">RUN cd ... &amp;&amp; do-something</code> 的指令，后者难以阅读、排错和维护。</p>\n<h2 id="官方镜像示例"><a href="#%E5%AE%98%E6%96%B9%E9%95%9C%E5%83%8F%E7%A4%BA%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>官方镜像示例</h2>\n<p>这些官方镜像的 Dockerfile 都是参考典范：<a href="https://github.com/docker-library/docs" target="_blank" rel="nofollow noreferrer noopener">https://github.com/docker-library/docs</a></p>\n<h1 id="如何调试-docker"><a href="#%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-docker" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何调试 Docker</h1>\n<h2 id="开启-debug-模式"><a href="#%E5%BC%80%E5%90%AF-debug-%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>开启 Debug 模式</h2>\n<p>在 dockerd 配置文件 <code class="language-text">daemon.json</code>（默认位于 <code class="language-text">/etc/docker/</code>）中添加</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84551233278548150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;debug&quot;: true\n}`, `84551233278548150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"debug"</span><span class="token operator">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>重启守护进程。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60694825383737940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo kill -SIGHUP \\$(pidof dockerd)`, `60694825383737940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">kill</span> -SIGHUP <span class="token variable"><span class="token variable">$(</span>pidof dockerd<span class="token variable">)</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时 dockerd 会在日志中输入更多信息供分析。</p>\n<h2 id="检查内核日志"><a href="#%E6%A3%80%E6%9F%A5%E5%86%85%E6%A0%B8%E6%97%A5%E5%BF%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检查内核日志</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75468123472296670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo dmesg | grep dockerd\n\\$ sudo dmesg | grep runc`, `75468123472296670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> dockerd\n$ <span class="token function">sudo</span> <span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> runc</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="docker-不响应时处理"><a href="#docker-%E4%B8%8D%E5%93%8D%E5%BA%94%E6%97%B6%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 不响应时处理</h2>\n<p>可以杀死 dockerd 进程查看其堆栈调用情况。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10975837992533100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo kill -SIGUSR1 \\$(pidof dockerd)`, `10975837992533100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">kill</span> -SIGUSR1 <span class="token variable"><span class="token variable">$(</span>pidof dockerd<span class="token variable">)</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="重置-docker-本地数据"><a href="#%E9%87%8D%E7%BD%AE-docker-%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重置 Docker 本地数据</h2>\n<p>注意，本操作会移除所有的 Docker 本地数据，包括镜像和容器等。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3122723700560348000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo rm -rf /var/lib/docker`, `3122723700560348000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">rm</span> -rf /var/lib/docker</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h1 id="compose"><a href="#compose" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compose</h1>\n<p>Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 OpenStack 中的 Heat 十分类似。</p>\n<p>其代码目前在 <a href="https://github.com/docker/compose" target="_blank" rel="nofollow noreferrer noopener">https://github.com/docker/compose</a> 上开源。</p>\n<p>Compose 定位是「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。</p>\n<p>通过第一部分中的介绍，我们知道使用一个 Dockerfile 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p>\n<p>Compose 恰好满足了这样的需求。它允许用户通过一个单独的 <code class="language-text">docker-compose.yml</code> 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p>\n<p>Compose 中有两个重要的概念：</p>\n<ul>\n<li>服务 (service)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li>\n<li>项目 (project)：由一组关联的应用容器组成的一个完整业务单元，在 <code class="language-text">docker-compose.yml</code> 文件中定义。</li>\n</ul>\n<p>Compose 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p>\n<p>Compose 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 Compose 来进行编排管理。</p>\n<h2 id="使用-2"><a href="#%E4%BD%BF%E7%94%A8-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用</h2>\n<h3 id="术语"><a href="#%E6%9C%AF%E8%AF%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>术语</h3>\n<p>首先介绍几个术语。</p>\n<ul>\n<li>服务(service)：一个应用容器，实际上可以运行多个相同镜像的实例。</li>\n<li>项目(project)：由一组关联的应用容器组成的一个完整业务单元。</li>\n</ul>\n<p>可见，一个项目可以由多个服务（容器）关联而成，Compose 面向项目进行管理。</p>\n<h3 id="场景"><a href="#%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>场景</h3>\n<p>最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。</p>\n<p>下面我们用 Python 来建立一个能够记录页面访问次数的 web 网站。</p>\n<h4 id="web-应用"><a href="#web-%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>web 应用</h4>\n<p>新建文件夹，在该目录中编写 app.py 文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34500377324262478000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from flask import Flask\nfrom redis import Redis\n\napp = Flask(__name__)\nredis = Redis(host=\'redis\', port=6379)\n\n@app.route(\'/\')\ndef hello():\n    count = redis.incr(\'hits\')\n    return \'Hello World! 该页面已被访问 {} 次。\\n\'.format(count)\n\nif __name__ == &quot;__main__&quot;:\n    app.run(host=&quot;0.0.0.0&quot;, debug=True)`, `34500377324262478000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask\n<span class="token keyword">from</span> redis <span class="token keyword">import</span> Redis\n\napp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>\nredis <span class="token operator">=</span> Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">\'redis\'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">)</span>\n\n@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    count <span class="token operator">=</span> redis<span class="token punctuation">.</span>incr<span class="token punctuation">(</span><span class="token string">\'hits\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token string">\'Hello World! 该页面已被访问 {} 次。\\n\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n\n<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>\n    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="dockerfile-1"><a href="#dockerfile-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile</h4>\n<p>编写 Dockerfile 文件，内容为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11933507979561542000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM python:3.6-alpine\nADD . /code\nWORKDIR /code\nRUN pip install redis flask\nCMD [&quot;python&quot;, &quot;app.py&quot;]`, `11933507979561542000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> python<span class="token punctuation">:</span>3.6<span class="token punctuation">-</span>alpine\n<span class="token keyword">ADD</span> . /code\n<span class="token keyword">WORKDIR</span> /code\n<span class="token keyword">RUN</span> pip install redis flask\n<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"python"</span><span class="token punctuation">,</span> <span class="token string">"app.py"</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="docker-composeyml"><a href="#docker-composeyml" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>docker-compose.yml</h4>\n<p>编写 <code class="language-text">docker-compose.yml</code> 文件，这个是 Compose 使用的主模板文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20909205857033330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n  web:\n    build: .\n    ports:\n      - \'5000:5000\'\n\n  redis:\n    image: \'redis:alpine\'`, `20909205857033330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">web</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span> .\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'5000:5000\'</span>\n\n  <span class="token key atrule">redis</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">\'redis:alpine\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="运行-compose-项目"><a href="#%E8%BF%90%E8%A1%8C-compose-%E9%A1%B9%E7%9B%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行 compose 项目</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76694913729652800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker compose up`, `76694913729652800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker compose up</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时访问本地 5000 端口，每次刷新页面，计数就会加 1。</p>\n<h2 id="compose-命令说明"><a href="#compose-%E5%91%BD%E4%BB%A4%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compose 命令说明</h2>\n<h3 id="命令对象与格式"><a href="#%E5%91%BD%E4%BB%A4%E5%AF%B9%E8%B1%A1%E4%B8%8E%E6%A0%BC%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>命令对象与格式</h3>\n<p>对于 Compose 来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或者容器。如果没有特别的说明，命令对象将是项目，这意味着项目中所有的服务都会受到命令影响。</p>\n<p>执行 <code class="language-text">docker compose [COMMAND] --help</code> 可以查看具体某个命令的使用格式。</p>\n<p>docker compose 命令的基本的使用格式是</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53372586696262550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker compose [-f=<arg>...] [options] [COMMAND] [ARGS...]`, `53372586696262550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker compose <span class="token punctuation">[</span>-f<span class="token operator">=</span><span class="token operator">&lt;</span>arg<span class="token operator">></span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARGS<span class="token punctuation">..</span>.<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="命令选项"><a href="#%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>命令选项</h3>\n<ul>\n<li><code class="language-text">-f, --file FILE</code> 指定使用的 Compose 模板文件，默认为 <code class="language-text">docker-compose.yml</code>，可以多次指定。</li>\n<li><code class="language-text">-p, --project-name NAME</code> 指定项目名称，默认将使用所在目录名称作为项目名。</li>\n<li><code class="language-text">--verbose</code> 输出更多调试信息。</li>\n<li><code class="language-text">-v, --version</code> 打印版本并退出。</li>\n</ul>\n<h3 id="命令使用说明"><a href="#%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>命令使用说明</h3>\n<h4 id="build"><a href="#build" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>build</h4>\n<p>格式为 <code class="language-text">docker compose build [options] [SERVICE...]</code>。</p>\n<p>构建（重新构建）项目中的服务容器。</p>\n<p>服务容器一旦构建后，将会带上一个标记名，例如对于 web 项目中的一个 db 容器，可能是 <code class="language-text">web_db</code>。</p>\n<p>可以随时在项目目录下运行 <code class="language-text">docker compose build</code> 来重新构建服务。</p>\n<p>选项包括：</p>\n<ul>\n<li><code class="language-text">--force-rm</code> 删除构建过程中的临时容器。</li>\n<li><code class="language-text">--no-cache</code> 构建镜像过程中不使用 cache（这将加长构建过程）。</li>\n<li><code class="language-text">--pull</code> 始终尝试通过 pull 来获取更新版本的镜像。</li>\n</ul>\n<h4 id="config"><a href="#config" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>config</h4>\n<p>验证 Compose 文件格式是否正确，若正确则显示配置，若格式错误显示错误原因。</p>\n<h4 id="down"><a href="#down" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>down</h4>\n<p>此命令将会停止 up 命令所启动的容器，并移除网络</p>\n<h4 id="exec"><a href="#exec" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>exec</h4>\n<p>进入指定的容器。</p>\n<h4 id="help"><a href="#help" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>help</h4>\n<p>获得一个命令的帮助。</p>\n<h4 id="images"><a href="#images" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>images</h4>\n<p>列出 Compose 文件中包含的镜像。</p>\n<h4 id="kill"><a href="#kill" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kill</h4>\n<p>格式为 <code class="language-text">docker compose kill [options] [SERVICE...]</code>。</p>\n<p>通过发送 SIGKILL 信号来强制停止服务容器。</p>\n<p>支持通过 <code class="language-text">-s</code> 参数来指定发送的信号，例如通过如下指令发送 SIGINT 信号。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63152421997911580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker compose kill -s SIGINT`, `63152421997911580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker compose <span class="token function">kill</span> -s SIGINT</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="logs"><a href="#logs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>logs</h4>\n<p>格式为 <code class="language-text">docker compose logs [options] [SERVICE...]</code>。</p>\n<p>查看服务容器的输出。默认情况下，<code class="language-text">docker compose</code> 将对不同的服务输出使用不同的颜色来区分。可以通过 <code class="language-text">--no-color</code> 来关闭颜色。</p>\n<p>该命令在调试问题的时候十分有用。</p>\n<h4 id="pause"><a href="#pause" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pause</h4>\n<p>格式为 <code class="language-text">docker compose pause [SERVICE...]</code>。</p>\n<p>暂停一个服务容器。</p>\n<h4 id="port"><a href="#port" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>port</h4>\n<p>格式为 <code class="language-text">docker compose port [options] SERVICE PRIVATE_PORT</code>。</p>\n<p>打印某个容器端口所映射的公共端口。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">--protocol=proto</code> 指定端口协议，tcp（默认值）或者 udp。</li>\n<li><code class="language-text">--index=index</code> 如果同一服务存在多个容器，指定命令对象容器的序号（默认为 1）。</li>\n</ul>\n<h4 id="ps"><a href="#ps" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ps</h4>\n<p>格式为 <code class="language-text">docker compose ps [options] [SERVICE...]</code>。</p>\n<p>列出项目中目前的所有容器。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">-q</code> 只打印容器的 ID 信息。</li>\n</ul>\n<h4 id="pull"><a href="#pull" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pull</h4>\n<p>格式为 <code class="language-text">docker compose pull [options] [SERVICE...]</code>。</p>\n<p>拉取服务依赖的镜像。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">--ignore-pull-failures</code> 忽略拉取镜像过程中的错误。</li>\n</ul>\n<h4 id="push"><a href="#push" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>push</h4>\n<p>推送服务依赖的镜像到 Docker 镜像仓库。</p>\n<h4 id="restart"><a href="#restart" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>restart</h4>\n<p>格式为 <code class="language-text">docker compose restart [options] [SERVICE...]</code>。</p>\n<p>重启项目中的服务。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">-t, --timeout TIMEOUT</code> 指定重启前停止容器的超时（默认为 10 秒）。</li>\n</ul>\n<h4 id="rm"><a href="#rm" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rm</h4>\n<p>格式为 <code class="language-text">docker compose rm [options] [SERVICE...]</code>。</p>\n<p>删除所有（停止状态的）服务容器。推荐先执行 <code class="language-text">docker compose stop</code> 命令来停止容器。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">-f, --force</code> 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。</li>\n<li><code class="language-text">-v</code> 删除容器所挂载的数据卷。</li>\n</ul>\n<h4 id="run-1"><a href="#run-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>run</h4>\n<p>格式为 <code class="language-text">docker compose run [options] [-p PORT...] [-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]</code>。</p>\n<p>在指定服务上执行一个命令。</p>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96337138221118730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker compose run ubuntu ping docker.com`, `96337138221118730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker compose run ubuntu <span class="token function">ping</span> docker.com</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将会启动一个 ubuntu 服务容器，并执行 <code class="language-text">ping docker.com</code> 命令。</p>\n<p>默认情况下，如果存在关联，则所有关联的服务将会自动被启动，除非这些服务已经在运行中。</p>\n<p>该命令类似启动容器后运行指定的命令，相关卷、链接等等都将会按照配置自动创建。</p>\n<p>两个不同点：</p>\n<ol>\n<li>给定命令将会覆盖原有的自动运行命令；</li>\n<li>不会自动创建端口，以避免冲突。</li>\n</ol>\n<p>如果不希望自动启动关联的容器，可以使用 <code class="language-text">--no-deps</code> 选项，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8050815418758961000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker compose run --no-deps web python manage.py shell`, `8050815418758961000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker compose run --no-deps web python manage.py shell</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将不会启动 web 容器所关联的其它容器。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">-d</code> 后台运行容器。</li>\n<li><code class="language-text">--name NAME</code> 为容器指定一个名字。</li>\n<li><code class="language-text">--entrypoint CMD</code> 覆盖默认的容器启动指令。</li>\n<li><code class="language-text">-e KEY=VAL</code> 设置环境变量值，可多次使用选项来设置多个环境变量。</li>\n<li><code class="language-text">-u, --user=&quot;&quot;</code> 指定运行容器的用户名或者 uid。</li>\n<li><code class="language-text">--no-deps</code> 不自动启动关联的服务容器。</li>\n<li><code class="language-text">--rm</code> 运行命令后自动删除容器，<code class="language-text">d</code> 模式下将忽略。</li>\n<li><code class="language-text">-p, --publish=[]</code> 映射容器端口到本地主机。</li>\n<li><code class="language-text">--service-ports</code> 配置服务端口并映射到本地主机。</li>\n<li><code class="language-text">-T</code> 不分配伪 tty，意味着依赖 tty 的指令将无法运行。</li>\n</ul>\n<h4 id="start"><a href="#start" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>start</h4>\n<p>格式为 <code class="language-text">docker compose start [SERVICE...]</code>。</p>\n<p>启动已经存在的服务容器。</p>\n<h4 id="stop"><a href="#stop" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>stop</h4>\n<p>格式为 <code class="language-text">docker compose stop [options] [SERVICE...]</code>。</p>\n<p>停止已经处于运行状态的容器，但不删除它。通过 <code class="language-text">docker compose start</code> 可以再次启动这些容器。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</li>\n</ul>\n<h4 id="top"><a href="#top" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>top</h4>\n<p>查看各个服务容器内运行的进程。</p>\n<h4 id="unpause"><a href="#unpause" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>unpause</h4>\n<p>格式为 <code class="language-text">docker compose unpause [SERVICE...]</code>。</p>\n<p>恢复处于暂停状态中的服务。</p>\n<h4 id="up"><a href="#up" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>up</h4>\n<p>格式为 <code class="language-text">docker compose up [options] [SERVICE...]</code>。</p>\n<p>该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。</p>\n<p>链接的服务都将会被自动启动，除非已经处于运行状态。</p>\n<p>可以说，大部分时候都可以直接通过该命令来启动一个项目。</p>\n<p>默认情况，<code class="language-text">docker compose up</code> 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。</p>\n<p>当通过 <code class="language-text">Ctrl-C</code> 停止命令时，所有容器将会停止。</p>\n<p>如果使用 <code class="language-text">docker compose up -d</code>，将会在后台启动并运行所有的容器。一般推荐生产环境下使用该选项。</p>\n<p>默认情况，如果服务容器已经存在，<code class="language-text">docker compose up</code> 将会尝试停止容器，然后重新创建（保持使用 <code class="language-text">volumes-from</code> 挂载的卷），以保证新启动的服务匹配 <code class="language-text">docker-compose.yml</code> 文件的最新内容。如果用户不希望容器被停止并重新创建，可以使用 <code class="language-text">docker compose up --no-recreate</code>。这样将只会启动处于停止状态的容器，而忽略已经运行的服务。如果用户只想重新部署某个服务，可以使用 <code class="language-text">docker compose up --no-deps -d &lt;SERVICE_NAME&gt;</code> 来重新创建服务并后台停止旧服务，启动新服务，并不会影响到其所依赖的服务。</p>\n<p>选项：</p>\n<ul>\n<li><code class="language-text">-d</code> 在后台运行服务容器。</li>\n<li><code class="language-text">--no-color</code> 不使用颜色来区分不同的服务的控制台输出。</li>\n<li><code class="language-text">--no-deps</code> 不启动服务所链接的容器。</li>\n<li><code class="language-text">--force-recreate</code> 强制重新创建容器，不能与 <code class="language-text">--no-recreate</code> 同时使用。</li>\n<li><code class="language-text">--no-recreate</code> 如果容器已经存在了，则不重新创建，不能与 <code class="language-text">--force-recreate</code> 同时使用。</li>\n<li><code class="language-text">--no-build</code> 不自动构建缺失的服务镜像。</li>\n<li><code class="language-text">-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</li>\n</ul>\n<h4 id="version"><a href="#version" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>version</h4>\n<p>格式为 <code class="language-text">docker compose version</code>。</p>\n<p>打印版本信息。</p>\n<h2 id="compose-模板文件"><a href="#compose-%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compose 模板文件</h2>\n<p>模板文件是使用 Compose 的核心，涉及到的指令关键字也比较多。但大家不用担心，这里面大部分指令跟 docker run 相关参数的含义都是类似的。</p>\n<p>默认的模板文件名称为 <code class="language-text">docker-compose.yml</code>，格式为 YAML 格式。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69503645879249980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\n\nservices:\n  webapp:\n    image: examples/web\n    ports:\n      - \'80:80\'\n    volumes:\n      - \'/data\'`, `69503645879249980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> examples/web\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'80:80\'</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'/data\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意每个服务都必须通过 image 指令指定镜像或 build 指令（需要 Dockerfile）等来自动构建生成镜像。</p>\n<p>如果使用 build 指令，在 Dockerfile 中设置的选项(例如：CMD, EXPOSE, VOLUME, ENV 等) 将会自动被获取，无需在 <code class="language-text">docker-compose.yml</code> 中重复设置。</p>\n<p>下面分别介绍各个指令的用法。</p>\n<h3 id="build-1"><a href="#build-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>build</h3>\n<p>指定 Dockerfile 所在文件夹的路径（可以是绝对路径，或者相对 <code class="language-text">docker-compose.yml</code> 文件的路径）。Compose 将会利用它自动构建这个镜像，然后使用这个镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43182680581259870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n  webapp:\n    build: ./dir`, `43182680581259870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你也可以使用 context 指令指定 Dockerfile 所在文件夹的路径。</p>\n<p>使用 dockerfile 指令指定 Dockerfile 文件名。</p>\n<p>使用 arg 指令指定构建镜像时的变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9986326355474362000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n  webapp:\n    build:\n      context: ./dir\n      dockerfile: Dockerfile-alternate\n      args:\n        buildno: 1`, `9986326355474362000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span>\n      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir\n      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate\n      <span class="token key atrule">args</span><span class="token punctuation">:</span>\n        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 <code class="language-text">cache_from</code> 指定构建镜像的缓存</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87201103313036020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`build:\n  context: .\n  cache_from:\n    - alpine:latest\n    - corp/web_app:3.14`, `87201103313036020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">build</span><span class="token punctuation">:</span>\n  <span class="token key atrule">context</span><span class="token punctuation">:</span> .\n  <span class="token key atrule">cache_from</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> alpine<span class="token punctuation">:</span>latest\n    <span class="token punctuation">-</span> corp/web_app<span class="token punctuation">:</span><span class="token number">3.14</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="cap_add-cap_drop"><a href="#cap_add-cap_drop" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">cap_add</code>, <code class="language-text">cap_drop</code></h3>\n<p>指定容器的内核能力（capacity）分配。</p>\n<p>例如，让容器拥有所有能力可以指定为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91384221855315510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cap_add:\n  - ALL`, `91384221855315510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">cap_add</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> ALL</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>去掉 <code class="language-text">NET_ADMIN</code> 能力可以指定为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37502454023404060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cap_drop:\n  - NET_ADMIN`, `37502454023404060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">cap_drop</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> NET_ADMIN</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="command"><a href="#command" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>command</h3>\n<p>覆盖容器启动后默认执行的命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39525867264521920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`command: echo &quot;hello world&quot;`, `39525867264521920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">command</span><span class="token punctuation">:</span> echo "hello world"</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="configs"><a href="#configs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>configs</h3>\n<p>仅用于 Swarm mode，详细内容请查看 Swarm mode 一节。</p>\n<h3 id="cgroup_parent"><a href="#cgroup_parent" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cgroup_parent</h3>\n<p>指定父 cgroup 组，意味着将继承该组的资源限制。</p>\n<p>例如，创建了一个 cgroup 组名称为 <code class="language-text">cgroups_1</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72936514579551190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cgroup_parent: cgroups_1`, `72936514579551190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">cgroup_parent</span><span class="token punctuation">:</span> cgroups_1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="container_name"><a href="#container_name" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>container_name</h3>\n<p>指定容器名称。默认将会使用 <code class="language-text">项目名称-服务名称-序号</code> 这样的格式。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79741104810513530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`container_name: docker-web-container`, `79741104810513530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">container_name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>web<span class="token punctuation">-</span>container</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<blockquote>\n<p>注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称。</p>\n</blockquote>\n<h3 id="deploy"><a href="#deploy" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>deploy</h3>\n<p>仅用于 Swarm mode，详细内容请查看 Swarm mode 一节</p>\n<h3 id="devices"><a href="#devices" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>devices</h3>\n<p>指定设备映射关系。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8598315463363892000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`devices:\n  - \'/dev/ttyUSB1:/dev/ttyUSB0\'`, `8598315463363892000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">devices</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token string">\'/dev/ttyUSB1:/dev/ttyUSB0\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="depends_on"><a href="#depends_on" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>depends_on</h3>\n<p>解决容器的依赖、启动先后的问题。以下例子中会先启动 <code class="language-text">redis db</code> 再启动 web</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82156139037309220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\n\nservices:\n  web:\n    build: .\n    depends_on:\n      - db\n      - redis\n\n  redis:\n    image: redis\n\n  db:\n    image: postgres`, `82156139037309220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">web</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span> .\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> db\n      <span class="token punctuation">-</span> redis\n\n  <span class="token key atrule">redis</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis\n\n  <span class="token key atrule">db</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>注意：web 服务不会等待 <code class="language-text">redis db</code>「完全启动」之后才启动。</p>\n</blockquote>\n<h3 id="dns"><a href="#dns" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dns</h3>\n<p>自定义 DNS 服务器。可以是一个值，也可以是一个列表。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6822959344254876000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dns: 8.8.8.8\n\ndns:\n  - 8.8.8.8\n  - 114.114.114.114`, `6822959344254876000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">dns</span><span class="token punctuation">:</span> 8.8.8.8\n\n<span class="token key atrule">dns</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> 8.8.8.8\n  <span class="token punctuation">-</span> 114.114.114.114</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="dns_search"><a href="#dns_search" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dns_search</h3>\n<p>配置 DNS 搜索域。可以是一个值，也可以是一个列表。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57868895755409965000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dns_search: example.com\n\ndns_search:\n  - domain1.example.com\n  - domain2.example.com`, `57868895755409965000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">dns_search</span><span class="token punctuation">:</span> example.com\n\n<span class="token key atrule">dns_search</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> domain1.example.com\n  <span class="token punctuation">-</span> domain2.example.com</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="tmpfs"><a href="#tmpfs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>tmpfs</h3>\n<p>挂载一个 tmpfs 文件系统到容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14115087619162980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`tmpfs: /run\ntmpfs:\n  - /run\n  - /tmp`, `14115087619162980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">tmpfs</span><span class="token punctuation">:</span> /run\n<span class="token key atrule">tmpfs</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> /run\n  <span class="token punctuation">-</span> /tmp</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="env_file"><a href="#env_file" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>env_file</h3>\n<p>从文件中获取环境变量，可以为单独的文件路径或列表。</p>\n<p>如果通过 <code class="language-text">docker compose -f FILE</code> 方式来指定 Compose 模板文件，则 <code class="language-text">env_file</code> 中变量的路径会基于模板文件路径。</p>\n<p>如果有变量名称与 environment 指令冲突，则按照惯例，以后者为准。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53582080858524540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`env_file: .env\n\nenv_file:\n  - ./common.env\n  - ./apps/web.env\n  - /opt/secrets.env`, `53582080858524540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">env_file</span><span class="token punctuation">:</span> .env\n\n<span class="token key atrule">env_file</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> ./common.env\n  <span class="token punctuation">-</span> ./apps/web.env\n  <span class="token punctuation">-</span> /opt/secrets.env</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>环境变量文件中每一行必须符合格式，支持 # 开头的注释行。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70865624980919240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# common.env: Set development environment\nPROG_ENV=development`, `70865624980919240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># common.env: Set development environment</span>\n<span class="token assign-left variable">PROG_ENV</span><span class="token operator">=</span>development</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="environment"><a href="#environment" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>environment</h3>\n<p>设置环境变量。你可以使用数组或字典两种格式。</p>\n<p>只给定名称的变量会自动获取运行 Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47969784574543970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`environment:\n  RACK_ENV: development\n  SESSION_SECRET:\n\nenvironment:\n  - RACK_ENV=development\n  - SESSION_SECRET`, `47969784574543970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">environment</span><span class="token punctuation">:</span>\n  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development\n  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>\n\n<span class="token key atrule">environment</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> RACK_ENV=development\n  <span class="token punctuation">-</span> SESSION_SECRET</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果变量名称或者值中用到 <code class="language-text">true|false</code>，<code class="language-text">yes|no</code> 等表达布尔含义的词汇，最好放到引号里，避免 YAML 自动解析某些内容为对应的布尔语义。这些特定词汇，包括</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16884250603385030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`y|Y|yes|Yes|YES|n|N|no|No|NO|true|True|TRUE|false|False|FALSE|on|On|ON|off|Off|OFF`, `16884250603385030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">y<span class="token operator">|</span>Y<span class="token operator">|</span><span class="token function">yes</span><span class="token operator">|</span>Yes<span class="token operator">|</span>YES<span class="token operator">|</span>n<span class="token operator">|</span>N<span class="token operator">|</span>no<span class="token operator">|</span>No<span class="token operator">|</span>NO<span class="token operator">|</span><span class="token boolean">true</span><span class="token operator">|</span>True<span class="token operator">|</span>TRUE<span class="token operator">|</span><span class="token boolean">false</span><span class="token operator">|</span>False<span class="token operator">|</span>FALSE<span class="token operator">|</span>on<span class="token operator">|</span>On<span class="token operator">|</span>ON<span class="token operator">|</span>off<span class="token operator">|</span>Off<span class="token operator">|</span>OFF</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="expose-1"><a href="#expose-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>expose</h3>\n<p>暴露端口，但不映射到宿主机，只被连接的服务访问。</p>\n<p>仅可以指定内部端口为参数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75057155873563530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`expose:\n  - \'3000\'\n  - \'8000\'`, `75057155873563530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">expose</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token string">\'3000\'</span>\n  <span class="token punctuation">-</span> <span class="token string">\'8000\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="external_links"><a href="#external_links" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>external_links</h3>\n<p>注意：不建议使用该指令。</p>\n<p>链接到 <code class="language-text">docker-compose.yml</code> 外部的容器，甚至并非 Compose 管理的外部容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18738179081663950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`external_links:\n  - redis_1\n  - project_db_1:mysql\n  - project_db_1:postgresql`, `18738179081663950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">external_links</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> redis_1\n  <span class="token punctuation">-</span> project_db_1<span class="token punctuation">:</span>mysql\n  <span class="token punctuation">-</span> project_db_1<span class="token punctuation">:</span>postgresql</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="extra_hosts"><a href="#extra_hosts" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>extra_hosts</h3>\n<p>类似 Docker 中的 <code class="language-text">--add-host</code> 参数，指定额外的 host 名称映射信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94753654034747650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`extra_hosts:\n  - \'googledns:8.8.8.8\'\n  - \'dockerhub:52.1.157.61\'`, `94753654034747650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token string">\'googledns:8.8.8.8\'</span>\n  <span class="token punctuation">-</span> <span class="token string">\'dockerhub:52.1.157.61\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>会在启动后的服务容器中 <code class="language-text">/etc/hosts</code> 文件中添加如下两条条目。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53291443061174880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`8.8.8.8 googledns\n52.1.157.61 dockerhub`, `53291443061174880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token number">8.8</span>.8.8 googledns\n<span class="token number">52.1</span>.157.61 dockerhub</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="healthcheck"><a href="#healthcheck" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>healthcheck</h3>\n<p>通过命令检查容器是否健康运行。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40336847915755630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`healthcheck:\n  test: [\'CMD\', \'curl\', \'-f\', \'http://localhost\']\n  interval: 1m30s\n  timeout: 10s\n  retries: 3`, `40336847915755630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>\n  <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'CMD\'</span><span class="token punctuation">,</span> <span class="token string">\'curl\'</span><span class="token punctuation">,</span> <span class="token string">\'-f\'</span><span class="token punctuation">,</span> <span class="token string">\'http://localhost\'</span><span class="token punctuation">]</span>\n  <span class="token key atrule">interval</span><span class="token punctuation">:</span> 1m30s\n  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s\n  <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="image"><a href="#image" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>image</h3>\n<p>指定为镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉取这个镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15793552156718825000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`image: ubuntu\nimage: orchardup/postgresql\nimage: a4bc65fd`, `15793552156718825000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu\n<span class="token key atrule">image</span><span class="token punctuation">:</span> orchardup/postgresql\n<span class="token key atrule">image</span><span class="token punctuation">:</span> a4bc65fd</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="labels"><a href="#labels" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>labels</h3>\n<p>为容器添加 Docker 元数据（metadata）信息。例如可以为容器添加辅助说明信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25255507177428570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`labels:\n  com.startupteam.description: \'webapp for a startup team\'\n  com.startupteam.department: \'devops department\'\n  com.startupteam.release: \'rc3 for v1.0\'`, `25255507177428570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">labels</span><span class="token punctuation">:</span>\n  <span class="token key atrule">com.startupteam.description</span><span class="token punctuation">:</span> <span class="token string">\'webapp for a startup team\'</span>\n  <span class="token key atrule">com.startupteam.department</span><span class="token punctuation">:</span> <span class="token string">\'devops department\'</span>\n  <span class="token key atrule">com.startupteam.release</span><span class="token punctuation">:</span> <span class="token string">\'rc3 for v1.0\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="links"><a href="#links" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>links</h3>\n<p>注意：不推荐使用该指令。</p>\n<h3 id="logging"><a href="#logging" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>logging</h3>\n<p>配置日志选项。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98765452186988580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`logging:\n  driver: syslog\n  options:\n    syslog-address: \'tcp://192.168.0.42:123\'`, `98765452186988580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">logging</span><span class="token punctuation">:</span>\n  <span class="token key atrule">driver</span><span class="token punctuation">:</span> syslog\n  <span class="token key atrule">options</span><span class="token punctuation">:</span>\n    <span class="token key atrule">syslog-address</span><span class="token punctuation">:</span> <span class="token string">\'tcp://192.168.0.42:123\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>目前支持三种日志驱动类型。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4292019537767011300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`driver: &quot;json-file&quot;\ndriver: &quot;syslog&quot;\ndriver: &quot;none&quot;`, `4292019537767011300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"json-file"</span>\n<span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"syslog"</span>\n<span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"none"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>options 配置日志驱动的相关参数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85943067731204690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`options:\n  max-size: \'200k\'\n  max-file: \'10\'`, `85943067731204690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">options</span><span class="token punctuation">:</span>\n  <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">\'200k\'</span>\n  <span class="token key atrule">max-file</span><span class="token punctuation">:</span> <span class="token string">\'10\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="network_mode"><a href="#network_mode" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>network_mode</h3>\n<p>设置网络模式。使用和 docker run 的 <code class="language-text">--network</code> 参数一样的值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23924598420411126000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`network_mode: &quot;bridge&quot;\nnetwork_mode: &quot;host&quot;\nnetwork_mode: &quot;none&quot;\nnetwork_mode: &quot;service:[service name]&quot;\nnetwork_mode: &quot;container:[container name/id]&quot;`, `23924598420411126000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"bridge"</span>\n<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"host"</span>\n<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"none"</span>\n<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"service:[service name]"</span>\n<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"container:[container name/id]"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="networks"><a href="#networks" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>networks</h3>\n<p>配置容器连接的网络。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40302860910845050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n  some-service:\n    networks:\n      - some-network\n      - other-network\n\nnetworks:\n  some-network:\n  other-network:`, `40302860910845050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network\n      <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network\n\n<span class="token key atrule">networks</span><span class="token punctuation">:</span>\n  <span class="token key atrule">some-network</span><span class="token punctuation">:</span>\n  other<span class="token punctuation">-</span>network<span class="token punctuation">:</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="pid"><a href="#pid" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pid</h3>\n<p>跟主机系统共享进程命名空间。打开该选项的容器之间，以及容器和宿主机系统之间可以通过进程 ID 来相互访问和操作。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87536761644227600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pid: \'host\'`, `87536761644227600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">pid</span><span class="token punctuation">:</span> <span class="token string">\'host\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="ports"><a href="#ports" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ports</h3>\n<p>暴露端口信息。</p>\n<p>使用宿主端口：容器端口（HOST:CONTAINER）格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78871228474828570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ports:\n  - \'3000\'\n  - \'8000:8000\'\n  - \'49100:22\'\n  - \'127.0.0.1:8001:8001\'`, `78871228474828570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">ports</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token string">\'3000\'</span>\n  <span class="token punctuation">-</span> <span class="token string">\'8000:8000\'</span>\n  <span class="token punctuation">-</span> <span class="token string">\'49100:22\'</span>\n  <span class="token punctuation">-</span> <span class="token string">\'127.0.0.1:8001:8001\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>注意：当使用 <code class="language-text">HOST:CONTAINER</code> 格式来映射端口时，如果你使用的容器端口小于 60 并且没放到引号里，可能会得到错误结果，因为 YAML 会自动解析 <code class="language-text">xx:yy</code> 这种数字格式为 60 进制。为避免出现这种问题，建议数字串都采用引号包括起来的字符串格式。</p>\n</blockquote>\n<h3 id="secrets"><a href="#secrets" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>secrets</h3>\n<p>存储敏感数据，例如 mysql 服务密码。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32605685004274410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3.1\'\nservices:\n\nmysql:\n  image: mysql\n  environment:\n    MYSQL_ROOT_PASSWORD_FILE: /run/secrets/db_root_password\n  secrets:\n    - db_root_password\n    - my_other_secret\n\nsecrets:\n  my_secret:\n    file: ./my_secret.txt\n  my_other_secret:\n    external: true`, `32605685004274410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3.1\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n\n<span class="token key atrule">mysql</span><span class="token punctuation">:</span>\n  <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql\n  <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n    <span class="token key atrule">MYSQL_ROOT_PASSWORD_FILE</span><span class="token punctuation">:</span> /run/secrets/db_root_password\n  <span class="token key atrule">secrets</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> db_root_password\n    <span class="token punctuation">-</span> my_other_secret\n\n<span class="token key atrule">secrets</span><span class="token punctuation">:</span>\n  <span class="token key atrule">my_secret</span><span class="token punctuation">:</span>\n    <span class="token key atrule">file</span><span class="token punctuation">:</span> ./my_secret.txt\n  <span class="token key atrule">my_other_secret</span><span class="token punctuation">:</span>\n    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="security_opt"><a href="#security_opt" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>security_opt</h3>\n<p>指定容器模板标签（label）机制的默认属性（用户、角色、类型、级别等）。例如配置标签的用户名和角色名。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94427062933465500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`security_opt:\n  - label:user:USER\n  - label:role:ROLE`, `94427062933465500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">security_opt</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> label<span class="token punctuation">:</span>user<span class="token punctuation">:</span>USER\n  <span class="token punctuation">-</span> label<span class="token punctuation">:</span>role<span class="token punctuation">:</span>ROLE</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="stop_signal"><a href="#stop_signal" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>stop_signal</h3>\n<p>设置另一个信号来停止容器。在默认情况下使用的是 SIGTERM 停止容器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47725985770442470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`stop_signal: SIGUSR1`, `47725985770442470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">stop_signal</span><span class="token punctuation">:</span> SIGUSR1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="sysctls"><a href="#sysctls" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>sysctls</h3>\n<p>配置容器内核参数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36629166785124733000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`sysctls:\n  net.core.somaxconn: 1024\n  net.ipv4.tcp_syncookies: 0\n\nsysctls:\n  - net.core.somaxconn=1024\n  - net.ipv4.tcp_syncookies=0`, `36629166785124733000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">sysctls</span><span class="token punctuation">:</span>\n  <span class="token key atrule">net.core.somaxconn</span><span class="token punctuation">:</span> <span class="token number">1024</span>\n  <span class="token key atrule">net.ipv4.tcp_syncookies</span><span class="token punctuation">:</span> <span class="token number">0</span>\n\n<span class="token key atrule">sysctls</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> net.core.somaxconn=1024\n  <span class="token punctuation">-</span> net.ipv4.tcp_syncookies=0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="ulimits"><a href="#ulimits" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ulimits</h3>\n<p>指定容器的 ulimits 限制值。</p>\n<p>例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制）和 40000（系统硬限制，只能 root 用户提高）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46862917321348375000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ulimits:\n  nproc: 65535\n  nofile:\n    soft: 20000\n    hard: 40000`, `46862917321348375000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">ulimits</span><span class="token punctuation">:</span>\n  <span class="token key atrule">nproc</span><span class="token punctuation">:</span> <span class="token number">65535</span>\n  <span class="token key atrule">nofile</span><span class="token punctuation">:</span>\n    <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">20000</span>\n    <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">40000</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="volumes"><a href="#volumes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>volumes</h3>\n<p>数据卷所挂载路径设置。可以设置为宿主机路径（HOST:CONTAINER）或者数据卷名称（VOLUME:CONTAINER），并且可以设置访问模式（HOST:CONTAINER:ro）。</p>\n<p>该指令中路径支持相对路径。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68916643831567350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`volumes:\n  - /var/lib/mysql\n  - cache/:/tmp/cache\n  - ~/configs:/etc/configs/:ro`, `68916643831567350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> /var/lib/mysql\n  <span class="token punctuation">-</span> cache/<span class="token punctuation">:</span>/tmp/cache\n  <span class="token punctuation">-</span> ~/configs<span class="token punctuation">:</span>/etc/configs/<span class="token punctuation">:</span>ro</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果路径为数据卷名称，必须在文件中配置数据卷。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70189636130099790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\n\nservices:\n  my_src:\n    image: mysql:8.0\n    volumes:\n      - mysql_data:/var/lib/mysql\n\nvolumes:\n  mysql_data:`, `70189636130099790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">my_src</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql\n\n<span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n  mysql_data<span class="token punctuation">:</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="其它指令"><a href="#%E5%85%B6%E5%AE%83%E6%8C%87%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其它指令</h3>\n<p>此外，还有包括 domainname, entrypoint, hostname, ipc, <code class="language-text">mac_address</code>, privileged, <code class="language-text">read_only</code>, <code class="language-text">shm_size</code>, restart, <code class="language-text">stdin_open</code>, tty, user, <code class="language-text">working_dir</code> 等指令，基本跟 docker run 中对应参数的功能一致。</p>\n<p>指定服务容器启动后执行的入口文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9092641955049552000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`entrypoint: /code/entrypoint.sh`, `9092641955049552000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> /code/entrypoint.sh</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>指定容器中运行应用的用户名。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86528164681871340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`user: nginx`, `86528164681871340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">user</span><span class="token punctuation">:</span> nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>指定容器中工作目录。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29357737224749390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`working_dir: /code`, `29357737224749390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">working_dir</span><span class="token punctuation">:</span> /code</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>指定容器中搜索域名、主机名、mac 地址等。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71557763483541660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`domainname: your_website.com\nhostname: test\nmac_address: 08-00-27-00-0C-0A`, `71557763483541660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">domainname</span><span class="token punctuation">:</span> your_website.com\n<span class="token key atrule">hostname</span><span class="token punctuation">:</span> test\n<span class="token key atrule">mac_address</span><span class="token punctuation">:</span> 08<span class="token punctuation">-</span>00<span class="token punctuation">-</span>27<span class="token punctuation">-</span>00<span class="token punctuation">-</span>0C<span class="token punctuation">-</span>0A</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>允许容器中运行一些特权命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29955263326776940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`privileged: true`, `29955263326776940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>指定容器退出后的重启策略为始终重启。该命令对保持服务始终运行十分有效，在生产环境中推荐配置为 always 或者 <code class="language-text">unless-stopped</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96369029502289200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`restart: always`, `96369029502289200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">restart</span><span class="token punctuation">:</span> always</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>以只读模式挂载容器的 root 文件系统，意味着不能对容器内容进行修改。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14440005941272816000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`read_only: true`, `14440005941272816000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">read_only</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>打开标准输入，可以接受外部输入。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39910436913707835000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`stdin_open: true`, `39910436913707835000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>模拟一个伪终端。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18439898926520070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`tty: true`, `18439898926520070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="读取变量"><a href="#%E8%AF%BB%E5%8F%96%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>读取变量</h3>\n<p>Compose 模板文件支持动态读取主机的系统环境变量和当前目录下的 <code class="language-text">.env</code> 文件中的变量。</p>\n<p>例如，下面的 Compose 文件将从运行它的环境中读取变量 <code class="language-text">${MONGO_VERSION}</code> 的值，并写入执行的指令中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23639063858426380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n\ndb:\n  image: \'mongo:\\${MONGO_VERSION}\'`, `23639063858426380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n\n<span class="token key atrule">db</span><span class="token punctuation">:</span>\n  <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">\'mongo:${MONGO_VERSION}\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果执行 <code class="language-text">MONGO_VERSION=3.2 docker compose up</code> 则会启动一个 <code class="language-text">mongo:3.2</code> 镜像的容器；如果执行 <code class="language-text">MONGO_VERSION=2.8 docker compose up</code> 则会启动一个 <code class="language-text">mongo:2.8</code> 镜像的容器。</p>\n<p>若当前目录存在 <code class="language-text">.env</code> 文件，执行 <code class="language-text">docker compose</code> 命令时将从该文件中读取变量。</p>\n<p>在当前目录新建 <code class="language-text">.env</code> 文件并写入以下内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44650174652396820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 支持 # 号注释\nMONGO_VERSION=3.6`, `44650174652396820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 支持 # 号注释</span>\n<span class="token assign-left variable">MONGO_VERSION</span><span class="token operator">=</span><span class="token number">3.6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>执行 <code class="language-text">docker compose up</code> 则会启动一个 <code class="language-text">mongo:3.6</code> 镜像的容器。</p>\n<h2 id="使用-django"><a href="#%E4%BD%BF%E7%94%A8-django" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 Django</h2>\n<p>我们现在将使用 Docker Compose 配置并运行一个 <code class="language-text">Django/PostgreSQL</code> 应用。</p>\n<p>在一切工作开始前，需要先编辑好三个必要的文件。</p>\n<p>第一步，因为应用将要运行在一个满足所有环境依赖的 Docker 容器里面，那么我们可以通过编辑 Dockerfile 文件来指定 Docker 容器要安装内容。内容如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11440315762009901000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM python:3\nENV PYTHONUNBUFFERED 1\nRUN mkdir /code\nWORKDIR /code\nCOPY requirements.txt /code/\nRUN pip install -r requirements.txt\nCOPY . /code/`, `11440315762009901000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> python<span class="token punctuation">:</span>3\n<span class="token keyword">ENV</span> PYTHONUNBUFFERED 1\n<span class="token keyword">RUN</span> mkdir /code\n<span class="token keyword">WORKDIR</span> /code\n<span class="token keyword">COPY</span> requirements.txt /code/\n<span class="token keyword">RUN</span> pip install <span class="token punctuation">-</span>r requirements.txt\n<span class="token keyword">COPY</span> . /code/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上内容指定应用将使用安装了 Python 以及必要依赖包的镜像。更多关于如何编写 Dockerfile 文件的信息可以查看 Dockerfile 使用。</p>\n<p>第二步，在 <code class="language-text">requirements.txt</code> 文件里面写明需要安装的具体依赖包名。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34820083787691460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Django>=2.0,<3.0\npsycopg2>=2.7,<3.0`, `34820083787691460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Django&gt;=2.0,&lt;3.0\npsycopg2&gt;=2.7,&lt;3.0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>第三步，<code class="language-text">docker-compose.yml</code> 文件将把所有的东西关联起来。它描述了应用的构成（一个 web 服务和一个数据库）、使用的 Docker 镜像、镜像之间的连接、挂载到容器的卷，以及服务开放的端口。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41401926013018644000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n  db:\n    image: postgres\n    environment:\n      POSTGRES_PASSWORD: \'postgres\'\n\n  web:\n    build: .\n    command: python manage.py runserver 0.0.0.0:8000\n    volumes:\n      - .:/code\n    ports:\n      - \'8000:8000\'`, `41401926013018644000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">db</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">\'postgres\'</span>\n\n  <span class="token key atrule">web</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span> .\n    <span class="token key atrule">command</span><span class="token punctuation">:</span> python manage.py runserver 0.0.0.0<span class="token punctuation">:</span><span class="token number">8000</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> .<span class="token punctuation">:</span>/code\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'8000:8000\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>查看 <code class="language-text">docker-compose.yml</code> 章节 了解更多详细的工作机制。</p>\n<p>现在我们就可以使用 <code class="language-text">docker compose run</code> 命令启动一个 Django 应用了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61688989596751620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker compose run web django-admin startproject django_example .`, `61688989596751620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker compose run web django-admin startproject django_example <span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>由于 web 服务所使用的镜像并不存在，所以 Compose 会首先使用 Dockerfile 为 web 服务构建一个镜像，接着使用这个镜像在容器里运行 <code class="language-text">django-admin startproject django_example</code> 指令。</p>\n<p>这将在当前目录生成一个 Django 应用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93864282840826070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ ls\nDockerfile       docker-compose.yml          django_example       manage.py       requirements.txt`, `93864282840826070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">ls</span>\nDockerfile       docker-compose.yml          django_example       manage.py       requirements.txt</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果你的系统是 Linux，记得更改文件权限。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49242731359257100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo chown -R \\$USER:\\$USER .`, `49242731359257100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">chown</span> -R <span class="token environment constant">$USER</span><span class="token builtin class-name">:</span><span class="token environment constant">$USER</span> <span class="token builtin class-name">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>首先，我们要为应用设置好数据库的连接信息。用以下内容替换 <code class="language-text">django_example/settings.py</code> 文件中 <code class="language-text">DATABASES = ...</code> 定义的节点内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45392943806813045000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`DATABASES = {\n    \'default\': {\n        \'ENGINE\': \'django.db.backends.postgresql\',\n        \'NAME\': \'postgres\',\n        \'USER\': \'postgres\',\n        \'HOST\': \'db\',\n        \'PORT\': 5432,\n        \'PASSWORD\': \'postgres\',\n    }\n}`, `45392943806813045000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'default\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">\'ENGINE\'</span><span class="token punctuation">:</span> <span class="token string">\'django.db.backends.postgresql\'</span><span class="token punctuation">,</span>\n        <span class="token string">\'NAME\'</span><span class="token punctuation">:</span> <span class="token string">\'postgres\'</span><span class="token punctuation">,</span>\n        <span class="token string">\'USER\'</span><span class="token punctuation">:</span> <span class="token string">\'postgres\'</span><span class="token punctuation">,</span>\n        <span class="token string">\'HOST\'</span><span class="token punctuation">:</span> <span class="token string">\'db\'</span><span class="token punctuation">,</span>\n        <span class="token string">\'PORT\'</span><span class="token punctuation">:</span> <span class="token number">5432</span><span class="token punctuation">,</span>\n        <span class="token string">\'PASSWORD\'</span><span class="token punctuation">:</span> <span class="token string">\'postgres\'</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这些信息是在 postgres 镜像固定设置好的。然后，运行 <code class="language-text">docker compose up</code>：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16081021950072926000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker compose up\n\ndjango_db_1 is up-to-date\nCreating django_web_1 ...\nCreating django_web_1 ... done\nAttaching to django_db_1, django_web_1\ndb_1   | The files belonging to this database system will be owned by user &quot;postgres&quot;.\ndb_1   | This user must also own the server process.\ndb_1   |\ndb_1   | The database cluster will be initialized with locale &quot;en_US.utf8&quot;.\ndb_1   | The default database encoding has accordingly been set to &quot;UTF8&quot;.\ndb_1   | The default text search configuration will be set to &quot;english&quot;.\n\nweb_1  | Performing system checks...\nweb_1  |\nweb_1  | System check identified no issues (0 silenced).\nweb_1  |\nweb_1  | November 23, 2017 - 06:21:19\nweb_1  | Django version 1.11.7, using settings \'django_example.settings\'\nweb_1  | Starting development server at http://0.0.0.0:8000/\nweb_1  | Quit the server with CONTROL-C.`, `16081021950072926000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker compose up\n\ndjango_db_1 is up-to-date\nCreating django_web_1 <span class="token punctuation">..</span>.\nCreating django_web_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>\nAttaching to django_db_1, django_web_1\ndb_1   <span class="token operator">|</span> The files belonging to this database system will be owned by user <span class="token string">"postgres"</span><span class="token builtin class-name">.</span>\ndb_1   <span class="token operator">|</span> This user must also own the server process.\ndb_1   <span class="token operator">|</span>\ndb_1   <span class="token operator">|</span> The database cluster will be initialized with locale <span class="token string">"en_US.utf8"</span><span class="token builtin class-name">.</span>\ndb_1   <span class="token operator">|</span> The default database encoding has accordingly been <span class="token builtin class-name">set</span> to <span class="token string">"UTF8"</span><span class="token builtin class-name">.</span>\ndb_1   <span class="token operator">|</span> The default text search configuration will be <span class="token builtin class-name">set</span> to <span class="token string">"english"</span><span class="token builtin class-name">.</span>\n\nweb_1  <span class="token operator">|</span> Performing system checks<span class="token punctuation">..</span>.\nweb_1  <span class="token operator">|</span>\nweb_1  <span class="token operator">|</span> System check identified no issues <span class="token punctuation">(</span><span class="token number">0</span> silenced<span class="token punctuation">)</span>.\nweb_1  <span class="token operator">|</span>\nweb_1  <span class="token operator">|</span> November <span class="token number">23</span>, <span class="token number">2017</span> - 06:21:19\nweb_1  <span class="token operator">|</span> Django version <span class="token number">1.11</span>.7, using settings <span class="token string">\'django_example.settings\'</span>\nweb_1  <span class="token operator">|</span> Starting development server at http://0.0.0.0:8000/\nweb_1  <span class="token operator">|</span> Quit the server with CONTROL-C.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个 Django 应用已经开始在你的 Docker 守护进程里监听着 8000 端口了。打开 <code class="language-text">127.0.0.1:8000</code> 即可看到 Django 欢迎页面。</p>\n<p>你还可以在 Docker 上运行其它的管理命令，例如对于同步数据库结构这种事，在运行完 <code class="language-text">docker compose up</code> 后，在另外一个终端进入文件夹运行以下命令即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46558567753908410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ docker compose run web python manage.py syncdb`, `46558567753908410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ docker compose run web python manage.py syncdb</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="使用-wordpress"><a href="#%E4%BD%BF%E7%94%A8-wordpress" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 WordPress</h2>\n<p>Compose 可以很便捷的让 Wordpress 运行在一个独立的环境中。</p>\n<h3 id="创建空文件夹"><a href="#%E5%88%9B%E5%BB%BA%E7%A9%BA%E6%96%87%E4%BB%B6%E5%A4%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建空文件夹</h3>\n<p>假设新建一个名为 wordpress 的文件夹，然后进入这个文件夹。</p>\n<h3 id="创建-docker-composeyml-文件"><a href="#%E5%88%9B%E5%BB%BA-docker-composeyml-%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 docker-compose.yml 文件</h3>\n<p><code class="language-text">docker-compose.yml</code> 文件将开启一个 wordpress 服务和一个独立的 MySQL 实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28692984237579800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n  db:\n    image: mysql:8.0\n    command:\n      - --default_authentication_plugin=mysql_native_password\n      - --character-set-server=utf8mb4\n      - --collation-server=utf8mb4_unicode_ci\n    volumes:\n      - db_data:/var/lib/mysql\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: somewordpress\n      MYSQL_DATABASE: wordpress\n      MYSQL_USER: wordpress\n      MYSQL_PASSWORD: wordpress\n\n  wordpress:\n    depends_on:\n      - db\n    image: wordpress:latest\n    ports:\n      - \'8000:80\'\n    restart: always\n    environment:\n      WORDPRESS_DB_HOST: db:3306\n      WORDPRESS_DB_USER: wordpress\n      WORDPRESS_DB_PASSWORD: wordpress\nvolumes:\n  db_data:`, `28692984237579800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">db</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span>\n    <span class="token key atrule">command</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>default_authentication_plugin=mysql_native_password\n      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>character<span class="token punctuation">-</span>set<span class="token punctuation">-</span>server=utf8mb4\n      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>collation<span class="token punctuation">-</span>server=utf8mb4_unicode_ci\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> db_data<span class="token punctuation">:</span>/var/lib/mysql\n    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> somewordpress\n      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> wordpress\n      <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> wordpress\n      <span class="token key atrule">MYSQL_PASSWORD</span><span class="token punctuation">:</span> wordpress\n\n  <span class="token key atrule">wordpress</span><span class="token punctuation">:</span>\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> db\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>latest\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'8000:80\'</span>\n    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token key atrule">WORDPRESS_DB_HOST</span><span class="token punctuation">:</span> db<span class="token punctuation">:</span><span class="token number">3306</span>\n      <span class="token key atrule">WORDPRESS_DB_USER</span><span class="token punctuation">:</span> wordpress\n      <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span> wordpress\n<span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n  db_data<span class="token punctuation">:</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="构建并运行项目"><a href="#%E6%9E%84%E5%BB%BA%E5%B9%B6%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建并运行项目</h3>\n<p>运行 <code class="language-text">docker compose up -d Compose</code> 就会拉取镜像再创建我们所需要的镜像，然后启动 wordpress 和数据库容器。接着浏览器访问 <code class="language-text">127.0.0.1:8000</code> 端口就能看到 WordPress 安装界面了。</p>\n<h1 id="kubernetes"><a href="#kubernetes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes</h1>\n<p>Kubernetes 是 Google 团队发起并维护的基于 Docker 的开源容器集群管理系统，它不仅支持常见的云平台，而且支持内部数据中心。</p>\n<p>建于 Docker 之上的 Kubernetes 可以构建一个容器的调度服务，其目的是让用户透过 Kubernetes 集群来进行云端容器集群的管理，而无需用户进行复杂的设置工作。系统会自动选取合适的工作节点来执行具体的容器集群调度处理工作。其核心概念是 Container Pod。一个 Pod 由一组工作于同一物理工作节点的容器构成。这些组容器拥有相同的网络命名空间、IP 以及存储配额，也可以根据实际情况对每一个 Pod 进行端口映射。此外，Kubernetes 工作节点会由主系统进行管理，节点包含了能够运行 Docker 容器所用到的服务。</p>\n<h2 id="项目简介"><a href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目简介</h2>\n<p>Kubernetes 是 Google 团队发起的开源项目，它的目标是管理跨多个主机的容器，提供基本的部署，维护以及应用伸缩，主要实现语言为 Go 语言。Kubernetes 是：</p>\n<ul>\n<li>易学：轻量级，简单，容易理解</li>\n<li>便携：支持公有云，私有云，混合云，以及多种云平台</li>\n<li>可拓展：模块化，可插拔，支持钩子，可任意组合</li>\n<li>自修复：自动重调度，自动重启，自动复制</li>\n</ul>\n<p>Kubernetes 构建于 Google 数十年经验，一大半来源于 Google 生产环境规模的经验。结合了社区最佳的想法和实践。</p>\n<p>在分布式系统中，部署，调度，伸缩一直是最为重要的也最为基础的功能。Kubernetes 就是希望解决这一序列问题的。</p>\n<p>Kubernetes 目前在 GitHub 进行维护。</p>\n<p>Kubernetes 能够运行在任何地方，虽然 Kubernetes 最初是为 GCE 定制的，但是在后续版本中陆续增加了其他云平台的支持，以及本地数据中心的支持。</p>\n<h2 id="基本概念-2"><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本概念</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-21-13-57-53-20b4f5eff63b3e1b9a12c962cf7d982d-14d8a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.9113924050633%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABw0lEQVQoz31TS2+bQBD2//8lvVXKpZUvzaWntkoqN3Fi13aCMZiyywL7fs12IErqItrVCI1gv8c8WKR/HB8slw2kaG3HuZBSCiFijJd3FhMMvD64Yvvs1jhlDKO0JoS0bQsAM+AQAcNHKGi/PVYNN8rw7HTXcZKSlbLte26tnSgNYORDGIyK1gWtLZoTqvn2/cPNaklZlpLresIYm1HGVyh7aT04y7u6qA/5edvSXNLaKul9mFf+C4z6WrDymR92Uar+eHx8/06cjiPvRHmEImsM2EtgXJe0kx6C0WRzpxjl52L38ar88pk8rLxWCeIbxQKsU3nR7Z91TWOAplf5r4YrGyDgnPAGK57K9S2vquaUGaedtxD9H+XocKguhdeSRmKjumr3NTidb26qp/thImjR43Eu+PmaMY9jroP/2ZBaCis6pzggyHptB2aPDkeBmYa9ZFTL5eP9j3OJNfqYnANsdhhyj+BLZbQ8dAuD9jKrKNcWwdeH7ZrU+DX6QQkb9YKEyYYNbsdohT7TThmH4E/77QOpEpICjiIgDJP/7fab7cao5Wa9qgoE+IhyWBjMLMkEOW5qsjGc+rbBwQ62YPbP+w0RV2gvodsuPwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 21 13 57 53" title="" data-src="/static/2022-07-21-13-57-53-20b4f5eff63b3e1b9a12c962cf7d982d-fee1c.png" data-srcset="/static/2022-07-21-13-57-53-20b4f5eff63b3e1b9a12c962cf7d982d-a67b7.png 200w,\n/static/2022-07-21-13-57-53-20b4f5eff63b3e1b9a12c962cf7d982d-0b187.png 400w,\n/static/2022-07-21-13-57-53-20b4f5eff63b3e1b9a12c962cf7d982d-fee1c.png 800w,\n/static/2022-07-21-13-57-53-20b4f5eff63b3e1b9a12c962cf7d982d-14d8a.png 1185w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>节点（Node）：一个节点是一个运行 Kubernetes 中的主机。</li>\n<li>容器组（Pod）：一个 Pod 对应于由若干容器组成的一个容器组，同个组内的容器共享一个存储卷(volume)。</li>\n<li>容器组生命周期（pos-states）：包含所有容器状态集合，包括容器组状态类型，容器组生命周期，事件，重启策略，以及 <code class="language-text">replication controllers</code>。</li>\n<li>Replication Controllers：主要负责指定数量的 pod 在同一时间一起运行。</li>\n<li>服务（services）：一个 Kubernetes 服务是容器组逻辑的高级抽象，同时也对外提供访问容器组的策略。</li>\n<li>卷（volumes）：一个卷就是一个目录，容器对其有访问权限。</li>\n<li>标签（labels）：标签是用来连接一组对象的，比如容器组。标签可以被用来组织和选择子对象。</li>\n<li>接口权限（<code class="language-text">accessing_the_api</code>）：端口，IP 地址和代理的防火墙规则。</li>\n<li>web 界面（ux）：用户可以通过 web 界面操作 Kubernetes。</li>\n<li>命令行操作（cli）：kubectl 命令。</li>\n</ul>\n<h3 id="节点-1"><a href="#%E8%8A%82%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节点</h3>\n<p>在 Kubernetes 中，节点是实际工作的点，节点可以是虚拟机或者物理机器，依赖于一个集群环境。每个节点都有一些必要的服务以运行容器组，并且它们都可以通过主节点来管理。必要服务包括 Docker，kubelet 和代理服务。</p>\n<h4 id="容器状态"><a href="#%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器状态</h4>\n<p>容器状态用来描述节点的当前状态。现在，其中包含三个信息：</p>\n<h5 id="主机-ip"><a href="#%E4%B8%BB%E6%9C%BA-ip" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主机 IP</h5>\n<p>主机 IP 需要云平台来查询，Kubernetes 把它作为状态的一部分来保存。如果 Kubernetes 没有运行在云平台上，节点 ID 就是必需的。IP 地址可以变化，并且可以包含多种类型的 IP 地址，如公共 IP，私有 IP，动态 IP，ipv6 等等。</p>\n<h5 id="节点周期"><a href="#%E8%8A%82%E7%82%B9%E5%91%A8%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节点周期</h5>\n<p>通常来说节点有 Pending，Running，Terminated 三个周期，如果 Kubernetes 发现了一个节点并且其可用，那么 Kubernetes 就把它标记为 Pending。然后在某个时刻，Kubernetes 将会标记其为 Running。节点的结束周期称为 Terminated。一个已经 Terminated 的节点不会接受和调度任何请求，并且已经在其上运行的容器组也会删除。</p>\n<h5 id="节点状态"><a href="#%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节点状态</h5>\n<p>节点的状态主要是用来描述处于 Running 的节点。当前可用的有 NodeReachable 和 NodeReady。以后可能会增加其他状态。NodeReachable 表示集群可达。NodeReady 表示 kubelet 返回 Status Ok 并且 HTTP 状态检查健康。</p>\n<h4 id="节点管理"><a href="#%E8%8A%82%E7%82%B9%E7%AE%A1%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节点管理</h4>\n<p>节点并非 Kubernetes 创建，而是由云平台创建，或者就是物理机器、虚拟机。在 Kubernetes 中，节点仅仅是一条记录，节点创建之后，Kubernetes 会检查其是否可用。在 Kubernetes 中，节点用如下结构保存：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2280048760041442000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;id&quot;: &quot;10.1.2.3&quot;,\n  &quot;kind&quot;: &quot;Minion&quot;,\n  &quot;apiVersion&quot;: &quot;v1beta1&quot;,\n  &quot;resources&quot;: {\n    &quot;capacity&quot;: {\n      &quot;cpu&quot;: 1000,\n      &quot;memory&quot;: 1073741824\n    }\n  },\n  &quot;labels&quot;: {\n    &quot;name&quot;: &quot;my-first-k8s-node&quot;\n  }\n}`, `2280048760041442000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"10.1.2.3"</span><span class="token punctuation">,</span>\n  <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"Minion"</span><span class="token punctuation">,</span>\n  <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"v1beta1"</span><span class="token punctuation">,</span>\n  <span class="token property">"resources"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"capacity"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"cpu"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>\n      <span class="token property">"memory"</span><span class="token operator">:</span> <span class="token number">1073741824</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"my-first-k8s-node"</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Kubernetes 校验节点可用依赖于 ID。在当前的版本中，有两个接口可以用来管理节点：节点控制和 Kube 管理。</p>\n<h4 id="节点控制"><a href="#%E8%8A%82%E7%82%B9%E6%8E%A7%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节点控制</h4>\n<p>在 Kubernetes 主节点中，节点控制器是用来管理节点的组件。主要包含：</p>\n<ul>\n<li>集群范围内节点同步</li>\n<li>单节点生命周期管理</li>\n</ul>\n<p>节点控制有一个同步轮询，主要监听所有云平台的虚拟实例，会根据节点状态创建和删除。可以通过 <code class="language-text">--node_sync_period</code> 标志来控制该轮询。如果一个实例已经创建，节点控制将会为其创建一个结构。同样的，如果一个节点被删除，节点控制也会删除该结构。在 Kubernetes 启动时可用通过 <code class="language-text">--machines</code> 标记来显示指定节点。同样可以使用 kubectl 来一条一条的添加节点，两者是相同的。通过设置 <code class="language-text">--sync_nodes=false</code> 标记来禁止集群之间的节点同步，你也可以使用 <code class="language-text">api/kubectl</code> 命令行来增删节点。</p>\n<h3 id="容器组"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器组</h3>\n<p>在 Kubernetes 中，使用的最小单位是容器组，容器组是创建，调度，管理的最小单位。一个容器组使用相同的 Docker 容器并共享卷（挂载点）。一个容器组是一个特定应用的打包集合，包含一个或多个容器。</p>\n<p>和运行的容器类似，一个容器组被认为只有很短的运行周期。容器组被调度到一组节点运行，直到容器的生命周期结束或者其被删除。如果节点死掉，运行在其上的容器组将会被删除而不是重新调度。（也许在将来的版本中会添加容器组的移动）。</p>\n<h4 id="容器组设计的初衷"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%88%9D%E8%A1%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器组设计的初衷</h4>\n<h4 id="资源共享和通信"><a href="#%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E5%92%8C%E9%80%9A%E4%BF%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>资源共享和通信</h4>\n<p>容器组主要是为了数据共享和它们之间的通信。</p>\n<p>在一个容器组中，容器都使用相同的网络地址和端口，可以通过本地网络来相互通信。每个容器组都有独立的 IP，可用通过网络来和其他物理主机或者容器通信。</p>\n<p>容器组有一组存储卷（挂载点），主要是为了让容器在重启之后可以不丢失数据。</p>\n<h4 id="容器组管理"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%AE%A1%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器组管理</h4>\n<p>容器组是一个应用管理和部署的高层次抽象，同时也是一组容器的接口。容器组是部署、水平放缩的最小单位。</p>\n<h4 id="容器组的使用"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%9A%84%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器组的使用</h4>\n<p>容器组可以通过组合来构建复杂的应用，其本来的意义包含：</p>\n<ul>\n<li>内容管理，文件和数据加载以及本地缓存管理等。</li>\n<li>日志和检查点备份，压缩，快照等。</li>\n<li>监听数据变化，跟踪日志，日志和监控代理，消息发布等。</li>\n<li>代理，网桥</li>\n<li>控制器，管理，配置以及更新</li>\n</ul>\n<h4 id="替代方案"><a href="#%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>替代方案</h4>\n<p>为什么不在一个单一的容器里运行多个程序？</p>\n<ul>\n<li>透明化。为了使容器组中的容器保持一致的基础设施和服务，比如进程管理和资源监控。这样设计是为了用户的便利性。</li>\n<li>解偶软件之间的依赖。每个容器都可能重新构建和发布，Kubernetes 必须支持热发布和热更新（将来）。</li>\n<li>方便使用。用户不必运行独立的程序管理，也不用担心每个应用程序的退出状态。</li>\n<li>高效。考虑到基础设施有更多的职责，容器必须要轻量化。</li>\n</ul>\n<h4 id="容器组的生命状态"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%9A%84%E7%94%9F%E5%91%BD%E7%8A%B6%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器组的生命状态</h4>\n<p>包括若干状态值：pending、running、succeeded、failed。</p>\n<h5 id="pending"><a href="#pending" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pending</h5>\n<p>容器组已经被节点接受，但有一个或多个容器还没有运行起来。这将包含某些节点正在下载镜像的时间，这种情形会依赖于网络情况。</p>\n<h5 id="running"><a href="#running" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>running</h5>\n<p>容器组已经被调度到节点，并且所有的容器都已经启动。至少有一个容器处于运行状态（或者处于重启状态）。</p>\n<h5 id="succeeded"><a href="#succeeded" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>succeeded</h5>\n<p>所有的容器都正常退出。</p>\n<h5 id="failed"><a href="#failed" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>failed</h5>\n<p>容器组中所有容器都意外中断了。</p>\n<h4 id="容器组生命周期"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器组生命周期</h4>\n<p>通常来说，如果容器组被创建了就不会自动销毁，除非被某种行为触发，而触发此种情况可能是人为，或者复制控制器所为。唯一例外的是容器组由 succeeded 状态成功退出，或者在一定时间内重试多次依然失败。</p>\n<p>如果某个节点死掉或者不能连接，那么节点控制器将会标记其上的容器组的状态为 failed。</p>\n<p>举例如下：</p>\n<ul>\n<li>\n<p>容器组状态 running，有 1 容器，容器正常退出</p>\n<ul>\n<li>记录完成事件</li>\n<li>\n<p>如果重启策略为：</p>\n<ul>\n<li>始终：重启容器，容器组保持 running</li>\n<li>失败时：容器组变为 succeeded</li>\n<li>从不：容器组变为 succeeded</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>容器组状态 running，有 1 容器，容器异常退出</p>\n<ul>\n<li>记录失败事件</li>\n<li>\n<p>如果重启策略为：</p>\n<ul>\n<li>始终：重启容器，容器组保持 running</li>\n<li>失败时：重启容器，容器组保持 running</li>\n<li>从不：容器组变为 failed</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>容器组状态 running，有 2 容器，有 1 容器异常退出</p>\n<ul>\n<li>记录失败事件</li>\n<li>\n<p>如果重启策略为：</p>\n<ul>\n<li>始终：重启容器，容器组保持 running</li>\n<li>失败时：重启容器，容器组保持 running</li>\n<li>从不：容器组保持 running</li>\n</ul>\n</li>\n<li>\n<p>当有 2 容器退出</p>\n<ul>\n<li>记录失败事件</li>\n<li>如果重启策略为：</li>\n<li>始终：重启容器，容器组保持 running</li>\n<li>失败时：重启容器，容器组保持 running</li>\n<li>从不：容器组变为 failed</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>容器组状态 running，容器内存不足</p>\n<ul>\n<li>标记容器错误中断</li>\n<li>记录内存不足事件</li>\n<li>\n<p>如果重启策略为：</p>\n<ul>\n<li>始终：重启容器，容器组保持 running</li>\n<li>失败时：重启容器，容器组保持 running</li>\n<li>从不：记录错误事件，容器组变为 failed</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>容器组状态 running，一块磁盘死掉</p>\n<ul>\n<li>杀死所有容器</li>\n<li>记录事件</li>\n<li>容器组变为 failed</li>\n<li>如果容器组运行在一个控制器下，容器组将会在其他地方重新创建</li>\n</ul>\n</li>\n<li>\n<p>容器组状态 running，对应的节点段溢出</p>\n<ul>\n<li>节点控制器等到超时</li>\n<li>节点控制器标记容器组 failed</li>\n<li>如果容器组运行在一个控制器下，容器组将会在其他地方重新创建</li>\n</ul>\n</li>\n</ul>\n<h3 id="replication-controllers"><a href="#replication-controllers" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Replication Controllers</h3>\n<h3 id="服务"><a href="#%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>服务</h3>\n<h3 id="卷"><a href="#%E5%8D%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>卷</h3>\n<h3 id="标签"><a href="#%E6%A0%87%E7%AD%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>标签</h3>\n<h3 id="接口权限"><a href="#%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>接口权限</h3>\n<h3 id="web-界面"><a href="#web-%E7%95%8C%E9%9D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>web 界面</h3>\n<h3 id="命令行操作"><a href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>命令行操作</h3>\n<h2 id="基本架构"><a href="#%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本架构</h2>\n<p>任何优秀的项目都离不开优秀的架构设计。本小节将介绍 Kubernetes 在架构方面的设计考虑。</p>\n<h3 id="基本考虑"><a href="#%E5%9F%BA%E6%9C%AC%E8%80%83%E8%99%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本考虑</h3>\n<p>如果让我们自己从头设计一套容器管理平台，有如下几个方面是很容易想到的：</p>\n<ul>\n<li>分布式架构，保证扩展性；</li>\n<li>逻辑集中式的控制平面 + 物理分布式的运行平面；</li>\n<li>一套资源调度系统，管理哪个容器该分配到哪个节点上；</li>\n<li>一套对容器内服务进行抽象和 HA 的系统。</li>\n</ul>\n<h3 id="运行原理"><a href="#%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行原理</h3>\n<p>下面这张图完整展示了 Kubernetes 的运行原理。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-ed8e3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 82.67736274755578%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAC4UlEQVQ4y42Uy05TURSGdwvWBJo4cWhECZBooi/gSAdoQuLYqT6FM57AARMMjVPHJAQmJISJRDgoLeV+v5VLaSm3trQ9N79/E0ghxLCSlb332nv961+Xc4xB1tbWIhsbG43r6+uNrFHZPM8z6XTa1Mvy8rJde3p6HuRyudT+/n63zmEYRsfGxi4fraysmNtSLpdvnMfHx83BwYE5OjqK7OzsCEAkupaWll7p/vj4OHJycmLOz88vHVZXV5/B7CvaDcuPVwxnZ2fN4OCguUscx/kyMTHRcecljo9I7w0P3i4uLrbLVq1Wzfz8vL0fGBiIwLAZZvHt7e347u5u8+joaAs+jyHQBKG4FNZxs7e313A7QCaTaSCF6NzcnL2bnp5+AmCGuhUqlUrO9/085+zZ2VmOTPIEz9dqNbua+whpt1FXF4CwVCqFOIfUK8QWAh7Wi6FT74n2nvp9SKVSXbDozOfznTDsmpqaei3AycnJFoBKNEVA/unpqY+PzxufhvjZbNbatDeKIAUkJNXw4uJC50DRAPghwIWFheewK1KesFAoeDh7AHoAeJTAg5QHuAewZw4PDwMeBwAGOASABMVisSZA13W/CZDmtCpFnG2q2MOr9CWy4WPVkGIgUNADGAZECxRZD2Hxl0CfacpTGPzGMY1TErAUq9X6PW9SGlJ3a2vLBdCFnQu4i6MLUFkReRRubm42UccGhvphb29vTEoZYkNDQ7G+vr5YIpGw2t/fHzO3u1QvMHUAeceMtVK7XwT8w2g4pOywdwho95TCkV2q7zMBuwT1SDAGV/qdy5+AfVINYduhumlMmDsbjPvr/Y2xuYdEh4eHXxCwrMapw+qoOquOw9SjTLbjlMozGKP6W9ylFNx+KSMjIy8BqgKi7gpUDbsebu0BtJ03DLNJJpM3lIE2MzMzhu80IkDWNpwrGmxNhRwFotlV6jAMFUwB/psrzbCA/ATaSbMiNjgFcrxLxfwfA8qR2IgatHIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 21 14 00 05" title="" data-src="/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-fee1c.png" data-srcset="/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-a67b7.png 200w,\n/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-0b187.png 400w,\n/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-fee1c.png 800w,\n/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-b1a91.png 1200w,\n/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-95179.png 1600w,\n/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-5d5ba.png 2400w,\n/static/2022-07-21-14-00-05-f49072d59e00b9dd169b21a1f7c9363c-ed8e3.png 3989w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>可见，Kubernetes 首先是一套分布式系统，由多个节点组成，节点分为两类：一类是属于管理平面的主节点/控制节点（Master Node）；一类是属于运行平面的工作节点（Worker Node）。</p>\n<p>显然，复杂的工作肯定都交给控制节点去做了，工作节点负责提供稳定的操作接口和能力抽象即可。</p>\n<p>从这张图上，我们没有能发现 Kubernetes 中对于控制平面的分布式实现，但是由于数据后端自身就是一套分布式的数据库 Etcd，因此可以很容易扩展到分布式实现。</p>\n<h3 id="控制平面"><a href="#%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>控制平面</h3>\n<h4 id="主节点服务"><a href="#%E4%B8%BB%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主节点服务</h4>\n<p>主节点上需要提供如下的管理服务：</p>\n<ul>\n<li>apiserver 是整个系统的对外接口，提供一套 RESTful 的 Kubernetes API，供客户端和其它组件调用；</li>\n<li>scheduler 负责对资源进行调度，分配某个 pod 到某个节点上。是 pluggable 的，意味着很容易选择其它实现方式；</li>\n<li>controller-manager 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。</li>\n</ul>\n<h4 id="etcd"><a href="#etcd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Etcd</h4>\n<p>这里 Etcd 即作为数据后端，又作为消息中间件。</p>\n<p>通过 Etcd 来存储所有的主节点上的状态信息，很容易实现主节点的分布式扩展。</p>\n<p>组件可以自动的去侦测 Etcd 中的数值变化来获得通知，并且获得更新后的数据来执行相应的操作。</p>\n<h3 id="工作节点"><a href="#%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工作节点</h3>\n<ul>\n<li>kubelet 是工作节点执行操作的 agent，负责具体的容器生命周期管理，根据从数据库中获取的信息来管理容器，并上报 pod 运行状态等；</li>\n<li>kube-proxy 是一个简单的网络访问代理，同时也是一个 Load Balancer。它负责将访问到某个服务的请求具体分配给工作节点上的 Pod（同一类标签）。</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-21-14-00-36-02375bb48eb8832038944c257631be5a-80d40.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 640px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 77.1875%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADY0lEQVQ4y2MonHnQpnTZpf9Va2//r914/3/Fymv/q9bf/V+05PzhgoVn5lRvuPe/Yu2tP+Wrb/wvXnbxD5D9P2/+iVYg+yGIXbnuzr+ylVf/lwDNKF568T+DUu1s5czFZ18Vb7j3JnvZxVeF6++8bN7/8X/p8ssnMqbunV+/7RlI02+ghn91W5/+a9777n/GtL3d+QtOPa3b+uR/yfLL/yuBjmnc+Qqo7vZ/hl1zTk5cMe/U4ZULzhxeNf/M4XVLLh7qXHwh0ia+3NnILcy3YftTq4Di/lDX5Jrkmo33LIuWnHVUM3f1jW5eZle64qpN7pyjtkCXWQN9YJM5fZ8dw/X1D/9fXH4dhP9dXnnz//1Nz/6enrxXlwECOBgQgBNKcwExPxAzAzEjkjp2MKshs12zLLnBpDSpzqwyrdkkI6LQTExURpeTn1vr////LN4pjnLOkVaywXkekv4ZLtJGzgYyyvqq3Hyi8jySKjo8UmoGXIIS8gLCMsp8weXTmGE2iwGxFBCLwFw1cU9GxdbXTf+nH835v+hyyf/5F4r+zT1b+H/rm6b/884VhoDUAC1kwADetv7MtoYOrJKi0jwiAqL8Ztb6PCDx7m0pXosvl66df6541oyjeSu7t6TumHe2eP6iy6Uru7YkW4LUaJnLsUMdxMaABUgAsSIQK7BzsqlD+UxQORkgZoGyRYGeUOTm4xAEsnmBWBqIBbAZCPI/s4KCPAvMoK4JraqXr1zacPrMqZ3HTx7L2Xdgb45PmLMIA6lAXl6B6caNG7vfvn37//v37/+fPHkCxv/+/ft///69g6dPn45Ys2YNKKYZvLy8GHEaNG3aNBiT8dq1a8sfPXr4GGjAuxfPn/8Hsv8D6S8/f/78//Lly/8HDx50hEYMI17XnTp7EYV/+sZH8WUr1pbOmLMkpK5rgcyaDTuc5s2bpwmUYuXh4WFjYmJigaZBTINfvHjBkGgLYffVJbLtmZdmfHZFsk55tKrlhCJrm74SV+fcUE1raMwKMTIyCEEjRhxkAYaBpaWlDCv7YsE2tRZ6yb480vD14b7a/+fXF/8/targz8sjjf8f7a97uXdJGTfREdJZ4g02MD/OVnbX3PRv+xZk/t8+K/X/pmlJ/w8uyvq/eXrym5oMF3BaTQo2w/AmALXvklkCjk1AAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 21 14 00 36" title="" data-src="/static/2022-07-21-14-00-36-02375bb48eb8832038944c257631be5a-80d40.png" data-srcset="/static/2022-07-21-14-00-36-02375bb48eb8832038944c257631be5a-5da91.png 200w,\n/static/2022-07-21-14-00-36-02375bb48eb8832038944c257631be5a-08121.png 400w,\n/static/2022-07-21-14-00-36-02375bb48eb8832038944c257631be5a-80d40.png 640w" data-sizes="(max-width: 640px) 100vw, 640px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="部署-kubernetes"><a href="#%E9%83%A8%E7%BD%B2-kubernetes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署 Kubernetes</h2>\n<p>目前，Kubernetes 支持在多种环境下使用，包括本地主机（Ubuntu、Debian、CentOS、Fedora 等）、云服务（腾讯云、阿里云、百度云等）。</p>\n<p>你可以使用以下几种方式部署 Kubernetes：</p>\n<ul>\n<li>kubeadm</li>\n<li>docker-desktop</li>\n<li>k3s</li>\n</ul>\n<p>接下来的小节会对以上几种方式进行详细介绍。</p>\n<h3 id="使用-kubeadm-部署-kubernetescri-使用-containerd"><a href="#%E4%BD%BF%E7%94%A8-kubeadm-%E9%83%A8%E7%BD%B2-kubernetescri-%E4%BD%BF%E7%94%A8-containerd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 kubeadm 部署 kubernetes(CRI 使用 containerd)</h3>\n<p>kubeadm 提供了 kubeadm init 以及 kubeadm join 这两个命令作为快速创建 kubernetes 集群的最佳实践。</p>\n<h4 id="安装-containerd"><a href="#%E5%AE%89%E8%A3%85-containerd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装 containerd</h4>\n<p>参考 安装 Docker 一节添加 <code class="language-text">apt/yum</code> 源，之后执行如下命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24384838446094490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# debian 系\n\\$ sudo apt install containerd.io\n\n# rhel 系\n\\$ sudo yum install containerd.io`, `24384838446094490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># debian 系</span>\n$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> containerd.io\n\n<span class="token comment"># rhel 系</span>\n$ <span class="token function">sudo</span> yum <span class="token function">install</span> containerd.io</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="配置-containerd"><a href="#%E9%85%8D%E7%BD%AE-containerd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置 containerd</h4>\n<p>新建 <code class="language-text">/etc/systemd/system/cri-containerd.service</code> 文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85521177795441130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[Unit]\nDescription=containerd container runtime for kubernetes\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd --config //etc/cri-containerd/config.toml\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=infinity\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target`, `85521177795441130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">[Unit]\nDescription=containerd container runtime for kubernetes\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd --config //etc/cri-containerd/config.toml\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=infinity\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>新建 <code class="language-text">/etc/cri-containerd/config.toml</code> containerd 配置文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30308288813213790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version = 2\n# persistent data location\nroot = &quot;/var/lib/cri-containerd&quot;\n# runtime state information\nstate = &quot;/run/cri-containerd&quot;\nplugin_dir = &quot;&quot;\ndisabled_plugins = []\nrequired_plugins = []\n# set containerd\'s OOM score\noom_score = 0\n\n[grpc]\n  address = &quot;/run/cri-containerd/cri-containerd.sock&quot;\n  tcp_address = &quot;&quot;\n  tcp_tls_cert = &quot;&quot;\n  tcp_tls_key = &quot;&quot;\n  # socket uid\n  uid = 0\n  # socket gid\n  gid = 0\n  max_recv_message_size = 16777216\n  max_send_message_size = 16777216\n\n[debug]\n  address = &quot;&quot;\n  format = &quot;json&quot;\n  uid = 0\n  gid = 0\n  level = &quot;&quot;\n\n[metrics]\n  address = &quot;127.0.0.1:1338&quot;\n  grpc_histogram = false\n\n[cgroup]\n  path = &quot;&quot;\n\n[timeouts]\n  &quot;io.containerd.timeout.shim.cleanup&quot; = &quot;5s&quot;\n  &quot;io.containerd.timeout.shim.load&quot; = &quot;5s&quot;\n  &quot;io.containerd.timeout.shim.shutdown&quot; = &quot;3s&quot;\n  &quot;io.containerd.timeout.task.state&quot; = &quot;2s&quot;\n\n[plugins]\n  [plugins.&quot;io.containerd.gc.v1.scheduler&quot;]\n    pause_threshold = 0.02\n    deletion_threshold = 0\n    mutation_threshold = 100\n    schedule_delay = &quot;0s&quot;\n    startup_delay = &quot;100ms&quot;\n  [plugins.&quot;io.containerd.grpc.v1.cri&quot;]\n    disable_tcp_service = true\n    stream_server_address = &quot;127.0.0.1&quot;\n    stream_server_port = &quot;0&quot;\n    stream_idle_timeout = &quot;4h0m0s&quot;\n    enable_selinux = false\n    selinux_category_range = 1024\n    sandbox_image = &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5&quot;\n    stats_collect_period = 10\n    # systemd_cgroup = false\n    enable_tls_streaming = false\n    max_container_log_line_size = 16384\n    disable_cgroup = false\n    disable_apparmor = false\n    restrict_oom_score_adj = false\n    max_concurrent_downloads = 3\n    disable_proc_mount = false\n    unset_seccomp_profile = &quot;&quot;\n    tolerate_missing_hugetlb_controller = true\n    disable_hugetlb_controller = true\n    ignore_image_defined_volumes = false\n    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]\n      snapshotter = &quot;overlayfs&quot;\n      default_runtime_name = &quot;runc&quot;\n      no_pivot = false\n      disable_snapshot_annotations = false\n      discard_unpacked_layers = false\n      [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]\n        [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]\n          runtime_type = &quot;io.containerd.runc.v2&quot;\n          pod_annotations = []\n          container_annotations = []\n          privileged_without_host_devices = false\n          base_runtime_spec = &quot;&quot;\n          [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]\n            # SystemdCgroup enables systemd cgroups.\n            SystemdCgroup = true\n            # BinaryName is the binary name of the runc binary.\n            # BinaryName = &quot;runc&quot;\n            # BinaryName = &quot;crun&quot;\n            # NoPivotRoot disables pivot root when creating a container.\n            # NoPivotRoot = false\n\n            # NoNewKeyring disables new keyring for the container.\n            # NoNewKeyring = false\n\n            # ShimCgroup places the shim in a cgroup.\n            # ShimCgroup = &quot;&quot;\n\n            # IoUid sets the I/O\'s pipes uid.\n            # IoUid = 0\n\n            # IoGid sets the I/O\'s pipes gid.\n            # IoGid = 0\n\n            # Root is the runc root directory.\n            Root = &quot;&quot;\n\n            # CriuPath is the criu binary path.\n            # CriuPath = &quot;&quot;\n\n            # CriuImagePath is the criu image path\n            # CriuImagePath = &quot;&quot;\n\n            # CriuWorkPath is the criu work path.\n            # CriuWorkPath = &quot;&quot;\n    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]\n      bin_dir = &quot;/opt/cni/bin&quot;\n      conf_dir = &quot;/etc/cni/net.d&quot;\n      max_conf_num = 1\n      conf_template = &quot;&quot;\n    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]\n      config_path = &quot;/etc/cri-containerd/certs.d&quot;\n      [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers]\n        # Foo = [&quot;bar&quot;]\n    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption]\n      key_model = &quot;&quot;\n    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming]\n      tls_cert_file = &quot;&quot;\n      tls_key_file = &quot;&quot;\n  [plugins.&quot;io.containerd.internal.v1.opt&quot;]\n    path = &quot;/opt/cri-containerd&quot;\n  [plugins.&quot;io.containerd.internal.v1.restart&quot;]\n    interval = &quot;10s&quot;\n  [plugins.&quot;io.containerd.metadata.v1.bolt&quot;]\n    content_sharing_policy = &quot;shared&quot;\n  [plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]\n    no_prometheus = false\n  [plugins.&quot;io.containerd.runtime.v2.task&quot;]\n    platforms = [&quot;linux/amd64&quot;]\n  [plugins.&quot;io.containerd.service.v1.diff-service&quot;]\n    default = [&quot;walking&quot;]\n  [plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;]\n    root_path = &quot;&quot;\n    pool_name = &quot;&quot;\n    base_image_size = &quot;&quot;\n    async_remove = false`, `30308288813213790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="toml"\n              >\n                <span class="gatsby-code-button-language">toml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="toml"><pre style="counter-reset: linenumber NaN" class="language-toml line-numbers"><code class="language-toml"><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token number">2</span>\n<span class="token comment"># persistent data location</span>\n<span class="token key property">root</span> <span class="token punctuation">=</span> <span class="token string">"/var/lib/cri-containerd"</span>\n<span class="token comment"># runtime state information</span>\n<span class="token key property">state</span> <span class="token punctuation">=</span> <span class="token string">"/run/cri-containerd"</span>\n<span class="token key property">plugin_dir</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n<span class="token key property">disabled_plugins</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token key property">required_plugins</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token comment"># set containerd\'s OOM score</span>\n<span class="token key property">oom_score</span> <span class="token punctuation">=</span> <span class="token number">0</span>\n\n<span class="token punctuation">[</span><span class="token table class-name">grpc</span><span class="token punctuation">]</span>\n  <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">"/run/cri-containerd/cri-containerd.sock"</span>\n  <span class="token key property">tcp_address</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n  <span class="token key property">tcp_tls_cert</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n  <span class="token key property">tcp_tls_key</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n  <span class="token comment"># socket uid</span>\n  <span class="token key property">uid</span> <span class="token punctuation">=</span> <span class="token number">0</span>\n  <span class="token comment"># socket gid</span>\n  <span class="token key property">gid</span> <span class="token punctuation">=</span> <span class="token number">0</span>\n  <span class="token key property">max_recv_message_size</span> <span class="token punctuation">=</span> <span class="token number">16777216</span>\n  <span class="token key property">max_send_message_size</span> <span class="token punctuation">=</span> <span class="token number">16777216</span>\n\n<span class="token punctuation">[</span><span class="token table class-name">debug</span><span class="token punctuation">]</span>\n  <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n  <span class="token key property">format</span> <span class="token punctuation">=</span> <span class="token string">"json"</span>\n  <span class="token key property">uid</span> <span class="token punctuation">=</span> <span class="token number">0</span>\n  <span class="token key property">gid</span> <span class="token punctuation">=</span> <span class="token number">0</span>\n  <span class="token key property">level</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n\n<span class="token punctuation">[</span><span class="token table class-name">metrics</span><span class="token punctuation">]</span>\n  <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">"127.0.0.1:1338"</span>\n  <span class="token key property">grpc_histogram</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n\n<span class="token punctuation">[</span><span class="token table class-name">cgroup</span><span class="token punctuation">]</span>\n  <span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n\n<span class="token punctuation">[</span><span class="token table class-name">timeouts</span><span class="token punctuation">]</span>\n  <span class="token key property">"io.containerd.timeout.shim.cleanup"</span> <span class="token punctuation">=</span> <span class="token string">"5s"</span>\n  <span class="token key property">"io.containerd.timeout.shim.load"</span> <span class="token punctuation">=</span> <span class="token string">"5s"</span>\n  <span class="token key property">"io.containerd.timeout.shim.shutdown"</span> <span class="token punctuation">=</span> <span class="token string">"3s"</span>\n  <span class="token key property">"io.containerd.timeout.task.state"</span> <span class="token punctuation">=</span> <span class="token string">"2s"</span>\n\n<span class="token punctuation">[</span><span class="token table class-name">plugins</span><span class="token punctuation">]</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.gc.v1.scheduler"</span><span class="token punctuation">]</span>\n    <span class="token key property">pause_threshold</span> <span class="token punctuation">=</span> <span class="token number">0.02</span>\n    <span class="token key property">deletion_threshold</span> <span class="token punctuation">=</span> <span class="token number">0</span>\n    <span class="token key property">mutation_threshold</span> <span class="token punctuation">=</span> <span class="token number">100</span>\n    <span class="token key property">schedule_delay</span> <span class="token punctuation">=</span> <span class="token string">"0s"</span>\n    <span class="token key property">startup_delay</span> <span class="token punctuation">=</span> <span class="token string">"100ms"</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri"</span><span class="token punctuation">]</span>\n    <span class="token key property">disable_tcp_service</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>\n    <span class="token key property">stream_server_address</span> <span class="token punctuation">=</span> <span class="token string">"127.0.0.1"</span>\n    <span class="token key property">stream_server_port</span> <span class="token punctuation">=</span> <span class="token string">"0"</span>\n    <span class="token key property">stream_idle_timeout</span> <span class="token punctuation">=</span> <span class="token string">"4h0m0s"</span>\n    <span class="token key property">enable_selinux</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n    <span class="token key property">selinux_category_range</span> <span class="token punctuation">=</span> <span class="token number">1024</span>\n    <span class="token key property">sandbox_image</span> <span class="token punctuation">=</span> <span class="token string">"registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5"</span>\n    <span class="token key property">stats_collect_period</span> <span class="token punctuation">=</span> <span class="token number">10</span>\n    <span class="token comment"># systemd_cgroup = false</span>\n    <span class="token key property">enable_tls_streaming</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n    <span class="token key property">max_container_log_line_size</span> <span class="token punctuation">=</span> <span class="token number">16384</span>\n    <span class="token key property">disable_cgroup</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n    <span class="token key property">disable_apparmor</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n    <span class="token key property">restrict_oom_score_adj</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n    <span class="token key property">max_concurrent_downloads</span> <span class="token punctuation">=</span> <span class="token number">3</span>\n    <span class="token key property">disable_proc_mount</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n    <span class="token key property">unset_seccomp_profile</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n    <span class="token key property">tolerate_missing_hugetlb_controller</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>\n    <span class="token key property">disable_hugetlb_controller</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>\n    <span class="token key property">ignore_image_defined_volumes</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n    <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".containerd</span><span class="token punctuation">]</span>\n      <span class="token key property">snapshotter</span> <span class="token punctuation">=</span> <span class="token string">"overlayfs"</span>\n      <span class="token key property">default_runtime_name</span> <span class="token punctuation">=</span> <span class="token string">"runc"</span>\n      <span class="token key property">no_pivot</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n      <span class="token key property">disable_snapshot_annotations</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n      <span class="token key property">discard_unpacked_layers</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n      <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".containerd.runtimes</span><span class="token punctuation">]</span>\n        <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc</span><span class="token punctuation">]</span>\n          <span class="token key property">runtime_type</span> <span class="token punctuation">=</span> <span class="token string">"io.containerd.runc.v2"</span>\n          <span class="token key property">pod_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n          <span class="token key property">container_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n          <span class="token key property">privileged_without_host_devices</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n          <span class="token key property">base_runtime_spec</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n          <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options</span><span class="token punctuation">]</span>\n            <span class="token comment"># SystemdCgroup enables systemd cgroups.</span>\n            <span class="token key property">SystemdCgroup</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>\n            <span class="token comment"># BinaryName is the binary name of the runc binary.</span>\n            <span class="token comment"># BinaryName = "runc"</span>\n            <span class="token comment"># BinaryName = "crun"</span>\n            <span class="token comment"># NoPivotRoot disables pivot root when creating a container.</span>\n            <span class="token comment"># NoPivotRoot = false</span>\n\n            <span class="token comment"># NoNewKeyring disables new keyring for the container.</span>\n            <span class="token comment"># NoNewKeyring = false</span>\n\n            <span class="token comment"># ShimCgroup places the shim in a cgroup.</span>\n            <span class="token comment"># ShimCgroup = ""</span>\n\n            <span class="token comment"># IoUid sets the I/O\'s pipes uid.</span>\n            <span class="token comment"># IoUid = 0</span>\n\n            <span class="token comment"># IoGid sets the I/O\'s pipes gid.</span>\n            <span class="token comment"># IoGid = 0</span>\n\n            <span class="token comment"># Root is the runc root directory.</span>\n            <span class="token key property">Root</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n\n            <span class="token comment"># CriuPath is the criu binary path.</span>\n            <span class="token comment"># CriuPath = ""</span>\n\n            <span class="token comment"># CriuImagePath is the criu image path</span>\n            <span class="token comment"># CriuImagePath = ""</span>\n\n            <span class="token comment"># CriuWorkPath is the criu work path.</span>\n            <span class="token comment"># CriuWorkPath = ""</span>\n    <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".cni</span><span class="token punctuation">]</span>\n      <span class="token key property">bin_dir</span> <span class="token punctuation">=</span> <span class="token string">"/opt/cni/bin"</span>\n      <span class="token key property">conf_dir</span> <span class="token punctuation">=</span> <span class="token string">"/etc/cni/net.d"</span>\n      <span class="token key property">max_conf_num</span> <span class="token punctuation">=</span> <span class="token number">1</span>\n      <span class="token key property">conf_template</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n    <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".registry</span><span class="token punctuation">]</span>\n      <span class="token key property">config_path</span> <span class="token punctuation">=</span> <span class="token string">"/etc/cri-containerd/certs.d"</span>\n      <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".registry.headers</span><span class="token punctuation">]</span>\n        <span class="token comment"># Foo = ["bar"]</span>\n    <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".image_decryption</span><span class="token punctuation">]</span>\n      <span class="token key property">key_model</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n    <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.grpc.v1.cri".x509_key_pair_streaming</span><span class="token punctuation">]</span>\n      <span class="token key property">tls_cert_file</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n      <span class="token key property">tls_key_file</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.internal.v1.opt"</span><span class="token punctuation">]</span>\n    <span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">"/opt/cri-containerd"</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.internal.v1.restart"</span><span class="token punctuation">]</span>\n    <span class="token key property">interval</span> <span class="token punctuation">=</span> <span class="token string">"10s"</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.metadata.v1.bolt"</span><span class="token punctuation">]</span>\n    <span class="token key property">content_sharing_policy</span> <span class="token punctuation">=</span> <span class="token string">"shared"</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.monitor.v1.cgroups"</span><span class="token punctuation">]</span>\n    <span class="token key property">no_prometheus</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.runtime.v2.task"</span><span class="token punctuation">]</span>\n    <span class="token key property">platforms</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"linux/amd64"</span><span class="token punctuation">]</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.service.v1.diff-service"</span><span class="token punctuation">]</span>\n    <span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"walking"</span><span class="token punctuation">]</span>\n  <span class="token punctuation">[</span><span class="token table class-name">plugins."io.containerd.snapshotter.v1.devmapper"</span><span class="token punctuation">]</span>\n    <span class="token key property">root_path</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n    <span class="token key property">pool_name</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n    <span class="token key property">base_image_size</span> <span class="token punctuation">=</span> <span class="token string">""</span>\n    <span class="token key property">async_remove</span> <span class="token punctuation">=</span> <span class="token boolean">false</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="安装-kubelet-kubeadm-kubectl-cri-tools-kubernetes-cni"><a href="#%E5%AE%89%E8%A3%85-kubelet-kubeadm-kubectl-cri-tools-kubernetes-cni" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装 kubelet kubeadm kubectl cri-tools kubernetes-cni</h4>\n<h5 id="ubuntudebian"><a href="#ubuntudebian" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ubuntu/Debian</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16752513797912760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ apt-get update && apt-get install -y apt-transport-https\n\\$ curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -\n\n\\$ cat <<EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n\n\\$ apt-get update\n\\$ apt-get install -y kubelet kubeadm kubectl`, `16752513797912760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y apt-transport-https\n$ <span class="token function">curl</span> https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> -\n\n$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n\n$ <span class="token function">apt-get</span> update\n$ <span class="token function">apt-get</span> <span class="token function">install</span> -y kubelet kubeadm kubectl</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="centosfedora"><a href="#centosfedora" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CentOS/Fedora</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37141853579896210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\n\\$ sudo yum install -y kubelet kubeadm kubectl`, `37141853579896210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/yum.repos.d/kubernetes.repo\n<span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span>\n<span class="token assign-left variable">name</span><span class="token operator">=</span>Kubernetes\n<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\n<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>\n<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>\n<span class="token assign-left variable">repo_gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>\n<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\n$ <span class="token function">sudo</span> yum <span class="token function">install</span> -y kubelet kubeadm kubectl</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="修改内核的运行参数"><a href="#%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修改内核的运行参数</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5257188167368487000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ cat <<EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward                 = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\n# 应用配置\n\\$ sysctl --system`, `5257188167368487000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  <span class="token operator">=</span> <span class="token number">1</span>\nnet.ipv4.ip_forward                 <span class="token operator">=</span> <span class="token number">1</span>\nnet.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>\nEOF\n\n<span class="token comment"># 应用配置</span>\n$ sysctl --system</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="配置-kubelet"><a href="#%E9%85%8D%E7%BD%AE-kubelet" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置 kubelet</h4>\n<h5 id="修改-kubeletservice"><a href="#%E4%BF%AE%E6%94%B9-kubeletservice" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修改 kubelet.service</h5>\n<p><code class="language-text">/etc/systemd/system/kubelet.service.d/10-proxy-ipvs.conf</code> 写入以下内容</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86804249132092150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 启用 ipvs 相关内核模块\n[Service]\nExecStartPre=-/sbin/modprobe ip_vs\nExecStartPre=-/sbin/modprobe ip_vs_rr\nExecStartPre=-/sbin/modprobe ip_vs_wrr\nExecStartPre=-/sbin/modprobe ip_vs_sh`, `86804249132092150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 启用 ipvs 相关内核模块</span>\n<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>\n<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>-/sbin/modprobe ip_vs\n<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>-/sbin/modprobe ip_vs_rr\n<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>-/sbin/modprobe ip_vs_wrr\n<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>-/sbin/modprobe ip_vs_sh</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行以下命令应用配置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78989649199371800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ sudo systemctl daemon-reload`, `78989649199371800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> systemctl daemon-reload</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="部署"><a href="#%E9%83%A8%E7%BD%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署</h4>\n<h5 id="master"><a href="#master" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>master</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92203986625174300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ systemctl enable cri-containerd\n\n\\$ systemctl start cri-containerd\n\n\\$ sudo kubeadm init \\\n      --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \\\n      --pod-network-cidr 10.244.0.0/16 \\\n      --cri-socket /run/cri-containerd/cri-containerd.sock \\\n      --v 5 \\\n      --ignore-preflight-errors=all`, `92203986625174300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ systemctl <span class="token builtin class-name">enable</span> cri-containerd\n\n$ systemctl start cri-containerd\n\n$ <span class="token function">sudo</span> kubeadm init <span class="token punctuation">\\</span>\n      --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers <span class="token punctuation">\\</span>\n      --pod-network-cidr <span class="token number">10.244</span>.0.0/16 <span class="token punctuation">\\</span>\n      --cri-socket /run/cri-containerd/cri-containerd.sock <span class="token punctuation">\\</span>\n      --v <span class="token number">5</span> <span class="token punctuation">\\</span>\n      --ignore-preflight-errors<span class="token operator">=</span>all</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">--pod-network-cidr 10.244.0.0/16</code> 参数与后续 CNI 插件有关，这里以 flannel 为例，若后续部署其他类型的网络插件请更改此参数。执行可能出现错误，例如缺少依赖包，根据提示安装即可。</p>\n<p>执行成功会输出</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45395293045547970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`...\n[addons] Applied essential addon: CoreDNS\nI1116 12:35:13.270407   86677 request.go:538] Throttling request took 181.409184ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/serviceaccounts\nI1116 12:35:13.470292   86677 request.go:538] Throttling request took 186.088112ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/configmaps\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p \\$HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf \\$HOME/.kube/config\n  sudo chown \\$(id -u):\\$(id -g) \\$HOME/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.199.100:6443 --token cz81zt.orsy9gm9v649e5lf \\\n    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe`, `45395293045547970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: CoreDNS\nI1116 <span class="token number">12</span>:35:13.270407   <span class="token number">86677</span> request.go:538<span class="token punctuation">]</span> Throttling request took <span class="token number">181</span>.409184ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/serviceaccounts\nI1116 <span class="token number">12</span>:35:13.470292   <span class="token number">86677</span> request.go:538<span class="token punctuation">]</span> Throttling request took <span class="token number">186</span>.088112ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/configmaps\n<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully<span class="token operator">!</span>\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube\n  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config\n  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:\n\nkubeadm <span class="token function">join</span> <span class="token number">192.168</span>.199.100:6443 --token cz81zt.orsy9gm9v649e5lf <span class="token punctuation">\\</span>\n    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="node-工作节点"><a href="#node-%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>node 工作节点</h5>\n<p>在另一主机重复部署小节以前的步骤，安装配置好 kubelet。根据提示，加入到集群。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40417455207695530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ systemctl enable cri-containerd\n\n\\$ systemctl start cri-containerd\n\n\\$ kubeadm join 192.168.199.100:6443 \\\n    --token cz81zt.orsy9gm9v649e5lf \\\n    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe \\\n    --cri-socket /run/cri-containerd/cri-containerd.sock`, `40417455207695530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ systemctl <span class="token builtin class-name">enable</span> cri-containerd\n\n$ systemctl start cri-containerd\n\n$ kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.199.100:6443 <span class="token punctuation">\\</span>\n    --token cz81zt.orsy9gm9v649e5lf <span class="token punctuation">\\</span>\n    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe <span class="token punctuation">\\</span>\n    --cri-socket /run/cri-containerd/cri-containerd.sock</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="查看服务-2"><a href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看服务</h4>\n<p>所有服务启动后，通过 crictl 查看本地实际运行的容器。这些服务大概分为三类：主节点服务、工作节点服务和其它服务。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54727776017103725000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`CONTAINER_RUNTIME_ENDPOINT=/run/cri-containerd/cri-containerd.sock crictl ps -a`, `54727776017103725000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">CONTAINER_RUNTIME_ENDPOINT</span><span class="token operator">=</span>/run/cri-containerd/cri-containerd.sock crictl <span class="token function">ps</span> -a</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h5 id="主节点服务-1"><a href="#%E4%B8%BB%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主节点服务</h5>\n<ul>\n<li>apiserver 是整个系统的对外接口，提供 RESTful 方式供客户端和其它组件调用；</li>\n<li>scheduler 负责对资源进行调度，分配某个 pod 到某个节点上；</li>\n<li>controller-manager 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。</li>\n</ul>\n<h5 id="工作节点服务"><a href="#%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工作节点服务</h5>\n<p>proxy 为 pod 上的服务提供访问的代理。</p>\n<h5 id="其它服务"><a href="#%E5%85%B6%E5%AE%83%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其它服务</h5>\n<p>Etcd 是所有状态的存储数据库；</p>\n<h4 id="使用-3"><a href="#%E4%BD%BF%E7%94%A8-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用</h4>\n<p>将 <code class="language-text">/etc/kubernetes/admin.conf</code> 复制到 <code class="language-text">~/.kube/config</code></p>\n<p>执行 <code class="language-text">$ kubectl get all -A</code> 查看启动的服务。</p>\n<p>由于未部署 CNI 插件，CoreDNS 未正常启动。如何使用 Kubernetes，请参考后续章节。</p>\n<h4 id="部署-cni"><a href="#%E9%83%A8%E7%BD%B2-cni" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署 CNI</h4>\n<p>这里以 flannel 为例进行介绍。</p>\n<h5 id="flannel"><a href="#flannel" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>flannel</h5>\n<p>检查 podCIDR 设置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89084687653063400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ kubectl get node -o yaml | grep CIDR\n\n# 输出\n    podCIDR: 10.244.0.0/16\n    podCIDRs:`, `89084687653063400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ kubectl get node -o yaml <span class="token operator">|</span> <span class="token function">grep</span> CIDR\n\n<span class="token comment"># 输出</span>\n    podCIDR: <span class="token number">10.244</span>.0.0/16\n    podCIDRs:</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99614495291314980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.11.0/Documentation/kube-flannel.yml`, `99614495291314980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.11.0/Documentation/kube-flannel.yml</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="master-节点默认不能运行-pod"><a href="#master-%E8%8A%82%E7%82%B9%E9%BB%98%E8%AE%A4%E4%B8%8D%E8%83%BD%E8%BF%90%E8%A1%8C-pod" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>master 节点默认不能运行 pod</h4>\n<p>如果用 kubeadm 部署一个单节点集群，默认情况下无法使用，请执行以下命令解除限制</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52556306859807240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ kubectl taint nodes --all node-role.kubernetes.io/master-\n\n# 恢复默认值\n# \\$ kubectl taint nodes NODE_NAME node-role.kubernetes.io/master=true:NoSchedule`, `52556306859807240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ kubectl taint nodes --all node-role.kubernetes.io/master-\n\n<span class="token comment"># 恢复默认值</span>\n<span class="token comment"># $ kubectl taint nodes NODE_NAME node-role.kubernetes.io/master=true:NoSchedule</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="docker-desktop-启用-kubernetes"><a href="#docker-desktop-%E5%90%AF%E7%94%A8-kubernetes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Desktop 启用 Kubernetes</h3>\n<p>使用 Docker Desktop 可以很方便的启用 Kubernetes，由于国内获取不到 k8s.gcr.io 镜像，我们必须首先解决这一问题。</p>\n<h4 id="获取-k8sgcrio-镜像"><a href="#%E8%8E%B7%E5%8F%96-k8sgcrio-%E9%95%9C%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取 k8s.gcr.io 镜像</h4>\n<p>由于国内拉取不到 k8s.gcr.io 镜像，我们可以使用开源项目 <a href="https://github.com/AliyunContainerService/k8s-for-docker-desktop" target="_blank" rel="nofollow noreferrer noopener">AliyunContainerService/k8s-for-docker-desktop</a> 来获取所需的镜像。</p>\n<h4 id="启用-kubernetes"><a href="#%E5%90%AF%E7%94%A8-kubernetes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>启用 Kubernetes</h4>\n<p>在 Docker Desktop 设置页面，点击 Kubernetes，选择 Enable Kubernetes，稍等片刻，看到左下方 Kubernetes 变为 running，Kubernetes 启动成功。</p>\n<h4 id="测试-1"><a href="#%E6%B5%8B%E8%AF%95-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70625468236651990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ kubectl version`, `70625468236651990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ kubectl version</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果正常输出信息，则证明 Kubernetes 成功启动。</p>\n<h3 id="一步步部署-kubernetes-集群"><a href="#%E4%B8%80%E6%AD%A5%E6%AD%A5%E9%83%A8%E7%BD%B2-kubernetes-%E9%9B%86%E7%BE%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一步步部署 kubernetes 集群</h3>\n<p>可以参考 <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster" target="_blank" rel="nofollow noreferrer noopener">opsnull/follow-me-install-kubernetes-cluster</a> 项目一步步部署 kubernetes 集群。</p>\n<h3 id="kubernetes-dashboard"><a href="#kubernetes-dashboard" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes Dashboard</h3>\n<p><a href="https://github.com/kubernetes/dashboard" target="_blank" rel="nofollow noreferrer noopener">Kubernetes Dashboard</a> 是基于网页的 Kubernetes 用户界面。</p>\n<h4 id="部署-1"><a href="#%E9%83%A8%E7%BD%B2-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署</h4>\n<p>执行以下命令即可部署 Dashboard：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8256952390529860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml`, `8256952390529860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="访问"><a href="#%E8%AE%BF%E9%97%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>访问</h4>\n<p>通过命令行代理访问，执行以下命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72565398909724156000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ kubectl proxy`, `72565398909724156000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ kubectl proxy</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>到 <code class="language-text">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</code> 即可访问。</p>\n<h4 id="登录-1"><a href="#%E7%99%BB%E5%BD%95-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>登录</h4>\n<p>目前，Dashboard 仅支持使用 Bearer 令牌登录。下面教大家如何创建该令牌：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42899695435728780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ kubectl create sa dashboard-admin -n kube-system\n\n\\$ kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin\n\n\\$ ADMIN_SECRET=\\$(kubectl get secrets -n kube-system | grep dashboard-admin | awk \'{print \\$1}\')\n\n\\$ DASHBOARD_LOGIN_TOKEN=\\$(kubectl describe secret -n kube-system \\${ADMIN_SECRET} | grep -E \'^token\' | awk \'{print \\$2}\')\n\necho \\${DASHBOARD_LOGIN_TOKEN}`, `42899695435728780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ kubectl create sa dashboard-admin -n kube-system\n\n$ kubectl create clusterrolebinding dashboard-admin --clusterrole<span class="token operator">=</span>cluster-admin --serviceaccount<span class="token operator">=</span>kube-system:dashboard-admin\n\n$ <span class="token assign-left variable">ADMIN_SECRET</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get secrets -n kube-system <span class="token operator">|</span> <span class="token function">grep</span> dashboard-admin <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">\'{print <span class="token variable">$1</span>}\'</span><span class="token variable">)</span></span>\n\n$ <span class="token assign-left variable">DASHBOARD_LOGIN_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl describe secret -n kube-system $<span class="token punctuation">{</span>ADMIN_SECRET<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">grep</span> -E <span class="token string">\'^token\'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">\'{print <span class="token variable">$2</span>}\'</span><span class="token variable">)</span></span>\n\n<span class="token builtin class-name">echo</span> <span class="token variable">${DASHBOARD_LOGIN_TOKEN}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>将结果粘贴到登录页面，即可登录。</p>\n<h2 id="kubernetes-命令行-kubectl"><a href="#kubernetes-%E5%91%BD%E4%BB%A4%E8%A1%8C-kubectl" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes 命令行 kubectl</h2>\n<h3 id="kubectl-使用"><a href="#kubectl-%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl 使用</h3>\n<p><a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="nofollow noreferrer noopener">kubectl</a> 是 Kubernetes 自带的客户端，可以用它来直接操作 Kubernetes。</p>\n<p>使用格式有两种：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29143481952759222000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl [flags]\nkubectl [command]`, `29143481952759222000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl <span class="token punctuation">[</span>flags<span class="token punctuation">]</span>\nkubectl <span class="token punctuation">[</span>command<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h4 id="get"><a href="#get" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>get</h4>\n<p>显示一个或多个资源</p>\n<h4 id="describe"><a href="#describe" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>describe</h4>\n<p>显示资源详情</p>\n<h4 id="create"><a href="#create" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>create</h4>\n<p>从文件或标准输入创建资源</p>\n<h4 id="update"><a href="#update" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>update</h4>\n<p>从文件或标准输入更新资源</p>\n<h4 id="delete"><a href="#delete" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>delete</h4>\n<p>通过文件名、标准输入、资源名或者 label selector 删除资源</p>\n<h4 id="log"><a href="#log" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>log</h4>\n<p>输出 pod 中一个容器的日志</p>\n<h4 id="rolling-update"><a href="#rolling-update" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rolling-update</h4>\n<p>对指定的 replication controller 执行滚动升级</p>\n<h4 id="exec-1"><a href="#exec-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>exec</h4>\n<p>在容器内部执行命令</p>\n<h4 id="port-forward"><a href="#port-forward" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>port-forward</h4>\n<p>将本地端口转发到 Pod</p>\n<h4 id="proxy"><a href="#proxy" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>proxy</h4>\n<p>为 Kubernetes API server 启动代理服务器</p>\n<h4 id="run-2"><a href="#run-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>run</h4>\n<p>在集群中使用指定镜像启动容器</p>\n<h4 id="expose-2"><a href="#expose-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>expose</h4>\n<p>将 <code class="language-text">replication controller service</code> 或 pod 暴露为新的 <code class="language-text">kubernetes service</code></p>\n<h4 id="label-1"><a href="#label-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>label</h4>\n<p>更新资源的 label</p>\n<h4 id="config-1"><a href="#config-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>config</h4>\n<p>修改 kubernetes 配置文件</p>\n<h4 id="cluster-info"><a href="#cluster-info" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cluster-info</h4>\n<p>显示集群信息</p>\n<h4 id="api-versions"><a href="#api-versions" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>api-versions</h4>\n<p>以 “组/版本” 的格式输出服务端支持的 API 版本</p>\n<h4 id="version-1"><a href="#version-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>version</h4>\n<p>输出服务端和客户端的版本信息</p>\n<h4 id="help-1"><a href="#help-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>help</h4>\n<p>显示各个命令的帮助信息</p>\n<h3 id="常用命令"><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常用命令</h3>\n<p>使用以下示例集来帮助你熟悉运行常用 kubectl 操作：</p>\n<h4 id="kubectl-apply---以文件或标准输入为准应用或更新资源"><a href="#kubectl-apply---%E4%BB%A5%E6%96%87%E4%BB%B6%E6%88%96%E6%A0%87%E5%87%86%E8%BE%93%E5%85%A5%E4%B8%BA%E5%87%86%E5%BA%94%E7%94%A8%E6%88%96%E6%9B%B4%E6%96%B0%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl apply - 以文件或标准输入为准应用或更新资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9518764645326948000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 使用 example-service.yaml 中的定义创建服务。\nkubectl apply -f example-service.yaml\n\n# 使用 example-controller.yaml 中的定义创建 replication controller。\nkubectl apply -f example-controller.yaml\n\n# 使用 <directory> 路径下的任意 .yaml、.yml 或 .json 文件 创建对象。\nkubectl apply -f <directory>`, `9518764645326948000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 使用 example-service.yaml 中的定义创建服务。</span>\nkubectl apply -f example-service.yaml\n\n<span class="token comment"># 使用 example-controller.yaml 中的定义创建 replication controller。</span>\nkubectl apply -f example-controller.yaml\n\n<span class="token comment"># 使用 &lt;directory> 路径下的任意 .yaml、.yml 或 .json 文件 创建对象。</span>\nkubectl apply -f <span class="token operator">&lt;</span>directory<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="kubectl-get---列出一个或多个资源"><a href="#kubectl-get---%E5%88%97%E5%87%BA%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl get - 列出一个或多个资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47744064487841610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 以纯文本输出格式列出所有 Pod。\nkubectl get pods\n\n# 以纯文本输出格式列出所有 Pod，并包含附加信息(如节点名)。\nkubectl get pods -o wide\n\n# 以纯文本输出格式列出具有指定名称的副本控制器。提示：你可以使用别名 \'rc\' 缩短和替换 \'replicationcontroller\' 资源类型。\nkubectl get replicationcontroller <rc-name>\n\n# 以纯文本输出格式列出所有副本控制器和服务。\nkubectl get rc,services\n\n# 以纯文本输出格式列出所有守护程序集，包括未初始化的守护程序集。\nkubectl get ds --include-uninitialized\n\n# 列出在节点 server01 上运行的所有 Pod\nkubectl get pods --field-selector=spec.nodeName=server01`, `47744064487841610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 以纯文本输出格式列出所有 Pod。</span>\nkubectl get pods\n\n<span class="token comment"># 以纯文本输出格式列出所有 Pod，并包含附加信息(如节点名)。</span>\nkubectl get pods -o wide\n\n<span class="token comment"># 以纯文本输出格式列出具有指定名称的副本控制器。提示：你可以使用别名 \'rc\' 缩短和替换 \'replicationcontroller\' 资源类型。</span>\nkubectl get replicationcontroller <span class="token operator">&lt;</span>rc-name<span class="token operator">></span>\n\n<span class="token comment"># 以纯文本输出格式列出所有副本控制器和服务。</span>\nkubectl get rc,services\n\n<span class="token comment"># 以纯文本输出格式列出所有守护程序集，包括未初始化的守护程序集。</span>\nkubectl get ds --include-uninitialized\n\n<span class="token comment"># 列出在节点 server01 上运行的所有 Pod</span>\nkubectl get pods --field-selector<span class="token operator">=</span>spec.nodeName<span class="token operator">=</span>server01</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="kubectl-describe---显示一个或多个资源的详细状态，默认情况下包括未初始化的资源"><a href="#kubectl-describe---%E6%98%BE%E7%A4%BA%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E8%B5%84%E6%BA%90%E7%9A%84%E8%AF%A6%E7%BB%86%E7%8A%B6%E6%80%81%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%E5%8C%85%E6%8B%AC%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl describe - 显示一个或多个资源的详细状态，默认情况下包括未初始化的资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28982018244723663000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 显示名为 <pod-name> 的 Pod 的详细信息。\nkubectl describe nodes <node-name>\n\n# 显示名为 <pod-name> 的 Pod 的详细信息。\nkubectl describe pods/<pod-name>\n\n# 显示由名为 <rc-name> 的副本控制器管理的所有 Pod 的详细信息。\n# 记住：副本控制器创建的任何 Pod 都以副本控制器的名称为前缀。\nkubectl describe pods <rc-name>\n\n# 描述所有的 Pod\nkubectl describe pods`, `28982018244723663000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 显示名为 &lt;pod-name> 的 Pod 的详细信息。</span>\nkubectl describe nodes <span class="token operator">&lt;</span>node-name<span class="token operator">></span>\n\n<span class="token comment"># 显示名为 &lt;pod-name> 的 Pod 的详细信息。</span>\nkubectl describe pods/<span class="token operator">&lt;</span>pod-name<span class="token operator">></span>\n\n<span class="token comment"># 显示由名为 &lt;rc-name> 的副本控制器管理的所有 Pod 的详细信息。</span>\n<span class="token comment"># 记住：副本控制器创建的任何 Pod 都以副本控制器的名称为前缀。</span>\nkubectl describe pods <span class="token operator">&lt;</span>rc-name<span class="token operator">></span>\n\n<span class="token comment"># 描述所有的 Pod</span>\nkubectl describe pods</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>说明： <code class="language-text">kubectl get</code> 命令通常用于检索同一资源类别的一个或多个资源。它具有丰富的参数，允许你使用 <code class="language-text">-o</code> 或 <code class="language-text">--output</code> 参数自定义输出格式。你可以指定 <code class="language-text">-w</code> 或 <code class="language-text">--watch</code> 参数以开始监测特定对象的更新。<code class="language-text">kubectl describe</code> 命令更侧重于描述指定资源的许多相关方面。它可以调用对 API 服务器的多个 API 调用来为用户构建视图。 例如，该 <code class="language-text">kubectl describe node</code> 命令不仅检索有关节点的信息，还检索在其上运行的 Pod 的摘要，为节点生成的事件等。</p>\n</blockquote>\n<h4 id="kubectl-delete---基于文件、标准输入或通过指定标签选择器、名称、资源选择器或资源来删除资源"><a href="#kubectl-delete---%E5%9F%BA%E4%BA%8E%E6%96%87%E4%BB%B6%E3%80%81%E6%A0%87%E5%87%86%E8%BE%93%E5%85%A5%E6%88%96%E9%80%9A%E8%BF%87%E6%8C%87%E5%AE%9A%E6%A0%87%E7%AD%BE%E9%80%89%E6%8B%A9%E5%99%A8%E3%80%81%E5%90%8D%E7%A7%B0%E3%80%81%E8%B5%84%E6%BA%90%E9%80%89%E6%8B%A9%E5%99%A8%E6%88%96%E8%B5%84%E6%BA%90%E6%9D%A5%E5%88%A0%E9%99%A4%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl delete - 基于文件、标准输入或通过指定标签选择器、名称、资源选择器或资源来删除资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66510840939005570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 使用 pod.yaml 文件中指定的类型和名称删除 Pod。\nkubectl delete -f pod.yaml\n\n# 删除所有带有 \'<label-key>=<label-value>\' 标签的 Pod 和服务。\nkubectl delete pods,services -l <label-key>=<label-value>\n\n# 删除所有 Pod，包括未初始化的 Pod。\nkubectl delete pods --all`, `66510840939005570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 使用 pod.yaml 文件中指定的类型和名称删除 Pod。</span>\nkubectl delete -f pod.yaml\n\n<span class="token comment"># 删除所有带有 \'&lt;label-key>=&lt;label-value>\' 标签的 Pod 和服务。</span>\nkubectl delete pods,services -l <span class="token operator">&lt;</span>label-key<span class="token operator">></span><span class="token operator">=</span><span class="token operator">&lt;</span>label-value<span class="token operator">></span>\n\n<span class="token comment"># 删除所有 Pod，包括未初始化的 Pod。</span>\nkubectl delete pods --all</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="kubectl-exec---对-pod-中的容器执行命令"><a href="#kubectl-exec---%E5%AF%B9-pod-%E4%B8%AD%E7%9A%84%E5%AE%B9%E5%99%A8%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl exec - 对 Pod 中的容器执行命令</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92620653419033510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 从 Pod <pod-name> 中获取运行 \'date\' 的输出。默认情况下，输出来自第一个容器。\nkubectl exec <pod-name> -- date\n\n# 运行输出 \'date\' 获取在 Pod <pod-name> 中容器 <container-name> 的输出。\nkubectl exec <pod-name> -c <container-name> -- date\n\n# 获取一个交互 TTY 并在 Pod <pod-name> 中运行 /bin/bash。默认情况下，输出来自第一个容器。\nkubectl exec -ti <pod-name> -- /bin/bash`, `92620653419033510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 从 Pod &lt;pod-name> 中获取运行 \'date\' 的输出。默认情况下，输出来自第一个容器。</span>\nkubectl <span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> -- <span class="token function">date</span>\n\n<span class="token comment"># 运行输出 \'date\' 获取在 Pod &lt;pod-name> 中容器 &lt;container-name> 的输出。</span>\nkubectl <span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> -c <span class="token operator">&lt;</span>container-name<span class="token operator">></span> -- <span class="token function">date</span>\n\n<span class="token comment"># 获取一个交互 TTY 并在 Pod &lt;pod-name> 中运行 /bin/bash。默认情况下，输出来自第一个容器。</span>\nkubectl <span class="token builtin class-name">exec</span> -ti <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> -- /bin/bash</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="kubectl-logs---打印-pod-中容器的日志"><a href="#kubectl-logs---%E6%89%93%E5%8D%B0-pod-%E4%B8%AD%E5%AE%B9%E5%99%A8%E7%9A%84%E6%97%A5%E5%BF%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl logs - 打印 Pod 中容器的日志</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80916788379994820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 返回 Pod <pod-name> 的日志快照。\nkubectl logs <pod-name>\n\n# 从 Pod <pod-name> 开始流式传输日志。这类似于 \'tail -f\' Linux 命令。\nkubectl logs -f <pod-name>`, `80916788379994820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 返回 Pod &lt;pod-name> 的日志快照。</span>\nkubectl logs <span class="token operator">&lt;</span>pod-name<span class="token operator">></span>\n\n<span class="token comment"># 从 Pod &lt;pod-name> 开始流式传输日志。这类似于 \'tail -f\' Linux 命令。</span>\nkubectl logs -f <span class="token operator">&lt;</span>pod-name<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="kubectl-diff---查看集群建议更新的差异"><a href="#kubectl-diff---%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E5%BB%BA%E8%AE%AE%E6%9B%B4%E6%96%B0%E7%9A%84%E5%B7%AE%E5%BC%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>kubectl diff - 查看集群建议更新的差异</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23955890791362912000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# “pod.json”中包含的差异资源。\nkubectl diff -f pod.json\n\n# 从标准输入读取的差异文件。\ncat service.yaml | kubectl diff -f -`, `23955890791362912000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># “pod.json”中包含的差异资源。</span>\nkubectl <span class="token function">diff</span> -f pod.json\n\n<span class="token comment"># 从标准输入读取的差异文件。</span>\n<span class="token function">cat</span> service.yaml <span class="token operator">|</span> kubectl <span class="token function">diff</span> -f -</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="kubectl-自动补全"><a href="#kubectl-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubectl 自动补全</h4>\n<h5 id="bash"><a href="#bash" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BASH</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49650471639902490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`source <(kubectl completion bash) # 在 bash 中设置当前 shell 的自动补全，要先安装 bash-completion 包。\necho &quot;source <(kubectl completion bash)&quot; >> ~/.bashrc # 在您的 bash shell 中永久的添加自动补全`, `49650471639902490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token builtin class-name">source</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span>kubectl completion <span class="token function">bash</span><span class="token punctuation">)</span> <span class="token comment"># 在 bash 中设置当前 shell 的自动补全，要先安装 bash-completion 包。</span>\n<span class="token builtin class-name">echo</span> <span class="token string">"source &lt;(kubectl completion bash)"</span> <span class="token operator">>></span> ~/.bashrc <span class="token comment"># 在您的 bash shell 中永久的添加自动补全</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>您还可以为 kubectl 使用一个速记别名，该别名也可以与 completion 一起使用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51967057411323620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`alias k=kubectl\ncomplete -o default -F __start_kubectl k`, `51967057411323620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">k</span><span class="token operator">=</span>kubectl\ncomplete -o default -F __start_kubectl k</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h5 id="zsh"><a href="#zsh" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ZSH</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74496408935769260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`source <(kubectl completion zsh)  # 在 zsh 中设置当前 shell 的自动补全\necho \'[[ \\$commands[kubectl] ]] && source <(kubectl completion zsh)\' >> ~/.zshrc # 在您的 zsh shell 中永久的添加自动补全`, `74496408935769260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token builtin class-name">source</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span>kubectl completion <span class="token function">zsh</span><span class="token punctuation">)</span>  <span class="token comment"># 在 zsh 中设置当前 shell 的自动补全</span>\n<span class="token builtin class-name">echo</span> <span class="token string">\'[[ <span class="token variable">$commands</span>[kubectl] ]] &amp;&amp; source &lt;(kubectl completion zsh)\'</span> <span class="token operator">>></span> ~/.zshrc <span class="token comment"># 在您的 zsh shell 中永久的添加自动补全</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h5 id="关于---all-namespaces-的一点说明"><a href="#%E5%85%B3%E4%BA%8E---all-namespaces-%E7%9A%84%E4%B8%80%E7%82%B9%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 <code class="language-text">--all-namespaces</code> 的一点说明</h5>\n<p>我们经常用到 <code class="language-text">--all-namespaces</code> 参数，你应该要知道它的简写 <code class="language-text">kubectl -A</code></p>\n<h4 id="kubectl-上下文和配置"><a href="#kubectl-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%92%8C%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubectl 上下文和配置</h4>\n<p>设置 kubectl 与哪个 Kubernetes 集群进行通信并修改配置信息。查看使用 kubeconfig 跨集群授权访问 文档获取配置文件详细信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82739495122084580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl config view # 显示合并的 kubeconfig 配置。\n\n# 同时使用多个 kubeconfig 文件并查看合并的配置\nKUBECONFIG=~/.kube/config:~/.kube/kubconfig2 kubectl config view\n\n# 获取 e2e 用户的密码\nkubectl config view -o jsonpath=\'{.users[?(@.name == &quot;e2e&quot;)].user.password}\'\n\nkubectl config view -o jsonpath=\'{.users[].name}\'    # 显示第一个用户\nkubectl config view -o jsonpath=\'{.users[*].name}\'   # 获取用户列表\nkubectl config get-contexts                          # 显示上下文列表\nkubectl config current-context                       # 展示当前所处的上下文\nkubectl config use-context my-cluster-name           # 设置默认的上下文为 my-cluster-name\n\n# 添加新的用户配置到 kubeconf 中，使用 basic auth 进行身份认证\nkubectl config set-credentials kubeuser/foo.kubernetes.com --username=kubeuser --password=kubepassword\n\n# 在指定上下文中持久性地保存名字空间，供所有后续 kubectl 命令使用\nkubectl config set-context --current --namespace=ggckad-s2\n\n# 使用特定的用户名和名字空间设置上下文\nkubectl config set-context gce --user=cluster-admin --namespace=foo \\\n  && kubectl config use-context gce\n\nkubectl config unset users.foo                       # 删除用户 foo\n\n# 设置或显示 context / namespace 的短别名\n# （仅适用于 bash 和 bash 兼容的 shell，在使用 kn 设置命名空间之前要先设置 current-context）\nalias kx=\'f() { [ &quot;\\$1&quot; ] && kubectl config use-context \\$1 || kubectl config current-context ; } ; f\'\nalias kn=\'f() { [ &quot;\\$1&quot; ] && kubectl config set-context --current --namespace \\$1 || kubectl config view --minify | grep namespace | cut -d&quot; &quot; -f6 ; } ; f\'`, `82739495122084580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl config view <span class="token comment"># 显示合并的 kubeconfig 配置。</span>\n\n<span class="token comment"># 同时使用多个 kubeconfig 文件并查看合并的配置</span>\n<span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>~/.kube/config:~/.kube/kubconfig2 kubectl config view\n\n<span class="token comment"># 获取 e2e 用户的密码</span>\nkubectl config view -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">\'{.users[?(@.name == "e2e")].user.password}\'</span>\n\nkubectl config view -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">\'{.users[].name}\'</span>    <span class="token comment"># 显示第一个用户</span>\nkubectl config view -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">\'{.users[*].name}\'</span>   <span class="token comment"># 获取用户列表</span>\nkubectl config get-contexts                          <span class="token comment"># 显示上下文列表</span>\nkubectl config current-context                       <span class="token comment"># 展示当前所处的上下文</span>\nkubectl config use-context my-cluster-name           <span class="token comment"># 设置默认的上下文为 my-cluster-name</span>\n\n<span class="token comment"># 添加新的用户配置到 kubeconf 中，使用 basic auth 进行身份认证</span>\nkubectl config set-credentials kubeuser/foo.kubernetes.com --username<span class="token operator">=</span>kubeuser --password<span class="token operator">=</span>kubepassword\n\n<span class="token comment"># 在指定上下文中持久性地保存名字空间，供所有后续 kubectl 命令使用</span>\nkubectl config set-context --current --namespace<span class="token operator">=</span>ggckad-s2\n\n<span class="token comment"># 使用特定的用户名和名字空间设置上下文</span>\nkubectl config set-context gce --user<span class="token operator">=</span>cluster-admin --namespace<span class="token operator">=</span>foo <span class="token punctuation">\\</span>\n  <span class="token operator">&amp;&amp;</span> kubectl config use-context gce\n\nkubectl config <span class="token builtin class-name">unset</span> users.foo                       <span class="token comment"># 删除用户 foo</span>\n\n<span class="token comment"># 设置或显示 context / namespace 的短别名</span>\n<span class="token comment"># （仅适用于 bash 和 bash 兼容的 shell，在使用 kn 设置命名空间之前要先设置 current-context）</span>\n<span class="token builtin class-name">alias</span> <span class="token assign-left variable">kx</span><span class="token operator">=</span><span class="token string">\'f() { [ "<span class="token variable">$1</span>" ] &amp;&amp; kubectl config use-context <span class="token variable">$1</span> || kubectl config current-context ; } ; f\'</span>\n<span class="token builtin class-name">alias</span> <span class="token assign-left variable">kn</span><span class="token operator">=</span><span class="token string">\'f() { [ "<span class="token variable">$1</span>" ] &amp;&amp; kubectl config set-context --current --namespace <span class="token variable">$1</span> || kubectl config view --minify | grep namespace | cut -d" " -f6 ; } ; f\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="kubectl-apply"><a href="#kubectl-apply" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubectl apply</h4>\n<p>apply 通过定义 Kubernetes 资源的文件来管理应用。它通过运行 kubectl apply 在集群中创建和更新资源。这是在生产中管理 Kubernetes 应用的推荐方法。 参见 <a href="https://kubectl.docs.kubernetes.io/zh/" target="_blank" rel="nofollow noreferrer noopener">Kubectl 文档</a>。</p>\n<h4 id="创建对象"><a href="#%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建对象</h4>\n<p>Kubernetes 配置可以用 YAML 或 JSON 定义。可以使用的文件扩展名有 <code class="language-text">.yaml</code>、<code class="language-text">.yml</code> 和 <code class="language-text">.json</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69391201592348615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl apply -f ./my-manifest.yaml           # 创建资源\nkubectl apply -f ./my1.yaml -f ./my2.yaml     # 使用多个文件创建\nkubectl apply -f ./dir                        # 基于目录下的所有清单文件创建资源\nkubectl apply -f https://git.io/vPieo         # 从 URL 中创建资源\nkubectl create deployment nginx --image=nginx # 启动单实例 nginx\n\n# 创建一个打印 “Hello World” 的 Job\nkubectl create job hello --image=busybox:1.28 -- echo &quot;Hello World&quot;\n\n# 创建一个打印 “Hello World” 间隔 1 分钟的 CronJob\nkubectl create cronjob hello --image=busybox:1.28 --schedule=&quot;*/1 * * * *&quot; -- echo &quot;Hello World&quot;\n\nkubectl explain pods                          # 获取 pod 清单的文档说明\n\n# 从标准输入创建多个 YAML 对象\ncat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox-sleep\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.28\n    args:\n    - sleep\n    - &quot;1000000&quot;\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox-sleep-less\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.28\n    args:\n    - sleep\n    - &quot;1000&quot;\nEOF\n\n# 创建有多个 key 的 Secret\ncat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysecret\ntype: Opaque\ndata:\n  password: \\$(echo -n &quot;s33msi4&quot; | base64 -w0)\n  username: \\$(echo -n &quot;jane&quot; | base64 -w0)\nEOF`, `69391201592348615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl apply -f ./my-manifest.yaml           <span class="token comment"># 创建资源</span>\nkubectl apply -f ./my1.yaml -f ./my2.yaml     <span class="token comment"># 使用多个文件创建</span>\nkubectl apply -f ./dir                        <span class="token comment"># 基于目录下的所有清单文件创建资源</span>\nkubectl apply -f https://git.io/vPieo         <span class="token comment"># 从 URL 中创建资源</span>\nkubectl create deployment nginx --image<span class="token operator">=</span>nginx <span class="token comment"># 启动单实例 nginx</span>\n\n<span class="token comment"># 创建一个打印 “Hello World” 的 Job</span>\nkubectl create job hello --image<span class="token operator">=</span>busybox:1.28 -- <span class="token builtin class-name">echo</span> <span class="token string">"Hello World"</span>\n\n<span class="token comment"># 创建一个打印 “Hello World” 间隔 1 分钟的 CronJob</span>\nkubectl create cronjob hello --image<span class="token operator">=</span>busybox:1.28 --schedule<span class="token operator">=</span><span class="token string">"*/1 * * * *"</span> -- <span class="token builtin class-name">echo</span> <span class="token string">"Hello World"</span>\n\nkubectl explain pods                          <span class="token comment"># 获取 pod 清单的文档说明</span>\n\n<span class="token comment"># 从标准输入创建多个 YAML 对象</span>\n<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">|</span> kubectl apply -f -\napiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox-sleep\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.28\n    args:\n    - <span class="token function">sleep</span>\n    - <span class="token string">"1000000"</span>\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox-sleep-less\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.28\n    args:\n    - <span class="token function">sleep</span>\n    - <span class="token string">"1000"</span>\nEOF\n\n<span class="token comment"># 创建有多个 key 的 Secret</span>\n<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">|</span> kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysecret\ntype: Opaque\ndata:\n  password: <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n <span class="token string">"s33msi4"</span> <span class="token operator">|</span> base64 -w0<span class="token variable">)</span></span>\n  username: <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n <span class="token string">"jane"</span> <span class="token operator">|</span> base64 -w0<span class="token variable">)</span></span>\nEOF</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="查看和查找资源"><a href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E6%9F%A5%E6%89%BE%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看和查找资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36502104944978076000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# get 命令的基本输出\nkubectl get services                          # 列出当前命名空间下的所有 services\nkubectl get pods --all-namespaces             # 列出所有命名空间下的全部的 Pods\nkubectl get pods -o wide                      # 列出当前命名空间下的全部 Pods，并显示更详细的信息\nkubectl get deployment my-dep                 # 列出某个特定的 Deployment\nkubectl get pods                              # 列出当前命名空间下的全部 Pods\nkubectl get pod my-pod -o yaml                # 获取一个 pod 的 YAML\n\n# describe 命令的详细输出\nkubectl describe nodes my-node\nkubectl describe pods my-pod\n\n# 列出当前名字空间下所有 Services，按名称排序\nkubectl get services --sort-by=.metadata.name\n\n# 列出 Pods，按重启次数排序\nkubectl get pods --sort-by=\'.status.containerStatuses[0].restartCount\'\n\n# 列举所有 PV 持久卷，按容量排序\nkubectl get pv --sort-by=.spec.capacity.storage\n\n# 获取包含 app=cassandra 标签的所有 Pods 的 version 标签\nkubectl get pods --selector=app=cassandra -o \\\n  jsonpath=\'{.items[*].metadata.labels.version}\'\n\n# 检索带有 “.” 键值，例： \'ca.crt\'\nkubectl get configmap myconfig \\\n  -o jsonpath=\'{.data.ca\\.crt}\'\n\n# 检索一个 base64 编码的值，其中的键名应该包含减号而不是下划线。\nkubectl get secret my-secret --template=\'{{index .data &quot;key-name-with-dashes&quot;}}\'\n\n# 获取所有工作节点（使用选择器以排除标签名称为 \'node-role.kubernetes.io/control-plane\' 的结果）\nkubectl get node --selector=\'!node-role.kubernetes.io/control-plane\'\n\n# 获取当前命名空间中正在运行的 Pods\nkubectl get pods --field-selector=status.phase=Running\n\n# 获取全部节点的 ExternalIP 地址\nkubectl get nodes -o jsonpath=\'{.items[*].status.addresses[?(@.type==&quot;ExternalIP&quot;)].address}\'\n\n# 列出属于某个特定 RC 的 Pods 的名称\n# 在转换对于 jsonpath 过于复杂的场合，&quot;jq&quot; 命令很有用；可以在 https://stedolan.github.io/jq/ 找到它。\nsel=\\${\\$(kubectl get rc my-rc --output=json | jq -j \'.spec.selector | to_entries | .[] | &quot;\\(.key)=\\(.value),&quot;\')%?}\necho \\$(kubectl get pods --selector=\\$sel --output=jsonpath={.items..metadata.name})\n\n# 显示所有 Pods 的标签（或任何其他支持标签的 Kubernetes 对象）\nkubectl get pods --show-labels\n\n# 检查哪些节点处于就绪状态\nJSONPATH=\'{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}\' \\\n && kubectl get nodes -o jsonpath=&quot;\\$JSONPATH&quot; | grep &quot;Ready=True&quot;\n\n# 不使用外部工具来输出解码后的 Secret\nkubectl get secret my-secret -o go-template=\'{{range \\$k,\\$v := .data}}{{&quot;### &quot;}}{{\\$k}}{{&quot;\\n&quot;}}{{\\$v|base64decode}}{{&quot;\\n\\n&quot;}}{{end}}\'\n\n# 列出被一个 Pod 使用的全部 Secret\nkubectl get pods -o json | jq \'.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name\' | grep -v null | sort | uniq\n\n# 列举所有 Pods 中初始化容器的容器 ID（containerID）\n# 可用于在清理已停止的容器时避免删除初始化容器\nkubectl get pods --all-namespaces -o jsonpath=\'{range .items[*].status.initContainerStatuses[*]}{.containerID}{&quot;\\n&quot;}{end}\' | cut -d/ -f3\n\n# 列出事件（Events），按时间戳排序\nkubectl get events --sort-by=.metadata.creationTimestamp\n\n# 比较当前的集群状态和假定某清单被应用之后的集群状态\nkubectl diff -f ./my-manifest.yaml\n\n# 生成一个句点分隔的树，其中包含为节点返回的所有键\n# 在复杂的嵌套JSON结构中定位键时非常有用\nkubectl get nodes -o json | jq -c \'paths|join(&quot;.&quot;)\'\n\n# 生成一个句点分隔的树，其中包含为pod等返回的所有键\nkubectl get pods -o json | jq -c \'paths|join(&quot;.&quot;)\'\n\n# 假设你的 Pods 有默认的容器和默认的名字空间，并且支持 \'env\' 命令，可以使用以下脚本为所有 Pods 生成 ENV 变量。\n# 该脚本也可用于在所有的 Pods 里运行任何受支持的命令，而不仅仅是 \'env\'。\nfor pod in \\$(kubectl get po --output=jsonpath={.items..metadata.name}); do echo \\$pod && kubectl exec -it \\$pod -- env; done\n\n# 获取一个 Deployment 的 status 子资源\nkubectl get deployment nginx-deployment --subresource=status`, `36502104944978076000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># get 命令的基本输出</span>\nkubectl get services                          <span class="token comment"># 列出当前命名空间下的所有 services</span>\nkubectl get pods --all-namespaces             <span class="token comment"># 列出所有命名空间下的全部的 Pods</span>\nkubectl get pods -o wide                      <span class="token comment"># 列出当前命名空间下的全部 Pods，并显示更详细的信息</span>\nkubectl get deployment my-dep                 <span class="token comment"># 列出某个特定的 Deployment</span>\nkubectl get pods                              <span class="token comment"># 列出当前命名空间下的全部 Pods</span>\nkubectl get pod my-pod -o yaml                <span class="token comment"># 获取一个 pod 的 YAML</span>\n\n<span class="token comment"># describe 命令的详细输出</span>\nkubectl describe nodes my-node\nkubectl describe pods my-pod\n\n<span class="token comment"># 列出当前名字空间下所有 Services，按名称排序</span>\nkubectl get services --sort-by<span class="token operator">=</span>.metadata.name\n\n<span class="token comment"># 列出 Pods，按重启次数排序</span>\nkubectl get pods --sort-by<span class="token operator">=</span><span class="token string">\'.status.containerStatuses[0].restartCount\'</span>\n\n<span class="token comment"># 列举所有 PV 持久卷，按容量排序</span>\nkubectl get <span class="token function">pv</span> --sort-by<span class="token operator">=</span>.spec.capacity.storage\n\n<span class="token comment"># 获取包含 app=cassandra 标签的所有 Pods 的 version 标签</span>\nkubectl get pods --selector<span class="token operator">=</span>app<span class="token operator">=</span>cassandra -o <span class="token punctuation">\\</span>\n  <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">\'{.items[*].metadata.labels.version}\'</span>\n\n<span class="token comment"># 检索带有 “.” 键值，例： \'ca.crt\'</span>\nkubectl get configmap myconfig <span class="token punctuation">\\</span>\n  -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">\'{.data.ca\\.crt}\'</span>\n\n<span class="token comment"># 检索一个 base64 编码的值，其中的键名应该包含减号而不是下划线。</span>\nkubectl get secret my-secret --template<span class="token operator">=</span><span class="token string">\'{{index .data "key-name-with-dashes"}}\'</span>\n\n<span class="token comment"># 获取所有工作节点（使用选择器以排除标签名称为 \'node-role.kubernetes.io/control-plane\' 的结果）</span>\nkubectl get node --selector<span class="token operator">=</span><span class="token string">\'!node-role.kubernetes.io/control-plane\'</span>\n\n<span class="token comment"># 获取当前命名空间中正在运行的 Pods</span>\nkubectl get pods --field-selector<span class="token operator">=</span>status.phase<span class="token operator">=</span>Running\n\n<span class="token comment"># 获取全部节点的 ExternalIP 地址</span>\nkubectl get nodes -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">\'{.items[*].status.addresses[?(@.type=="ExternalIP")].address}\'</span>\n\n<span class="token comment"># 列出属于某个特定 RC 的 Pods 的名称</span>\n<span class="token comment"># 在转换对于 jsonpath 过于复杂的场合，"jq" 命令很有用；可以在 https://stedolan.github.io/jq/ 找到它。</span>\n<span class="token assign-left variable">sel</span><span class="token operator">=</span><span class="token variable">${$(kubectl get rc my-rc --output=json | jq -j \'.spec.selector | to_entries | .<span class="token punctuation">[</span><span class="token punctuation">]</span> | "\\(.key)=\\(.value)<span class="token operator">,</span>"\')<span class="token operator">%</span>?}</span>\n<span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$(</span>kubectl get pods --selector<span class="token operator">=</span>$sel --output<span class="token operator">=</span>jsonpath<span class="token operator">=</span><span class="token punctuation">{</span>.items<span class="token punctuation">..</span>metadata.name<span class="token punctuation">}</span><span class="token variable">)</span></span>\n\n<span class="token comment"># 显示所有 Pods 的标签（或任何其他支持标签的 Kubernetes 对象）</span>\nkubectl get pods --show-labels\n\n<span class="token comment"># 检查哪些节点处于就绪状态</span>\n<span class="token assign-left variable">JSONPATH</span><span class="token operator">=</span><span class="token string">\'{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}\'</span> <span class="token punctuation">\\</span>\n <span class="token operator">&amp;&amp;</span> kubectl get nodes -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$JSONPATH</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"Ready=True"</span>\n\n<span class="token comment"># 不使用外部工具来输出解码后的 Secret</span>\nkubectl get secret my-secret -o go-template<span class="token operator">=</span><span class="token string">\'{{range <span class="token variable">$k</span>,<span class="token variable">$v</span> := .data}}{{"### "}}{{<span class="token variable">$k</span>}}{{"<span class="token entity" title="\\n">\\n</span>"}}{{<span class="token variable">$v</span>|base64decode}}{{"<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>"}}{{end}}\'</span>\n\n<span class="token comment"># 列出被一个 Pod 使用的全部 Secret</span>\nkubectl get pods -o json <span class="token operator">|</span> jq <span class="token string">\'.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name\'</span> <span class="token operator">|</span> <span class="token function">grep</span> -v null <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span>\n\n<span class="token comment"># 列举所有 Pods 中初始化容器的容器 ID（containerID）</span>\n<span class="token comment"># 可用于在清理已停止的容器时避免删除初始化容器</span>\nkubectl get pods --all-namespaces -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">\'{range .items[*].status.initContainerStatuses[*]}{.containerID}{"<span class="token entity" title="\\n">\\n</span>"}{end}\'</span> <span class="token operator">|</span> <span class="token function">cut</span> -d/ -f3\n\n<span class="token comment"># 列出事件（Events），按时间戳排序</span>\nkubectl get events --sort-by<span class="token operator">=</span>.metadata.creationTimestamp\n\n<span class="token comment"># 比较当前的集群状态和假定某清单被应用之后的集群状态</span>\nkubectl <span class="token function">diff</span> -f ./my-manifest.yaml\n\n<span class="token comment"># 生成一个句点分隔的树，其中包含为节点返回的所有键</span>\n<span class="token comment"># 在复杂的嵌套JSON结构中定位键时非常有用</span>\nkubectl get nodes -o json <span class="token operator">|</span> jq -c <span class="token string">\'paths|join(".")\'</span>\n\n<span class="token comment"># 生成一个句点分隔的树，其中包含为pod等返回的所有键</span>\nkubectl get pods -o json <span class="token operator">|</span> jq -c <span class="token string">\'paths|join(".")\'</span>\n\n<span class="token comment"># 假设你的 Pods 有默认的容器和默认的名字空间，并且支持 \'env\' 命令，可以使用以下脚本为所有 Pods 生成 ENV 变量。</span>\n<span class="token comment"># 该脚本也可用于在所有的 Pods 里运行任何受支持的命令，而不仅仅是 \'env\'。</span>\n<span class="token keyword">for</span> <span class="token for-or-select variable">pod</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span>kubectl get po --output<span class="token operator">=</span>jsonpath<span class="token operator">=</span><span class="token punctuation">{</span>.items<span class="token punctuation">..</span>metadata.name<span class="token punctuation">}</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$pod</span> <span class="token operator">&amp;&amp;</span> kubectl <span class="token builtin class-name">exec</span> -it <span class="token variable">$pod</span> -- <span class="token function">env</span><span class="token punctuation">;</span> <span class="token keyword">done</span>\n\n<span class="token comment"># 获取一个 Deployment 的 status 子资源</span>\nkubectl get deployment nginx-deployment --subresource<span class="token operator">=</span>status</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="更新资源"><a href="#%E6%9B%B4%E6%96%B0%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更新资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10156027685409219000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl set image deployment/frontend www=image:v2               # 滚动更新 &quot;frontend&quot; Deployment 的 &quot;www&quot; 容器镜像\nkubectl rollout history deployment/frontend                      # 检查 Deployment 的历史记录，包括版本\nkubectl rollout undo deployment/frontend                         # 回滚到上次部署版本\nkubectl rollout undo deployment/frontend --to-revision=2         # 回滚到特定部署版本\nkubectl rollout status -w deployment/frontend                    # 监视 &quot;frontend&quot; Deployment 的滚动升级状态直到完成\nkubectl rollout restart deployment/frontend                      # 轮替重启 &quot;frontend&quot; Deployment\n\ncat pod.json | kubectl replace -f -                              # 通过传入到标准输入的 JSON 来替换 Pod\n\n# 强制替换，删除后重建资源。会导致服务不可用。\nkubectl replace --force -f ./pod.json\n\n# 为多副本的 nginx 创建服务，使用 80 端口提供服务，连接到容器的 8000 端口。\nkubectl expose rc nginx --port=80 --target-port=8000\n\n# 将某单容器 Pod 的镜像版本（标签）更新到 v4\nkubectl get pod mypod -o yaml | sed \'s/\\(image: myimage\\):.*\\$/\\1:v4/\' | kubectl replace -f -\n\nkubectl label pods my-pod new-label=awesome                      # 添加标签\nkubectl annotate pods my-pod icon-url=http://goo.gl/XXBTWq       # 添加注解\nkubectl autoscale deployment foo --min=2 --max=10                # 对 &quot;foo&quot; Deployment 自动伸缩容`, `10156027685409219000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl <span class="token builtin class-name">set</span> image deployment/frontend <span class="token assign-left variable">www</span><span class="token operator">=</span>image:v2               <span class="token comment"># 滚动更新 "frontend" Deployment 的 "www" 容器镜像</span>\nkubectl rollout <span class="token function">history</span> deployment/frontend                      <span class="token comment"># 检查 Deployment 的历史记录，包括版本</span>\nkubectl rollout undo deployment/frontend                         <span class="token comment"># 回滚到上次部署版本</span>\nkubectl rollout undo deployment/frontend --to-revision<span class="token operator">=</span><span class="token number">2</span>         <span class="token comment"># 回滚到特定部署版本</span>\nkubectl rollout status -w deployment/frontend                    <span class="token comment"># 监视 "frontend" Deployment 的滚动升级状态直到完成</span>\nkubectl rollout restart deployment/frontend                      <span class="token comment"># 轮替重启 "frontend" Deployment</span>\n\n<span class="token function">cat</span> pod.json <span class="token operator">|</span> kubectl replace -f -                              <span class="token comment"># 通过传入到标准输入的 JSON 来替换 Pod</span>\n\n<span class="token comment"># 强制替换，删除后重建资源。会导致服务不可用。</span>\nkubectl replace --force -f ./pod.json\n\n<span class="token comment"># 为多副本的 nginx 创建服务，使用 80 端口提供服务，连接到容器的 8000 端口。</span>\nkubectl expose rc nginx --port<span class="token operator">=</span><span class="token number">80</span> --target-port<span class="token operator">=</span><span class="token number">8000</span>\n\n<span class="token comment"># 将某单容器 Pod 的镜像版本（标签）更新到 v4</span>\nkubectl get pod mypod -o yaml <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">\'s/\\(image: myimage\\):.*$/<span class="token entity" title="\\1">\\1</span>:v4/\'</span> <span class="token operator">|</span> kubectl replace -f -\n\nkubectl label pods my-pod new-label<span class="token operator">=</span>awesome                      <span class="token comment"># 添加标签</span>\nkubectl annotate pods my-pod icon-url<span class="token operator">=</span>http://goo.gl/XXBTWq       <span class="token comment"># 添加注解</span>\nkubectl autoscale deployment foo --min<span class="token operator">=</span><span class="token number">2</span> --max<span class="token operator">=</span><span class="token number">10</span>                <span class="token comment"># 对 "foo" Deployment 自动伸缩容</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="部分更新资源"><a href="#%E9%83%A8%E5%88%86%E6%9B%B4%E6%96%B0%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部分更新资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57935043843712380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 部分更新某节点\nkubectl patch node k8s-node-1 -p \'{&quot;spec&quot;:{&quot;unschedulable&quot;:true}}\'\n\n# 更新容器的镜像；spec.containers[*].name 是必须的。因为它是一个合并性质的主键。\nkubectl patch pod valid-pod -p \'{&quot;spec&quot;:{&quot;containers&quot;:[{&quot;name&quot;:&quot;kubernetes-serve-hostname&quot;,&quot;image&quot;:&quot;new image&quot;}]}}\'\n\n# 使用带位置数组的 JSON patch 更新容器的镜像\nkubectl patch pod valid-pod --type=\'json\' -p=\'[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/containers/0/image&quot;, &quot;value&quot;:&quot;new image&quot;}]\'\n\n# 使用带位置数组的 JSON patch 禁用某 Deployment 的 livenessProbe\nkubectl patch deployment valid-deployment  --type json   -p=\'[{&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/livenessProbe&quot;}]\'\n\n# 在带位置数组中添加元素\nkubectl patch sa default --type=\'json\' -p=\'[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/secrets/1&quot;, &quot;value&quot;: {&quot;name&quot;: &quot;whatever&quot; } }]\'\n\n# 通过修正 scale 子资源来更新 Deployment 的副本数\nkubectl patch deployment nginx-deployment --subresource=\'scale\' --type=\'merge\' -p \'{&quot;spec&quot;:{&quot;replicas&quot;:2}}\'`, `57935043843712380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 部分更新某节点</span>\nkubectl patch node k8s-node-1 -p <span class="token string">\'{"spec":{"unschedulable":true}}\'</span>\n\n<span class="token comment"># 更新容器的镜像；spec.containers[*].name 是必须的。因为它是一个合并性质的主键。</span>\nkubectl patch pod valid-pod -p <span class="token string">\'{"spec":{"containers":[{"name":"kubernetes-serve-hostname","image":"new image"}]}}\'</span>\n\n<span class="token comment"># 使用带位置数组的 JSON patch 更新容器的镜像</span>\nkubectl patch pod valid-pod --type<span class="token operator">=</span><span class="token string">\'json\'</span> -p<span class="token operator">=</span><span class="token string">\'[{"op": "replace", "path": "/spec/containers/0/image", "value":"new image"}]\'</span>\n\n<span class="token comment"># 使用带位置数组的 JSON patch 禁用某 Deployment 的 livenessProbe</span>\nkubectl patch deployment valid-deployment  --type json   -p<span class="token operator">=</span><span class="token string">\'[{"op": "remove", "path": "/spec/template/spec/containers/0/livenessProbe"}]\'</span>\n\n<span class="token comment"># 在带位置数组中添加元素</span>\nkubectl patch sa default --type<span class="token operator">=</span><span class="token string">\'json\'</span> -p<span class="token operator">=</span><span class="token string">\'[{"op": "add", "path": "/secrets/1", "value": {"name": "whatever" } }]\'</span>\n\n<span class="token comment"># 通过修正 scale 子资源来更新 Deployment 的副本数</span>\nkubectl patch deployment nginx-deployment --subresource<span class="token operator">=</span><span class="token string">\'scale\'</span> --type<span class="token operator">=</span><span class="token string">\'merge\'</span> -p <span class="token string">\'{"spec":{"replicas":2}}\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="编辑资源"><a href="#%E7%BC%96%E8%BE%91%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑资源</h4>\n<p>使用你偏爱的编辑器编辑 API 资源。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13427736933993329000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl edit svc/docker-registry                      # 编辑名为 docker-registry 的服务\nKUBE_EDITOR=&quot;nano&quot; kubectl edit svc/docker-registry   # 使用其他编辑器`, `13427736933993329000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl edit svc/docker-registry                      <span class="token comment"># 编辑名为 docker-registry 的服务</span>\n<span class="token assign-left variable">KUBE_EDITOR</span><span class="token operator">=</span><span class="token string">"nano"</span> kubectl edit svc/docker-registry   <span class="token comment"># 使用其他编辑器</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h4 id="对资源进行伸缩"><a href="#%E5%AF%B9%E8%B5%84%E6%BA%90%E8%BF%9B%E8%A1%8C%E4%BC%B8%E7%BC%A9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对资源进行伸缩</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54438162150516466000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl scale --replicas=3 rs/foo                                 # 将名为 \'foo\' 的副本集伸缩到 3 副本\nkubectl scale --replicas=3 -f foo.yaml                            # 将在 &quot;foo.yaml&quot; 中的特定资源伸缩到 3 个副本\nkubectl scale --current-replicas=2 --replicas=3 deployment/mysql  # 如果名为 mysql 的 Deployment 的副本当前是 2，那么将它伸缩到 3\nkubectl scale --replicas=5 rc/foo rc/bar rc/baz                   # 伸缩多个副本控制器`, `54438162150516466000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl scale --replicas<span class="token operator">=</span><span class="token number">3</span> rs/foo                                 <span class="token comment"># 将名为 \'foo\' 的副本集伸缩到 3 副本</span>\nkubectl scale --replicas<span class="token operator">=</span><span class="token number">3</span> -f foo.yaml                            <span class="token comment"># 将在 "foo.yaml" 中的特定资源伸缩到 3 个副本</span>\nkubectl scale --current-replicas<span class="token operator">=</span><span class="token number">2</span> --replicas<span class="token operator">=</span><span class="token number">3</span> deployment/mysql  <span class="token comment"># 如果名为 mysql 的 Deployment 的副本当前是 2，那么将它伸缩到 3</span>\nkubectl scale --replicas<span class="token operator">=</span><span class="token number">5</span> rc/foo rc/bar rc/baz                   <span class="token comment"># 伸缩多个副本控制器</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="删除资源"><a href="#%E5%88%A0%E9%99%A4%E8%B5%84%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除资源</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83746217302148090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl delete -f ./pod.json                                              # 删除在 pod.json 中指定的类型和名称的 Pod\nkubectl delete pod,service baz foo                                        # 删除名称为 &quot;baz&quot; 和 &quot;foo&quot; 的 Pod 和服务\nkubectl delete pods,services -l name=myLabel                              # 删除包含 name=myLabel 标签的 pods 和服务\nkubectl -n my-ns delete pod,svc --all                                     # 删除在 my-ns 名字空间中全部的 Pods 和服务\n# 删除所有与 pattern1 或 pattern2 awk 模式匹配的 Pods\nkubectl get pods  -n mynamespace --no-headers=true | awk \'/pattern1|pattern2/{print \\$1}\' | xargs  kubectl delete -n mynamespace pod`, `83746217302148090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl delete -f ./pod.json                                              <span class="token comment"># 删除在 pod.json 中指定的类型和名称的 Pod</span>\nkubectl delete pod,service baz foo                                        <span class="token comment"># 删除名称为 "baz" 和 "foo" 的 Pod 和服务</span>\nkubectl delete pods,services -l <span class="token assign-left variable">name</span><span class="token operator">=</span>myLabel                              <span class="token comment"># 删除包含 name=myLabel 标签的 pods 和服务</span>\nkubectl -n my-ns delete pod,svc --all                                     <span class="token comment"># 删除在 my-ns 名字空间中全部的 Pods 和服务</span>\n<span class="token comment"># 删除所有与 pattern1 或 pattern2 awk 模式匹配的 Pods</span>\nkubectl get pods  -n mynamespace --no-headers<span class="token operator">=</span>true <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">\'/pattern1|pattern2/{print <span class="token variable">$1</span>}\'</span> <span class="token operator">|</span> <span class="token function">xargs</span>  kubectl delete -n mynamespace pod</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="与运行中的-pods-进行交互"><a href="#%E4%B8%8E%E8%BF%90%E8%A1%8C%E4%B8%AD%E7%9A%84-pods-%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>与运行中的 Pods 进行交互</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9902892178136380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl logs my-pod                                 # 获取 pod 日志（标准输出）\nkubectl logs -l name=myLabel                        # 获取含 name=myLabel 标签的 Pods 的日志（标准输出）\nkubectl logs my-pod --previous                      # 获取上个容器实例的 pod 日志（标准输出）\nkubectl logs my-pod -c my-container                 # 获取 Pod 容器的日志（标准输出, 多容器场景）\nkubectl logs -l name=myLabel -c my-container        # 获取含 name=myLabel 标签的 Pod 容器日志（标准输出, 多容器场景）\nkubectl logs my-pod -c my-container --previous      # 获取 Pod 中某容器的上个实例的日志（标准输出, 多容器场景）\nkubectl logs -f my-pod                              # 流式输出 Pod 的日志（标准输出）\nkubectl logs -f my-pod -c my-container              # 流式输出 Pod 容器的日志（标准输出, 多容器场景）\nkubectl logs -f -l name=myLabel --all-containers    # 流式输出含 name=myLabel 标签的 Pod 的所有日志（标准输出）\nkubectl run -i --tty busybox --image=busybox:1.28 -- sh  # 以交互式 Shell 运行 Pod\nkubectl run nginx --image=nginx -n mynamespace      # 在 “mynamespace” 命名空间中运行单个 nginx Pod\nkubectl run nginx --image=nginx                     # 运行 ngins Pod 并将其规约写入到名为 pod.yaml 的文件\n  --dry-run=client -o yaml > pod.yaml\n\nkubectl attach my-pod -i                            # 挂接到一个运行的容器中\nkubectl port-forward my-pod 5000:6000               # 在本地计算机上侦听端口 5000 并转发到 my-pod 上的端口 6000\nkubectl exec my-pod -- ls /                         # 在已有的 Pod 中运行命令（单容器场景）\nkubectl exec --stdin --tty my-pod -- /bin/sh        # 使用交互 shell 访问正在运行的 Pod (一个容器场景)\nkubectl exec my-pod -c my-container -- ls /         # 在已有的 Pod 中运行命令（多容器场景）\nkubectl top pod POD_NAME --containers               # 显示给定 Pod 和其中容器的监控数据\nkubectl top pod POD_NAME --sort-by=cpu              # 显示给定 Pod 的指标并且按照 \'cpu\' 或者 \'memory\' 排序`, `9902892178136380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl logs my-pod                                 <span class="token comment"># 获取 pod 日志（标准输出）</span>\nkubectl logs -l <span class="token assign-left variable">name</span><span class="token operator">=</span>myLabel                        <span class="token comment"># 获取含 name=myLabel 标签的 Pods 的日志（标准输出）</span>\nkubectl logs my-pod --previous                      <span class="token comment"># 获取上个容器实例的 pod 日志（标准输出）</span>\nkubectl logs my-pod -c my-container                 <span class="token comment"># 获取 Pod 容器的日志（标准输出, 多容器场景）</span>\nkubectl logs -l <span class="token assign-left variable">name</span><span class="token operator">=</span>myLabel -c my-container        <span class="token comment"># 获取含 name=myLabel 标签的 Pod 容器日志（标准输出, 多容器场景）</span>\nkubectl logs my-pod -c my-container --previous      <span class="token comment"># 获取 Pod 中某容器的上个实例的日志（标准输出, 多容器场景）</span>\nkubectl logs -f my-pod                              <span class="token comment"># 流式输出 Pod 的日志（标准输出）</span>\nkubectl logs -f my-pod -c my-container              <span class="token comment"># 流式输出 Pod 容器的日志（标准输出, 多容器场景）</span>\nkubectl logs -f -l <span class="token assign-left variable">name</span><span class="token operator">=</span>myLabel --all-containers    <span class="token comment"># 流式输出含 name=myLabel 标签的 Pod 的所有日志（标准输出）</span>\nkubectl run -i --tty busybox --image<span class="token operator">=</span>busybox:1.28 -- <span class="token function">sh</span>  <span class="token comment"># 以交互式 Shell 运行 Pod</span>\nkubectl run nginx --image<span class="token operator">=</span>nginx -n mynamespace      <span class="token comment"># 在 “mynamespace” 命名空间中运行单个 nginx Pod</span>\nkubectl run nginx --image<span class="token operator">=</span>nginx                     <span class="token comment"># 运行 ngins Pod 并将其规约写入到名为 pod.yaml 的文件</span>\n  --dry-run<span class="token operator">=</span>client -o yaml <span class="token operator">></span> pod.yaml\n\nkubectl attach my-pod -i                            <span class="token comment"># 挂接到一个运行的容器中</span>\nkubectl port-forward my-pod <span class="token number">5000</span>:6000               <span class="token comment"># 在本地计算机上侦听端口 5000 并转发到 my-pod 上的端口 6000</span>\nkubectl <span class="token builtin class-name">exec</span> my-pod -- <span class="token function">ls</span> /                         <span class="token comment"># 在已有的 Pod 中运行命令（单容器场景）</span>\nkubectl <span class="token builtin class-name">exec</span> --stdin --tty my-pod -- /bin/sh        <span class="token comment"># 使用交互 shell 访问正在运行的 Pod (一个容器场景)</span>\nkubectl <span class="token builtin class-name">exec</span> my-pod -c my-container -- <span class="token function">ls</span> /         <span class="token comment"># 在已有的 Pod 中运行命令（多容器场景）</span>\nkubectl <span class="token function">top</span> pod POD_NAME --containers               <span class="token comment"># 显示给定 Pod 和其中容器的监控数据</span>\nkubectl <span class="token function">top</span> pod POD_NAME --sort-by<span class="token operator">=</span>cpu              <span class="token comment"># 显示给定 Pod 的指标并且按照 \'cpu\' 或者 \'memory\' 排序</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="从容器中复制文件和目录"><a href="#%E4%BB%8E%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从容器中复制文件和目录</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84970945980491580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl cp /tmp/foo_dir my-pod:/tmp/bar_dir            # 将 /tmp/foo_dir 本地目录复制到远程当前命名空间中 Pod 中的 /tmp/bar_dir\nkubectl cp /tmp/foo my-pod:/tmp/bar -c my-container    # 将 /tmp/foo 本地文件复制到远程 Pod 中特定容器的 /tmp/bar 下\nkubectl cp /tmp/foo my-namespace/my-pod:/tmp/bar       # 将 /tmp/foo 本地文件复制到远程 “my-namespace” 命名空间内指定 Pod 中的 /tmp/bar\nkubectl cp my-namespace/my-pod:/tmp/foo /tmp/bar       # 将 /tmp/foo 从远程 Pod 复制到本地 /tmp/bar`, `84970945980491580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl <span class="token function">cp</span> /tmp/foo_dir my-pod:/tmp/bar_dir            <span class="token comment"># 将 /tmp/foo_dir 本地目录复制到远程当前命名空间中 Pod 中的 /tmp/bar_dir</span>\nkubectl <span class="token function">cp</span> /tmp/foo my-pod:/tmp/bar -c my-container    <span class="token comment"># 将 /tmp/foo 本地文件复制到远程 Pod 中特定容器的 /tmp/bar 下</span>\nkubectl <span class="token function">cp</span> /tmp/foo my-namespace/my-pod:/tmp/bar       <span class="token comment"># 将 /tmp/foo 本地文件复制到远程 “my-namespace” 命名空间内指定 Pod 中的 /tmp/bar</span>\nkubectl <span class="token function">cp</span> my-namespace/my-pod:/tmp/foo /tmp/bar       <span class="token comment"># 将 /tmp/foo 从远程 Pod 复制到本地 /tmp/bar</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>说明：<code class="language-text">kubectl cp</code> 要求容器镜像中存在 <code class="language-text">tar</code> 二进制文件。如果 <code class="language-text">tar</code> 不存在，<code class="language-text">kubectl cp</code> 将失败。对于进阶用例，例如符号链接、通配符扩展或保留文件权限，请考虑使用 <code class="language-text">kubectl exec</code>。</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38527436650849450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`tar cf - /tmp/foo | kubectl exec -i -n my-namespace my-pod -- tar xf - -C /tmp/bar  # 将 /tmp/foo 本地文件复制到远程 “my-namespace” 命名空间中 pod 中的 /tmp/bar\nkubectl exec -n my-namespace my-pod -- tar cf - /tmp/foo | tar xf - -C /tmp/bar    # 将 /tmp/foo 从远程 pod 复制到本地 /tmp/bar`, `38527436650849450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">tar</span> cf - /tmp/foo <span class="token operator">|</span> kubectl <span class="token builtin class-name">exec</span> -i -n my-namespace my-pod -- <span class="token function">tar</span> xf - -C /tmp/bar  <span class="token comment"># 将 /tmp/foo 本地文件复制到远程 “my-namespace” 命名空间中 pod 中的 /tmp/bar</span>\nkubectl <span class="token builtin class-name">exec</span> -n my-namespace my-pod -- <span class="token function">tar</span> cf - /tmp/foo <span class="token operator">|</span> <span class="token function">tar</span> xf - -C /tmp/bar    <span class="token comment"># 将 /tmp/foo 从远程 pod 复制到本地 /tmp/bar</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h4 id="与-deployments-和-services-进行交互"><a href="#%E4%B8%8E-deployments-%E5%92%8C-services-%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>与 Deployments 和 Services 进行交互</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39146994257826400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl logs deploy/my-deployment                         # 获取一个 Deployment 的 Pod 的日志（单容器例子）\nkubectl logs deploy/my-deployment -c my-container         # 获取一个 Deployment 的 Pod 的日志（多容器例子）\n\nkubectl port-forward svc/my-service 5000                  # 侦听本地端口 5000 并转发到 Service 后端端口 5000\nkubectl port-forward svc/my-service 5000:my-service-port  # 侦听本地端口 5000 并转发到名字为 <my-service-port> 的 Service 目标端口\n\nkubectl port-forward deploy/my-deployment 5000:6000       # 侦听本地端口 5000 并转发到 <my-deployment> 创建的 Pod 里的端口 6000\nkubectl exec deploy/my-deployment -- ls                   # 在 Deployment 里的第一个 Pod 的第一个容器里运行命令（单容器和多容器例子）`, `39146994257826400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl logs deploy/my-deployment                         <span class="token comment"># 获取一个 Deployment 的 Pod 的日志（单容器例子）</span>\nkubectl logs deploy/my-deployment -c my-container         <span class="token comment"># 获取一个 Deployment 的 Pod 的日志（多容器例子）</span>\n\nkubectl port-forward svc/my-service <span class="token number">5000</span>                  <span class="token comment"># 侦听本地端口 5000 并转发到 Service 后端端口 5000</span>\nkubectl port-forward svc/my-service <span class="token number">5000</span>:my-service-port  <span class="token comment"># 侦听本地端口 5000 并转发到名字为 &lt;my-service-port> 的 Service 目标端口</span>\n\nkubectl port-forward deploy/my-deployment <span class="token number">5000</span>:6000       <span class="token comment"># 侦听本地端口 5000 并转发到 &lt;my-deployment> 创建的 Pod 里的端口 6000</span>\nkubectl <span class="token builtin class-name">exec</span> deploy/my-deployment -- <span class="token function">ls</span>                   <span class="token comment"># 在 Deployment 里的第一个 Pod 的第一个容器里运行命令（单容器和多容器例子）</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="与节点和集群进行交互"><a href="#%E4%B8%8E%E8%8A%82%E7%82%B9%E5%92%8C%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>与节点和集群进行交互</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53272587293177100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl cordon my-node                                                # 标记 my-node 节点为不可调度\nkubectl drain my-node                                                 # 对 my-node 节点进行清空操作，为节点维护做准备\nkubectl uncordon my-node                                              # 标记 my-node 节点为可以调度\nkubectl top node my-node                                              # 显示给定节点的度量值\nkubectl cluster-info                                                  # 显示主控节点和服务的地址\nkubectl cluster-info dump                                             # 将当前集群状态转储到标准输出\nkubectl cluster-info dump --output-directory=/path/to/cluster-state   # 将当前集群状态输出到 /path/to/cluster-state\n\n# 如果已存在具有指定键和效果的污点，则替换其值为指定值。\nkubectl taint nodes foo dedicated=special-user:NoSchedule`, `53272587293177100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl cordon my-node                                                <span class="token comment"># 标记 my-node 节点为不可调度</span>\nkubectl drain my-node                                                 <span class="token comment"># 对 my-node 节点进行清空操作，为节点维护做准备</span>\nkubectl uncordon my-node                                              <span class="token comment"># 标记 my-node 节点为可以调度</span>\nkubectl <span class="token function">top</span> node my-node                                              <span class="token comment"># 显示给定节点的度量值</span>\nkubectl cluster-info                                                  <span class="token comment"># 显示主控节点和服务的地址</span>\nkubectl cluster-info dump                                             <span class="token comment"># 将当前集群状态转储到标准输出</span>\nkubectl cluster-info dump --output-directory<span class="token operator">=</span>/path/to/cluster-state   <span class="token comment"># 将当前集群状态输出到 /path/to/cluster-state</span>\n\n<span class="token comment"># 如果已存在具有指定键和效果的污点，则替换其值为指定值。</span>\nkubectl taint nodes foo <span class="token assign-left variable">dedicated</span><span class="token operator">=</span>special-user:NoSchedule</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="资源类型"><a href="#%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>资源类型</h5>\n<p>列出所支持的全部资源类型和它们的简称、API 组, 是否是名字空间作用域和 Kind。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86437824144586670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl api-resources`, `86437824144586670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl api-resources</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>用于探索 API 资源的其他操作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10889949442583347000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kubectl api-resources --namespaced=true      # 所有命名空间作用域的资源\nkubectl api-resources --namespaced=false     # 所有非命名空间作用域的资源\nkubectl api-resources -o name                # 用简单格式列举所有资源（仅显示资源名称）\nkubectl api-resources -o wide                # 用扩展格式列举所有资源（又称 &quot;wide&quot; 格式）\nkubectl api-resources --verbs=list,get       # 支持 &quot;list&quot; 和 &quot;get&quot; 请求动词的所有资源\nkubectl api-resources --api-group=extensions # &quot;extensions&quot; API 组中的所有资源`, `10889949442583347000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">kubectl api-resources --namespaced<span class="token operator">=</span>true      <span class="token comment"># 所有命名空间作用域的资源</span>\nkubectl api-resources --namespaced<span class="token operator">=</span>false     <span class="token comment"># 所有非命名空间作用域的资源</span>\nkubectl api-resources -o name                <span class="token comment"># 用简单格式列举所有资源（仅显示资源名称）</span>\nkubectl api-resources -o wide                <span class="token comment"># 用扩展格式列举所有资源（又称 "wide" 格式）</span>\nkubectl api-resources --verbs<span class="token operator">=</span>list,get       <span class="token comment"># 支持 "list" 和 "get" 请求动词的所有资源</span>\nkubectl api-resources --api-group<span class="token operator">=</span>extensions <span class="token comment"># "extensions" API 组中的所有资源</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="格式化输出"><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>格式化输出</h5>\n<p>要以特定格式将详细信息输出到终端窗口，将 <code class="language-text">-o</code>（或者 <code class="language-text">--output</code>）参数添加到支持的 kubectl 命令中。</p>\n<table>\n<thead>\n<tr>\n<th align="left">输出格式</th>\n<th align="left">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><code class="language-text">-o=custom-columns=&lt;spec&gt;</code></td>\n<td align="left">使用逗号分隔的自定义列来打印表格</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">-o=custom-columns-file=&lt;filename&gt;</code></td>\n<td align="left">使用 \n<code class="language-text">&lt;filename&gt;</code>\n 文件中的自定义列模板打印表格</td>\n</tr>\n<tr>\n<td align="left">-o=json</td>\n<td align="left">输出 JSON 格式的 API 对象</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">-o=jsonpath=&lt;template&gt;</code></td>\n<td align="left">打印 jsonpath 表达式中定义的字段</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">-o=jsonpath-file=&lt;filename&gt;</code></td>\n<td align="left">打印在 \n<code class="language-text">&lt;filename&gt;</code>\n 文件中定义的 jsonpath 表达式所指定的字段。</td>\n</tr>\n<tr>\n<td align="left">-o=name</td>\n<td align="left">仅打印资源名称而不打印其他内容</td>\n</tr>\n<tr>\n<td align="left">-o=wide</td>\n<td align="left">以纯文本格式输出额外信息，对于 Pod 来说，输出中包含了节点名称</td>\n</tr>\n<tr>\n<td align="left">-o=yaml</td>\n<td align="left">输出 YAML 格式的 API 对象</td>\n</tr>\n</tbody>\n</table>\n<p>使用 <code class="language-text">-o=custom-columns</code> 的示例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74948412223969690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 集群中运行着的所有镜像\nkubectl get pods -A -o=custom-columns=\'DATA:spec.containers[*].image\'\n\n# 列举 default 名字空间中运行的所有镜像，按 Pod 分组\nkubectl get pods --namespace default --output=custom-columns=&quot;NAME:.metadata.name,IMAGE:.spec.containers[*].image&quot;\n\n# 除 &quot;k8s.gcr.io/coredns:1.6.2&quot; 之外的所有镜像\nkubectl get pods -A -o=custom-columns=\'DATA:spec.containers[?(@.image!=&quot;k8s.gcr.io/coredns:1.6.2&quot;)].image\'\n\n# 输出 metadata 下面的所有字段，无论 Pod 名字为何\nkubectl get pods -A -o=custom-columns=\'DATA:metadata.*\'`, `74948412223969690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 集群中运行着的所有镜像</span>\nkubectl get pods -A -o<span class="token operator">=</span>custom-columns<span class="token operator">=</span><span class="token string">\'DATA:spec.containers[*].image\'</span>\n\n<span class="token comment"># 列举 default 名字空间中运行的所有镜像，按 Pod 分组</span>\nkubectl get pods --namespace default --output<span class="token operator">=</span>custom-columns<span class="token operator">=</span><span class="token string">"NAME:.metadata.name,IMAGE:.spec.containers[*].image"</span>\n\n<span class="token comment"># 除 "k8s.gcr.io/coredns:1.6.2" 之外的所有镜像</span>\nkubectl get pods -A -o<span class="token operator">=</span>custom-columns<span class="token operator">=</span><span class="token string">\'DATA:spec.containers[?(@.image!="k8s.gcr.io/coredns:1.6.2")].image\'</span>\n\n<span class="token comment"># 输出 metadata 下面的所有字段，无论 Pod 名字为何</span>\nkubectl get pods -A -o<span class="token operator">=</span>custom-columns<span class="token operator">=</span><span class="token string">\'DATA:metadata.*\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有关更多示例，请参看 <a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/#custom-columns" target="_blank" rel="nofollow noreferrer noopener">kubectl 参考文档</a>。</p>\n<h5 id="kubectl-日志输出详细程度和调试"><a href="#kubectl-%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E8%AF%A6%E7%BB%86%E7%A8%8B%E5%BA%A6%E5%92%8C%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubectl 日志输出详细程度和调试</h5>\n<p>Kubectl 日志输出详细程度是通过 <code class="language-text">-v</code> 或者 <code class="language-text">--v</code> 来控制的，参数后跟一个数字表示日志的级别。Kubernetes 通用的日志习惯和相关的日志级别在 <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-instrumentation/logging.md" target="_blank" rel="nofollow noreferrer noopener">这里</a> 有相应的描述。</p>\n<table>\n<thead>\n<tr>\n<th align="left">详细程度</th>\n<th align="left">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">—v=0</td>\n<td align="left">用于那些应该 始终 对运维人员可见的信息，因为这些信息一般很有用。</td>\n</tr>\n<tr>\n<td align="left">—v=1</td>\n<td align="left">如果您不想要看到冗余信息，此值是一个合理的默认日志级别。</td>\n</tr>\n<tr>\n<td align="left">—v=2</td>\n<td align="left">输出有关服务的稳定状态的信息以及重要的日志消息，这些信息可能与系统中的重大变化有关。这是建议大多数系统设置的默认日志级别。</td>\n</tr>\n<tr>\n<td align="left">—v=3</td>\n<td align="left">包含有关系统状态变化的扩展信息。</td>\n</tr>\n<tr>\n<td align="left">—v=4</td>\n<td align="left">包含调试级别的冗余信息。</td>\n</tr>\n<tr>\n<td align="left">—v=5</td>\n<td align="left">跟踪级别的详细程度。</td>\n</tr>\n<tr>\n<td align="left">—v=6</td>\n<td align="left">显示所请求的资源。</td>\n</tr>\n<tr>\n<td align="left">—v=7</td>\n<td align="left">显示 HTTP 请求头。</td>\n</tr>\n<tr>\n<td align="left">—v=8</td>\n<td align="left">显示 HTTP 请求内容。</td>\n</tr>\n<tr>\n<td align="left">—v=9</td>\n<td align="left">显示 HTTP 请求内容而且不截断内容。</td>\n</tr>\n</tbody>\n</table>\n<p>// TODO <a href="https://vuepress.mirror.docker-practice.com/security/" target="_blank" rel="nofollow noreferrer noopener">https://vuepress.mirror.docker-practice.com/security/</a></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Docker入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:164,frontmatter:{date:"2022-07-14 13:53:03",path:"/docker-introduce-learning/",tags:"后端, Docker, 读书笔记",title:"Docker入门学习",draft:null}}],length:21,tag:"后端",pagesSum:5,page:1}}}});